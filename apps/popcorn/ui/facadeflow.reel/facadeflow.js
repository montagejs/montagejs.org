var Montage=require("montage").Montage,Component=require("montage/ui/component").Component,RangeController=require("montage/core/range-controller").RangeController;exports.Facadeflow=Montage.create(Component,{didCreate:{value:function(){var e=RangeController.create();e.defineBinding("content",{"<-":"category",source:this}),this.buttonController=e,this.application.addEventListener("dataReceived",this,!1)}},selectedMovie:{value:null},_scroll:{value:null},scroll:{set:function(e){this._scroll=e,0==e%1&&this.category?(this.selectedMovie=this.category[e],this.detailsFadeIn=!0,this.detailsFadeOut=!1,this.needsDraw=!0):0!=e%1&&this.category&&(this.detailsFadeOut=!0,this.detailsFadeIn=!1,this.needsDraw=!0)},get:function(){return this._scroll}},_fadeIn:{value:!1},_fadeOut:{value:!1},latestBoxofficeMovies:{value:null},upcomingMovies:{value:null},inTheaters:{value:null},topDvdRentals:{value:null},category:{value:null},buttonController:{value:null},_switchValue:{value:null},switchValue:{set:function(e){this._switchValue=e},get:function(){return this._switchValue}},_categoryId:{value:null},categoryId:{get:function(){return this._categoryId},set:function(e){e&&(this._categoryId=e,this._changeCategory(e))}},pointInCircleAt:{value:function(e){return[Math.cos(e),Math.sin(e)]}},tangentInCircleAt:{value:function(e){return[-Math.sin(e),Math.cos(e)]}},scaleVector:{value:function(e,t){return[e[0]*t,e[1]*t]}},_changeCategory:{value:function(e){var t=this;this.detailsFadeOut=!0,this._fadeOut=!0,this.needsDraw=!0,setTimeout(function(){t.templateObjects&&t.templateObjects.flow&&(t.templateObjects.flow.scroll=0),t.category=t[e],t.selectedMovie=t.category[0],t._fadeIn=!0,t._fadeOut=!1,t.detailsFadeIn=!0,t.detailsFadeOut=!1,t.needsDraw=!0},500)}},handleDataReceived:{value:function(){this.category=this.latestBoxofficeMovies,this.selectedMovie=this.category[0],this.detailsFadeIn=!0,this._fadeIn=!0,this.needsDraw=!0}},draw:{value:function(){var e=this.templateObjects.flow,t=this.templateObjects.details;this._fadeIn&&(e.element.classList.remove("flow-fade-out"),this._fadeIn=!1),this._fadeOut&&(e.element.classList.add("flow-fade-out"),this._fadeOut=!1),this.detailsFadeIn&&(t.element.classList.remove("details-fade-out"),this.detailsFadeIn=!1),this.detailsFadeOut&&(0==t.element.classList.contains("details-fade-out")&&t.element.classList.add("details-fade-out"),this.detailsFadeOut=!1)}},enterDocument:{value:function(e){if(e){var t,a,i,n,o=[],s=480,l=.130976446,r=this.templateObjects.flow;for(n=0;8>=n;n++)i=Math.PI-n*Math.PI/8,t=this.scaleVector(this.pointInCircleAt(i),s),a=this.scaleVector(this.tangentInCircleAt(i),s*l),o.push({knotPosition:[t[0],0,-t[1]],previousHandlerPosition:[t[0]+a[0],0,-t[1]-a[1]],nextHandlerPosition:[t[0]-a[0],0,-t[1]+a[1]],previousDensity:1,nextDensity:1,rotateY:i-Math.PI/2});o[4].knotPosition[2]=-200,o[4].nextHandlerPosition[2]=-200,o[4].previousHandlerPosition[2]=-200,r.cameraPosition=[0,0,400],r.paths=[{knots:o,headOffset:4,tailOffset:4,units:{rotateY:"rad"}}]}}}});