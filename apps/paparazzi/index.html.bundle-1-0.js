montageDefine("120b0c7","ui/repetition.reel/repetition",{dependencies:["montage","ui/component","ui/template","core/logger","core/gate","core/change-notification"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=e("ui/template").Template,o=e("core/logger").logger("repetition"),u=e("core/gate").Gate,a=e("core/change-notification").ChangeNotification,f=e("core/change-notification").PropertyChangeNotification,l=r.create(Object.prototype,{_repetition:{value:null},_fakeIndex:{value:null},_unusedIndexes:{value:null},initWithRepetition:{value:function(e){return this._repetition=e,this._fakeIndex=[],this._unusedIndexes=[],this}},automaticallyDispatchPropertyChangeListener:{value:function(){return!1}},undefinedGet:{value:function(e){if(this._repetition.objects)return this._repetition.objects[this._fakeIndex.indexOf(e)]}},0:{set:function(){throw'You cannot use a two-way binding on the "objectAtCurrentIteration" or "current" property.'},get:function(){if(this._repetition.objects)return this._repetition.objects[this._fakeIndex.indexOf("0")]}},addFakeObjectAtPosition:{value:function(e){var t;return this._unusedIndexes.length>0?t=this._unusedIndexes.pop():t=String(this._fakeIndex.length),this._fakeIndex.splice(e,0,t),t}},resetFakeObjects:{value:function(){var e=this._repetition.objects;this._fakeIndex.length=0;if(e)for(var t=0,n=e.length;t<n;t++)this._fakeIndex[t]=String(t)}},removeFakeObjectAtPosition:{value:function(e){var t;return this._unusedIndexes.unshift(this._fakeIndex.splice(e,1)[0]),this._unusedIndexes[0]}},_dispatchFakePropertyChange:{value:function(e,t){var n,r;n=a.getPropertyChangeDescriptor(this,e),n&&(r=Object.create(f),r.target=this,r.propertyPath=e,r.minus=t,r.plus=this.undefinedGet(e),t!==r.plus&&n.handleChange(r))}}}),c=t.Repetition=r.create(i,{hasTemplate:{value:!1},didCreate:{value:function(){this.addPropertyChangeListener("objects",this),this._fakeObjects=Object.create(l).initWithRepetition(this)}},clonesChildComponents:{value:!0},_emptyFunction:{value:function(){}},_updateItems:{value:function(e,t,n){var r=this._fakeObjects,i,s=e?e.length:0,o=t?t.length:0,u,a,f;u=Math.max(s,o),a=Math.min(s,o),f=o-s;for(var l=0;l<a;l++)r._dispatchFakePropertyChange(r._fakeIndex[n+l],e[n+l]);if(f>0){this._expectedChildComponentsCount+=(this._iterationChildComponentsCount||1)*f,this.canDrawGate.setField("iterationLoaded",!1);for(;l<u;l++)r.addFakeObjectAtPosition(n+l),this._addItem({index:n+l,insertionIndex:n+l})}else if(f<0){var c=n+a;for(;l<u;l++)i=r.removeFakeObjectAtPosition(c),r._dispatchFakePropertyChange(i,e[l]),this._deleteItem(c)}}},handleChange:{enumerable:!1,value:function(e){"objects"===e.currentPropertyPath&&this._isComponentExpanded&&this._updateItems(e.minus,e.plus,e.index||0)}},_fakeObjects:{value:null},_hasBeenDeserialized:{value:!1,enumerable:!1},_nextDeserializedItemIx:{enumerable:!1,value:0,distinct:!0},init:{enumerable:!1,value:function(){return this._items=[],this._itemsToAppend=[],this._nextDeserializedItemIx=0,this._itemsToRemove=[],this._deletedItems=[],this}},_contentController:{value:null},contentController:{get:function(){return this._contentController},set:function(e){if(this._contentController===e)return;this._contentController&&(Object.deleteBinding(this,"objects"),Object.deleteBinding(this,"selectedIndexes")),this._contentController=e;if(this._contentController){this._bindingDescriptors&&Object.deleteBinding(this,"objects");var t,n;t={boundObject:this._contentController,boundObjectPropertyPath:"organizedObjects",oneway:!0},n={boundObject:this._contentController,boundObjectPropertyPath:"selectedIndexes"},this._hasBeenDeserialized?(Object.defineBinding(this,"objects",t),Object.defineBinding(this,"selectedIndexes",n)):(this._controllerBindingsToInstall||(this._controllerBindingsToInstall={}),this._controllerBindingsToInstall.objects=t,this._controllerBindingsToInstall.selectedIndexes=n)}}},_objects:{enumerable:!1,value:null},_mappedObjects:{enumerable:!1,value:null},objects:{dependencies:["indexMap","indexMapEnabled"],enumerable:!1,serializable:!0,get:function(){return!this.indexMap||!this.indexMapEnabled?this._objects:(this._objects&&!this._mappedObjects&&(this._mappedObjects=this.indexMap.map(function(e){return isNaN(e)?undefined:this._objects.getProperty(e)},this)),this._mappedObjects)},set:function(e){o.isDebug&&o.debug(this," set objects:",e?e.length:null,e,"same objects?",e===this._objects),this._mappedObjects=null,this._objects=e,this.contentController||(this.selectedIndexes=null)}},_isSelectionEnabled:{enumerable:!1,value:!1},isSelectionEnabled:{get:function(){return this._isSelectionEnabled},set:function(e){if(e===this._isSelectionEnabled)return;this._isSelectionEnabled=e,this._isComponentExpanded&&this._refreshSelectionTracking()}},_childLoadedCount:{enumerable:!1,value:0},_iterationChildComponentsCount:{enumerable:!1,value:null},_expectedChildComponentsCount:{enumerable:!1,value:null},_indexMap:{enumerable:!1,value:null},indexMap:{get:function(){return this._indexMap}},_indexMapEnabled:{enumerable:!1,value:!1},indexMapEnabled:{get:function(){return this._indexMapEnabled},set:function(e){if(e===this._indexMapEnabled)return;!this._indexMap&&e&&(this._indexMap=[]),this._indexMapEnabled=e,this.refreshIndexMap()}},_drawnIndexMap:{enumerable:!1,value:null},drawnIndexMap:{get:function(){return this._drawnIndexMap}},mapIndexToIndex:{value:function(e,t,n){this._indexMap||(this._indexMap=[]);if(t===this._indexMap[e]||!isNaN(t)&&this._indexMap.indexOf(t)>-1)return;this._indexMap[e]=t,this._indexMapAffectedIndexes[e]=!0,this._indexMapChanged=!0,(n||typeof n=="undefined")&&this.refreshIndexMap()}},clearIndexMap:{value:function(){this._indexMap.clear()}},refreshIndexMap:{value:function(){var e=this._mappedObjects;this._mappedObjects=null,this._isComponentExpanded&&(this._updateItems(e,this.objects,0),this.needsDraw=!0)}},_indexMapChanged:{enumerable:!1,value:!1},_indexMapAffectedIndexes:{enumerable:!1,distinct:!0,value:{}},_dirtyIndexes:{enumerable:!1,distinct:!0,value:{}},_items:{enumerable:!1,value:[],distinct:!0},_itemsToAppend:{enumerable:!1,value:[],distinct:!0},_itemsToRemove:{enumerable:!1,value:[],distinct:!0},_deletedItems:{enumerable:!1,value:[],distinct:!0},_updatingItems:{value:!1},_refreshItems:{value:function(){if(this._updatingItems)return;this._updatingItems=!0;var e=this._objects?this._objects.length:0,t=this._items.length+this._itemsToAppend.length,n,r,i=this._addItem,s=this._deleteItem;this._objects&&this.indexMap&&this._indexMapEnabled&&(e=this.indexMap.length),n=e-t,0!==n&&(this.needsDraw=!0);if(n>0){this._expectedChildComponentsCount+=(this._iterationChildComponentsCount||1)*n,this.canDrawGate.setField("iterationLoaded",!1);for(r=0;r<n;r++)i.call(this)}else if(n<0)for(r=n;r<0;r++)s.call(this);this._updatingItems=!1}},_addItems:{value:function(e,t){var n=e.length;if(this._updatingItems)return;this._updatingItems=!0,this._expectedChildComponentsCount+=(this._iterationChildComponentsCount||1)*n,this.canDrawGate.setField("iterationLoaded",!1);for(var r=0;r<n;r++)this._addItem({index:t+r,insertionIndex:t+r});this._updatingItems=!1}},_addItem:{value:function(e){var t=this,n=this._items,r,i,s,o,u=this._itemsToAppend,a,f,l,c=t.canDrawGate,h;e||(e={}),a=u.push(e)-1,o=n.length+a;if("index"in e)for(h=0;h<a;h++){var p=u[h];p.index>=e.index&&p.index++}t._canDraw=!1,s=this._iterationChildComponentsCount,this._iterationTemplate.instantiateWithComponent(this,function(){if(s===0)++t._childLoadedCount===t._expectedChildComponentsCount&&(c.setField("iterationLoaded",!0),t.needsDraw=!0);else{r=t.childComponents,f=o*t._iterationChildComponentsCount,l=f+s;for(h=f;h<l;h++)i=r[h],i.needsDraw=!0,i.loadComponentTree(function(){++t._childLoadedCount===t._expectedChildComponentsCount&&(c.setField("iterationLoaded",!0),t.needsDraw=!0)})}})}},_deleteItem:{value:function(e){var t,n=e,r,i=this.childComponents,s=this._iterationChildComponentsCount,o=this._itemsToAppend,u=o.length,a=!1,f=0;for(var l=0;l<u;l++){var c=o[l];c.index>e?c.index--:c.index<e?f++:a=c.removed=!0}if(!a){if(!(this._items.length>0))throw"BUG: _deleteItem was called on the repetition but no elements exist to be removed";n=e-f,t=this._items.splice(n,1)[0],t.removalIndex=n,this._itemsToRemove.push(t),this._removeIterationChildComponents(t.childComponentsIndex)}this.needsDraw=!0}},_removeIterationChildComponents:{value:function(e){var t=this.childComponents,n=this._iterationChildComponentsCount,r,i,s;if(n>0){r=t.splice(e,n),this._childLoadedCount-=n,this._expectedChildComponentsCount-=n;for(var o=0,u=r.length;o<u;o++)r[o].cleanupDeletedComponentTree(!0);i=this._items;for(var o=0;s=i[o];o++)s.childComponentsIndex>e&&(s.childComponentsIndex-=n);i=this._itemsToAppend;for(var o=0;s=i[o];o++)s.childComponentsIndex>e&&(s.childComponentsIndex-=n)}else this._childLoadedCount--,this._expectedChildComponentsCount--}},_iterationTemplate:{enumerable:!1,value:null},expandComponent:{value:function(e){this._updatingItems||this._setupIterationTemplate(),this._isComponentExpanded=!0,e&&e()}},templateDidDeserializeObject:{value:null},_setupIterationTemplate:{value:function(){var e=this._element,t=this.childComponents,n;this.setupIterationSerialization(),this.setupIterationDeserialization(),this._iterationChildComponentsCount=t.length,this._iterationChildCount=e.childNodes.length,this._iterationChildElementCount=e.children.length,this._iterationChildComponentsCount>0?(this._templateId=t[0]._suuid||t[0].uuid,this._iterationTemplate=s.templateWithComponent(this,this._templateDelegate)):(this._iterationTemplate=s.create(),this._iterationTemplate.delegate=this._templateDelegate,this._iterationTemplate.initWithComponent(this)),this._iterationTemplate.optimize(),this._removeOriginalContent=!0,o.isDebug&&o.debug(this._iterationTemplate.exportToString()),this.removeIterationSerialization();while(n=t.shift())n.needsDraw=!1;this.objects&&this.objects.length!==this._items.length&&this._updateItems([],this.objects,0)}},_templateDelegate:{value:{serializeObjectProperties:function(e,t){e.set("ownerComponent",t.ownerComponent,"reference")}}},templateDidLoad:{value:function(){var e=this._deserializedItem,t;if(e){t=e.element.childNodes,e.fragment=document.createDocumentFragment(),e.childComponentsIndex=this.childComponents.length-this._iterationChildComponentsCount;while(t.length>0)e.fragment.appendChild(t[0]);delete e.element}}},contentWillChange:{value:function(e){this._updatingItems=!0,this.reset()}},contentDidChange:{value:function(){this._updatingItems=!1,this._setupIterationTemplate()}},reset:{value:function(){this._items.clear(),this._itemsToAppend.clear(),this._nextDeserializedItemIx=0,this._itemsToRemove.clear(),this._deletedItems.clear()}},deserializedFromTemplate:{value:function(){this._isComponentExpanded&&this.setupIterationSerialization();var e=this._controllerBindingsToInstall,t;if(e){for(t in e)Object.defineBinding(this,t,e[t]);delete this._controllerBindingsToInstall}this._hasBeenDeserialized=!0}},canDraw:{value:function(){var e=this.canDrawGate.value,t,n,r=this.childComponents.length;if(e)for(n=0;n<r;n++)if(!this.childComponents[n].canDraw()){e=!1;break}return e}},prepareForDraw:{value:function(){this._refreshSelectionTracking()}},_selectedIndexesToDeselectOnDraw:{value:null},_selectedIndexes:{value:null},selectedIndexes:{get:function(){return this._selectedIndexes},set:function(e){this._selectedIndexes=e,this._markIndexesDirty(e),this._isComponentExpanded&&(this.needsDraw=!0)}},_activeIndexes:{value:null},activeIndexes:{get:function(){return this._activeIndexes},set:function(e){this._activeIndexes=e,this._markIndexesDirty(e),this._isComponentExpanded&&(this.needsDraw=!0)}},_markIndexesDirty:{value:function(e){if(e)for(var t=0,n=e.length;t<n;t++)this._dirtyIndexes[this._indexMap?this._indexMap.indexOf(e[t]):e[t]]=!0}},_refreshSelectionTracking:{value:function(){this.isSelectionEnabled?window.Touch?this.element.addEventListener("touchstart",this,!0):this.element.addEventListener("mousedown",this,!0):window.Touch?this.element.removeEventListener("touchstart",this,!0):this.element.removeEventListener("mousedown",this,!0)}},_itemIndexOfElement:{value:function(e){var t=e,n=null,r,i;if(t===this.element)return n;while(t&&t.parentNode!==this.element)t=t.parentNode;return t?(i=this.element.ownerDocument.createRange(),i.setStart(this.element,0),i.setEndAfter(t),r=this._iterationChildCount>1?1:0,n=(i.endOffset+r)/this._iterationChildCount-1,this.indexMap?this.indexMap[n]:n):null}},captureTouchstart:{value:function(e){if(this._selectionPointer||0===this._selectionPointer)return;this._observeSelectionPointer(e.changedTouches[0].identifier);var t=this._itemIndexOfElement(e.target);null!==t?this.activeIndexes=[t]:this._ignoreSelectionPointer()}},handleTouchend:{value:function(e){var t=0,n;while(t<e.changedTouches.length&&e.changedTouches[t].identifier!==this._selectionPointer)t++;t<e.changedTouches.length&&(this.eventManager.isPointerClaimedByComponent(this._selectionPointer,this)&&(n=this._itemIndexOfElement(e.target),null!==n&&(this.selectedIndexes=[n])),this._ignoreSelectionPointer())}},handleTouchcancel:{value:function(){this._ignoreSelectionPointer()}},captureMousedown:{value:function(e){this._observeSelectionPointer("mouse");var t=this._itemIndexOfElement(e.target);null!==t?this.activeIndexes=[t]:this._ignoreSelectionPointer()}},handleMouseup:{value:function(e){var t=this._itemIndexOfElement(e.target);null!==t&&(this.selectedIndexes=[t]),this._ignoreSelectionPointer()}},surrenderPointer:{value:function(e,t){return this._ignoreSelectionPointer(),!0}},_selectionPointer:{value:null},_observeSelectionPointer:{value:function(e){this._selectionPointer=e,this.eventManager.claimPointer(e,this),window.Touch?(document.addEventListener("touchend",this,!1),document.addEventListener("touchcancel",this,!1)):document.addEventListener("mouseup",this,!1)}},_ignoreSelectionPointer:{value:function(){this.eventManager.forfeitPointer(this._selectionPointer,this),this._selectionPointer=null,this.activeIndexes=[],window.Touch?(document.removeEventListener("touchend",this,!1),document.removeEventListener("touchcancel",this,!1)):document.removeEventListener("mouseup",this,!1)}},_iterationChildCount:{value:null},_iterationChildElementCount:{value:null},draw:{value:function(){var e,t,n,r,i=this._items.length,s,o=this.element,u=o.ownerDocument,a,f,l,c,h,p,d,v,m=this._indexMapChanged,g,y,b=this._iterationChildCount,w;if(!this.canDrawGate.value)return;this._removeOriginalContent&&(this._removeOriginalContent=!1,o.innerHTML="");if(1===this._iterationChildElementCount){l=o.children;for(e=0;e<l.length;e++)d=l.item(e),d&&this._dirtyIndexes[e]&&(v=d.classList,v.remove("active"),v.remove("selected"),v.remove("no-transition"),m&&this._indexMapAffectedIndexes[e]&&(v.add("no-transition"),this._dirtyIndexes[e]=!1))}m&&(this._indexMapAffectedIndexes.clear(),this._indexMapChanged=!1,this.needsDraw=!0);var E;if(this._itemsToRemove.length>0){f=document.createRange();for(e=0;t=this._itemsToRemove[e];e++)E=t.removalIndex,f.setStart(o,E*b),f.setEnd(o,E*b+b),f.extractContents();this._itemsToRemove.clear()}var S;if(this._itemsToAppend.length>0){for(e=0;t=this._itemsToAppend[e];e++){if(t.removed){this._removeIterationChildComponents(t.childComponentsIndex);continue}n=t.fragment,S=t.insertionIndex,delete t.fragment,delete t.insertionIndex,delete t.index,isNaN(S)?o.appendChild(n):o.insertBefore(n,o.childNodes[S*this._iterationChildCount]),this._items.splice(S,0,t)}i=this._items.length,this._itemsToAppend.clear(),this._nextDeserializedItemIx=0}if(null!==this.selectedIndexes&&this.selectedIndexes.length>0&&1===this._iterationChildElementCount){l=o.children,a=this.selectedIndexes.length,c=Math.min(a,l.length);for(e=0;e<c;e++)y=this.indexMap?this.indexMap.indexOf(this.selectedIndexes[e]):this.selectedIndexes[e],d=l.item(y),d&&(d.classList.add("selected"),this._dirtyIndexes[y]=!0)}if(null!==this._activeIndexes&&this._activeIndexes.length>0&&1===this._iterationChildElementCount){l=this.element.children,h=this._activeIndexes.length,p=Math.min(h,l.length);for(e=0;e<p;e++)g=this.indexMap?this.indexMap.indexOf(this._activeIndexes[e]):this._activeIndexes[e],d=l.item(g),d&&(d.classList.add("active"),this._dirtyIndexes[g]=!0)}this._drawnIndexMap=this._indexMap?this.indexMap.slice(0):null}},setupIterationSerialization:{value:function(){r.defineProperty(this,"serializeSelf",{value:this.serializeIteration})}},setupIterationDeserialization:{value:function(){this.deserializeProperties=this.deserializeIteration}},removeIterationSerialization:{value:function(){delete this.serializeSelf}},propertyChangeBindingListener:{value:function(e,t,n,r,i,s,o){var u=o,a=e,f,l,c,h,p,d;if(o&&o.boundObjectPropertyPath.match(/objectAtCurrentIteration/)){if(!this._deserializedItem)return null;l=this._fakeObjects._fakeIndex[this._deserializedItem.index],u={},c=Object.keys(o),h=c.length;for(var v=0;v<h;v++)p=c[v],u[p]=o[p];d=o.boundObjectPropertyPath.replace(/objectAtCurrentIteration/,"_fakeObjects."+l),u.boundObjectPropertyPath=d,a=e.replace(/objectAtCurrentIteration/,"_fakeObjects."+l)}else if(o&&o.boundObjectPropertyPath.match(/selectionAtCurrentIteration/)){if(!this._deserializedItem)return null;l=this._fakeObjects._fakeIndex[this._deserializedItem.index],u={},c=Object.keys(o),h=c.length;for(var v=0;v<h;v++)p=c[v],u[p]=o[p];d=o.boundObjectPropertyPath.replace(/selectionAtCurrentIteration/,"contentController.selections."+l),u.boundObjectPropertyPath=d,a=e.replace(/selectionAtCurrentIteration/,"contentController.selections."+l)}return u.boundObject===this?Object.prototype.propertyChangeBindingListener.call(this,a,t,n,r,i,s,u):u.boundObject.propertyChangeBindingListener(a,t,n,r,i,s,u)}},serializeIteration:{value:function(e){e.setProperty("element",this.element);var t=this.childComponents,n=e.addObject,r,i=t.length;for(r=0;r<i;r++)n.call(e,t[r]);e.setProperty("_isComponentExpanded",!0)}},deserializeIteration:{value:function(e){var t=this._itemsToAppend[this._nextDeserializedItemIx++];t?(this._deserializedItem=t,t.element=e.get("element"),this.eventManager.registerEventHandlerForElement(this,t.element),o.debug&&o.debug(this._montage_metadata.objectName+":deserializeIteration","childNodes: ",t.element)):this._deserializedItem=null}}})}}),montageDefine("120b0c7","ui/flow.reel/flow",{dependencies:["montage","ui/component","ui/flow-bezier-spline"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=e("ui/flow-bezier-spline").FlowBezierSpline,o=t.Flow=r.create(i,{didCreate:{value:function(){this._slideOffsets={}}},slotContent:{serializable:!0,value:null},_flowTranslateComposer:{value:null},_scrollingMode:{value:"linear"},scrollingMode:{serializable:!0,get:function(){return this._scrollingMode},set:function(e){switch(e){case"linear":case"drag":this._scrollingMode=e}}},_linearScrollingVector:{value:[-300,0]},linearScrollingVector:{seriazable:!0,get:function(){return this._linearScrollingVector},set:function(e){this._linearScrollingVector=e}},_repetition:{value:null},momentumDuration:{serializable:!0,value:650},_splinePaths:{value:null},splinePaths:{enumerable:!1,get:function(){return this._splinePaths||(this._splinePaths=[]),this._splinePaths},set:function(e){this._splinePaths=e}},appendPath:{value:function(e){var t=s.create(),n=e.knots,r=e.knots.length,i=[],o=[],u=[],a=[],f,l;t.parameters={};for(f in e.units)t.parameters[f]={data:[],units:e.units[f]};for(f=0;f<r;f++){i[f]=n[f].knotPosition,u[f]=n[f].previousHandlerPosition,o[f]=n[f].nextHandlerPosition,a[f]=n[f].previousDensity;for(l in e.units)t.parameters[l].data.push(n[f][l])}t.knots=i,t.previousHandlers=u,t.nextHandlers=o,t.densities=a,t._computeDensitySummation(),this.splinePaths.push(t),e.hasOwnProperty("headOffset")||(e.headOffset=0),e.hasOwnProperty("tailOffset")||(e.tailOffset=0),this._paths.push(e),this._updateLength()}},_paths:{value:null},paths:{get:function(){var e=this.splinePaths.length,t=[],n,r,i,s,o,u,a;for(o=0;o<e;o++){r=this.splinePaths[o].knots.length,n={knots:[],units:{}};for(u=0;u<r;u++)s={knotPosition:this.splinePaths[o].knots[u]},this.splinePaths[o].nextHandlers&&this.splinePaths[o].nextHandlers[u]&&(s.nextHandlerPosition=this.splinePaths[o].nextHandlers[u]),this.splinePaths[o].previousHandlers&&this.splinePaths[o].previousHandlers[u]&&(s.previousHandlerPosition=this.splinePaths[o].previousHandlers[u]),this.splinePaths[o].densities&&this.splinePaths[o].densities[u]&&(s.previousDensity=this.splinePaths[o].densities[u],s.nextDensity=this.splinePaths[o].densities[u]),n.knots.push(s);for(u in this.splinePaths[o].parameters){n.units[u]=this.splinePaths[o].parameters[u].units,i=this.splinePaths[o].parameters[u].data.length;for(a=0;a<i;a++)n.knots[a][u]=this.splinePaths[o].parameters[u].data[a]}this._paths[o].hasOwnProperty("headOffset")?n.headOffset=this._paths[o].headOffset:n.headOffset=0,this._paths[o].hasOwnProperty("tailOffset")?n.tailOffset=this._paths[o].tailOffset:n.tailOffset=0,t.push(n)}return t},set:function(e){var t=e.length,n;this._splinePaths=[],this._paths=[];for(n=0;n<t;n++)this.appendPath(e[n]);this.needsDraw=!0}},_cameraElement:{value:null},_cameraPosition:{value:[0,0,800]},_cameraTargetPoint:{value:[0,0,0]},_cameraFov:{value:50},_cameraRoll:{value:0},cameraPosition:{get:function(){return this._cameraPosition},set:function(e){this._cameraPosition=e,this._isCameraUpdated=!0,this.needsDraw=!0}},cameraTargetPoint:{get:function(){return this._cameraTargetPoint},set:function(e){this._cameraTargetPoint=e,this._isCameraUpdated=!0,this.needsDraw=!0}},cameraFov:{get:function(){return this._cameraFov},set:function(e){this._cameraFov=e,this._isCameraUpdated=!0,this.needsDraw=!0}},cameraRoll:{get:function(){return this._cameraRoll},set:function(e){this._cameraRoll=e,this._isCameraUpdated=!0,this.needsDraw=!0}},_stride:{value:0},stride:{get:function(){return this._stride},set:function(e){this._stride=e}},_scrollingTransitionDurationMiliseconds:{value:500},_scrollingTransitionDuration:{value:"500ms"},scrollingTransitionDuration:{get:function(){return this._scrollingTransitionDuration},set:function(e){var t=e+"",n=t.length,r;n>=2&&t[n-1]==="s"?n>=3&&t[n-2]==="m"?r=t.substr(0,n-2)-0:r=t.substr(0,n-1)*1e3:(r=t-0,t+="ms"),!isNaN(r)&&this._scrollingTransitionDurationMiliseconds!==r&&(this._scrollingTransitionDurationMiliseconds=r,this._scrollingTransitionDuration=t)}},_scrollingTransitionTimingFunctionBezier:{value:[.25,.1,.25,1]},_scrollingTransitionTimingFunction:{value:"ease"},hasSelectedIndexScrolling:{value:!1},selectedIndexScrollingOffset:{value:0},_handleSelectedIndexesChange:{value:function(e){this.hasSelectedIndexScrolling&&e.plus&&this.startScrollingIndexToOffset(e.plus[0],this.selectedIndexScrollingOffset)}},_timingFunctions:{value:{ease:[.25,.1,.25,1],linear:[0,0,1,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1]}},scrollingTransitionTimingFunction:{get:function(){return this._scrollingTransitionTimingFunction},set:function(e){var t=e+"",n,r;if(this._timingFunctions.hasOwnProperty(t))this._scrollingTransitionTimingFunction=t,this._scrollingTransitionTimingFunctionBezier=this._timingFunctions[t];else if(t.substr(0,13)==="cubic-bezier("&&t.substr(t.length-1,1)===")"){n=t.substr(13,t.length-14).split(",");if(n.length===4){for(r=0;r<4;r++){n[r]-=0;if(isNaN(n[r]))return}n[0]<0?n[0]=0:n[0]>1&&(n[0]=1),n[2]<0?n[2]=0:n[2]>1&&(n[2]=1),this._scrollingTransitionTimingFunction="cubic-bezier("+n+")",this._scrollingTransitionTimingFunctionBezier=n}}}},_computeCssCubicBezierValue:{value:function(e,t){var n=.5,r=.25,i,s,o;for(o=0;o<20;o++)i=n*n,s=1-n,3*(s*s*n*t[0]+s*i*t[2])+i*n>e?n-=r:n+=r,r*=.5;return i=n*n,s=1-n,3*(s*s*n*t[1]+s*i*t[3])+i*n}},_isTransitioningScroll:{value:!1},stopScrolling:{value:function(){this._isTransitioningScroll=!1}},startScrollingIndexToOffset:{value:function(e,t){this._scrollingOrigin=this.scroll,this._scrollingDestination=e-t,this._scrollingDestination>this._length?this._scrollingDestination=this._length:this._scrollingDestination<0&&(this._scrollingDestination=0),this._isScrolling=!0,this._scrollingStartTime=Date.now(),this._isTransitioningScroll=!0,this.needsDraw=!0}},_isCameraUpdated:{value:!0},_width:{value:null},_height:{value:null},_repetitionComponents:{value:null},_boundingBoxSize:{value:[200,200,0]},boundingBoxSize:{serializable:!0,get:function(){return this._boundingBoxSize},set:function(e){this._boundingBoxSize=e,this.elementsBoundingSphereRadius=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])*.5}},_elementsBoundingSphereRadius:{value:283},elementsBoundingSphereRadius:{get:function(){return this._elementsBoundingSphereRadius},set:function(e){this._elementsBoundingSphereRadius!==e&&(this._elementsBoundingSphereRadius=e,this.needsDraw=!0)}},_halfPI:{value:Math.PI*.5},_doublePI:{value:Math.PI*2},_computeFrustumNormals:{value:function(){var e=this.cameraFov*.5*this._doublePI/360,t=Math.sin(e),n=Math.cos(e),r=t*this._width/this._height,i=this.cameraTargetPoint[0]-this.cameraPosition[0],s=this.cameraTargetPoint[1]-this.cameraPosition[1],o=this.cameraTargetPoint[2]-this.cameraPosition[2],u=this._halfPI-Math.atan2(o,i),a=i*Math.sin(u)+o*Math.cos(u),f,l,c,h,p,d,v=this._halfPI-Math.atan2(a,s),m,g=[[n,0,r],[-n,0,r],[0,n,t],[0,-n,t]],y,b=[],w;for(w=0;w<4;w++)y=g[w],f=y[0],l=y[1]*Math.cos(-v)-y[2]*Math.sin(-v),c=y[1]*Math.sin(-v)+y[2]*Math.cos(-v),h=f*Math.cos(-u)-c*Math.sin(-u),p=l,d=f*Math.sin(-u)+c*Math.cos(-u),m=1/Math.sqrt(h*h+p*p+d*d),b.push([h*m,p*m,d*m]);return b}},_segmentsIntersection:{value:function(e,t){var n=0,r=0,i,s,o=[];while(n<e.length&&r<t.length)e[n][0]>=t[r][1]?r++:e[n][1]<=t[r][0]?n++:(e[n][0]>=t[r][0]?i=e[n][0]:i=t[r][0],e[n][1]<=t[r][1]?s=e[n][1]:s=t[r][1],o.push([i,s]),e[n][1]<t[r][1]?n++:e[n][1]>t[r][1]?r++:(n++,r++));return o}},_computeVisibleRange:{value:function(e){var t=e._knots.length-1,n=this._cameraPosition[0],r=this._cameraPosition[1],i=this._cameraPosition[2],s=this._computeFrustumNormals(),o,u=[],a=[],f=[],l,c,h,p=this._elementsBoundingSphereRadius,d=e._knots,v=e._nextHandlers,m=e._previousHandlers,g=[],y=[];for(c=0;c<t;c++){o=s[0],u=e.directedPlaneBezierIntersection(n-o[0]*p,r-o[1]*p,i-o[2]*p,s[0],d[c],v[c],m[c+1],d[c+1],g);if(u.length){o=s[1],a=e.directedPlaneBezierIntersection(n-o[0]*p,r-o[1]*p,i-o[2]*p,s[1],d[c],v[c],m[c+1],d[c+1],g);if(a.length){l=this._segmentsIntersection(u,a);if(l.length){o=s[2],u=e.directedPlaneBezierIntersection(n-o[0]*p,r-o[1]*p,i-o[2]*p,s[2],d[c],v[c],m[c+1],d[c+1],g),l=this._segmentsIntersection(u,l);if(l.length){o=s[3],u=e.directedPlaneBezierIntersection(n-o[0]*p,r-o[1]*p,i-o[2]*p,s[3],d[c],v[c],m[c+1],d[c+1],g),l=this._segmentsIntersection(u,l);for(h=0;h<l.length;h++)f.push([c,l[h][0],l[h][1]])}}}}}var b=e._densities,w,E,S,x,T,N,C;for(c=0;c<f.length;c++)w=b[f[c][0]],E=b[f[c][0]+1],S=f[c][0]?e._densitySummation[f[c][0]-1]:0,x=f[c][1],T=f[c][2],N=(E-w)*x*x*.5+x*w+S,C=(E-w)*T*T*.5+T*w+S,y.push([N,C]);return y}},prepareForDraw:{value:function(){var e=this,t;this._repetitionComponents=this._repetition._childComponents,window.addEventListener("resize",function(){e._isCameraUpdated=!0,e.needsDraw=!0},!1)}},_updateIndexMap:{value:function(e,t){var n=this._repetition.indexMap,r=[],i,s,o=n&&!isNaN(n.length)?n.length:0;for(s=0;s<o;s++)typeof t[n[s]]=="number"?e[t[n[s]]]=null:r.push(s);for(s=i=0;i<r.length&&s<e.length;s++)e[s]!==null&&(this._repetition.mapIndexToIndex(r[i],e[s],!1),i++);for(i=o;s<e.length;s++)e[s]!==null&&(this._repetition.mapIndexToIndex(i,e[s],!1),i++);this._repetition.refreshIndexMap()}},willDraw:{value:function(){var e,t,n,r,i,s,o,u,a,f,l,c=[],h,p,d={},v=this._paths,m=v.length,g=this.splinePaths;this._isTransitioningScroll&&(h=(Date.now()-this._scrollingStartTime)/this._scrollingTransitionDurationMiliseconds,p=this._computeCssCubicBezierValue(h,this._scrollingTransitionTimingFunctionBezier),h<1?this.scroll=this._scrollingOrigin+(this._scrollingDestination-this._scrollingOrigin)*p:(this.scroll=this._scrollingDestination,this._isTransitioningScroll=!1)),this._width=this._element.clientWidth,this._height=this._element.clientHeight;if(g.length){a=this._numberOfIterations%m,f=(this._numberOfIterations-a)/m;for(i=0;i<m;i++){l=f+(i<a?1:0),e=this._computeVisibleRange(g[i]),g[i]._computeDensitySummation(),s=this._scroll-v[i].headOffset;for(n=0;n<e.length;n++){o=Math.ceil(e[n][0]+s),u=Math.ceil(e[n][1]+s),o<0&&(o=0),u>l&&(u=l);for(r=o;r<u;r++)t=r*m+i,typeof d[t]=="undefined"&&(d[t]=c.length,c.push(t))}}}this._updateIndexMap(c,d)}},draw:{value:function(){var e,t=this._repetitionComponents.length,n,r,i,s,o,u=this._paths.length,a,f,l,c,h,p,d=this._repetition._indexMap,v,m,g,y,b=1e-5,w=Date.now(),E=6,S=this.lastDrawTime?(w-this.lastDrawTime)*.018*this._elasticScrollingSpeed:0,x=1-S/E,T,N,C,k=this._minSlideOffsetIndex,L=this._maxSlideOffsetIndex;this.lastDrawTime=w;for(s=0;s<E;s++){for(e=this._draggedSlideIndex-1;e>=k;e--)T=this._getSlideOffset(e),N=this._getSlideOffset(e+1),C=(T-N)*x+N,C>0&&(C=0),this._updateSlideOffset(e,C);for(e=this._draggedSlideIndex+1;e<=L;e++)T=this._getSlideOffset(e),N=this._getSlideOffset(e-1),C=(T-N)*x+N,C<0&&(C=0),this._updateSlideOffset(e,C)}this._isTransitioningScroll&&(this.needsDraw=!0);if(this._isCameraUpdated){var A=Math.tan((90-this.cameraFov*.5)*this._doublePI/360)*this._height*.5,O=this.cameraTargetPoint[0]-this.cameraPosition[0],M=this.cameraTargetPoint[1]-this.cameraPosition[1],_=this.cameraTargetPoint[2]-this.cameraPosition[2],D=Math.atan2(-O,-_),P,H;P=O*-Math.sin(-D)+_*Math.cos(-D),H=Math.atan2(-M,-P),this._element.style.webkitPerspective=A+"px",this._cameraElement.style.webkitTransform="translate3d(0,0,"+A+"px)rotateX("+H+"rad)rotateY("+ -D+"rad)"+"translate3d("+ -this.cameraPosition[0]+"px,"+ -this.cameraPosition[1]+"px,"+ -this.cameraPosition[2]+"px)",this._isCameraUpdated=!1}if(this.splinePaths.length)for(e=0;e<t;e++)y=this.offset(d[e]),a=y.pathIndex,r=y.slideTime,m=this._splinePaths[a]._convertSplineTimeToBezierIndexTime(r),o=this._repetitionComponents[e].element.parentNode,m!==null?(f=this._splinePaths[a].getPositionAtIndexTime(m),g=this._splinePaths[a].getRotationAtIndexTime(m),i="-webkit-transform:translate3d("+(f[0]*1e5>>0)*1e-5+"px,"+(f[1]*1e5>>0)*1e-5+"px,"+(f[2]*1e5>>0)*1e-5+"px)"+(g[2]?"rotateZ("+(g[2]*1e5>>0)*1e-5+"rad)":"")+(g[1]?"rotateY("+(g[1]*1e5>>0)*1e-5+"rad)":"")+(g[0]?"rotateX("+(g[0]*1e5>>0)*1e-5+"rad)":"")+";"+this._splinePaths[a].getStyleAtIndexTime(m),o.setAttribute("style",i)):o.setAttribute("style","-webkit-transform:scale3d(0,0,0);opacity:0");else for(e=0;e<t;e++)o=this._repetitionComponents[e].element.parentNode,o.setAttribute("style","-webkit-transform:scale3d(0,0,0);opacity:0");this.needsDraw=!0}},_updateLength:{value:function(){if(this._paths){var e,t=this._paths.length,n,r,i=0,s,o,u;if(t>0){o=this._numberOfIterations%t,s=(this._numberOfIterations-o)/t;for(u=0;u<t;u++)e=this._paths[u],n=s+(u<o?1:0),r=n-e.tailOffset+e.headOffset-1,r>i&&(i=r);this.length=i}this.needsDraw=!0}}},_numberOfIterations:{value:0},numberOfIterations:{get:function(){return this._numberOfIterations},set:function(e){this._numberOfIterations!==e&&(this._numberOfIterations=e,this._updateLength())}},_objects:{value:null},objects:{get:function(){return this._objects},set:function(e){this._objects=e,this.needsDraw=!0}},contentController:{value:null},isSelectionEnabled:{value:null},selectedIndexes:{serializable:!1,value:null},activeIndexes:{serializable:!1,value:null},propertyChangeBindingListener:{value:function(e,t,n,r,i,s,o){return o.boundObjectPropertyPath.match(/objectAtCurrentIteration/)?this._repetition?(o.boundObject=this._repetition,this._repetition.propertyChangeBindingListener.apply(this._repetition,arguments)):null:Object.prototype.propertyChangeBindingListener.apply(this,arguments)}},_orphanedChildren:{value:null},deserializedFromTemplate:{value:function(){this._orphanedChildren=this.childComponents,this.childComponents=null}},templateDidLoad:{value:function(){var e,t=this.element.ownerDocument.createRange(),n,r=this;t.selectNodeContents(this.element),e=t.extractContents(),n=this._repetition.element.appendChild(document.createElement("div")),n.appendChild(e),n.setAttribute("data-montage-id","wrapper"),this._repetition.indexMapEnabled=!0,this._repetition.childComponents=this._orphanedChildren,this._repetition.willDraw=function(){r.needsDraw=!0},Object.defineBinding(this,"numberOfIterations",{boundObject:this._repetition,boundObjectPropertyPath:"_objects.count()",oneway:"true"})}},_length:{value:0},length:{get:function(){return this._length},set:function(e){e<0?this._length=0:this._length=e}},_scroll:{value:0},_range:{value:20},_hasElasticScrolling:{value:!1},hasElasticScrolling:{get:function(){return this._hasElasticScrolling},set:function(e){e?this._hasElasticScrolling=!0:this._hasElasticScrolling=!1}},_slideOffsets:{value:null},_slideOffsetsLength:{value:0},_maxSlideOffsetIndex:{value:-1},_minSlideOffsetIndex:{value:2e9},_updateSlideOffset:{value:function(e,t){var n=1e-4;e>=0&&(t<-n||t>n?(typeof this._slideOffsets[e]=="undefined"&&(this._slideOffsetsLength++,e<this._minSlideOffsetIndex&&(this._minSlideOffsetIndex=e),e>this._maxSlideOffsetIndex&&(this._maxSlideOffsetIndex=e)),this._slideOffsets[e]=t):this._removeSlideOffset(e))}},_incrementSlideOffset:{value:function(e,t){this._updateSlideOffset(e,this._getSlideOffset(e)+t)}},_removeSlideOffset:{value:function(e){if(typeof this._slideOffsets[e]!="undefined"){var t,n,r;delete this._slideOffsets[e],this._slideOffsetsLength--;if(e===this._minSlideOffsetIndex){t=Object.keys(this._slideOffsets),this._minSlideOffsetIndex=2e9;for(n=0;n<t.length;n++)r=t[n]|0,r<this._minSlideOffsetIndex&&(this._minSlideOffsetIndex=r)}if(e===this._maxSlideOffsetIndex){typeof t=="undefined"&&(t=Object.keys(this._slideOffsets)),this._maxSlideOffsetIndex=-1;for(n=0;n<t.length;n++)r=t[n]|0,r>this._maxSlideOffsetIndex&&(this._maxSlideOffsetIndex=r)}}}},_getSlideOffset:{value:function(e){return e<this._minSlideOffsetIndex?this._minSlideOffsetIndex>this._draggedSlideIndex?e=this._draggedSlideIndex:e=this._minSlideOffsetIndex:e>this._maxSlideOffsetIndex&&(this._maxSlideOffsetIndex<this._draggedSlideIndex?e=this._draggedSlideIndex:e=this._maxSlideOffsetIndex),typeof this._slideOffsets[e]!="undefined"?this._slideOffsets[e]:0}},scroll:{get:function(){return this._scroll},set:function(e){e<0&&(e=0),e>this.length&&(e=this.length);if(this._hasElasticScrolling&&this._draggedSlideIndex!==null){var t,n,r=this._draggedSlideIndex-this._range,i=this._draggedSlideIndex+this._range,s,o,u;r>this._minSlideOffsetIndex&&(r=this._minSlideOffsetIndex),i<this._maxSlideOffsetIndex&&(i=this._maxSlideOffsetIndex),s=e-this._scroll,r<0&&(r=0);for(t=r;t<=i;t++)t!==this._draggedSlideIndex?this._incrementSlideOffset(t,s):this._removeSlideOffset(t);this._scroll=e}else this._scroll=e;this.needsDraw=!0}},_isInputEnabled:{value:!0},isInputEnabled:{get:function(){return this._isInputEnabled},set:function(e){e?this._isInputEnabled=!0:this._isInputEnabled=!1}},_draggedSlideIndex:{value:0},draggedSlideIndex:{get:function(){return this._draggedSlideIndex},set:function(e){if(e!==this._draggedSlideIndex){if(e!==null){var t=this._getSlideOffset(e),n=this._minSlideOffsetIndex,r=this._maxSlideOffsetIndex,i;this._incrementSlideOffset(this._draggedSlideIndex,-t);for(i=n;i<=r;i++)i!==this._draggedSlideIndex&&this._incrementSlideOffset(i,-t);this._removeSlideOffset(e),this._scroll-=t,this._flowTranslateComposer._scroll=this._scroll}this._draggedSlideIndex=e,this.needsDraw=!0}}},_elasticScrollingSpeed:{value:1},lastDrawTime:{value:null},offset:{enumerable:!1,value:function(e){var t=this._paths.length,n=e%t,r=Math.floor(e/t)-this._scroll+this._paths[n].headOffset;return{pathIndex:n,slideTime:r+this._getSlideOffset(e)}}},serializeSelf:{value:function(e){e.setProperties();var t=this.originalContent;for(var n=0,r;r=t[n];n++)r.controller&&e.addObject(r.controller)}}})}}),montageDefine("120b0c7","ui/composer/flow-translate-composer",{dependencies:["montage","ui/composer/translate-composer","core/event/event-manager","core/geometry/point","ui/dom"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/composer/translate-composer").TranslateComposer,s=e("core/event/event-manager").defaultEventManager,o=e("core/geometry/point").Point,u=e("ui/dom").convertPointFromPageToNode,a=t.FlowTranslateComposer=r.create(i,{_scrollingMode:{value:"linear"},scrollingMode:{get:function(){return this._scrollingMode},set:function(e){switch(e){case"linear":case"drag":this._scrollingMode=e}}},_linearScrollingVector:{value:[-300,0]},linearScrollingVector:{get:function(){return this._linearScrollingVector},set:function(e){this._linearScrollingVector=e}},_startPageX:{value:null},_startPageY:{value:null},_pageX:{value:null},_pageY:{value:null},_pointerStartX:{value:null},_pointerStartY:{value:null},_contentOffsetX:{value:null},_contentOffsetY:{value:null},_start:{value:function(e,t){var n=window.getComputedStyle(this._element,null),r=this.convertCssPixelsPropertyStringToNumber(n.getPropertyValue("border-left-width")),i=this.convertCssPixelsPropertyStringToNumber(n.getPropertyValue("border-top-width")),s=this.convertCssPixelsPropertyStringToNumber(n.getPropertyValue("padding-left")),a=this.convertCssPixelsPropertyStringToNumber(n.getPropertyValue("padding-top")),f=u(this._element,o.create().init(e,t));this._pointerStartX=this._pointerX=f.x-r-s,this._pointerStartY=this._pointerY=f.y-i-a,this._contentOffsetX=this._startPageX-this._pointerStartX,this._contentOffsetY=this._startPageY-this._pointerStartY,this._computePointedElement(),this._startPageX=this._pageX=e,this._startPageY=this._pageY=t,this._startScroll=this._scroll,this._previousScrollDelta=0,this._scrollEnd=null,this.isAnimating=!1,window.Touch?(document.addEventListener("touchend",this,!0),document.addEventListener("touchmove",this,!0)):(document.addEventListener("mouseup",this,!0),document.addEventListener("mousemove",this,!0)),this._isFirstMove=!0}},_analyzeMovement:{value:function(e){var t=e.velocity,n,r,i;if(!t)return;n=t.speed,n>=this.startTranslateSpeed?this._stealPointer():(r=this.startPageX-e.pageX,i=this.startPageY-e.pageY,r*r+i*i>this.startTranslateRadius*this.startTranslateRadius&&this._stealPointer())}},_dispatchTranslateStart:{value:function(e,t){var n=document.createEvent("CustomEvent");n.initCustomEvent("translateStart",!0,!0,null),n.scroll=this._scroll,this.dispatchEvent(n)}},_dispatchTranslateEnd:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateEnd",!0,!0,null),e.scroll=this._scroll,this.dispatchEvent(e)}},_dispatchTranslate:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translate",!0,!0,null),e.scroll=this._scroll,this.dispatchEvent(e)}},_move:{value:function(e,t){var n;this._isFirstMove&&(this._dispatchTranslateStart(),this._isFirstMove=!1),this._pageX=e,this._pageY=t,this._scrollingMode==="drag"?(this._pointerX=e-this._contentOffsetX,this._pointerY=t-this._contentOffsetY,this._updateDragScroll()):this._updateLinearScroll(),this._closerIndex!==null,this._shouldDispatchTranslate&&this._dispatchTranslate()}},_end:{value:function(e){this.startTime=Date.now(),this.endX=this.startX=this._pageX,this.endY=this.startY=this._pageY,this._hasMomentum&&(e.velocity.speed>40||this.translateStrideX||this.translateStrideY)?(this._axis!="vertical"?this.momentumX=e.velocity.x*this._pointerSpeedMultiplier*(this._invertXAxis?1:-1):this.momentumX=0,this._axis!="horizontal"?this.momentumY=e.velocity.y*this._pointerSpeedMultiplier*(this._invertYAxis?1:-1):this.momentumY=0,this.endX=this.startX+this.momentumX*this.__momentumDuration/2e3,this.endY=this.startY+this.momentumY*this.__momentumDuration/2e3,this.startStrideXTime=null,this.startStrideYTime=null,this.animateMomentum=!0):this.animateMomentum=!1,this.animateMomentum?this._animationInterval():this._isFirstMove||this._dispatchTranslateEnd(),this._releaseInterest()}},handleMousewheel:{value:function(){}},_scroll:{value:0},scroll:{get:function(){return this._scroll},set:function(e){this.minScroll!==null&&e<this.minScroll&&(e=this.minScroll),this.maxScroll!==null&&e>this.maxScroll&&(e=this.maxScroll),this._scroll=e}},minScroll:{value:null},maxScroll:{value:null},_flow:{value:null},flow:{get:function(){return this._flow},set:function(e){this._flow=e,this.component=e}},_updateScroll:{value:function(){this._scrollingMode==="linear"?this._updateLinearScroll():this._updateDragScroll()}},_updateLinearScroll:{value:function(){var e=500/this._flow._height,t=(this._pageX-this._startPageX)*this._linearScrollingVector[0]*e,n=(this._pageY-this._startPageY)*this._linearScrollingVector[1]*e,r=this._linearScrollingVector[0]*this._linearScrollingVector[0]+this._linearScrollingVector[1]*this._linearScrollingVector[1],i=(t+n)/r;this.scroll+=i-this._previousScrollDelta,this._previousScrollDelta=i}},_updateDragScroll:{value:function(){var e=(this._pointerX-this._pointerStartX)*this._lineVectorX,t=(this._pointerY-this._pointerStartY)*this._lineVectorY,n=this._lineVectorX*this._lineVectorX+this._lineVectorY*this._lineVectorY,r=(e+t)/n;this.scroll+=r-this._previousScrollDelta,this._previousScrollDelta=r;var i=this._flow,s=i._cameraPosition,o=i._splinePaths,u=o.length,a=this._closerIndex%u,f=this.flow._splinePaths[a],l=Math.floor(this._closerIndex/u)-this._scroll+this._flow._paths[a].headOffset,c,h,p,d,v,m,g,y,b=null,w=null,E=0,S,x,T=this._element.clientWidth*.5,N=this._element.clientHeight*.5,e=T-this._pointerX,t=N-this._pointerY,C=i.cameraTargetPoint[0]-s[0],k=i.cameraTargetPoint[1]-s[1],L=i.cameraTargetPoint[2]-s[2],A=-Math.atan2(C,L),O,M,_=this._pointerIntersectionPosition,D,P,H,B,j,F,I,q;O=L*Math.cos(A)-C*Math.sin(A),M=-Math.atan2(k,O),B=Math.sin(A),j=Math.cos(A),F=Math.sin(M),I=Math.cos(M),P=N/Math.tan(i.cameraFov*.008726646259972),q=0,g=1e100;do x=f._convertSplineTimeToBezierIndexTime(l+q),x!==null&&(c=f.getPositionAtIndexTime(x),rotation=o[a].getRotationAtIndexTime(x),D=this._rotateXYZ(_,rotation),h=(s[2]-c[2]-D[2])*B-(c[0]-s[0]+D[0])*j,p=c[1]-s[1]+D[1],d=(c[2]-s[2]+D[2])*j-(c[0]-s[0]+D[0])*B,v=d*F+p*I,m=d*I-p*F,H=P/m,h=e+h*H,p=t+v*H,S=h*h+p*p,S<g&&(g=S,b=q)),q-=.025;while(q>-6);b+.025>0&&(b=-0.025),q=b+.025,g=1e100;do x=f._convertSplineTimeToBezierIndexTime(l+q),x!==null&&(c=f.getPositionAtIndexTime(x),rotation=o[a].getRotationAtIndexTime(x),D=this._rotateXYZ(_,rotation),h=(s[2]-c[2]-D[2])*B-(c[0]-s[0]+D[0])*j,p=c[1]-s[1]+D[1],d=(c[2]-s[2]+D[2])*j-(c[0]-s[0]+D[0])*B,v=d*F+p*I,m=d*I-p*F,H=P/m,h=e+h*H,p=t+v*H,S=h*h+p*p,S<g&&(g=S,b=q)),q-=2e-4;while(q>b-.05);q=0,y=1e100;do x=f._convertSplineTimeToBezierIndexTime(l+q),x!==null&&(c=f.getPositionAtIndexTime(x),rotation=o[a].getRotationAtIndexTime(x),D=this._rotateXYZ(_,rotation),h=(s[2]-c[2]-D[2])*B-(c[0]-s[0]+D[0])*j,p=c[1]-s[1]+D[1],d=(c[2]-s[2]+D[2])*j-(c[0]-s[0]+D[0])*B,v=d*F+p*I,m=d*I-p*F,H=P/m,h=e+h*H,p=t+v*H,S=h*h+p*p,S<y&&(y=S,w=q)),q+=.025;while(q<6);w-.025<0&&(w=.025),q=w-.025,y=1e100;do x=f._convertSplineTimeToBezierIndexTime(l+q),x!==null&&(c=f.getPositionAtIndexTime(x),rotation=o[a].getRotationAtIndexTime(x),D=this._rotateXYZ(_,rotation),h=(s[2]-c[2]-D[2])*B-(c[0]-s[0]+D[0])*j,p=c[1]-s[1]+D[1],d=(c[2]-s[2]+D[2])*j-(c[0]-s[0]+D[0])*B,v=d*F+p*I,m=d*I-p*F,H=P/m,h=e+h*H,p=t+v*H,S=h*h+p*p,S<y&&(y=S,w=q)),q+=2e-4;while(q<w+.05);b?w?b*b<w*w?E=b:E=w:E=b:w&&(E=w),E>0?E<=.05&&(this.scroll=this._scroll-E):E>=-0.05&&(this.scroll=this._scroll-E)}},frame:{value:function(e){this.isAnimating&&this._animationInterval()}},convertCssPixelsPropertyStringToNumber:{value:function(e){return typeof e=="string"?e.substr(-2)==="px"?e.substr(0,e.length-2)*1:0:0}},_rayRectangleIntersection:{value:function(e,t,n,r){var i=e[1]*r[2]-e[2]*r[1],s=e[2]*r[0]-e[0]*r[2],o=e[0]*r[1]-e[1]*r[0],u=n[0]*i+n[1]*s+n[2]*o,a=1e-10,f,l,c=!1,h,p,d;return u<-a?(f=-t[0]*i-t[1]*s-t[2]*o,f<0&&f>u&&(h=n[1]*t[2]-n[2]*t[1],p=n[2]*t[0]-n[0]*t[2],d=n[0]*t[1]-n[1]*t[0],l=e[0]*h+e[1]*p+e[2]*d,l<0&&l>u&&(c=(r[0]*h+r[1]*p+r[2]*d)/u,c<0&&(c=!1)))):u>a&&(f=-t[0]*i-t[1]*s-t[2]*o,f>0&&f<u&&(h=n[1]*t[2]-n[2]*t[1],p=n[2]*t[0]-n[0]*t[2],d=n[0]*t[1]-n[1]*t[0],l=e[0]*h+e[1]*p+e[2]*d,l>0&&l<u&&(c=(r[0]*h+r[1]*p+r[2]*d)/u,c<0&&(c=!1)))),c}},_rayRectangleIntersectionPosition:{enumerable:!1,value:function(e,t,n,r){var i=e[1]*r[2]-e[2]*r[1],s=e[2]*r[0]-e[0]*r[2],o=e[0]*r[1]-e[1]*r[0],u=n[0]*i+n[1]*s+n[2]*o,a=this._flow._boundingBoxSize,f,l,c,h,p;return f=-t[0]*i-t[1]*s-t[2]*o,c=n[1]*t[2]-n[2]*t[1],h=n[2]*t[0]-n[0]*t[2],p=n[0]*t[1]-n[1]*t[0],l=e[0]*c+e[1]*h+e[2]*p,[f*a[0]/u-a[0]*.5,l*a[1]/u-a[1]*.5,0]}},_rotateXYZ:{enumerable:!1,value:function(e,t){var n=Math.cos(t[0]),r=Math.sin(t[0]),i=Math.cos(t[1]),s=Math.sin(t[1]),o=Math.cos(t[2]),u=Math.sin(t[2]),a,f,l,c;return f=n*e[1]-r*e[2],l=r*e[1]+n*e[2],c=i*e[0]+s*l,l=-s*e[0]+i*l,a=o*c-u*f,f=u*c+o*f,[a,f,l]}},_pointerIntersectionPosition:{enumerable:!1,value:null},_closerIndex:{enumerable:!1,value:null},_computePointedElement:{value:function(){var e=this._flow._splinePaths,t=e.length;if(t){var n=this._flow,r=n.cameraTargetPoint[0]-n.cameraPosition[0],i=n.cameraTargetPoint[2]-n.cameraPosition[2],s=Math.atan2(r,i),o=i*Math.cos(-s)-r*Math.sin(-s),u=Math.atan2(n.cameraTargetPoint[1]-n.cameraPosition[1],o),a=this._element.clientWidth*.5-this._pointerX,f=this._pointerY-this._element.clientHeight*.5,l=this._element.offsetHeight*.5/Math.tan(n.cameraFov*n._doublePI*(1/720)),c,h,p=[],d=n._repetition._indexMap,v=d.length,m,g,y,b=null,w=null,E=1e100,S,x,T,N,C,k,L,A,O;h=l*Math.cos(u)-f*Math.sin(u),f=l*Math.sin(u)+f*Math.cos(u),c=h*Math.cos(s)-a*Math.sin(s),a=h*Math.sin(s)+a*Math.cos(s),L=[a,f,c];for(O=0;O<e.length;O++)p[O]=e[O].transform([1,0,0,0,0,1,0,0,0,0,1,0,-n.cameraPosition[0],-n.cameraPosition[1],-n.cameraPosition[2],1]);for(O=0;O<v;O++)A=this._flow.offset(d[O]),m=A.pathIndex,y=A.slideTime,x=p[m]._convertSplineTimeToBezierIndexTime(y),x!==null&&(pos=p[m].getPositionAtIndexTime(x),T=e[m].getRotationAtIndexTime(x),C=this._rotateXYZ([n.boundingBoxSize[0],0,0],T),k=this._rotateXYZ([0,n.boundingBoxSize[1],0],T),N=[pos[0]-(C[0]+k[0])*.5,pos[1]-(C[1]+k[1])*.5,pos[2]-(C[2]+k[2])*.5],(S=this._rayRectangleIntersection(L,N,C,k))&&S<E&&(E=S,b=d[O],this._pointerIntersectionPosition=this._rayRectangleIntersectionPosition(L,N,C,k)));this._closerIndex=b,b!==null}}},test:{enumerable:!1,value:function(){var e=this._flow,t=this._bezierValue,n=e.cameraTargetPoint[0]-e.cameraPosition[0],r=e.cameraTargetPoint[1]-e.cameraPosition[1],i=e.cameraTargetPoint[2]-e.cameraPosition[2],s=Math.atan2(n,i),o,u,a,f,l,c,h,p,d,v,m=this._pointerX,g=this._pointerY;o=i*Math.cos(-s)-n*Math.sin(-s),u=Math.atan2(r,o),f=this._element.clientWidth*.5-m,l=g-this._element.clientHeight*.5,v=c=this._element.offsetHeight*.5/Math.tan(e.cameraFov*e._doublePI*(1/720)),d=c*Math.cos(u)-l*Math.sin(u),p=c*Math.sin(u)+l*Math.cos(u),h=f,c=d*Math.cos(s)-h*Math.sin(s),f=d*Math.sin(s)+h*Math.cos(s),l=p,this.t=a=this._raycastBezierTubes(e._cameraPosition[0],e._cameraPosition[1],e._cameraPosition[2],this._computeRotationValuesToXAxis(f,l,c));if(a[0]!==null){var y=[e._splinePaths[a[0]]._knots[a[1]][0]-e._cameraPosition[0],e._splinePaths[a[0]]._knots[a[1]][1]-e._cameraPosition[1],e._splinePaths[a[0]]._knots[a[1]][2]-e._cameraPosition[2],e._splinePaths[a[0]]._nextHandlers[a[1]][0]-e._cameraPosition[0],e._splinePaths[a[0]]._nextHandlers[a[1]][1]-e._cameraPosition[1],e._splinePaths[a[0]]._nextHandlers[a[1]][2]-e._cameraPosition[2],e._splinePaths[a[0]]._previousHandlers[a[1]+1][0]-e._cameraPosition[0],e._splinePaths[a[0]]._previousHandlers[a[1]+1][1]-e._cameraPosition[1],e._splinePaths[a[0]]._previousHandlers[a[1]+1][2]-e._cameraPosition[2],e._splinePaths[a[0]]._knots[a[1]+1][0]-e._cameraPosition[0],e._splinePaths[a[0]]._knots[a[1]+1][1]-e._cameraPosition[1],e._splinePaths[a[0]]._knots[a[1]+1][2]-e._cameraPosition[2]],b=[],f,l,c,h,p,d,w,E,S,x,T;for(T=0;T<12;T+=3)b[0]=y[T+2]*Math.sin(-s)+y[T]*Math.cos(-s),b[1]=y[T+1],b[2]=y[T+2]*Math.cos(-s)-y[T]*Math.sin(-s),y[T]=b[0],y[T+1]=b[2]*Math.sin(-u)+b[1]*Math.cos(-u),y[T+2]=b[2]*Math.cos(-u)-b[1]*Math.sin(-u);c=t(y[2],y[5],y[8],y[11],a[2]),d=t(y[2],y[5],y[8],y[11],a[2]+1e-8),f=t(y[0],y[3],y[6],y[9],a[2])/c,h=t(y[0],y[3],y[6],y[9],a[2]+1e-8)/d,w=(h-f)*v/1e-8,l=t(y[1],y[4],y[7],y[10],a[2])/c,p=t(y[1],y[4],y[7],y[10],a[2]+1e-8)/d,dy=(p-l)*v/1e-8,E=Math.sqrt(w*w+dy*dy),S=Math.atan2(dy,w),x=e._splinePaths[a[0]]._densities[a[1]]*(1-a[2])+e._splinePaths[a[0]]._densities[a[1]+1]*a[2],this._lineVectorX=Math.cos(-S)*E/x,this._lineVectorY=Math.sin(-S)*E/x}}},_lineVectorX:{enumerable:!1,value:Math.cos(Math.PI-.6)*80},_lineVectorY:{enumerable:!1,value:Math.sin(Math.PI-.6)*80},_startX:{enumerable:!1,value:0},_startY:{enumerable:!1,value:0},_currentX:{enumerable:!1,value:0},_currentY:{enumerable:!1,value:0},_previousScrollDelta:{enumerable:!1,value:0},_startScroll:{enumerable:!1,value:0},_bezierValue:{enumerable:!1,value:function(e,t,n,r,i){var s=1-i;return e*s*s*s+t*3*s*s*i+n*3*s*i*i+r*i*i*i}},_computeRotationValuesToXAxis:{enumerable:!1,value:function(e,t,n){var r,i,s,o,u;return e*e<1e-100&&(e=1e-50),r=e*e+t*t,i=Math.sqrt(r),s=1/i,u=e*s,o=-t*s,s=1/Math.sqrt(r+n*n),[o,u,-n*s,i*s]}},_infinite:{enumerable:!1,value:1e100},_sphereIntersection:{enumerable:!1,value:function(e,t){var n=e[0]*t[1]-e[1]*t[0],r=e[0]*t[0]+e[1]*t[1],i=n*t[2]+e[2]*t[3],s=e[3]*e[3],o,u,a;return r*r+i*i<=s?(o=n*t[3]-e[2]*t[2],u=Math.sqrt(s-r*r-i*i),a=o-u,a<0?o+u<0?this._infinite:0:a):this._infinite}},_bezierTubeBoundingSphere:{enumerable:!1,value:function(e,t){var n=e[0],r=e[1],i=e[2],s=e[0],o=e[1],u=e[2],a,f,l,c,h;return h=e[3],h<n?n=h:h>s&&(s=h),h=e[4],h<r?r=h:h>o&&(o=h),h=e[5],h<i?i=h:h>u&&(u=h),h=e[6],h<n?n=h:h>s&&(s=h),h=e[7],h<r?r=h:h>o&&(o=h),h=e[8],h<i?i=h:h>u&&(u=h),h=e[9],h<n?n=h:h>s&&(s=h),h=e[10],h<r?r=h:h>o&&(o=h),h=e[11],h<i?i=h:h>u&&(u=h),a=(s-n)*.5,f=(o-r)*.5,l=(u-i)*.5,c=Math.sqrt(a*a+f*f+l*l)+t,[n+a,r+f,i+l,c]}},_raycastBezierTubes:{enumerable:!1,value:function(e,t,n,r){var i,s,o=[],u=this._infinite,a=null,f=0,l=null,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F=0,I=this._flow._splinePaths;for(j=0;j<I.length;j++)for(B=0;B<I[j]._knots.length-1;B++)o[F]=[I[j]._knots[B][0]-e,I[j]._knots[B][1]-t,I[j]._knots[B][2]-n,I[j]._nextHandlers[B][0]-e,I[j]._nextHandlers[B][1]-t,I[j]._nextHandlers[B][2]-n,I[j]._previousHandlers[B+1][0]-e,I[j]._previousHandlers[B+1][1]-t,I[j]._previousHandlers[B+1][2]-n,I[j]._knots[B+1][0]-e,I[j]._knots[B+1][1]-t,I[j]._knots[B+1][2]-n,0,1048576,B,j],F++;B=F-1;while(B>=0)v=o[B],g=(v[0]+v[3])*.5,y=(v[3]+v[6])*.5,b=(v[6]+v[9])*.5,x=(v[1]+v[4])*.5,T=(v[4]+v[7])*.5,N=(v[7]+v[10])*.5,A=(v[2]+v[5])*.5,O=(v[5]+v[8])*.5,M=(v[8]+v[11])*.5,w=(g+y)*.5,E=(y+b)*.5,S=(w+E)*.5,C=(x+T)*.5,k=(T+N)*.5,L=(C+k)*.5,_=(A+O)*.5,D=(O+M)*.5,P=(_+D)*.5,H=v[13]>>1,c=[v[0],v[1],v[2],g,x,A,w,C,_,S,L,P,v[12],H,v[14],v[15]],i=this._bezierTubeBoundingSphere(c,this._flow._elementsBoundingSphereRadius),h=[S,L,P,E,k,D,b,N,M,v[9],v[10],v[11],v[12]+H,H,v[14],v[15]],s=this._bezierTubeBoundingSphere(h,this._flow._elementsBoundingSphereRadius),p=this._sphereIntersection(i,r),d=this._sphereIntersection(s,r),p<u?d<u?p<d?H?(o[B++]=h,o[B]=c):(u=p-1e-5,f=v[12],a=v[14],l=v[15],B--):H?(o[B++]=c,o[B]=h):(u=d-1e-5,f=v[12],a=v[14],l=v[15],B--):H?o[B]=c:(u=p-1e-5,f=v[12],a=v[14],l=v[15],B--):d<u?H?o[B]=h:(u=d-1e-5,f=v[12],a=v[14],l=v[15],B--):B--;return[l,a,f*(1/1048576)]}},_translateStride:{enumerable:!1,value:null},translateStride:{serializable:!0,get:function(){return this._translateStride},set:function(e){this._translateStride=e,this.translateStrideX=e}},startStrideTime:{enumerable:!1,value:null},_scrollEnd:{enumerable:!1,value:null},_scrollStart:{enumerable:!1,value:null},_hasMomentum:{enumerable:!1,value:!0},_animationInterval:{enumerable:!1,value:function(){var e=Date.now(),t,n,r,i,s,o=!1,u,a,f;a=this.minScroll,f=this.maxScroll,this.minScroll=null,this.maxScroll=null,this._scrollEnd===null&&(this._scrollStart=this.scroll,this._pageX=this.endX,this._pageY=this.endY,this._updateScroll(),this._scrollEnd=this.scroll,this._pageX=this.startX,this._pageY=this.startY,this._updateScroll()),this.animateMomentum?(t=e-this.startTime,t<this.__momentumDuration?(this._pageX=this.startX+(this.momentumX+this.momentumX*(this.__momentumDuration-t)/this.__momentumDuration)*t/1e3/2,this._pageY=this.startY+(this.momentumY+this.momentumY*(this.__momentumDuration-t)/this.__momentumDuration)*t/1e3/2,this._updateScroll(),this.translateStrideX&&this.startStrideXTime===null&&(this.__momentumDuration-t<this.translateStrideDuration||Math.abs(this.scroll-this._scrollEnd)<this.translateStrideX*.75)&&(this.startStrideXTime=e,this._strideStartScroll=this._scroll)):this.animateMomentum=!1):this.startStrideXTime===null&&(this.startStrideXTime=this.startTime,this._strideStartScroll=this._scrollStart),u=this.scroll,this.startStrideXTime&&e-this.startStrideXTime>0&&(r=Math.round(this._scrollEnd/this.translateStrideX),e-this.startStrideXTime<this.translateStrideDuration?(t=this._bezierTValue((e-this.startStrideXTime)/this.translateStrideDuration,.275,0,.275,1),n=(e-this.startStrideXTime)/this.translateStrideDuration,u=u*(1-n)+(r*this.translateStrideX*t+this._strideStartScroll*(1-t))*n,o=!0):u=r*this.translateStrideX),this.minScroll=a,this.maxScroll=f,u<a&&(u=a,this.animateMomentum=!1,o=!1),u>f&&(u=f,this.animateMomentum=!1,o=!1),this.scroll=u,this.isAnimating=this.animateMomentum||o,this.isAnimating?this.needsFrame=!0:(this._dispatchTranslateEnd(),this._scrollEnd=null)}}})}}),montageDefine("120b0c7","ui/composer/translate-composer",{dependencies:["montage","ui/composer/composer","core/event/event-manager"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/composer/composer").Composer,s=e("core/event/event-manager").defaultEventManager,o=t.TranslateComposer=r.create(i,{_NATIVE_ELEMENTS:{value:["A","IFRAME","EMBED","OBJECT","VIDEO","AUDIO","CANVAS","LABEL","INPUT","BUTTON","SELECT","TEXTAREA","KEYGEN","DETAILS","COMMAND"]},_WHEEL_POINTER:{value:"wheel",writable:!1},_externalUpdate:{value:!0},isAnimating:{value:!1},frame:{value:function(e){this.isAnimating&&this._animationInterval(),this._externalUpdate=!1}},_pointerSpeedMultiplier:{value:1},pointerSpeedMultiplier:{get:function(){return this._pointerSpeedMultiplier},set:function(e){this._pointerSpeedMultiplier=e}},pointerStartEventPosition:{value:null},_shouldDispatchTranslate:{value:!1},_isSelfUpdate:{value:!1},_allowFloats:{value:!1},allowFloats:{get:function(){return this._allowFloats},set:function(e){this._allowFloats!==e&&(this._allowFloats=e,this.translateX=this._translateX,this.translateY=this._translateY)}},_translateX:{value:0},translateX:{get:function(){return this._translateX},set:function(e){if(this._axis==="vertical")this._translateX=this._minTranslateX||0;else{var t=isNaN(e)?0:this._allowFloats?parseFloat(e):e>>0;this._minTranslateX!==null&&t<this._minTranslateX&&(t=this._minTranslateX),this._maxTranslateX!==null&&t>this._maxTranslateX&&(t=this._maxTranslateX),this._isSelfUpdate||(this.isAnimating=!1),this._translateX=t}}},_translateY:{value:0},translateY:{get:function(){return this._translateY},set:function(e){if(this._axis==="horizontal")this._translateY=this._minTranslateY||0;else{var t=isNaN(e)?0:this._allowFloats?parseFloat(e):e>>0;this._minTranslateY!==null&&t<this._minTranslateY&&(t=this._minTranslateY),this._maxTranslateY!==null&&t>this._maxTranslateY&&(t=this._maxTranslateY),this._isSelfUpdate||(this.isAnimating=!1),this._translateY=t}}},_minTranslateX:{value:null},minTranslateX:{get:function(){return this._minTranslateX},set:function(e){e!==null&&(e=parseFloat(e)),this._minTranslateX!=e&&(e!==null&&this._translateX<e&&(this.translateX=e),this._minTranslateX=e)}},_maxTranslateX:{value:null},maxTranslateX:{get:function(){return this._maxTranslateX},set:function(e){e!==null&&(e=parseFloat(e)),this._maxTranslateX!=e&&(e!==null&&this._translateX>e&&(this.translateX=e),this._maxTranslateX=e)}},_minTranslateY:{value:null},minTranslateY:{get:function(){return this._minTranslateY},set:function(e){e!==null&&(e=parseFloat(e)),this._minTranslateY!=e&&(e!==null&&this._translateY<e&&(this.translateY=e),this._minTranslateY=e)}},_maxTranslateY:{value:null},maxTranslateY:{get:function(){return this._maxTranslateY},set:function(e){e!==null&&(e=parseFloat(e)),this._maxTranslateY!=e&&(e!==null&&this._translateY>e&&(this.translateY=e),this._maxTranslateY=e)}},_axis:{value:"both"},axis:{get:function(){return this._axis},set:function(e){switch(e){case"vertical":case"horizontal":this._axis=e,this.translateX=this._translateX,this.translateY=this._translateY;break;default:this._axis="both"}}},invertAxis:{depends:["invertXAxis","invertYAxis"],get:function(){return this._invertXAxis===this._invertYAxis?this._invertXAxis:null},set:function(e){this.invertXAxis=e,this.invertYAxis=e}},_invertXAxis:{value:!1},invertXAxis:{get:function(){return this._invertXAxis},set:function(e){this._invertXAxis=!!e}},_invertYAxis:{value:!1},invertYAxis:{get:function(){return this._invertYAxis},set:function(e){this._invertYAxis=!!e}},startTranslateSpeed:{value:500},startTranslateRadius:{value:8},_hasMomentum:{value:!0},hasMomentum:{get:function(){return this._hasMomentum},set:function(e){this._hasMomentum=e?!0:!1}},__momentumDuration:{value:650},_momentumDuration:{get:function(){return this.__momentumDuration},set:function(e){this.__momentumDuration=isNaN(e)?1:e>>0,this.__momentumDuration<1&&(this.__momentumDuration=1)}},_pointerX:{value:null},_pointerY:{value:null},_touchIdentifier:{value:null},_isFirstMove:{value:!1},_start:{value:function(e,t,n){this.pointerStartEventPosition={pageX:e,pageY:t,target:n},this._pointerX=e,this._pointerY=t,window.Touch?(document.addEventListener("touchend",this,!0),document.addEventListener("touchmove",this,!0)):(document.addEventListener("mouseup",this,!0),document.addEventListener("mousemove",this,!0)),this.isAnimating=!1,this._isFirstMove=!0}},_observedPointer:{value:null},_shouldPreventDefault:{value:function(e){return!!e.target.tagName&&o._NATIVE_ELEMENTS.indexOf(e.target.tagName)===-1&&!e.target.isContentEditable}},captureMousedown:{value:function(e){if(e.button!==0)return;this._shouldPreventDefault(e)&&e.preventDefault(),this._observedPointer="mouse",this._start(e.clientX,e.clientY,e.target)}},handleMousedown:{value:function(e){e.button===0&&!this.eventManager.componentClaimingPointer(this._observedPointer)&&this.eventManager.claimPointer(this._observedPointer,this)}},captureMousemove:{value:function(e){this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?(e.preventDefault(),this._move(e.clientX,e.clientY)):this.axis!=="both"?this._analyzeMovement(e):this._stealPointer()&&(e.preventDefault(),this._move(e.clientX,e.clientY))}},captureMouseup:{value:function(e){this._end(e)}},_releaseInterest:{value:function(){window.Touch?(document.removeEventListener("touchend",this,!0),document.removeEventListener("touchmove",this,!0)):(document.removeEventListener("mouseup",this,!0),document.removeEventListener("mousemove",this,!0)),this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this.eventManager.forfeitPointer(this._observedPointer,this),this._observedPointer=null}},captureTouchstart:{value:function(e){this._shouldPreventDefault(e)&&e.preventDefault();if(this._observedPointer!==null&&this.eventManager.isPointerClaimedByComponent(this._observedPointer,this))return;e.targetTouches.length===1&&(this._observedPointer=e.targetTouches[0].identifier,this._start(e.targetTouches[0].clientX,e.targetTouches[0].clientY,e.targetTouches[0].target))}},handleTouchstart:{value:function(e){this.eventManager.componentClaimingPointer(this._observedPointer)||e.targetTouches.length===1&&(this._shouldPreventDefault(e)&&e.preventDefault(),this.eventManager.claimPointer(this._observedPointer,this))}},captureTouchmove:{value:function(e){var t=0,n=e.changedTouches.length;while(t<n&&e.changedTouches[t].identifier!==this._observedPointer)t++;t<n&&(this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?(e.preventDefault(),this._move(e.changedTouches[t].clientX,e.changedTouches[t].clientY)):this._analyzeMovement(e.changedTouches[t]))}},captureTouchend:{value:function(e){var t=0,n=e.changedTouches.length;while(t<n&&e.changedTouches[t].identifier!==this._observedPointer)t++;t<n&&this._end(e.changedTouches[t])}},_analyzeMovement:{value:function(e){var t=e.velocity;if(!t)return;var n=.7853981633974483,r=2.356194490192345,i=-2.356194490192345,s=-0.7853981633974483,o,u,a,f,l,c,h,p;c=t.speed;if(0===t.speed||isNaN(t.speed))return;l=t.angle,"horizontal"===this.axis?(a=l<=n&&l>=s,f=l>=r||l<=i,(a||f)&&this._stealPointer()):"vertical"===this.axis?(o=l<=s&&l>=i,u=l>=n&&l<=r,(o||u)&&this._stealPointer()):c>=this.startTranslateSpeed?this._stealPointer():(h=this.pointerStartEventPosition.pageX-e.pageX,p=this.pointerStartEventPosition.pageY-e.pageY,h*h+p*p>this.startTranslateRadius*this.startTranslateRadius&&this._stealPointer())}},_stealPointer:{value:function(){return this.eventManager.claimPointer(this._observedPointer,this)}},_translateEndTimeout:{value:null},captureMousewheel:{value:function(e){this.eventManager.componentClaimingPointer(this._WHEEL_POINTER)||this.eventManager.claimPointer(this._WHEEL_POINTER,this.component)}},handleMousewheel:{value:function(e){var t=this;if(this.eventManager.isPointerClaimedByComponent(this._WHEEL_POINTER,this.component)){var n=this._translateY;this._dispatchTranslateStart(),this.translateY=this._translateY-e.wheelDeltaY*20/120,this._dispatchTranslate(),window.clearTimeout(this._translateEndTimeout),this._translateEndTimeout=window.setTimeout(function(){t._dispatchTranslateEnd()},400),n!==this._translateY&&this._shouldPreventDefault(e)&&e.preventDefault(),this.eventManager.forfeitPointer(this._WHEEL_POINTER,this.component)}}},_move:{value:function(e,t){var n;this._isFirstMove&&(this._dispatchTranslateStart(this._translateX,this._translateY),this._isFirstMove=!1),this._isSelfUpdate=!0,this._axis!="vertical"&&(n=this._invertXAxis?this._pointerX-e:e-this._pointerX,this.translateX+=n*this._pointerSpeedMultiplier),this._axis!="horizontal"&&(n=this._invertYAxis?this._pointerY-t:t-this._pointerY,this.translateY+=n*this._pointerSpeedMultiplier),this._isSelfUpdate=!1,this._pointerX=e,this._pointerY=t,this._shouldDispatchTranslate&&this._dispatchTranslate()}},_bezierTValue:{value:function(e,t,n,r,i){var s=1-3*r+3*t,o=3*r-6*t,u=3*t,a=.5,f,l,c,h;for(l=0;l<10;l++)h=a*a,f=3*s*h+2*o*a+u,c=1-a,a-=(3*(c*c*a*t+c*h*r)+h*a-e)/f;return h=a*a,c=1-a,3*(c*c*a*n+c*h*i)+h*a}},_dispatchTranslateStart:{value:function(e,t){var n=document.createEvent("CustomEvent");n.initCustomEvent("translateStart",!0,!0,null),n.translateX=e,n.translateY=t,this.dispatchEvent(n)}},_dispatchTranslateEnd:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateEnd",!0,!0,null),e.translateX=this._translateX,e.translateY=this._translateY,this.dispatchEvent(e)}},_dispatchTranslate:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translate",!0,!0,null),e.translateX=this._translateX,e.translateY=this._translateY,this.dispatchEvent(e)}},animateBouncingX:{value:!1,enumerable:!1},startTimeBounceX:{value:!1,enumerable:!1},animateBouncingY:{value:!1,enumerable:!1},startTimeBounceY:{value:!1,enumerable:!1},animateMomentum:{value:!1,enumerable:!1},startTime:{value:null,enumerable:!1},startX:{value:null,enumerable:!1},posX:{value:null,enumerable:!1},endX:{value:null,enumerable:!1},startY:{value:null,enumerable:!1},posY:{value:null,enumerable:!1},endY:{value:null,enumerable:!1},translateStrideX:{value:null},translateStrideY:{value:null},translateStrideDuration:{value:330},_animationInterval:{value:function(){var e=Date.now(),t,n,r,i,s=!1;this.animateMomentum&&(t=e-this.startTime,t<this.__momentumDuration?(this.posX=this.startX-(this.momentumX+this.momentumX*(this.__momentumDuration-t)/this.__momentumDuration)*t/1e3/2,this.posY=this.startY-(this.momentumY+this.momentumY*(this.__momentumDuration-t)/this.__momentumDuration)*t/1e3/2,this.translateStrideX&&this.startStrideXTime===null&&(this.__momentumDuration-t<this.translateStrideDuration||Math.abs(this.posX-this.endX)<this.translateStrideX*.75)&&(this.startStrideXTime=e),this.translateStrideY&&this.startStrideYTime===null&&(this.__momentumDuration-t<this.translateStrideDuration||Math.abs(this.posY-this.endY)<this.translateStrideY*.75)&&(this.startStrideYTime=e)):this.animateMomentum=!1),n=Math.round(this.endX/this.translateStrideX),this.startStrideXTime&&e-this.startStrideXTime>0&&(e-this.startStrideXTime<this.translateStrideDuration?(t=this._bezierTValue((e-this.startStrideXTime)/this.translateStrideDuration,.275,0,.275,1),this.posX=this.posX*(1-t)+n*this.translateStrideX*t,s=!0):this.posX=n*this.translateStrideX),n=Math.round(this.endY/this.translateStrideY),this.startStrideYTime&&e-this.startStrideYTime>0&&(e-this.startStrideYTime<this.translateStrideDuration?(t=this._bezierTValue((e-this.startStrideYTime)/this.translateStrideDuration,.275,0,.275,1),this.posY=this.posY*(1-t)+n*this.translateStrideY*t,s=!0):this.posY=n*this.translateStrideY),r=this.posX,i=this.posY,this._isSelfUpdate=!0,this.translateX=r,this.translateY=i,this._isSelfUpdate=!1,this.isAnimating=this.animateMomentum||s,this.isAnimating?this.needsFrame=!0:this._dispatchTranslateEnd()}},_end:{value:function(e){this.startTime=Date.now(),this.endX=this.posX=this.startX=this._translateX,this.endY=this.posY=this.startY=this._translateY,this._hasMomentum&&(e.velocity.speed>40||this.translateStrideX||this.translateStrideY)?(this._axis!="vertical"?this.momentumX=e.velocity.x*this._pointerSpeedMultiplier*(this._invertXAxis?1:-1):this.momentumX=0,this._axis!="horizontal"?this.momentumY=e.velocity.y*this._pointerSpeedMultiplier*(this._invertYAxis?1:-1):this.momentumY=0,this.endX=this.startX-this.momentumX*this.__momentumDuration/2e3,this.endY=this.startY-this.momentumY*this.__momentumDuration/2e3,this.startStrideXTime=null,this.startStrideYTime=null,this.animateMomentum=!0):this.animateMomentum=!1,this.animateMomentum?this._animationInterval():this._isFirstMove||this._dispatchTranslateEnd(),this._releaseInterest()}},surrenderPointer:{value:function(e,t){return!0}},eventManager:{get:function(){return s}},load:{value:function(){window.Touch?(this._element.addEventListener("touchstart",this,!0),this._element.addEventListener("touchstart",this,!1)):(this._element.addEventListener("mousedown",this,!0),this._element.addEventListener("mousedown",this,!1),this._element.addEventListener("mousewheel",this,!1),this._element.addEventListener("mousewheel",this,!0)),this.eventManager.isStoringPointerEvents=!0}},addEventListener:{value:function(e,t,n){i.addEventListener.call(this,e,t,n),e==="translate"&&(this._shouldDispatchTranslate=!0)}}})}}),montageDefine("fb87e57","filtered-camera.reel/filtered-camera",{dependencies:["montage/core/core","montage/ui/component","montage/core/event/mutable-event","shuriken/effect/effect-library","filters/paparazzi-repository","montage/core/promise","gl-util"],factory:function(e,t,n){var r=e("montage/core/core").Montage,i=e("montage/ui/component").Component,s=e("montage/core/event/mutable-event").MutableEvent,o=e("shuriken/effect/effect-library").EffectLibrary,u=e("filters/paparazzi-repository").PaparazziRepository,a=e("montage/core/promise").Promise,f=e("gl-util").glUtil;t.FilteredCamera=r.create(i,{canvas:{value:null},snapshotCanvas:{value:null},snapshotCtx:{value:null},previewCanvas:{value:null},previewCtx:{value:null},previewImage:{value:null},filters:{value:[],distinct:!0},gl:{value:null},video:{value:null},stream:{value:null},texture:{value:null},vertexBuffer:{value:null},framebuffer:{value:null},identityMat:{value:mat4.identity()},invertedIdentityMat:{value:null},projectionMat:{value:null},startTime:{value:0},_filterIndex:{value:-1},filterIndex:{get:function(){return this._filterIndex},set:function(e){var t=this;if(!this.filters.length){this._filterIndex=-1,this.filter=null;return}this._filterIndex=(e+this.filters.length)%this.filters.length,this.filter=this.filters[this._filterIndex],this.needsDraw=!0}},filter:{value:null},mousestate:{value:null},useNextFilter:{value:function(){this.filterIndex=this._filterIndex+1}},usePrevFilter:{value:function(){this.filterIndex=this._filterIndex-1}},templateDidLoad:{value:function(){var e=this;this.startTime=Date.now(),this.projectionMat=mat4.create(),this.invertedIdentityMat=mat4.identity(),mat4.scale(this.invertedIdentityMat,[1,-1,1]);try{navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,window.URL=window.URL||window.webkitURL,navigator.getUserMedia({video:!0},function(t){e.video.src=window.URL.createObjectURL(t),e.stream=t,e.video.play(),document.addEventListener("webkitvisibilitychange",function(){document.webkitHidden?(console.log("Hidden! Pausing!"),e.video.pause()):(console.log("Visible! Playing!"),e.video.play())},!1)},function(){console.log("getUserMedia denied")})}catch(t){console.log("getUserMedia failed:",t)}window.addEventListener("resize",function(){e.resizeCanvas()},!1),this.canvas.element.addEventListener("click",function(t){e.handleClick(t)},!1),this.canvas.element.addEventListener("mousemove",function(t){e.mousestate={offsetX:t.offsetX-e.canvas.width/2,offsetY:t.offsetY-e.canvas.height/2}},!1)}},handleGlready:{value:function(){var e=this;this.gl=this.canvas.gl,this.initGLTexture(this.gl),this.initGLBuffer(this.gl),this.initGLFramebuffer(this.gl,640,480),this.resizeCanvas(),this.previewImage=new Image,this.previewImage.addEventListener("load",function(){e.initFilterList()},!1),this.previewImage.src="./img/default-scene.png",this.filterIndex=this.filterIndex}},initFilterList:{value:function(){var e=this;o.registerEffectRepository("Paparazzi",u.templates);var t,n=0,r=u.templates;for(t in r)n++;for(t in r)this.buildFilter(t,function(t){e.filters.push(t),e.filter||(e.filterIndex=0,e.needsDraw=!0);if(e.filters.length==n){var r=document.createEvent("CustomEvent");r.initCustomEvent("filtersloaded",!0,!1,null),e.dispatchEvent(r)}});this.filterIndex=0}},handleClick:{value:function(e){var t=e.offsetX/this.canvas.width;t<.3?this.usePrevFilter():t>.7&&this.useNextFilter()}},resizeCanvas:{value:function(){var e=this.gl;if(!e)return;this.canvas.width=this.element.offsetWidth,this.canvas.height=480,mat4.perspective(45,this.canvas.width/this.canvas.height,1,1024,this.projectionMat),e.viewport(0,0,this.canvas.width,this.canvas.height)}},draw:{value:function(){var e=this.gl;if(!e||!this.filter)return;this.updateGLTexture(e),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var t=this.video,n=t.videoWidth/t.videoHeight,r=mat4.create(),i=this.nextFilter||this.filter,s=this.prevFilter||this.filter;this.drawFilteredView(e,this.filter,this.identityMat,this.identityMat),this.needsDraw=!0}},drawFilteredView:{value:function(e,t,n,r){if(!t||!t.shaderProgram)return;var i=t.shaderProgram;e.useProgram(i),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.enableVertexAttribArray(i.attribute.aPosition),e.vertexAttribPointer(i.attribute.aPosition,3,e.FLOAT,!1,20,0),e.enableVertexAttribArray(i.attribute.aTexCoord),e.vertexAttribPointer(i.attribute.aTexCoord,2,e.FLOAT,!1,20,12);var s,o=t._textures.length;for(s=0;s<o;s++)e.activeTexture(e.TEXTURE1+s),e.bindTexture(e.TEXTURE_2D,t._textures[s]);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),e.uniform1i(i.uniform.uSampler,0),i.uniform.uModelViewMatrix&&e.uniformMatrix4fv(i.uniform.uModelViewMatrix,!1,n),i.uniform.uProjMatrix&&e.uniformMatrix4fv(i.uniform.uProjMatrix,!1,r),i.uniform.uTime&&e.uniform1f(i.uniform.uTime,(Date.now()-this.startTime)/1e3),i.uniform.uInverseTextureSize&&e.uniform2f(i.uniform.uInverseTextureSize,1/this.camera.videoWidth,1/this.videoHeight),e.drawArrays(e.TRIANGLES,0,6)}},initGLTexture:{value:function(e){this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGB,1,1,0,e.RGB,e.UNSIGNED_BYTE,null)}},updateGLTexture:{value:function(e){e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,this.video)}},initGLBuffer:{value:function(e){var t=[-1,-1,0,1,0,1,-1,0,0,0,-1,1,0,1,1,-1,1,0,1,1,1,-1,0,0,0,1,1,0,0,1];this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW)}},initGLFramebuffer:{value:function(e,t,n){var r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,n,0,e.RGBA,e.UNSIGNED_BYTE,null),this.framebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0),e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),this.snapshotCanvas=document.createElement("canvas"),this.snapshotCanvas.width=t,this.snapshotCanvas.height=n,this.snapshotCtx=this.snapshotCanvas.getContext("2d"),this.previewCanvas=document.createElement("canvas"),this.previewCanvas.width=t/2,this.previewCanvas.height=n/2,this.previewCtx=this.previewCanvas.getContext("2d")}},handleWillChange:{value:function(e,t,n,r){if(!e.shaderProgram)return;var i=e.inputs[t].type,s=e.shaderProgram.uniform[n];if(!s)return;var o=this.gl,u=a.defer();if(i==="vec4")o.uniform4fv(s,r),u.resolve();else if(i==="vec3")o.uniform3fv(s,r),u.resolve();else if(i=="path"){var f=new Image,l=this,c=o.createTexture();c.image=new Image,c.image.onload=function(){var t=e._textures.length+1;o.activeTexture(o.TEXTURE0+t),o.bindTexture(o.TEXTURE_2D,c),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,c.image),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),e._textures.push(c),o.useProgram(e.shaderProgram),o.uniform1i(s,t),u.resolve()},c.image.src=r}else u.resolve();return u.promise}},_getSourceFromScript:{value:function(e){var t=null;if(e){t="";var n=e.firstChild;while(n)n.nodeType==3&&(t+=n.textContent),n=n.nextSibling}return t}},filterDidChange:{value:function(e,t){var n=this.gl,r=[];if(!e.profiles.GLSL){console.error("Cannot use filters without a GLSL profile");return}var i=null,s=e.profiles.GLSL,o=s.techniques;if(o){techniqueNames=Object.keys(o);if(techniqueNames.length){var u=techniqueNames[0],l=o[u],c=Object.keys(l);i=l[c[0]],e.shaderProgram=f.createShaderProgram(n,this._getSourceFromScript(i["x-shader/x-vertex"]),this._getSourceFromScript(i["x-shader/x-fragment"])),n.useProgram(e.shaderProgram),e._textures=[]}}if(i){var h=e.inputKeys;h&&h.forEach(function(t){var n=i.inputs;n&&(symbol=n[t].symbol,symbol||(symbol=t));var s,o;o=e.inputs[t],r.push(this.handleWillChange(e,t,symbol,o.value))},this)}t&&a.all(r).then(t),this.needsDraw=!0}},buildFilter:{value:function(e,t){var n=this.gl;if(!n)return;var r=this;o.effectWithName(e,function(n){n.name=e,r.filterDidChange(n,function(){n.previewSrc=r.getFilterPreviewURL(r.previewImage,n),t&&t(n)})})}},getFilterPreviewURL:{value:function(e,t){var n=this.gl;n.bindTexture(n.TEXTURE_2D,this.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGB,n.RGB,n.UNSIGNED_BYTE,e);var r=this.previewCanvas.width,i=this.previewCanvas.height,s=this.previewCtx.createImageData(r,i),o=new Uint8Array(r*i*4);n.bindFramebuffer(n.FRAMEBUFFER,this.framebuffer),n.viewport(0,0,r,i),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),this.drawFilteredView(n,t,this.invertedIdentityMat,this.identityMat),n.finish(),n.readPixels(0,0,r,i,n.RGBA,n.UNSIGNED_BYTE,o),n.bindFramebuffer(n.FRAMEBUFFER,null),n.viewport(0,0,this.canvas.width,this.canvas.height);var u;for(u=0;u<o.length;++u)s.data[u]=o[u];return this.previewCtx.putImageData(s,0,0),this.previewCanvas.toDataURL()}},getSnapshotURL:{value:function(){var e=this.gl;this.updateGLTexture(e);var t=this.snapshotCanvas.width,n=this.snapshotCanvas.height,r=this.snapshotCtx.createImageData(t,n),i=new Uint8Array(t*n*4);e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),e.viewport(0,0,t,n),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.drawFilteredView(e,this.filter,this.invertedIdentityMat,this.identityMat),e.finish(),e.readPixels(0,0,t,n,e.RGBA,e.UNSIGNED_BYTE,i),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.canvas.width,this.canvas.height);var s;for(s=0;s<i.length;++s)r.data[s]=i[s];return this.snapshotCtx.putImageData(r,0,0),this.snapshotCanvas.toDataURL()}}})}}),montageDefine("120b0c7","ui/controller/array-controller",{dependencies:["montage","ui/controller/object-controller","core/change-notification","ui/controller/array-controller"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/controller/object-controller").ObjectController,s=e("core/change-notification").ChangeNotification,o=t.ArrayController=r.create(i,{didCreate:{value:function(){var e=this;this.addPropertyChangeListener("selections",function(){var t=[];e._selections.forEach(function(e,n){e&&t.push(n)}),e.selectedIndexes=t}),this.addPropertyChangeListener("content",function(){e.selectedObjects=null,e.automaticallyOrganizeObjects&&e.organizeObjects()})}},_content:{value:null},content:{get:function(){return this._content},set:function(e){if(this._content===e)return;this._content=e}},delegate:{value:null},_organizedObjects:{distinct:!0,value:[]},organizedObjects:{get:function(){return this._organizedObjects}},automaticallyOrganizeObjects:{value:!0},_sortFunction:{value:null},sortFunction:{get:function(){return this._sortFunction},set:function(e){if(this._sortFunction===e)return;this._sortFunction=e,this.automaticallyOrganizeObjects&&this.organizeObjects()}},_filterFunction:{value:null},filterFunction:{get:function(){return this._filterFunction},set:function(e){if(this._filterFunction===e)return;this._filterFunction=e,this.automaticallyOrganizeObjects&&this.organizeObjects()}},_startIndex:{value:null},startIndex:{get:function(){return this._startIndex},set:function(e){if(this._startIndex===e)return;this._startIndex=e,this.automaticallyOrganizeObjects&&this.organizeObjects()}},_endIndex:{enumerable:!1,value:null},endIndex:{get:function(){return this._endIndex},set:function(e){if(this._endIndex===e)return;this._endIndex=e,this.automaticallyOrganizeObjects&&this.organizeObjects()}},_organizedObjectsIndexes:{value:null},_rangedOrganizedObjectsIndexes:{value:null},_selectedIndexes:{value:null},selectedIndexes:{get:function(){return this._selectedIndexes?this._selectedIndexes:this.selectedContentIndexes?this._selectedIndexes=this._convertIndexesFromContentToOrganized(this.selectedContentIndexes):null},set:function(e){if(this.selectedIndexes!==e){var t=e?this._convertIndexesFromOrganizedToContent(e):null,n=null;if(this.delegate&&typeof this.delegate.shouldChangeSelection=="function"){t&&(n=this.content.filter(function(e,n){return t.indexOf(n)>=0},this));if(this.delegate.shouldChangeSelection(this,n,this._selectedObjects)===!1)return}this.dispatchPropertyChange("selections","selectedContentIndexes","selectedObjects",function(){this._selectedIndexes=e,this._selectedContentIndexes=t,this._selectedObjects=null,this._selections=null})}}},_convertIndexesFromOrganizedToContent:{value:function(e){var t,n=[],r,i=e.length,s,o;r=this._rangedOrganizedObjectsIndexes?this._rangedOrganizedObjectsIndexes:this._organizedObjectsIndexes;if(r){o=r.length;for(t=0;t<i;t++)s=e[t],s<o&&s>=0&&(n[n.length]=r[s])}else for(t=0;t<i;t++)n[n.length]=e[t]+this.startIndex;return n.sort()}},_convertIndexesFromContentToOrganized:{value:function(e){var t,n=[],r,i=e.length,s;r=this._rangedOrganizedObjectsIndexes?this._rangedOrganizedObjectsIndexes:this._organizedObjectsIndexes;if(r)for(t=0;t<i;t++)s=e[t],s>=0&&(s=r.indexOf(s),s!==-1&&(n[n.length]=s));else for(t=0;t<i;t++)s=e[t]-this.startIndex,s>-1&&(this.endIndex==null||s<this.endIndex)&&(n[n.length]=s);return n.sort()}},organizeObjects:{value:function(){var e=this.content,t=this.filterFunction,n=this.sortFunction,r=0,i=0,s,o,u,a;e&&typeof t=="function"&&(s=[],e=e.filter(function(e){var n=t.call(this,e);return n&&(s[i]=r,i++),r++,n},this));if(typeof n=="function"){o=[],u=[],r=0;for(r=0;a=e[r];r++)a!==null&&typeof a=="object"?(a._montage_array_controller_index=r,u[r]=a):u[r]={_montage_array_controller_index:r,_montage_array_controller_value:a};u=u.sort(function(e,t){return e._montage_array_controller_value&&(e=e._montage_array_controller_value),t._montage_array_controller_value&&(t=t._montage_array_controller_value),n.call(this,e,t)}),e=[];for(r=0;a=u[r];r++)i=a._montage_array_controller_index,o[r]=s?s[i]:i,a._montage_array_controller_value?e[r]=a._montage_array_controller_value:(e[r]=a,delete a._montage_array_controller_index);this._organizedObjectsIndexes=o}else this._organizedObjectsIndexes=s;this._applyRangeIfNeeded(e)}},_applyRangeIfNeeded:{value:function(e){var t=this.startIndex,n=this.endIndex;e&&(typeof t=="number"||typeof n=="number")&&(t=typeof t=="number"&&t>=0?t:0,n=typeof n=="number"&&n<e.length?n:e.length,e=e.slice(t,n),this._organizedObjectsIndexes?this._rangedOrganizedObjectsIndexes=this._organizedObjectsIndexes.slice(t,n):this._rangedOrganizedObjectsIndexes=null),this.dispatchPropertyChange("organizedObjects",function(){this._organizedObjects=e?e:[]})}},_selectedObjects:{value:null},selectedObjects:{get:function(){return this._selectedObjects?this._selectedObjects:this._selectedContentIndexes?(this.content&&(this._selectedObjects=this.content.filter(function(e,t){return this._selectedContentIndexes.indexOf(t)>=0},this)),this._selectedObjects):null},set:function(e){e===null||typeof e=="undefined"?e=null:Array.isArray(e)||(e=[e]);if(this.selectedObjects===e)return;if(this.delegate&&typeof this.delegate.shouldChangeSelection=="function"&&this.delegate.shouldChangeSelection(this,e,this._selectedObjects)===!1)return;this.dispatchPropertyChange("selections","selectedContentIndexes","selectedIndexes",function(){this._selectedObjects=e,this._selectedContentIndexes=null,this._selectedIndexes=null,this._selections=null})}},_selectedContentIndexes:{value:null},selectedContentIndexes:{get:function(){if(this._selectedContentIndexes)return this._selectedContentIndexes;if(!this._selectedObjects)return null;this._selectedContentIndexes=[];var e;return this._selectedObjects.forEach(function(t){(e=this.content.indexOf(t))!==-1&&this._selectedContentIndexes.push(e)},this),this._selectedContentIndexes},set:function(e){e===null||e===!1||typeof e=="undefined"?e=null:Array.isArray(e)||(e=[e]);if(this.selectedContentIndexes===e)return;if(this.delegate&&typeof this.delegate.shouldChangeSelection=="function"){var t=e,n=null;t&&(n=this.content.filter(function(e,n){return t.indexOf(n)>=0},this));if(this.delegate.shouldChangeSelection(this,n,this._selectedObjects)===!1)return}this._selectedContentIndexes=e,this.dispatchPropertyChange("selections","selectedIndexes","selectedObjects",function(){this._selectedIndexes=null,this._selectedObjects=null,this._selections=null})}},_selections:{value:null},selections:{get:function(){if(!this._selections){this._selections=new Array(this._organizedObjects.length);if(this.selectedIndexes){var e=this._selections,t=this.selectedIndexes,n=t.length,r,i;for(r=0;r<n;r++)i=t[r],i<e.length&&(e[i]=!0)}}return this._selections}},initWithContent:{value:function(e){return this.content=e,this}},selectObjectsOnAddition:{value:!1},clearFilterFunctionOnAddition:{value:!0},add:{value:function(){var e=this.newObject();this.content.push(e),this.selectObjectsOnAddition&&(this.selectedContentIndexes=[this.content.length-1]),this.clearFilterFunctionOnAddition&&(this.filterFunction=null),this.automaticallyOrganizeObjects&&this.organizeObjects()}},addObjects:{value:function(){var e=Array.prototype.slice.call(arguments),t,n=e.length,r,i,s=this.content;s?s.push.apply(s,e):this.content=s=e;if(this.selectObjectsOnAddition){r=[],i=s.length-n;for(t=0;t<n;t++)r[t]=i++;this.selectedContentIndexes=r,this.selectedObjects=e}this.clearFilterFunctionOnAddition&&(this.filterFunction=null),this.automaticallyOrganizeObjects&&this.organizeObjects()}},remove:{value:function(){var e;return this.selectedObjects&&this.selectedObjects.length>0&&(e=this.removeObjects.apply(this,this.selectedObjects),this.automaticallyOrganizeObjects&&this.organizeObjects()),e}},removeObjects:{value:function(){var e=Array.prototype.slice.call(arguments),t;return t=this.content.filter(function(t){return e.indexOf(t)<0}),this.content=t,this.automaticallyOrganizeObjects&&this.organizeObjects(),e}},removeObjectsAtSelectedIndexes:{value:function(){return this.removeObjectsAtIndexes(this.selectedIndexes)}},removeObjectsAtIndexes:{value:function(e){var t,n;return e&&e.length>0&&(t=[],n=this.content.filter(function(n,r){return e.indexOf(r)<0?!0:(t.push(n),!1)}),this.content=n,this.automaticallyOrganizeObjects&&this.organizeObjects()),t}}})}}),montageDefine("120b0c7","ui/composer/press-composer",{dependencies:["montage","ui/composer/composer","core/event/mutable-event"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/composer/composer").Composer,s=e("core/event/mutable-event").MutableEvent,o=t.PressComposer=r.create(i,{load:{value:function(){window.Touch?this._element.addEventListener("touchstart",this,!0):this._element.addEventListener("mousedown",this,!0)}},unload:{value:function(){window.Touch?this._element.removeEventListener("touchstart",this):this._element.removeEventListener("mousedown",this)}},delegate:{value:null},cancelPress:{value:function(){return this._state===o.PRESSED?(this._dispatchPressCancel(),this._endInteraction(),!0):!1}},addEventListener:{value:function(e,t,n){i.addEventListener.call(this,e,t,n),e==="longPress"&&(this._shouldDispatchLongPress=!0)}},UNPRESSED:{value:0},PRESSED:{value:1},CANCELLED:{value:2},_state:{enumerable:!1,value:0},state:{get:function(){return this._state}},_shouldDispatchLongPress:{enumerable:!1,value:!1},_longPressThreshold:{enumerable:!1,value:1e3},longPressThreshold:{get:function(){return this._longPressThreshold},set:function(e){this._longPressThreshold!==e&&(this._longPressThreshold=e)}},_longPressTimeout:{enumberable:!1,value:null},_observedPointer:{enumerable:!1,value:null},_startInteraction:{enumerable:!1,value:function(e){if("disabled"in this.component&&this.component.disabled||this._observedPointer!==null)return!1;var t=0,n;if(e.type==="touchstart"){n=e.changedTouches.length;for(;t<n;t++)if(!this.component.eventManager.componentClaimingPointer(e.changedTouches[t].identifier)){this._observedPointer=e.changedTouches[t].identifier;break}if(this._observedPointer===null)return!1;document.addEventListener("touchend",this,!1),document.addEventListener("touchcancel",this,!1)}else e.type==="mousedown"&&(this._observedPointer="mouse",document.addEventListener("mouseup",this,!1),document.addEventListener("click",this,!1));this._element.addEventListener("dragstart",this,!1),this.component.eventManager.claimPointer(this._observedPointer,this),this._dispatchPressStart(e)}},_interpretInteraction:{value:function(e){var t,n,r;if(this._observedPointer===null){this._endInteraction(e);return}t=!this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this),n=e.target;while(n!==this._element&&n&&n.parentNode)n=n.parentNode;r=n===this._element;if(t&&e.type==="click"){e.preventDefault(),this._endInteraction(e);return}if(e.type==="mouseup"){if(!t&&r){this._dispatchPress(e),this._endInteraction(e);return}if(!t&&!r){this._dispatchPressCancel(e),this._endInteraction(e);return}t&&!r&&this._endInteraction(e)}}},_endInteraction:{value:function(e){if(!e||e.type==="touchend"||e.type==="touchcancel")document.removeEventListener("touchend",this),document.removeEventListener("touchcancel",this);else if(!e||e.type==="click"||e.type==="mouseup")document.removeEventListener("click",this),document.removeEventListener("mouseup",this);this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this.component.eventManager.forfeitPointer(this._observedPointer,this),this._observedPointer=null,this._state=o.UNPRESSED}},_changedTouchisObserved:{value:function(e){if(this._observedPointer===null)return!1;var t=0,n=event.changedTouches.length;for(;t<n;t++)if(event.changedTouches[t].identifier===this._observedPointer)return t;return!1}},surrenderPointer:{value:function(e,t){var n=this.callDelegateMethod("surrenderPointer",e,t);return typeof n!="undefined"&&n===!1?!1:(this._dispatchPressCancel(),!0)}},captureTouchstart:{value:function(e){this._startInteraction(e)}},handleTouchend:{value:function(e){if(this._observedPointer===null){this._endInteraction(e);return}this._changedTouchisObserved(e.changedTouches)!==!1&&(this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?this._dispatchPress(e):e.preventDefault(),this._endInteraction(e))}},handleTouchcancel:{value:function(e){if(this._observedPointer===null||this._changedTouchisObserved(e.changedTouches)!==!1)this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this._dispatchPressCancel(e),this._endInteraction(e)}},captureMousedown:{value:function(e){this._startInteraction(e)}},handleClick:{value:function(e){this._interpretInteraction(e)}},handleMouseup:{value:function(e){this._interpretInteraction(e)}},handleDragstart:{value:function(e){this._dispatchPressCancel(e),this._endInteraction()}},_createPressEvent:{enumerable:!1,value:function(e,t){var n,r,i;return t||(t=document.createEvent("CustomEvent"),t.initCustomEvent(e,!0,!0,null)),n=u.create(),n.event=t,n.type=e,n.pointer=this._observedPointer,t.changedTouches&&(i=this._changedTouchisObserved(t.changedTouches))!==!1&&(n.touch=t.changedTouches[i]),n}},_dispatchPressStart:{enumerable:!1,value:function(e){this._state=o.PRESSED,this.dispatchEvent(this._createPressEvent("pressStart",e));if(this._shouldDispatchLongPress){var t=this;this._longPressTimeout=setTimeout(function(){t._dispatchLongPress()},this._longPressThreshold)}}},_dispatchPress:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(clearTimeout(this._longPressTimeout),this._longPressTimeout=null),this.dispatchEvent(this._createPressEvent("press",e)),this._state=o.UNPRESSED}},_dispatchLongPress:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(this.dispatchEvent(this._createPressEvent("longPress",e)),this._longPressTimeout=null)}},_dispatchPressCancel:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(clearTimeout(this._longPressTimeout),this._longPressTimeout=null),this._state=o.CANCELLED,this.dispatchEvent(this._createPressEvent("pressCancel",e))}}}),u=function(){var e,t,n,i,s,o;e=r.create(r,{type:{value:"press"},_event:{enumerable:!1,value:null},event:{get:function(){return this._event},set:function(e){this._event=e}},_touch:{enumerable:!1,value:null},touch:{get:function(){return this._touch},set:function(e){this._touch=e}}}),t=["altKey","ctrlKey","metaKey","shiftKey","cancelBubble","currentTarget","defaultPrevented","eventPhase","timeStamp","preventDefault","stopImmediatePropagation","stopPropagation"],n=["clientX","clientY","pageX","pageY","screenX","screenY","target"],i=function(e){return{get:function(){return this._event[e]}}},s=function(e){return{get:function(){return this._touch?this._touch[e]:this._event[e]}}};for(o=t.length-1;o>=0;o--)r.defineProperty(e,t[o],i(t[o]));for(o=n.length-1;o>=0;o--)r.defineProperty(e,n[o],s(n[o]));return e}()}}),montageDefine("120b0c7","ui/flow-bezier-spline",{dependencies:["montage"],factory:function(e,t,n){var r=e("montage").Montage,i=t.FlowBezierSpline=r.create(r,{didCreate:{value:function(){this._knots=[],this._densities=[]}},knots:{get:function(){return this._knots},set:function(e){this._knots=e}},previousHandlers:{get:function(){return this._previousHandlers||(this._previousHandlers=[]),this._previousHandlers},set:function(e){this._previousHandlers=e}},nextHandlers:{get:function(){return this._nextHandlers||(this._nextHandlers=[]),this._nextHandlers},set:function(e){this._nextHandlers=e}},densities:{get:function(){return this._densities},set:function(e){this._densities=e,this._densitiesLength=this._densities.length,this._maxTime=null}},_parameters:{value:{}},parameters:{get:function(){return this._parameters||(this._parameters={}),this._parameters},set:function(e){this._parameters=e,this._parametersLength=this._parameters.length}},_maxTime:{enumerable:!1,value:null},computeMaxTime:{value:function(){return this._computeDensitySummation(),this._densitySummation.length?this._maxTime=this._densitySummation[this._densitySummation.length-1]:this._maxTime=0,this._maxTime}},_densitySummation:{enumerable:!1,value:null},_computeDensitySummation:{enumerable:!1,value:function(){var e=this.densities,t=e.length-1,n=0,r;this._densitySummation=[];for(r=0;r<t;r++)n+=(e[r]+e[r+1])/2,this._densitySummation[r]=n;this._maxTime=null}},_convertSplineTimeToBezierIndexTime:{enumerable:!1,value:function(e){if(e<0)return null;this._maxTime===null&&this.computeMaxTime();if(e>=this._maxTime)return null;var t=this._densitySummation,n=t.length,r=n-1,i=n>>1,s,o,u,a,f;while(i)r-i>=0&&t[r-i]>e?r-=i:i>>=1;return s=e-(r?t[r-1]:0),u=this._densities[r],a=this._densities[r+1],f=u-a,f<-1e-10||f>1e-10?o=(u-Math.sqrt(u*u+(a-u)*2*s))/f:o=s/u,[r,o]}},getPositionAtIndexTime:{value:function(e){var t=e[0],n=e[1],r=this._knots[t],i=this._nextHandlers[t],s=this._previousHandlers[t+1],o=this._knots[t+1],u=1-n,a=u*u*u,f=u*u*n*3,l=u*n*n*3,c=n*n*n;return[r[0]*a+i[0]*f+s[0]*l+o[0]*c,r[1]*a+i[1]*f+s[1]*l+o[1]*c,r[2]*a+i[2]*f+s[2]*l+o[2]*c]}},getRotationAtIndexTime:{value:function(e){var t=e[0],n=e[1],r,i,s,o=1-n,u=this._parameters;return typeof u.rotateX!="undefined"?r=u.rotateX.data[t]*o+u.rotateX.data[t+1]*n:r=0,typeof u.rotateY!="undefined"?i=u.rotateY.data[t]*o+u.rotateY.data[t+1]*n:i=0,typeof u.rotateZ!="undefined"?s=u.rotateZ.data[t]*o+u.rotateZ.data[t+1]*n:s=0,[r,i,s]}},getStyleAtIndexTime:{value:function(e){var t=e[0],n=e[1],r=this._parameters,i=1-n,s,o,u="";parameterKeys=Object.keys(r),parameterKeyCount=parameterKeys.length;for(s=0;s<parameterKeyCount;s++)o=parameterKeys[s],jParameter=r[o],jParameterData=jParameter.data,o!=="rotateX"&&o!=="rotateY"&&o!=="rotateZ"&&typeof jParameterData[t]!="undefined"&&typeof jParameterData[t+1]!="undefined"&&(u+=o+":"+((jParameterData[t]*i+jParameterData[t+1]*n)*1e5>>0)*1e-5+jParameter.units+";");return u}},transformVectorArray:{value:function(e,t){var n=e.length,r=[],i,s;for(s=0;s<n;s++)i=e[s],i&&(r[s]=[i[0]*t[0]+i[1]*t[4]+i[2]*t[8]+t[12],i[0]*t[1]+i[1]*t[5]+i[2]*t[9]+t[13],i[0]*t[2]+i[1]*t[6]+i[2]*t[10]+t[14]]);return r}},transform:{value:function(e){var t=i.create();return t._densities=this._densities,t._densitySummation=this._densitySummation,t._knots=this.transformVectorArray(this.knots,e),t._previousHandlers=this.transformVectorArray(this.previousHandlers,e),t._nextHandlers=this.transformVectorArray(this.nextHandlers,e),t}},deCasteljau:{value:function(e,t,n,r,i){var s=1-i,o=s*e[0]+i*t[0],u=s*t[0]+i*n[0],a=s*n[0]+i*r[0],f=s*o+i*u,l=s*u+i*a,c=s*f+i*l,h=s*e[1]+i*t[1],p=s*t[1]+i*n[1],d=s*n[1]+i*r[1],v=s*h+i*p,m=s*p+i*d,g=s*v+i*m,y=s*e[2]+i*t[2],b=s*t[2]+i*n[2],w=s*n[2]+i*r[2],E=s*y+i*b,S=s*b+i*w,x=s*E+i*S;return[[e,[o,h,y],[f,v,E],[c,g,x]],[[c,g,x],[l,m,S],[a,d,w],r]]}},cubic:{enumerable:!1,value:function(e,t,n,r,i){return((e*i+t)*i+n)*i+r}},cubeRoot:{enumerable:!1,value:function(e){return e>0?Math.pow(e,1/3):-Math.pow(-e,1/3)}},cubicRealRoots:{enumerable:!1,value:function(e,t,n,r){var i=1e-100,s=Math;if(e<-i||e>i){var o=1/e,u=t*o,a=n*o,f=(3*a-u*u)*(1/9),l=(4.5*u*a-13.5*r*o-u*u*u)*(1/27),c=f*f*f+l*l;if(c>i){var h=s.sqrt(c);return[this.cubeRoot(l+h)+this.cubeRoot(l-h)+u*(-1/3)]}if(c>-i){if(l<-i||l>i){var p=this.cubeRoot(l),d=p*2+u*(-1/3),v=u*(-1/3)-p;return d<v?[d,v]:[v,d]}return[u*(-1/3)]}var m=s.acos(l/s.sqrt(-f*f*f))*(1/3),g=s.sqrt(-f),y=g*s.sin(m)*1.7320508075688772,b=u*(-1/3);return g*=s.cos(m),[b-g-y,b-g+y,b+g*2]}if(t<-i||t>i){var w=n*n-4*t*r;return w>=0?(w=s.sqrt(w),[(-n-w)/(2*t),(w-n)/(2*t)]):[]}return n<-i||n>i?[-r/n]:[]}},_halfPI:{enumerable:!1,value:Math.PI*.5},reflectionMatrix:{enumerable:!1,value:function(e,t,n,r){var i=Math,s=this._halfPI-i.atan2(t,e),o=i.sin(s),u=i.cos(s),a=this._halfPI-i.atan2(n,e*o+t*u),f=i.sin(a);return r[0]=f*o,r[1]=u*f,r[2]=i.cos(a),r}},reflectedY:{enumerable:!1,value:function(e,t,n,r){return e*r[0]+t*r[1]+n*r[2]}},directedPlaneBezierIntersection:{enumerable:!1,value:function(e,t,n,r,i,s,o,u,a){var f=this.reflectionMatrix(r[0],r[1],r[2],a),l=this.reflectedY(i[0]-e,i[1]-t,i[2]-n,f),c=this.reflectedY(s[0]-e,s[1]-t,s[2]-n,f),h=this.reflectedY(o[0]-e,o[1]-t,o[2]-n,f),p=this.reflectedY(u[0]-e,u[1]-t,u[2]-n,f),d=(c-h)*3+p-l,v=(l+h)*3-6*c,m=(c-l)*3,g=this.cubicRealRoots(d,v,m,l),y,b=0,w,E=0,S=[];while(E<g.length&&g[E]<=0)E++;while(E<g.length&&g[E]<1)y=b,b=g[E],w=(y+b)*.5,this.cubic(d,v,m,l,w)>=0&&S.push([y,b]),E++;return w=(b+1)*.5,this.cubic(d,v,m,l,w)>=0&&S.push([b,1]),S}}})}}),montageDefine("120b0c7","ui/native/select.reel/select",{dependencies:["montage","ui/component","ui/controller/array-controller","ui/native-control","ui/composer/press-composer"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=e("ui/controller/array-controller").ArrayController,o=e("ui/native-control").NativeControl,u=e("ui/composer/press-composer").PressComposer,a=t.Select=r.create(o,{_fromInput:{value:null},_synching:{value:null},__selectedIndexes:{value:null,enumerable:!1},_selectedIndexes:{set:function(e){this.__selectedIndexes=e,this.needsDraw===!1&&(this.needsDraw=this._synching||!this._fromInput)},get:function(){return this.__selectedIndexes}},_content:{value:null,enumerable:!1},content:{set:function(e){Array.isArray(e)||(e=[e]),this._content=e;if(!this.contentController){var t=s.create();t.content=e,this.contentController=t}this.needsDraw=!0},get:function(){return this._content}},valuePropertyPath:{value:null},textPropertyPath:{value:null},_contentController:{value:null},contentController:{get:function(){return this._contentController},set:function(e){if(this._contentController===e)return;this._contentController&&Object.deleteBinding(this,"_selectedIndexes"),this._contentController=e,this._contentController&&(this._bindingDescriptors&&Object.deleteBinding(this,"content"),Object.defineBinding(this,"content",{boundObject:this._contentController,boundObjectPropertyPath:"organizedObjects",oneway:!0}),Object.defineBinding(this,"_selectedIndexes",{boundObject:this._contentController,boundObjectPropertyPath:"selectedIndexes"}))}},_getSelectedValuesFromIndexes:{value:function(){var e=this.contentController?this.contentController.selectedObjects:null,t=[];if(e&&e.length>0){var n=0,r=e.length,i;for(;n<r;n++)i=this.valuePropertyPath||"value",e[n][i]&&t.push(e[n][i])}return t}},_synchValues:{value:function(){this._synching||(this._synching=!0,this.values=this._getSelectedValuesFromIndexes(),this.value=this.values&&this.values.length>0?this.values[0]:null,this._synching=!1)}},_values:{value:null},values:{get:function(){return this._values},set:function(e){var t=this.contentController?this.contentController.content:null;if(e&&t){this._values=e;if(!this._synching){var n=[],r=0,i=this._values.length,s;for(;r<i;r++)s=this._indexOf(this._values[r]),s>=0&&n.push(s);this._synching=!0,this.contentController.selectedIndexes=n,this._synching=!1}}}},_value:{value:null},value:{get:function(){return this._value},set:function(e){this._value=e,this._synching||(e==null?this.values=[]:this.values=[e])}},blur:{value:function(){this._element.blur()}},focus:{value:function(){this._element.focus()}},_addOptionsFromMarkup:{value:function(){var e=this.element,t=e.querySelectorAll("option");if(!this.contentController){var n=s.create(),r=[];n.content=[];if(t&&t.length>0){var i=0,o=t.length,u;for(;i<o;i++)u=t[i].getAttribute("selected"),u&&r.push(i),n.addObjects({value:t[i].value,text:t[i].textContent});this.contentController=n,r.length===0&&o>0&&(r=[0]),this._fromInput=!0,this.contentController.selectedIndexes=r}}}},deserializedFromTemplate:{value:function(){this._addOptionsFromMarkup()}},_removeAll:{value:function(e){while(e.firstChild)e.removeChild(e.firstChild)}},_refreshOptions:{value:function(){var e=this.content||[],t=e.length,n,r,i,s;for(n=0;n<t;n++)r=document.createElement("option"),String.isString(e[n])?i=s=e[n]:(i=e[n][this.textPropertyPath||"text"],s=e[n][this.valuePropertyPath||"value"]),r.value=s,r.textContent=i||s,this._selectedIndexes&&this._selectedIndexes.length>0&&this._selectedIndexes.indexOf(n)>=0&&r.setAttribute("selected","true"),this.element.appendChild(r)}},prepareForDraw:{value:function(){this.element.addEventListener("focus",this),this.element.addEventListener("change",this)}},prepareForActivationEvents:{value:function(){var e=u.create();this.addComposer(e)}},draw:{enumerable:!1,value:function(){var e=this.element;this._fromInput=!1,this._synching=!1,this._removeAll(e),this._refreshOptions();var t=Object.getPrototypeOf(a).draw;t.call(this)}},didDraw:{value:function(){this._synchValues()}},_indexOf:{value:function(e){var t=this.content||[],n=t.length,r,i,s;for(r=0;r<n;r++){String.isString(t[r])?s=t[r]:s=t[r][this.valuePropertyPath||"value"];if(s&&s===e)return r}return-1}},_getSelectedOptions:{value:function(e){var t=e.querySelectorAll("option"),n,r=t.length,i=[];for(n=0;n<r;n++)t[n].selected&&i.push(t[n]);return i}},_getSelectedOptionsIndices:{value:function(e){var t=e.querySelectorAll("option"),n,r=t.length,i=[];for(n=0;n<r;n++)t[n].selected&&i.push(n);return i}},handleChange:{value:function(e){var t=this._getSelectedOptionsIndices(this.element);t.length>0&&(this._fromInput=!0,this._synching=!1,this.contentController.selectedIndexes=t,this._synchValues())}}});a.addAttributes({autofocus:{dataType:"boolean"},disabled:{dataType:"boolean"},form:null,multiple:{dataType:"boolean"},name:null,required:{dataType:"boolean"},size:{dataType:"number",value:"1"}})}}),montageDefine("120b0c7","ui/native/button.reel/button",{dependencies:["montage","ui/component","ui/native-control","ui/composer/press-composer"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=e("ui/native-control").NativeControl,o=e("ui/composer/press-composer").PressComposer,u=t.Button=r.create(s,{_preventFocus:{enumerable:!1,value:!1},preventFocus:{get:function(){return this._preventFocus},set:function(e){e===!0?this._preventFocus=!0:this._preventFocus=!1}},enabled:{dependencies:["disabled"],get:function(){return!this._disabled},set:function(e){this.disabled=!e}},converter:{value:null},_labelNode:{value:undefined,enumerable:!1},_label:{value:undefined,enumerable:!1},label:{get:function(){return this._label},set:function(e){if(e&&e.length>0&&this.converter)try{e=this.converter.convert(e),this.error&&(this.error=null)}catch(t){this.error=t}this._label=e,this._isInputElement&&(this._value=e),this.needsDraw=!0}},setLabelInitialValue:{value:function(e){this._label===undefined&&(this._label=e)}},holdThreshold:{get:function(){return this._pressComposer.longPressThreshold},set:function(e){this._pressComposer.longPressThreshold=e}},_pressComposer:{enumberable:!1,value:null},_active:{enumerable:!1,value:!1},active:{get:function(){return this._active},set:function(e){this._active=e,this.needsDraw=!0}},blur:{value:function(){this._element.blur()}},focus:{value:function(){this._element.focus()}},didCreate:{value:function(){this._pressComposer=o.create(),this.addComposer(this._pressComposer)}},prepareForActivationEvents:{value:function(){this._pressComposer.addEventListener("pressStart",this,!1),this._pressComposer.addEventListener("press",this,!1),this._pressComposer.addEventListener("pressCancel",this,!1)}},addEventListener:{value:function(e,t,n){s.addEventListener.call(this,e,t,n),e==="hold"&&this._pressComposer.addEventListener("longPress",this,!1)}},handlePressStart:{value:function(e){this.active=!0,e.touch&&document.addEventListener("touchmove",this,!1),this._preventFocus||this._element.focus()}},handlePress:{value:function(e){this.active=!1,this._dispatchActionEvent(),document.removeEventListener("touchmove",this,!1)}},handleKeyup:{value:function(e){e.keyCode===32&&(this.active=!1,this._dispatchActionEvent())}},handleLongPress:{value:function(e){this._pressComposer.cancelPress();var t=document.createEvent("CustomEvent");t.initCustomEvent("hold",!0,!0,null),this.dispatchEvent(t)}},handlePressCancel:{value:function(e){this.active=!1,document.removeEventListener("touchmove",this,!1)}},handleTouchmove:{value:function(e){e.preventDefault()}},_isInputElement:{value:!1,enumerable:!1},willPrepareForDraw:{value:function(){s.willPrepareForDraw.call(this),this._element.setAttribute("role","button"),this._isInputElement=this._element.tagName==="INPUT",this._isInputElement?(Object.defineProperty(this,"value",{get:function(){return this._label},set:function(e){this.label=e}}),this._label===undefined&&(this._label=this._element.value)):(this._element.firstChild||this._element.appendChild(document.createTextNode("")),this._labelNode=this._element.firstChild,this.setLabelInitialValue(this._labelNode.data),this._label===undefined&&(this._label=this._labelNode.data)),this.needsDraw=!0}},prepareForDraw:{value:function(){this._element.addEventListener("keyup",this,!1)}},_drawLabel:{enumerable:!1,value:function(e){this._isInputElement?this._element.setAttribute("value",e):this._labelNode.data=e}},draw:{value:function(){Object.getPrototypeOf(u).draw.call(this),this._disabled?this._element.classList.add("disabled"):this._element.classList.remove("disabled"),this._active?this._element.classList.add("active"):this._element.classList.remove("active"),this._drawLabel(this.label)}},_detail:{value:null},detail:{get:function(){return this._detail===null&&(this._detail=a.create()),this._detail}},createActionEvent:{value:function(){var e=document.createEvent("CustomEvent"),t,n;if(t=this._detail)n=t._data;return e.initCustomEvent("action",!0,!0,n),e}}});u.addAttributes({autofocus:{value:!1,dataType:"boolean"},disabled:{value:!1,dataType:"boolean"},form:null,formaction:null,formenctype:null,formmethod:null,formnovalidate:{dataType:"boolean"},formtarget:null,type:{value:"button"},name:null,value:null});var a=r.create(r,{didCreate:{value:function(){this._data=Object.create(null)}},initWithReservedAndOptions:{value:function(e,t){Map.call(this,e,t)}},get:{value:function(e){return this.undefinedGet(e)}},set:{value:function(e,t){this.undefinedSet(e,t)}},_data:{value:null},_defineProperty:{value:function(e,t){t=typeof t!="undefined"?t:null,r.defineProperty(this,e,{get:function(){return this._data[e]},set:function(t){this._data[e]=t}}),this._data[e]=t}},undefinedGet:{value:function(e){return typeof this._data[e]=="undefined"&&this._defineProperty(e),this._data[e]}},undefinedSet:{value:function(e,t){typeof this._data[e]=="undefined"?this._defineProperty(e,t):this._data[e]=t}}})}}),montageDefine("2649653","effect/effect",{dependencies:["montage/core/core","animation/animation-manager","montage/ui/template"],factory:function(e,t,n){var r=e("montage/core/core").Montage,i=e("animation/animation-manager").AnimationManager,s=e("montage/ui/template").Template,o=r.create(r,{_path:{value:null},_type:{value:null},_startValue:{value:null},_endValue:{value:null},_context:{value:null},_delegate:{value:null},_duration:{value:0},_startTime:{value:0},_intervalRequest:{value:0},init:{value:function(e,t,n,r,i,s,o){this._type=t,this._startValue=n,this._endValue=r,this._context=s,this._delegate=o,this._duration=i,this._path=e}},handleUpdate:{value:function(){var e=new Date,t=e.getTime()/1e3,n=(t-this._startTime)/this._duration;if(this._delegate){var r;this._type==="vec4"?(r=[0,0,0,0],r[0]=(1-n)*this._startValue[0]+n*this._endValue[0],r[1]=(1-n)*this._startValue[1]+n*this._endValue[1],r[2]=(1-n)*this._startValue[2]+n*this._endValue[2],r[3]=(1-n)*this._startValue[3]+n*this._endValue[3]):this._type==="float"&&(r=(1-n)*this._startValue+n*this._endValue),this._delegate.handleAnimationValueUpdate&&this._delegate.handleAnimationValueUpdate(this,this._path,r)}}},stopAnimation:{value:function(){clearInterval(this._intervalRequest)}},run:{value:function(){var e=new Date,t=e.getTime()/1e3,n=this;this._startTime=t,this._intervalRequest=setInterval(function(){n.handleUpdate.call(n)},1/30),setTimeout(function(){n.stopAnimation.call(n)},this._duration*1e3)}}});Effect=t.Effect=r.create(r,{_name:{enumerable:!0,value:""},name:{enumerable:!1,get:function(){return this._name},set:function(e){this._name=e}},_profiles:{enumerable:!0,value:{}},profiles:{enumerable:!1,get:function(){return this._profiles},set:function(e){this._profiles=e}},_template:{enumerable:!0,value:{}},template:{enumerable:!1,get:function(){return this._template},set:function(e){this._template=e}},loadTemplate:{value:function(e,t,n,i){if(this.template&&(!this._isTemplateLoaded||!this._isTemplateLoading)){this._isTemplateLoading=!0;var o=this,u,a,f=this.inputs,l=function(n){n.instantiateWithOwnerAndDocument(o,window.document,function(n){n.name=t;if(f){var r=Object.keys(f);r.forEach(function(e){n.inputs[e].value=f[e].value},this)}e&&e(n,i)}),o._isTemplateLoaded=!0,o._isTemplateLoading=!1},c;n?(u=r.getInfoForObject(this),c=u.require):c=window.require,s.templateWithModuleId(c,this.template,l)}}},_inputsDidChange:{value:function(){var e=this.inputKeys,t=this;e.forEach(function(e){var t=this.inputs[e].value;r.defineProperty(this.inputs[e],"_value",{writable:!0,value:null}),r.defineProperty(this.inputs[e],"handleAnimationValueUpdate",{value:function(e,t,n){this.animatedValue=n}}),r.defineProperty(this.inputs[e],"animatedValue",{writable:!0,value:null}),r.defineProperty(this.inputs[e],"value",{get:function(){return this._value},set:function(e){var t=i.animationDuration>0;if(t&&this._value!==null&&this.type==="vec4"){var n=r.create(o);n.init(null,"vec4",this._value,e,i.animationDuration,this,this),n.run()}else this.animatedValue=e;this._value=e}}),this.inputs[e].animatedValue=t,this.inputs[e].value=t},this)}},_inputs:{enumerable:!1,value:null},inputs:{enumerable:!0,get:function(){return this._inputs},set:function(e){this._inputs=e,this._inputsDidChange()}},inputKeys:{enumerable:!1,get:function(){return this._inputs?Object.keys(this._inputs):[]}}})}}),montageDefine("fb87e57","main.reel/main.html",{text:'<!doctype html>\n\n<html>\n    <meta http-equiv=Content-Type content="text/html; charset=utf-8">\n    <head>\n        <link rel=stylesheet href=main.css>\n        <link rel=stylesheet href=button.css>\n        <link rel=stylesheet href=select.css>\n\n        <script type="text/montage-serialization">{"owner":{"prototype":"main.reel","properties":{"element":{"#":"paparazzi"},"flash":{"#":"flash"},"countdown":{"@":"countdown"},"camera":{"@":"camera"},"gallery":{"@":"gallery"},"filterGallery":{"@":"filterGallery"},"filterSelect":{"@":"filterSelect"}}},"camera":{"prototype":"filtered-camera.reel","properties":{"element":{"#":"camera"}},"bindings":{"filterIndex":{"<->":"@filterGallery.selectedFilterIndex"}},"listeners":[{"type":"filtersloaded","listener":{"@":"owner"},"capture":false}]},"filterGallery":{"prototype":"filter-gallery.reel","properties":{"element":{"#":"filterGallery"}},"bindings":{"filters":{"<-":"@camera.filters"}}},"snapshotButton":{"prototype":"montage/ui/button.reel","properties":{"element":{"#":"snapshotButton"},"identifier":"snapshot"},"listeners":[{"type":"action","listener":{"@":"owner"},"capture":false}]},"filterSelect":{"prototype":"montage/ui/select.reel","properties":{"element":{"#":"filterSelect"},"identifier":"filterSelect","textPropertyPath":"name","valuePropertyPath":"name"},"bindings":{"contentController":{"<-":"@filterGallery.filterController"}}},"gallery":{"prototype":"gallery.reel","properties":{"element":{"#":"gallery"}}},"flashCheckbox":{"prototype":"montage/ui/input-checkbox.reel","properties":{"element":{"#":"flashCheckbox"}},"bindings":{"checked":{"<->":"@owner.doFlash"}}},"countdown":{"prototype":"montage/ui/dynamic-text.reel","properties":{"element":{"#":"countdown"}}},"nextFilter":{"prototype":"montage/ui/button.reel","properties":{"element":{"#":"nextFilter"},"identifier":"nextFilter"},"listeners":[{"type":"action","listener":{"@":"owner"},"capture":false}]},"prevFilter":{"prototype":"montage/ui/button.reel","properties":{"element":{"#":"prevFilter"},"identifier":"prevFilter"},"listeners":[{"type":"action","listener":{"@":"owner"},"capture":false}]}}</script>\n    </head>\n    <body>\n        <section id=paparazzi class=paparazzi>\n            <section class=screen>\n                <div data-montage-id=camera class=camera></div>\n                <div data-montage-id=filterGallery class=filterGallery></div>\n            </section>\n\n            <section class=controls>\n                <button data-montage-id=prevFilter class="button prevFilter"></button>\n                <select data-montage-id=filterSelect class=select></select>\n                <button data-montage-id=nextFilter class="button nextFilter"></button>\n                <input type=checkbox data-montage-id=flashCheckbox id=flashCheckbox><label for=flashCheckbox>Flash?</label>\n                <div class=divider></div>\n                <button data-montage-id=snapshotButton class="button action">Snapshot!</button>\n            </section>\n\n            <section data-montage-id=gallery></section>\n\n            <section data-montage-id=flash class=flash-overlay>\n                <div data-montage-id=countdown class=countdown>3</div>\n            </section>\n        </section>\n    </body>\n</html>'}),montageDefine("fb87e57","gl-util",{dependencies:[],factory:function(e,t,n){(function(e){"use strict";var t=e.glUtil={getContext:function(e){var t;if(e.getContext){try{t=e.getContext("webgl");if(t)return t}catch(n){}try{t=e.getContext("experimental-webgl");if(t)return t}catch(n){}}return null},showGLFailed:function(e){var t=document.createElement("div"),n="<h3>Sorry, but a WebGL context could not be created</h3>";n+="Either your browser does not support WebGL, or it may be disabled.<br/>",n+='Please visit <a href="http://get.webgl.org">http://get.webgl.org</a> for ',n+="details on how to get a WebGL enabled browser.",t.innerHTML=n,t.id="gl-error",e.parentNode.replaceChild(t,e)},createShaderProgram:function(e,t,n){var r=e.createProgram(),i=this._compileShader(e,t,e.VERTEX_SHADER),s=this._compileShader(e,n,e.FRAGMENT_SHADER);e.attachShader(r,i),e.attachShader(r,s),e.linkProgram(r);if(!e.getProgramParameter(r,e.LINK_STATUS))return e.deleteProgram(r),e.deleteShader(i),e.deleteShader(s),null;var o,u,a,f=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES);r.attribute={};for(o=0;o<f;o++)u=e.getActiveAttrib(r,o),r.attribute[u.name]=e.getAttribLocation(r,u.name);var l=e.getProgramParameter(r,e.ACTIVE_UNIFORMS);r.uniform={};for(o=0;o<l;o++)a=e.getActiveUniform(r,o),r.uniform[a.name]=e.getUniformLocation(r,a.name);return r},_compileShader:function(e,t,n){var r=e.createShader(n);return e.shaderSource(r,t),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(console.debug(e.getShaderInfoLog(r)),e.deleteShader(r),null)},getSourceFromId:function(e,t){var n=document.getElementById(t);if(!n)return null;var r="",i=n.firstChild;while(i)i.nodeType==3&&(r+=i.textContent),i=i.nextSibling;return r},createSolidTexture:function(e,t){var n=new Uint8Array(t),r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGB,1,1,0,e.RGB,e.UNSIGNED_BYTE,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),r},loadTexture:function(e,t,n){var r=e.createTexture(),i=new Image;return i.addEventListener("load",function(){e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D),n&&n(r)}),i.src=t,r}}})(typeof t!="undefined"?t:window)}}),montageDefine("120b0c7","ui/flow.reel/flow.html",{text:'<!DOCTYPE html>\n\n<html>\n<head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=flow.css>\n    <script type="text/montage-serialization">{"repetition":{"prototype":"ui/repetition.reel","properties":{"element":{"#":"montage-flow-repetition"}},"bindings":{"objects":{"<-":"@owner.objects"},"contentController":{"<-":"@owner.contentController"},"isSelectionEnabled":{"<-":"@owner.isSelectionEnabled"}}},"flowTranslateComposer":{"prototype":"ui/composer/flow-translate-composer","properties":{"flow":{"@":"owner"},"invertAxis":true,"allowFloats":true,"minScroll":0},"bindings":{"maxScroll":{"<-":"@owner.length"},"_momentumDuration":{"<-":"@owner.momentumDuration"},"translateStride":{"<-":"@owner.stride"},"scrollingMode":{"<-":"@owner.scrollingMode"},"linearScrollingVector":{"<-":"@owner.linearScrollingVector"}}},"slot":{"prototype":"ui/slot.reel","properties":{"element":{"#":"montage-flow-slot"}},"bindings":{"content":{"<->":"@owner.slotContent"}}},"owner":{"properties":{"element":{"#":"montage-flow"},"_repetition":{"@":"repetition"},"_flowTranslateComposer":{"@":"flowTranslateComposer"},"_cameraElement":{"#":"montage-flow-camera"}},"bindings":{"scroll":{"<->":"@flowTranslateComposer.scroll"},"selectedIndexes":{"<-":"@repetition.selectedIndexes"},"activeIndexes":{"<-":"@repetition.activeIndexes"},"draggedSlideIndex":{"<-":"@flowTranslateComposer._closerIndex"}}}}</script>\n</head>\n<body>\n    <div data-montage-id=montage-flow class=montage-Flow>\n        <div data-montage-id=montage-flow-camera class=montage-Flow-camera>\n            <div data-montage-id=montage-flow-repetition class=montage-Flow-Repetition></div>\n            <div data-montage-id=montage-flow-slot class=montage-Flow-Slot></div>\n        </div>\n    </div>\n</body>\n</html>'}),montageDefine("fb87e57","gallery.reel/gallery.html",{text:'<!doctype html>\n\n<html>\n    <meta http-equiv=Content-Type content="text/html; charset=utf-8">\n    <head>\n        <link rel=stylesheet href=gallery.css>\n\n        <script type="text/montage-serialization">{"owner":{"prototype":"gallery.reel","properties":{"element":{"#":"gallery"},"snapshotController":{"@":"snapshotController"},"list":{"@":"list"}}},"snapshotController":{"prototype":"montage/ui/controller/array-controller","properties":{"content":[]}},"list":{"prototype":"montage/ui/flow.reel","properties":{"element":{"#":"flow"},"contentController":{"@":"snapshotController"},"axis":"horizontal","isSelectionEnabled":true,"hasSelectedIndexScrolling":true,"selectedIndexScrollingOffset":0,"stride":1,"cameraFov":90,"cameraPosition":[0,0,85],"paths":[{"knots":[{"knotPosition":[-780,-15,-128],"nextHandlerPosition":[-520,-15,0],"previousDensity":7,"nextDensity":7},{"previousHandlerPosition":[-450,-15,0],"knotPosition":[0,-15,0],"nextHandlerPosition":[450,-15,0],"previousDensity":7,"nextDensity":7},{"knotPosition":[780,-15,-128],"previousHandlerPosition":[520,-15,0],"previousDensity":7,"nextDensity":7}],"headOffset":7,"tailOffset":7,"units":{}}]}},"snapshot":{"prototype":"snapshot.reel","properties":{"element":{"#":"snapshot"}},"bindings":{"src":{"<-":"@list.objectAtCurrentIteration"}}}}</script>\n        <style>\n\n        </style>\n    </head>\n    <body>\n        <section data-montage-id=gallery class=gallery>\n            <section data-montage-id=flow class=flow>\n                <div data-montage-id=snapshot></div>\n            </section>\n        </section>\n    </body>\n</html>'}),montageDefine("120b0c7","ui/check-input",{dependencies:["montage","ui/component","ui/native-control","ui/composer/press-composer"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=e("ui/native-control").NativeControl,o=e("ui/composer/press-composer").PressComposer,u=t.CheckInput=r.create(s,{blur:{value:function(){this._element.blur()}},focus:{value:function(){this._element.focus()}},draw:{value:function(){this._element.setAttribute("aria-checked",this._checked)}},_pressComposer:{enumerable:!1,value:null},prepareForActivationEvents:{value:function(){var e=this._pressComposer=o.create();this.addComposer(e),e.addEventListener("pressStart",this,!1),e.addEventListener("press",this,!1)}},prepareForDraw:{enumerable:!1,value:function(){this._element.addEventListener("change",this)}},_fakeCheck:{enumerable:!1,value:function(){var e;this._element.checked=!this._element.checked,e=document.createEvent("HTMLEvents"),e.initEvent("change",!0,!0),this._element.dispatchEvent(e)}},_shouldFakeCheck:{enumerable:!1,value:!1},handlePressStart:{value:function(e){this._shouldFakeCheck=e.defaultPrevented}},handlePress:{value:function(e){this._shouldFakeCheck&&(this._shouldFakeCheck=!1,this._fakeCheck())}},handleChange:{enumerable:!1,value:function(e){if(!this._pressComposer||this._pressComposer.state!==o.CANCELLED)Object.getPropertyDescriptor(this,"checked").set.call(this,this.element.checked,!0),this._dispatchActionEvent()}}})}}),montageDefine("fb87e57","main.reel/main",{dependencies:["montage/core/core","montage/ui/component"],factory:function(e,t,n){var r=e("montage/core/core").Montage,i=e("montage/ui/component").Component;t.Main=r.create(i,{camera:{value:null},flash:{value:null},doFlash:{value:!0},countdown:{value:null},gallery:{value:null},filterGallery:{value:null},filters:{value:[],distinct:!0},snapshotController:{value:null},handleSnapshotAction:{value:function(){this.countdownSnapshot()}},handleNextFilterAction:{value:function(){this.camera.useNextFilter()}},handlePrevFilterAction:{value:function(){this.camera.usePrevFilter()}},handleFiltersloaded:{value:function(){this.filterGallery.filterController.selectedObjects=this.camera.filters[0]}},countdownSnapshot:{value:function(){var e=this;if(!this.doFlash){e.takeSnapshot();return}e.flash.classList.add("showCountdown"),e.countdown.value="3",setTimeout(function(){e.countdown.value="2",setTimeout(function(){e.countdown.value="1",setTimeout(function(){e.countdown.value="",e.flash.classList.remove("showCountdown"),e.flash.classList.add("flash"),setTimeout(function(){e.takeSnapshot(),e.flash.classList.remove("flash")},500)},1e3)},1e3)},1e3)}},takeSnapshot:{value:function(){var e=this.camera.getSnapshotURL();this.gallery.addSnapshot(e)}},templateDidLoad:{value:function(){var e=this;this.camera.addPropertyChangeListener("filterIndex",function(){e.filterSelect.element.selectedIndex=e.camera.filterIndex},!1)}}})}}),montageDefine("fb87e57","filter-gallery.reel/filter-gallery.html",{text:'<!doctype html>\n\n<html>\n    <meta http-equiv=Content-Type content="text/html; charset=utf-8">\n    <head>\n        <link rel=stylesheet href=filter-gallery.css>\n        <link rel=stylesheet href=scrollbar.css>\n\n        <script type="text/montage-serialization">{"owner":{"prototype":"filter-gallery.reel","properties":{"element":{"#":"filterGallery"},"filterController":{"@":"filterController"},"list":{"@":"list"}},"bindings":{"selectedFilter":{"<-":"@filterController.selectedObjects.0"},"selectedFilterIndex":{"<-":"@filterController.selectedIndexes.0"}}},"filterController":{"prototype":"montage/ui/controller/array-controller","bindings":{"content":{"<-":"@owner.filters"}}},"list":{"prototype":"montage/ui/repetition.reel","properties":{"element":{"#":"filterList"},"contentController":{"@":"filterController"},"isSelectionEnabled":true,"axis":"vertical"}},"filterPreview":{"prototype":"filter-preview.reel","properties":{"element":{"#":"filterPreview"}},"bindings":{"filter":{"<-":"@list.objectAtCurrentIteration"}}}}</script>\n        <style>\n\n        </style>\n    </head>\n    <body>\n        <section data-montage-id=filterGallery class=filterGallery>\n            <section data-montage-id=filterList class=filterList>\n                <div data-montage-id=filterPreview></div>\n            </section>\n        </section>\n    </body>\n</html>'}),montageDefine("2649653","effect/effect-library",{dependencies:["montage/core/core","effect/effect","effect/effect-loader","default-effect-repository/default-effect-repository"],factory:function(e,t,n){var r=e("montage/core/core").Montage,i=e("effect/effect").Effect,s=e("effect/effect-loader").EffectLoader,o=e("default-effect-repository/default-effect-repository").DefaultEffectRepository;EffectLibrary=t.EffectLibrary=r.create(r,{_repositories:{value:{}},registerEffectRepository:{value:function(e,t){this._repositories[e]=t}},unregisterEffectRepository:{value:function(e){this._repositories[e]=null}},_registerDefaultRepositoryIfNeeded:{value:function(){var e="default";this._repositories[e]||this.registerEffectRepository(e,o.templates)}},effectNames:{get:function(e){var t;this._registerDefaultRepositoryIfNeeded();var n=[];return e?(t=this._repositories[e],n=Object.keys(t)):Object.keys(this._repositories).forEach(function(e){t=this._repositories[e],n=n.concat(Object.keys(t))},this),n}},effectWithName:{value:function(e,t){function n(e,n){t(e,n)}var r=this;this._registerDefaultRepositoryIfNeeded();var i=Object.keys(this._repositories);i&&i.forEach(function(t){var r=this._repositories[t],i=r[e];i&&s.loadEffect(n,e,i,r.__builtin_templates,null)},this)}}})}}),montageDefine("120b0c7","ui/slot.reel/slot",{dependencies:["montage","ui/component"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component;t.Slot=r.create(i,{hasTemplate:{enumerable:!1,value:!1},didCreate:{value:function(){this.content=null}},delegate:{value:null},_content:{value:null},prepareForDraw:{value:function(){this.element.classList.add("montage-Slot")}},content:{get:function(){return this._content},set:function(e){var t;e&&typeof e.needsDraw!="undefined"?(e.element?t=e.element:(t=document.createElement("div"),t.id="appendDiv",this.delegate&&typeof this.delegate.slotElementForComponent=="function"&&(t=this.delegate.slotElementForComponent(this,e,t))),Object.getPropertyDescriptor(i,"domContent").set.call(this,t),e.setElementWithParentComponent(t,this),e.needsDraw=!0):Object.getPropertyDescriptor(i,"domContent").set.call(this,e),this._content=e,this.needsDraw=!0}},contentDidChange:{value:function(e,t){this.delegate&&typeof this.delegate.slotDidSwitchContent=="function"&&this.delegate.slotDidSwitchContent(this,e,e?e.controller:null,t,t?t.controller:null)}}})}}),montageDefine("120b0c7","ui/composer/composer",{dependencies:["montage"],factory:function(e,t,n){var r=e("montage").Montage;t.Composer=r.create(r,{_component:{value:null},component:{get:function(){return this._component},set:function(e){this._component=e}},_element:{value:null},element:{get:function(){return this._element},set:function(e){this._element=e}},lazyLoad:{value:!1},_needsFrame:{value:!1},needsFrame:{set:function(e){this._needsFrame!==e&&(this._needsFrame=e,this._component&&e&&this._component.scheduleComposer(this))},get:function(){return this._needsFrame}},frame:{value:function(e){}},_resolveDefaults:{value:function(){this.element==null&&this.component!=null&&(this.element=this.component.element)}},_load:{value:function(){this.element||this._resolveDefaults(),this.load()}},load:{value:function(){}},unload:{value:function(){}},deserializedFromTemplate:{value:function(){this.component&&this.component.addComposer(this)}}})}}),montageDefine("fb87e57","filtered-camera.reel/filtered-camera.html",{text:'<!doctype html>\n\n<html>\n    <meta http-equiv=Content-Type content="text/html; charset=utf-8">\n    <head>\n        <link rel=stylesheet href=filtered-camera.css>\n\n        <script type="text/montage-serialization">{"owner":{"prototype":"filtered-camera.reel","properties":{"element":{"#":"filtered-camera"},"video":{"#":"video"},"canvas":{"@":"canvas"}}},"canvas":{"prototype":"gl-canvas.reel[GLCanvas]","properties":{"element":{"#":"canvas"},"width":640,"height":480,"preserveDrawingBuffer":true},"listeners":[{"type":"glready","listener":{"@":"owner"},"capture":false}]}}</script>\n    </head>\n    <body>\n        <section data-montage-id=filtered-camera class=filtered-camera>\n            <canvas data-montage-id=canvas></canvas>\n            <video data-montage-id=video class=filtered-camera-video></video>\n        </section>\n    </body>\n</html>'}),montageDefine("fb87e57","filter-preview.reel/filter-preview.html",{text:'<!doctype html>\n\n<html>\n    <meta http-equiv=Content-Type content="text/html; charset=utf-8">\n    <head>\n        <link rel=stylesheet href=filter-preview.css>\n\n        <script type="text/montage-serialization">{"owner":{"prototype":"filter-preview.reel","properties":{"element":{"#":"filterPreview"},"image":{"@":"image"}}},"image":{"prototype":"montage/ui/image.reel","properties":{"element":{"#":"image"}},"bindings":{"src":{"<-":"@owner.filter.previewSrc"}}},"label":{"prototype":"montage/ui/dynamic-text.reel","properties":{"element":{"#":"label"}},"bindings":{"value":{"<-":"@owner.filter.name"}}}}</script>\n    </head>\n    <body>\n        <section data-montage-id=filterPreview class=filterPreview>\n            <img data-montage-id=image>\n            <div data-montage-id=label class=label></div>\n        </section>\n    </body>\n</html>'}),montageDefine("fb87e57","snapshot.reel/snapshot.html",{text:'<!doctype html>\n\n<html>\n    <meta http-equiv=Content-Type content="text/html; charset=utf-8">\n    <head>\n        <link rel=stylesheet href=snapshot.css>\n\n        <script type="text/montage-serialization">{"owner":{"prototype":"snapshot.reel","properties":{"element":{"#":"snapshot"},"image":{"@":"image"}}},"image":{"prototype":"montage/ui/image.reel","properties":{"element":{"#":"image"}},"bindings":{"src":{"<-":"@owner.src"}}},"link":{"prototype":"montage/ui/anchor.reel","properties":{"element":{"#":"link"}},"bindings":{"href":{"<-":"@owner.src"}}}}</script>\n    </head>\n    <body>\n        <section data-montage-id=snapshot class=snapshot>\n                <img data-montage-id=image>\n                <a data-montage-id=link href="#" download=paparazzi-snapshot.png class=download>Download</a>\n        </section>\n    </body>\n</html>'}),montageDefine("fb87e57","gl-canvas.reel/gl-canvas",{dependencies:["montage/core/core","montage/ui/native-control"],factory:function(e,t,n){var r=e("montage/core/core").Montage,i=e("montage/ui/native-control").NativeControl,s=t.GLCanvas=r.create(i,{gl:{value:null},preserveDrawingBuffer:{value:!1},prepareForDraw:{value:function(){var e=this.preserveDrawingBuffer,t=this.gl=this.element.getContext("experimental-webgl",{preserveDrawingBuffer:e});this.gl.clearDepth(1),this.gl.enable(t.DEPTH_TEST),this.gl.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.viewport(0,0,this.width,this.height),t.clearColor(0,0,0,1);var n=document.createEvent("CustomEvent");n.initCustomEvent("glready",!0,!1,null),this.dispatchEvent(n)}},toDataURL:{value:function(){return this.element.toDataURL()}}});s.addAttributes({width:null,height:null})}}),montageDefine("120b0c7","ui/dynamic-text.reel/dynamic-text",{dependencies:["montage","ui/component"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component;t.DynamicText=r.create(i,{hasTemplate:{value:!1},_value:{value:null},value:{get:function(){return this._value},set:function(e){this._value!==e&&(this._value=e,this.needsDraw=!0)}},converter:{value:null},defaultValue:{value:""},_valueNode:{value:null},_RANGE:{value:document.createRange()},prepareForDraw:{value:function(){var e=this._RANGE;e.selectNodeContents(this.element),e.deleteContents(),this._valueNode=document.createTextNode(""),e.insertNode(this._valueNode)}},draw:{value:function(){var e=this._value,t=e||0===e?e:this.defaultValue;this.converter&&(t=this.converter.convert(t)),this._valueNode.data=t}}})}}),montageDefine("2649653","effect/effect-loader",{dependencies:["montage/core/core","montage/ui/template","effect/effect"],factory:function(e,t,n){var r=e("montage/core/core").Montage,i=e("montage/ui/template").Template,s=e("effect/effect").Effect;EffectLoader=t.EffectLoader=r.create(r,{loadEffect:{value:function(e,t,n,s,o){if(!this._isTemplateLoaded||!this._isTemplateLoading){this._isTemplateLoading=!0;var u=this,a,f,l=function(n){u._template=n,n.instantiateWithOwnerAndDocument(null,window.document,function(n){n.name=t,e&&e(n,o)}),u._isTemplateLoaded=!0,u._isTemplateLoading=!1},c;s?(a=r.getInfoForObject(this),c=a.require):c=window.require,i.templateWithModuleId(c,n,l)}}}})}}),montageDefine("fb87e57","filters/paparazzi-repository",{dependencies:["montage/core/core"],factory:function(e,t,n){var r=e("montage/core/core").Montage;PaparazziRepository=t.PaparazziRepository=r.create(r,{templates:{enumerable:!1,get:function(){return{Normal:"/filters/normal.html",Greyscale:"/filters/greyscale.html",Invert:"/filters/invert.html",Mirror:"/filters/mirror.html",Bulge:"/filters/bulge.html",Pinch:"/filters/pinch.html",Swirl:"/filters/swirl.html",Eyepatch:"/filters/eyepatch.html",Moustache:"/filters/moustache.html",Clown:"/filters/clown.html",Glass:"/filters/glassRipple.html"}}}})}}),montageDefine("120b0c7","ui/native/input-checkbox.reel/input-checkbox",{dependencies:["montage","ui/component","ui/check-input"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=e("ui/check-input").CheckInput,o=t.InputCheckbox=r.create(s,{});o.addAttributes({autofocus:{value:!1,dataType:"boolean"},disabled:{value:!1,dataType:"boolean"},checked:{value:!1,dataType:"boolean"},form:null,name:null,readonly:{value:!1,dataType:"boolean"},title:null,value:{value:"on"}})}}),montageDefine("120b0c7","ui/controller/object-controller",{dependencies:["montage"],factory:function(e,t,n){var r=e("montage").Montage,i=t.ObjectController=r.create(r,{objectPrototype:{enumerable:!1,value:null},newObject:{enumerable:!1,value:function(){return this.objectPrototype.create()}},initWithContent:{value:function(e){return this.content=e,this}},content:{enumerable:!1,value:null},blueprintModuleId:e("montage")._blueprintModuleIdDescriptor,blueprint:e("montage")._blueprintDescriptor})}}),montageDefine("fb87e57","snapshot.reel/snapshot",{dependencies:["montage/core/core","montage/ui/component"],factory:function(e,t,n){var r=e("montage/core/core").Montage,i=e("montage/ui/component").Component,s=t.Snapshot=r.create(i,{src:{value:null},image:{value:null},_rotation:{value:0},rotation:{get:function(){return this._rotation},set:function(e){this._rotation=e,this.needsDraw=!0}},prepareForDraw:{value:function(){var e=30;this.rotation=Math.random()*e*2-e}},draw:{value:function(){}}})}}),montageDefine("120b0c7","ui/native-control",{dependencies:["montage","ui/component"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=t.NativeControl=r.create(i,{hasTemplate:{value:!1},willPrepareForDraw:{value:function(){}}});s.addAttributes({accesskey:null,contenteditable:null,contextmenu:null,dir:null,draggable:null,dropzone:null,hidden:{dataType:"boolean"},lang:null,spellcheck:null,style:null,tabindex:null,title:null})}}),montageDefine("120b0c7","ui/native/anchor.reel/anchor",{dependencies:["montage","ui/component","ui/native-control"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=e("ui/native-control").NativeControl,o=t.Anchor=r.create(s,{blur:{value:function(){this._element.blur()}},focus:{value:function(){this._element.focus()}}});o.addAttributes({textContent:null,href:null,hreflang:null,media:null,rel:null,target:null,type:null})}}),montageDefine("120b0c7","ui/input-checkbox.reel/input-checkbox",{dependencies:["montage","ui/component","ui/native/input-checkbox.reel"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=e("ui/native/input-checkbox.reel").InputCheckbox;t.InputCheckbox=r.create(s,{hasTemplate:{value:!0},willPrepareForDraw:{value:function(){s.willPrepareForDraw.call(this),this.element.classList.add("montage-InputCheckbox")}}})}}),montageDefine("120b0c7","ui/button.reel/button",{dependencies:["montage","ui/component","ui/native/button.reel"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=e("ui/native/button.reel").Button;t.Button=r.create(s,{hasTemplate:{value:!0},willPrepareForDraw:{value:function(){s.willPrepareForDraw.call(this),this.element.classList.add("montage-Button")}}})}}),montageDefine("120b0c7","ui/select.reel/select",{dependencies:["montage","ui/component","ui/native/select.reel"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=e("ui/native/select.reel").Select;t.Select=r.create(s,{hasTemplate:{value:!0},willPrepareForDraw:{value:function(){s.willPrepareForDraw.call(this),this.element.classList.add("montage-Select")}}})}}),montageDefine("120b0c7","ui/anchor.reel/anchor",{dependencies:["montage","ui/component","ui/native/anchor.reel"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=e("ui/native/anchor.reel").Anchor;t.Anchor=r.create(s,{hasTemplate:{value:!1},willPrepareForDraw:{value:function(){s.willPrepareForDraw.call(this),this.element.classList.add("montage-anchor")}}})}}),montageDefine("fb87e57","filter-gallery.reel/filter-gallery",{dependencies:["montage/core/core","montage/ui/component"],factory:function(e,t,n){var r=e("montage/core/core").Montage,i=e("montage/ui/component").Component,s=t.FilterGallery=r.create(i,{filterController:{value:null},list:{value:null},filters:{value:[],distinct:!0},selectedFilter:{value:null},selectedFilterIndex:{value:null}})}}),montageDefine("2649653","default-effect-repository/default-effect-repository",{dependencies:["montage/core/core"],factory:function(e,t,n){var r=e("montage/core/core").Montage;DefaultEffectRepository=t.DefaultEffectRepository=r.create(r,{templates:{enumerable:!0,get:function(){var e={};return Object.defineProperty(e,"__builtin_templates",{writable:!0,value:!0}),e}}})}}),montageDefine("2649653","animation/animation-manager",{dependencies:["montage/core/core"],factory:function(e,t,n){var r=e("montage/core/core").Montage;AnimationManager=t.AnimationManager=r.create(r,{_animationDuration:{enumerable:!1,value:0},animationDuration:{enumerable:!0,get:function(){return this._animationDuration},set:function(e){this._animationDuration=e}}})}}),montageDefine("120b0c7","ui/image.reel/image",{dependencies:["montage","ui/component","ui/native/image.reel"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=e("ui/native/image.reel").Image;t.Image=r.create(s,{willPrepareForDraw:{value:function(){s.willPrepareForDraw.call(this),this.element.classList.add("montage-image")}}})}}),montageDefine("fb87e57","gallery.reel/gallery",{dependencies:["montage/core/core","montage/ui/component"],factory:function(e,t,n){var r=e("montage/core/core").Montage,i=e("montage/ui/component").Component,s=t.Gallery=r.create(i,{snapshotController:{value:null},list:{value:null},addSnapshot:{value:function(e){this.snapshotController.content.unshift(e)}}})}}),montageDefine("120b0c7","ui/native/image.reel/image",{dependencies:["montage","ui/component","ui/native-control"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=e("ui/native-control").NativeControl,o=t.Image=r.create(s,{});o.addAttributes({alt:null,height:null,src:null,width:null})}}),montageDefine("fb87e57","filter-preview.reel/filter-preview",{dependencies:["montage/core/core","montage/ui/component"],factory:function(e,t,n){var r=e("montage/core/core").Montage,i=e("montage/ui/component").Component,s=t.FilterPreview=r.create(i,{src:{value:null},image:{value:null},filter:{value:null}})}}),montageDefine("2649653","package.json",{exports:{name:"shuriken",version:"0.0.0",hash:"2649653",directories:{lib:"./"},mappings:{montage:{name:"montage",hash:"120b0c7",location:"../montage@120b0c7/"}},production:!0,useScriptInjection:!0}}),montageDefine("120b0c7","ui/input-checkbox.reel/input-checkbox.html",{text:"<!DOCTYPE html>\n\n<html>\n<head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=input-checkbox.css>\n</head>\n<body>\n</body>\n</html>"}),montageDefine("120b0c7","ui/select.reel/select.html",{text:"<!DOCTYPE html>\n\n<html>\n<head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=select.css>\n</head>\n<body>\n</body>\n</html>"}),montageDefine("120b0c7","ui/button.reel/button.html",{text:"<!DOCTYPE html>\n\n<html>\n<head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=button.css>\n</head>\n<body>\n</body>\n</html>"})
bundleLoaded(undefined)