function CombinedStream(){this.writable=!1,this.readable=!0,this.dataSize=0,this.maxDataSize=2097152,this.pauseStreams=!0,this._released=!1,this._streams=[],this._currentStream=null}var util=require("util"),Stream=require("stream").Stream,DelayedStream=require("delayed-stream");module.exports=CombinedStream,util.inherits(CombinedStream,Stream),CombinedStream.create=function(e){var t=new this;e=e||{};for(var n in e)t[n]=e[n];return t},CombinedStream.isStreamLike=function(e){return typeof e!="function"&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"&&!Buffer.isBuffer(e)},CombinedStream.prototype.append=function(e){var t=CombinedStream.isStreamLike(e);return t&&(e instanceof DelayedStream||(e.on("data",this._checkDataSize.bind(this)),e=DelayedStream.create(e,{maxDataSize:Infinity,pauseStream:this.pauseStreams})),this._handleErrors(e),this.pauseStreams&&e.pause()),this._streams.push(e),this},CombinedStream.prototype.pipe=function(e,t){Stream.prototype.pipe.call(this,e,t),this.resume()},CombinedStream.prototype._getNext=function(){this._currentStream=null;var e=this._streams.shift();if(typeof e=="undefined"){this.end();return}if(typeof e!="function"){this._pipeNext(e);return}var t=e;t(function(e){var t=CombinedStream.isStreamLike(e);t&&(e.on("data",this._checkDataSize.bind(this)),this._handleErrors(e)),this._pipeNext(e)}.bind(this))},CombinedStream.prototype._pipeNext=function(e){this._currentStream=e;var t=CombinedStream.isStreamLike(e);if(t){e.on("end",this._getNext.bind(this)),e.pipe(this,{end:!1});return}var n=e;this.write(n),this._getNext()},CombinedStream.prototype._handleErrors=function(e){var t=this;e.on("error",function(e){t._emitError(e)})},CombinedStream.prototype.write=function(e){this.emit("data",e)},CombinedStream.prototype.pause=function(){if(!this.pauseStreams)return;this.emit("pause")},CombinedStream.prototype.resume=function(){this._released||(this._released=!0,this.writable=!0,this._getNext()),this.emit("resume")},CombinedStream.prototype.end=function(){this._reset(),this.emit("end")},CombinedStream.prototype.destroy=function(){this._reset(),this.emit("close")},CombinedStream.prototype._reset=function(){this.writable=!1,this._streams=[],this._currentStream=null},CombinedStream.prototype._checkDataSize=function(){this._updateDataSize();if(this.dataSize<=this.maxDataSize)return;var e="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this._emitError(new Error(e))},CombinedStream.prototype._updateDataSize=function(){this.dataSize=0;var e=this;this._streams.forEach(function(t){if(!t.dataSize)return;e.dataSize+=t.dataSize}),this._currentStream&&this._currentStream.dataSize&&(this.dataSize+=this._currentStream.dataSize)},CombinedStream.prototype._emitError=function(e){this._reset(),this.emit("error",e)}