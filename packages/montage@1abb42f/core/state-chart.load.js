montageDefine("1abb42f","core/state-chart",{dependencies:["montage"],factory:function(e,n){var t=e("montage").Montage,s=n.State=t.specialize({_stateChart:{enumerable:!1,value:null},init:{value:function(e){this.substates={},this.enterState=null,this.exitState=null;for(var n,t,a=Object.keys(e),o=0;n=a[o];o++)t=e[n],"object"==typeof t&&s.prototype.isPrototypeOf(t)&&(t.name=n,t.parentState=this,this.substates[n]=t),this[n]="string"==typeof t&&"initialSubstate"!==n?this._encloseGotoState(t):t;return this}},name:{enumerable:!1,value:null},_initialSubstate:{enumerable:!1,value:null},initialSubstate:{get:function(){return"string"==typeof this._initialSubstate&&(this._initialSubstate=this[this._initialSubstate]),this._initialSubstate},set:function(e){this._initialSubstate=e}},substates:{enumerable:!1,value:null},parentState:{enumerable:!1,value:null},_path:{enumerable:!1,value:null},path:{enumerable:!1,get:function(){return this._path||(this._path=this.parentState&&this.parentState.path?this.parentState.path+"."+this.name:this.name),this._path}},enterState:{enumerable:!1,value:null},exitState:{enumerable:!1,value:null},isInState:{enumerable:!1,value:function(e){return"string"!=typeof e&&(e=e.name),!!this.path.match(RegExp(".?"+e+".?"))}},_encloseGotoState:{value:function(e){return function(n,t){return this._stateChart._gotoState(e,t)}}},gotoState:{value:function(e,n){return this._stateChart._gotoState(e,n)}},_performAction:{enumerable:null,value:function(e,n,t){if(this[e])this[e](n,t);else{if(!this.parentState)throw"Action '"+e+"' not available";this.parentState._performAction(e,n,t)}}},toString:{enumerable:!1,value:function(){return"[State "+this.path+" ]"}}});n.StateChart=t.specialize({delegate:{enumerable:!1,value:null},ownerStateProperty:{enumerable:!1,value:null},rootState:{enumerable:!1,value:null},_currentState:{enumerable:!1,value:null},currentState:{get:function(){return this.ownerStateProperty?null:this._currentState}},initWithState:{value:function(e){return this._states={},this.rootState=e,this.rootState._stateChart=this,this._prepareState(this.rootState),this.enterDefaultState(),this}},_defaultState:{enumerable:!1,value:null},defaultState:{enumerable:!1,get:function(){if(!this._defaultState){var e,n;for(e=n=this.rootState;n=n.initialSubstate;)e=n;this._defaultState=e}return this._defaultState}},enterDefaultState:{enumerable:!1,value:function(){if(this.ownerStateProperty&&!this.owner)throw"This stateChart has been configured to require an owner to execute this function";var e=this.ownerStateProperty?this.owner:this,n=this.ownerStateProperty?e["_"+this.ownerStateProperty]:e.currentState;if(n)throw"Cannot enter default state from '"+n.name+"'";var t,s;for(t=s=this.rootState;s=s.initialSubstate;)t.enterState&&t.enterState(this,e),t=s,s.initialSubstate&&t.exitState&&t.exitState(this,e);return this.ownerStateProperty?e["_"+this.ownerStateProperty]=this.defaultState:this._currentState=this.defaultState,this.defaultState}},_prepareState:{enumerable:!1,value:function(e){e._stateChart=this,e.name&&(this._states[e.name]=e);var n;for(n in e.substates)this._prepareState(e.substates[n])}},_states:{enumerable:!1,value:null},stateWithName:{enumerable:!1,value:function(e){return this._states[e]}},performAction:{value:function(e,n){if(this.ownerStateProperty&&!n)throw"This stateChart has been configured to require an owner to execute this function";n=this.ownerStateProperty?n:this;var t=this.ownerStateProperty?n[this.ownerStateProperty]:n.currentState;if(!t)throw"Cannot perform action '"+e+"' without a currentState";t._performAction(e,this,n),this.owner=null}},_gotoState:{value:function(e,n){if(this.ownerStateProperty&&!n)throw"This stateChart has been configured to require an owner to execute this function";n=this.ownerStateProperty?n:this;var t,s,a,o,i,r,l,p,c,u,h,d=this.ownerStateProperty?n[this.ownerStateProperty]:n.currentState,m=d.name,g=e,f=!1,v=!1,b=!1,y=!1;if("string"==typeof g?e=this._states[e]:g=e.name,g!==m&&(this.delegate&&(f="function"==typeof this.delegate.stateChartWillExitState,v="function"==typeof this.delegate.stateChartWillEnterState,b="function"==typeof this.delegate.stateChartDidExitState,y="function"==typeof this.delegate.stateChartDidEnterState),!this.delegate||"function"!=typeof this.delegate.stateChartShouldGoFromStateToState||this.delegate.stateChartShouldGoFromStateToState(this,d,e))){if(this.delegate&&"function"==typeof this.delegate.stateChartWillGoFromStateToState&&this.delegate.stateChartWillGoFromStateToState(this,d,e),t=d.path,s=e.path,RegExp(t).test(s))for(o=s.replace(RegExp(t+".?"),"").split("."),i=o.length,a=0;i>a;a++)u=this._states[o[a]],v&&this.delegate.stateChartWillEnterState(this,u),"function"==typeof u.enterState&&u.enterState(this,n),y&&this.delegate.stateChartDidEnterState(this,u);else{for(t=t.split("."),s=s.split("."),r=-1,p=s.length,c=Math.min(t.length,p);c>r&&(l=r+1,t[l]===s[l]);)r++;for(a=t.length-1;a>r;a--)u=this._states[t[a]],f&&this.delegate.stateChartWillExitState(this,u),"function"==typeof u.exitState&&u.exitState(this,n),b&&this.delegate.stateChartDidExitState(this,u);for(r=0>r?0:r,a=r;p>a;a++)u=this._states[s[a]],v&&this.delegate.stateChartWillEnterState(this,u),this.ownerStateProperty?n["_"+this.ownerStateProperty]=u:this._currentState=u,"function"==typeof u.enterState&&u.enterState(this,n),y&&this.delegate.stateChartDidEnterState(this,u)}h=d,this.delegate&&"function"==typeof this.delegate.stateChartDidGoFromStateToState&&this.delegate.stateChartDidGoFromStateToState(this,h,e),"function"==typeof n.transitionedFromStateToState&&n.transitionedFromStateToState(this,h,e)}}}})}});