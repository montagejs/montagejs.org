montageDefine("07f5592","zlib",{dependencies:["./lib/_stream_transform.js","util","assert"],factory:function(e,t){function n(e,t,n){function r(){for(var t;null!==(t=e.read());)o.push(t),s+=t.length;e.once("readable",r)}function i(t){e.removeListener("end",a),e.removeListener("readable",r),n(t)}function a(){var e=Buffer.concat(o,s);o=[],n(null,e)}var o=[],s=0;e.on("error",i),e.on("end",a),e.end(t),r()}function r(e){return this instanceof r?(c.call(this,e,d.DEFLATE),void 0):new r(e)}function i(e){return this instanceof i?(c.call(this,e,d.INFLATE),void 0):new i(e)}function a(e){return this instanceof a?(c.call(this,e,d.GZIP),void 0):new a(e)}function o(e){return this instanceof o?(c.call(this,e,d.GUNZIP),void 0):new o(e)}function s(e){return this instanceof s?(c.call(this,e,d.DEFLATERAW),void 0):new s(e)}function l(e){return this instanceof l?(c.call(this,e,d.INFLATERAW),void 0):new l(e)}function u(e){return this instanceof u?(c.call(this,e,d.UNZIP),void 0):new u(e)}function c(e,n){if(this._opts=e=e||{},this._chunkSize=e.chunkSize||t.Z_DEFAULT_CHUNK,h.call(this,e),this._readableState.chunkSize=null,e.chunkSize&&(e.chunkSize<t.Z_MIN_CHUNK||e.chunkSize>t.Z_MAX_CHUNK))throw Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<t.Z_MIN_WINDOWBITS||e.windowBits>t.Z_MAX_WINDOWBITS))throw Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<t.Z_MIN_LEVEL||e.level>t.Z_MAX_LEVEL))throw Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<t.Z_MIN_MEMLEVEL||e.memLevel>t.Z_MAX_MEMLEVEL))throw Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=t.Z_FILTERED&&e.strategy!=t.Z_HUFFMAN_ONLY&&e.strategy!=t.Z_RLE&&e.strategy!=t.Z_FIXED&&e.strategy!=t.Z_DEFAULT_STRATEGY)throw Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!Buffer.isBuffer(e.dictionary))throw Error("Invalid dictionary: it should be a Buffer instance");this._binding=new d.Zlib(n);var r=this;this._hadError=!1,this._binding.onerror=function(e,n){r._binding=null,r._hadError=!0;var i=Error(e);i.errno=n,i.code=t.codes[n],r.emit("error",i)},this._binding.init(e.windowBits||t.Z_DEFAULT_WINDOWBITS,e.level||t.Z_DEFAULT_COMPRESSION,e.memLevel||t.Z_DEFAULT_MEMLEVEL,e.strategy||t.Z_DEFAULT_STRATEGY,e.dictionary),this._buffer=new Buffer(this._chunkSize),this._offset=0,this._closed=!1,this.once("end",this.close)}var h=e("./lib/_stream_transform.js"),d=process.binding("zlib"),p=e("util"),f=e("assert").ok;d.Z_MIN_WINDOWBITS=8,d.Z_MAX_WINDOWBITS=15,d.Z_DEFAULT_WINDOWBITS=15,d.Z_MIN_CHUNK=64,d.Z_MAX_CHUNK=1/0,d.Z_DEFAULT_CHUNK=16384,d.Z_MIN_MEMLEVEL=1,d.Z_MAX_MEMLEVEL=9,d.Z_DEFAULT_MEMLEVEL=8,d.Z_MIN_LEVEL=-1,d.Z_MAX_LEVEL=9,d.Z_DEFAULT_LEVEL=d.Z_DEFAULT_COMPRESSION,Object.keys(d).forEach(function(e){e.match(/^Z/)&&(t[e]=d[e])}),t.codes={Z_OK:d.Z_OK,Z_STREAM_END:d.Z_STREAM_END,Z_NEED_DICT:d.Z_NEED_DICT,Z_ERRNO:d.Z_ERRNO,Z_STREAM_ERROR:d.Z_STREAM_ERROR,Z_DATA_ERROR:d.Z_DATA_ERROR,Z_MEM_ERROR:d.Z_MEM_ERROR,Z_BUF_ERROR:d.Z_BUF_ERROR,Z_VERSION_ERROR:d.Z_VERSION_ERROR},Object.keys(t.codes).forEach(function(e){t.codes[t.codes[e]]=e}),t.Deflate=r,t.Inflate=i,t.Gzip=a,t.Gunzip=o,t.DeflateRaw=s,t.InflateRaw=l,t.Unzip=u,t.createDeflate=function(e){return new r(e)},t.createInflate=function(e){return new i(e)},t.createDeflateRaw=function(e){return new s(e)},t.createInflateRaw=function(e){return new l(e)},t.createGzip=function(e){return new a(e)},t.createGunzip=function(e){return new o(e)},t.createUnzip=function(e){return new u(e)},t.deflate=function(e,t){n(new r,e,t)},t.gzip=function(e,t){n(new a,e,t)},t.deflateRaw=function(e,t){n(new s,e,t)},t.unzip=function(e,t){n(new u,e,t)},t.inflate=function(e,t){n(new i,e,t)},t.gunzip=function(e,t){n(new o,e,t)},t.inflateRaw=function(e,t){n(new l,e,t)},p.inherits(c,h),c.prototype.reset=function(){return this._binding.reset()},c.prototype._flush=function(e,t){var n=this._readableState,r=this;this._transform(null,e,function(e){return e?t(e):(n.length&&n.length<n.lowWaterMark&&!n.ended&&n.needReadable&&r.emit("readable"),t(),void 0)})},c.prototype.flush=function(e){var t=this._writableState,n=this._transformState;if(t.writing){t.needDrain=!0;var r=this;return this.once("drain",function(){r._flush(n.output,e)}),void 0}this._flush(n.output,e||function(){})},c.prototype.close=function(e){if(e&&process.nextTick(e),!this._closed){this._closed=!0,this._binding.close();var t=this;process.nextTick(function(){t.emit("close")})}},c.prototype._transform=function(e,t,n){function r(a,o){if(!p._hadError){var s=u-o;if(f(s>=0,"have should not go down"),s>0){var h=p._buffer.slice(p._offset,p._offset+s);p._offset+=s,t(h)}if((0===o||p._offset>=p._chunkSize)&&(u=p._chunkSize,p._offset=0,p._buffer=new Buffer(p._chunkSize)),0===o){c+=l-a,l=a;var d=p._binding.write(i,e,c,l,p._buffer,p._offset,p._chunkSize);return d.callback=r,d.buffer=e,void 0}n()}}var i,a=this._writableState,o=a.ending||a.ended,s=o&&(!e||a.length===e.length);if(null!==e&&!Buffer.isBuffer(e))return n(Error("invalid input"));i=s?d.Z_FINISH:null===e?d.Z_FULL_FLUSH:d.Z_NO_FLUSH;var l=e&&e.length,u=this._chunkSize-this._offset,c=0,h=this._binding.write(i,e,c,l,this._buffer,this._offset,u);h.buffer=e,h.callback=r;var p=this},p.inherits(r,c),p.inherits(i,c),p.inherits(a,c),p.inherits(o,c),p.inherits(s,c),p.inherits(l,c),p.inherits(u,c)}});