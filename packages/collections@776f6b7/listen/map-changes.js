"use strict";function MapChanges(){throw Error("Can't construct. MapChanges is a mixin.")}var WeakMap=require("weak-map"),List=require("../list");module.exports=MapChanges;var object_owns=Object.prototype.hasOwnProperty,mapChangeDescriptors=new WeakMap;MapChanges.prototype.getAllMapChangeDescriptors=function(){var e=require("../dict");return mapChangeDescriptors.has(this)||mapChangeDescriptors.set(this,e()),mapChangeDescriptors.get(this)},MapChanges.prototype.getMapChangeDescriptor=function(e){var t=this.getAllMapChangeDescriptors();return e=e||"",t.has(e)||t.set(e,{willChangeListeners:new List,changeListeners:new List}),t.get(e)},MapChanges.prototype.addMapChangeListener=function(e,t,n){!this.isObservable&&this.makeObservable&&this.makeObservable();var i,r=this.getMapChangeDescriptor(t);i=n?r.willChangeListeners:r.changeListeners,i.push(e),this.dispatchesMapChanges=!0;var a=this;return function(){a&&(a.removeMapChangeListener(e,t,n),a=null)}},MapChanges.prototype.removeMapChangeListener=function(e,t,n){var i,r=this.getMapChangeDescriptor(t);i=n?r.willChangeListeners:r.changeListeners;var a=i.findLast(e);if(!a)throw Error("Can't remove listener: does not exist.");a["delete"]()},MapChanges.prototype.dispatchMapChange=function(e,t,n){var i=this.getAllMapChangeDescriptors(),r="Map"+(n?"WillChange":"Change");i.forEach(function(i,a){if(!i.isActive){i.isActive=!0;var o;o=n?i.willChangeListeners:i.changeListeners;var s="handle"+(a.slice(0,1).toUpperCase()+a.slice(1))+r;try{o.forEach(function(n){if(n[s])n[s](t,e,this);else{if(!n.call)throw Error("Handler "+n+" has no method "+s+" and is not callable");n.call(n,t,e,this)}},this)}finally{i.isActive=!1}}},this)},MapChanges.prototype.addBeforeMapChangeListener=function(e,t){return this.addMapChangeListener(e,t,!0)},MapChanges.prototype.removeBeforeMapChangeListener=function(e,t){return this.removeMapChangeListener(e,t,!0)},MapChanges.prototype.dispatchBeforeMapChange=function(e,t){return this.dispatchMapChange(e,t,!0)};