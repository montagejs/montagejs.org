var common=require("../common"),assert=common.assert,DelayedStream=common.DelayedStream,http=require("http"),UPLOAD=new Buffer(10485760),server=http.createServer(function(e,t){var n=DelayedStream.create(e,{maxDataSize:UPLOAD.length});setTimeout(function(){t.writeHead(200),n.pipe(t)},10)});server.listen(common.PORT,function(){var e=http.request({method:"POST",port:common.PORT});e.write(UPLOAD),e.end(),e.on("response",function(e){var t=0;e.on("data",function(e){t+=e.length}).on("end",function(){assert.equal(t,UPLOAD.length),server.close()})})})