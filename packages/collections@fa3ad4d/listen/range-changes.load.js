montageDefine("fa3ad4d","listen/range-changes",{dependencies:["../weak-map","../dict"],factory:function(e,t,n){"use strict";function s(){throw Error("Can't construct. RangeChanges is a mixin.")}var a=e("../weak-map"),i=e("../dict"),r=new a;n.exports=s,s.prototype.getAllRangeChangeDescriptors=function(){return r.has(this)||r.set(this,i()),r.get(this)},s.prototype.getRangeChangeDescriptor=function(e){var t=this.getAllRangeChangeDescriptors();return e=e||"",t.has(e)||t.set(e,{isActive:!1,changeListeners:[],willChangeListeners:[]}),t.get(e)},s.prototype.addRangeChangeListener=function(e,t,n){!this.isObservable&&this.makeObservable&&this.makeObservable();var s,a=this.getRangeChangeDescriptor(t);s=n?a.willChangeListeners:a.changeListeners,s.push(e),this.dispatchesRangeChanges=!0;var i=this;return function(){i&&(i.removeRangeChangeListener(e,t,n),i=null)}},s.prototype.removeRangeChangeListener=function(e,t,n){var s,a=this.getRangeChangeDescriptor(t);s=n?a.willChangeListeners:a.changeListeners;var i=s.lastIndexOf(e);if(-1===i)throw Error("Can't remove listener: does not exist.");s.splice(i,1)},s.prototype.dispatchRangeChange=function(e,t,n,s){var a=this.getAllRangeChangeDescriptors(),i="Range"+(s?"WillChange":"Change");a.forEach(function(a,r){if(!a.isActive){a.isActive=!0;var o;o=s?a.willChangeListeners:a.changeListeners;var l="handle"+(r.slice(0,1).toUpperCase()+r.slice(1))+i;try{o.forEach(function(a){if(a[l])a[l](e,t,n,this,s);else{if(!a.call)throw Error("Handler "+a+" has no method "+l+" and is not callable");a.call(this,e,t,n,this,s)}},this)}finally{a.isActive=!1}}},this)},s.prototype.addBeforeRangeChangeListener=function(e,t){return this.addRangeChangeListener(e,t,!0)},s.prototype.removeBeforeRangeChangeListener=function(e,t){return this.removeRangeChangeListener(e,t,!0)},s.prototype.dispatchBeforeRangeChange=function(e,t,n){return this.dispatchRangeChange(e,t,n,!0)}}});