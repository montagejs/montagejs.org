function Reader(e){if(!e||!Buffer.isBuffer(e))throw new TypeError("data must be a node Buffer");this._buf=e,this._size=e.length,this._len=0,this._offset=0;var t=this;this.__defineGetter__("length",function(){return t._len}),this.__defineGetter__("offset",function(){return t._offset}),this.__defineGetter__("remain",function(){return t._size-t._offset}),this.__defineGetter__("buffer",function(){return t._buf.slice(t._offset)})}var assert=require("assert"),ASN1=require("./types"),errors=require("./errors"),newInvalidAsn1Error=errors.newInvalidAsn1Error;Reader.prototype.readByte=function(e){if(this._size-this._offset<1)return null;var t=this._buf[this._offset]&255;return e||(this._offset+=1),t},Reader.prototype.peek=function(){return this.readByte(!0)},Reader.prototype.readLength=function(e){e===undefined&&(e=this._offset);if(e>=this._size)return null;var t=this._buf[e++]&255;if(t===null)return null;if((t&128)==128){t&=127;if(t==0)throw newInvalidAsn1Error("Indefinite length not supported");if(t>4)throw newInvalidAsn1Error("encoding too long");if(this._size-e<t)return null;this._len=0;for(var n=0;n<t;n++)this._len=(this._len<<8)+(this._buf[e++]&255)}else this._len=t;return e},Reader.prototype.readSequence=function(e){var t=this.peek();if(t===null)return null;if(e!==undefined&&e!==t)throw newInvalidAsn1Error("Expected 0x"+e.toString(16)+": got 0x"+t.toString(16));var n=this.readLength(this._offset+1);return n===null?null:(this._offset=n,t)},Reader.prototype.readInt=function(){return this._readTag(ASN1.Integer)},Reader.prototype.readBoolean=function(){return this._readTag(ASN1.Boolean)===0?!1:!0},Reader.prototype.readEnumeration=function(){return this._readTag(ASN1.Enumeration)},Reader.prototype.readString=function(e,t){e||(e=ASN1.OctetString);var n=this.peek();if(n===null)return null;if(n!==e)throw newInvalidAsn1Error("Expected 0x"+e.toString(16)+": got 0x"+n.toString(16));var r=this.readLength(this._offset+1);if(r===null)return null;if(this.length>this._size-r)return null;this._offset=r;if(this.length===0)return"";var i=this._buf.slice(this._offset,this._offset+this.length);return this._offset+=this.length,t?i:i.toString("utf8")},Reader.prototype.readOID=function(e){e||(e=ASN1.OID);var t=this.peek();if(t===null)return null;if(t!==e)throw newInvalidAsn1Error("Expected 0x"+e.toString(16)+": got 0x"+t.toString(16));var n=this.readLength(this._offset+1);if(n===null)return null;if(this.length>this._size-n)return null;this._offset=n;var r=[],i=0;for(var s=0;s<this.length;s++){var o=this._buf[this._offset++]&255;i<<=7,i+=o&127,(o&128)==0&&(r.push(i),i=0)}return i=r.shift(),r.unshift(i%40),r.unshift(i/40>>0),r.join(".")},Reader.prototype._readTag=function(e){assert.ok(e!==undefined);var t=this.peek();if(t===null)return null;if(t!==e)throw newInvalidAsn1Error("Expected 0x"+e.toString(16)+": got 0x"+t.toString(16));var n=this.readLength(this._offset+1);if(n===null)return null;if(this.length>4)throw newInvalidAsn1Error("Integer too long: "+this.length);if(this.length>this._size-n)return null;this._offset=n;var r=this._buf[this._offset++],i=0;i=r&127;for(var s=1;s<this.length;s++)i<<=8,i|=this._buf[this._offset++]&255;return(r&128)==128&&(i=-i),i},module.exports=Reader