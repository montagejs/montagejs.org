var http=require("http"),assert=require("assert"),request=require("../index"),portOne=8968,portTwo=8969,s1=http.createServer(function(e,t){e.url=="/original"?(t.writeHeader(302,{location:"/redirected"}),t.end()):e.url=="/redirected"&&(t.writeHeader(200,{"content-type":"text/plain"}),t.write("OK"),t.end())}).listen(portOne),s2=http.createServer(function(e,t){var n=request("http://localhost:"+portOne+"/original");e.pipe(n),n.pipe(t)}).listen(portTwo,function(){var e=request("http://localhost:"+portTwo+"/original",function(e,t,n){assert.equal(n,"OK"),s1.close(),s2.close()});e.timeout=1e3})