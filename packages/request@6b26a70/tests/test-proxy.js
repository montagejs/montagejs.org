var server=require("./server"),events=require("events"),stream=require("stream"),assert=require("assert"),fs=require("fs"),request=require("../index"),path=require("path"),util=require("util"),port=6768,called=!1,proxiedHost="google.com",s=server.createServer(port);s.listen(port,function(){s.on("http://google.com/",function(e,t){called=!0,assert.equal(e.headers.host,proxiedHost),t.writeHeader(200),t.end()}),request({url:"http://"+proxiedHost,proxy:"http://localhost:"+port},function(e,t,n){s.close()})}),process.on("exit",function(){assert.ok(called,"the request must be made to the proxy server")})