var fs=require("fs"),http=require("http"),path=require("path"),https=require("https"),events=require("events"),stream=require("stream"),assert=require("assert");exports.createServer=function(e){e=e||6767;var t=http.createServer(function(e,n){t.emit(e.url,e,n)});return t.port=e,t.url="http://localhost:"+e,t},exports.createSSLServer=function(e,t){e=e||16767;var n={key:path.join(__dirname,"ssl","test.key"),cert:path.join(__dirname,"ssl","test.crt")};if(t)for(var r in t)n[r]=t[r];for(var r in n)n[r]=fs.readFileSync(n[r]);var i=https.createServer(n,function(e,t){i.emit(e.url,e,t)});return i.port=e,i.url="https://localhost:"+e,i},exports.createPostStream=function(e){var t=new stream.Stream;return t.writeable=!0,t.readable=!0,setTimeout(function(){t.emit("data",new Buffer(e)),t.emit("end")},0),t},exports.createPostValidator=function(e,t){var n=function(n,r){var i="";n.on("data",function(e){i+=e}),n.on("end",function(){if(n.headers["content-type"]&&n.headers["content-type"].indexOf("boundary=")>=0){var s=n.headers["content-type"].split("boundary=")[1];e=e.replace(/__BOUNDARY__/g,s)}i!==e&&console.log(i,e),assert.equal(i,e),t&&(assert.ok(n.headers["content-type"]),assert.ok(~n.headers["content-type"].indexOf(t))),r.writeHead(200,{"content-type":"text/plain"}),r.write("OK"),r.end()})};return n},exports.createGetResponse=function(e,t){var n=function(n,r){t=t||"text/plain",r.writeHead(200,{"content-type":t}),r.write(e),r.end()};return n},exports.createChunkResponse=function(e,t){var n=function(n,r){t=t||"text/plain",r.writeHead(200,{"content-type":t}),e.forEach(function(e){r.write(e)}),r.end()};return n}