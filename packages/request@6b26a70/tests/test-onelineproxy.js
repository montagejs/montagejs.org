var http=require("http"),assert=require("assert"),request=require("../index"),server=http.createServer(function(e,t){t.statusCode=200;if(e.url==="/get"){assert.equal(e.method,"GET"),t.write("content"),t.end();return}if(e.url==="/put"){var n="";assert.equal(e.method,"PUT"),e.on("data",function(e){n+=e}),e.on("end",function(){assert.equal(n,"content"),t.write("success"),t.end()});return}if(e.url==="/proxy")return assert.equal(e.method,"PUT"),e.pipe(request("http://localhost:8080/put")).pipe(t);if(e.url==="/test")return request("http://localhost:8080/get").pipe(request.put("http://localhost:8080/proxy")).pipe(t);throw new Error("Unknown url",e.url)}).listen(8080,function(){request("http://localhost:8080/test",function(e,t,n){if(e)throw e;if(t.statusCode!==200)throw new Error("statusCode not 200 "+t.statusCode);assert.equal(n,"success"),server.close()})})