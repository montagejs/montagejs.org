function bouncy(e,t){return function(){var n={a:"b",b:"c",c:"d",d:"e",e:"f",f:"g",g:"h",h:"end"},r=!0;Object.keys(n).forEach(function(i){var o=n[i],u=r?301:302;r=!r,e.on("/"+i,function(e,n){n.writeHead(u,{location:t+"/"+o}),n.end()})}),e.on("/end",function(e,t){var n=e.headers["x-test-key"];hits[n]=!0,pending--,pending===0&&done()})}}function done(){assert.deepEqual(hits,expect),process.exit(0)}var server=require("./server"),assert=require("assert"),request=require("../index"),s=server.createServer(),ss=server.createSSLServer(),sUrl="http://localhost:"+s.port,ssUrl="https://localhost:"+ss.port;s.listen(s.port,bouncy(s,ssUrl)),ss.listen(ss.port,bouncy(ss,sUrl));var hits={},expect={},pending=0;for(var i=0;i<5;i++){pending++;var val="test_"+i;expect[val]=!0,request({url:(i%2?sUrl:ssUrl)+"/a",headers:{"x-test-key":val},rejectUnauthorized:!1})}