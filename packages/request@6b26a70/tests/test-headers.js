var server=require("./server"),assert=require("assert"),request=require("../index"),Cookie=require("cookie-jar"),Jar=Cookie.Jar,s=server.createServer();s.listen(s.port,function(){function r(r,i){var o=t;t+=1,n+=1,s.on("/"+o,function(e,t){i(e,t),t.writeHead(200),t.end()}),r.url=e+"/"+o,request(r,function(e,r,i){assert.ok(!e),assert.equal(r.statusCode,200),n-=1,n===0&&(console.log(t+" tests passed."),s.close())})}var e="http://localhost:"+s.port,t=0,n=0;r({headers:{cookie:"foo=bar"}},function(e,t){assert.ok(e.headers.cookie),assert.equal(e.headers.cookie,"foo=bar")});var i=new Jar;i.add(new Cookie("quux=baz")),r({jar:i,headers:{cookie:"foo=bar"}},function(e,t){assert.ok(e.headers.cookie),assert.equal(e.headers.cookie,"foo=bar; quux=baz")}),r({},function(e,t){assert.ok(!e.headers.cookie)})})