var Hoek=require("hoek"),Sntp=require("sntp"),Boom=require("boom"),internals={};internals.import=function(){for(var e in Hoek)Hoek.hasOwnProperty(e)&&(exports[e]=Hoek[e])},internals.import(),exports.version=function(){return exports.loadPackage(__dirname+"/..").version},exports.parseHost=function(e,t){t=t?t.toLowerCase():"host";var n=e.headers[t];if(!n)return null;var r=/^(?:(?:\r\n)?[\t ])*([^:]+)(?::(\d+))?(?:(?:\r\n)?[\t ])*$/,i=n.match(r);return!i||i.length!==3||!i[1]?null:{name:i[1],port:i[2]?i[2]:e.connection&&e.connection.encrypted?443:80}},exports.parseContentType=function(e){return e?e.split(";")[0].trim().toLowerCase():""},exports.parseRequest=function(e,t){if(!e.headers)return e;var n=exports.parseHost(e,t.hostHeaderName);if(!n)return new Error("Invalid Host header");var r={method:e.method,url:e.url,host:n.name,port:n.port,authorization:e.headers.authorization,contentType:e.headers["content-type"]||""};return r},exports.now=function(){return Sntp.now()},exports.parseAuthorizationHeader=function(e,t){t=t||["id","ts","nonce","hash","ext","mac","app","dlg"];if(!e)return Boom.unauthorized(null,"Hawk");var n=e.match(/^(\w+)(?:\s+(.*))?$/);if(!n)return Boom.badRequest("Invalid header syntax");var r=n[1];if(r.toLowerCase()!=="hawk")return Boom.unauthorized(null,"Hawk");var i=n[2];if(!i)return Boom.badRequest("Invalid header syntax");var s={},o="",u=i.replace(/(\w+)="([^"\\]*)"\s*(?:,\s*|$)/g,function(e,n,r){if(t.indexOf(n)===-1){o="Unknown attribute: "+n;return}if(r.match(/^[ \w\!#\$%&'\(\)\*\+,\-\.\/\:;<\=>\?@\[\]\^`\{\|\}~]+$/)===null){o="Bad attribute value: "+n;return}if(s.hasOwnProperty(n)){o="Duplicate attribute: "+n;return}return s[n]=r,""});return u!==""?Boom.badRequest(o||"Bad header format"):s},exports.unauthorized=function(e){return Boom.unauthorized(e,"Hawk")}