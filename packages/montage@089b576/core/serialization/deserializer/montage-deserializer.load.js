montageDefine("089b576","core/serialization/deserializer/montage-deserializer",{dependencies:["core/core","mousse/deserialization/interpreter","mousse/deserialization/deserializer","./montage-interpreter","./montage-reviver","core/promise","core/jshint","core/logger"],factory:function(e,n){var s=e("core/core").Montage;e("mousse/deserialization/interpreter").Interpreter;var a=e("mousse/deserialization/deserializer").Deserializer,t=e("./montage-interpreter").MontageInterpreter,o=e("./montage-reviver").MontageReviver,i=e("core/promise").Promise,r=e("core/jshint").JSHINT;e("core/logger").logger("montage-deserializer");var p=s.specialize.call(a,{_interpreter:{value:null},_serializationString:{value:null},_serialization:{value:null},init:{value:function(e,n,s){if(!this.isSerializationStringValid(e))throw Error(this._formatSerializationSyntaxError(e));return a.call(this,e),this._origin,this._serialization=null,this._interpreter=(new t).init(n,s),this}},serialization:{get:function(){var e=this._serialization;return e||(e=JSON.parse(this._serializationString),this._serialization=e),e}},deserialize:{value:function(e,n){var s;try{s=JSON.parse(this._serializationString)}catch(a){return i.reject(a)}return this._interpreter.instantiate(s,e,n)}},preloadModules:{value:function(){var e=JSON.parse(this._serializationString);return this._interpreter.preloadModules(e)}},getExternalObjectLabels:{value:function(){var e=this.serialization,n=[];for(var s in e)0===Object.keys(e[s]).length&&n.push(s);return n}},isSerializationStringValid:{value:function(e){try{return JSON.parse(e),!0}catch(n){return!1}}},_formatSerializationSyntaxError:{value:function(e){var n,s,a,t,o,i="   ",p=this._origin;if(r(e))n="Syntax error in the serialization but not able to find it!\n"+e;else{s=r.errors[0],a=e.split("\n"),t=(i+a.length).length,o=s.line-1;for(var l=0,c=a.length;c>l;l++)a[l]=Array(t-(l+1+"").length+1).join(l===o?">":" ")+(l+1)+" "+a[l];n="Syntax error at line "+s.line+(p?" from "+p:"")+":\n"+s.evidence+"\n"+s.reason+"\n"+a.join("\n")}return n}}},{defineDeserializationUnit:{value:function(e,n){o.defineUnitReviver(e,n)}}});n.MontageDeserializer=p,n.deserialize=function(e,n){return(new p).init(e,n).deserializeObject()}}});