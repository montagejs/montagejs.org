montageDefine("1934147","composer/translate-composer",{dependencies:["montage","composer/composer","core/event/event-manager"],factory:function(n,s){"use strict";var e=(n("montage").Montage,n("composer/composer").Composer),a=n("core/event/event-manager").defaultEventManager,t=s.TranslateComposer=e.specialize({_NATIVE_ELEMENTS:{value:["A","IFRAME","EMBED","OBJECT","VIDEO","AUDIO","CANVAS","LABEL","INPUT","BUTTON","SELECT","TEXTAREA","KEYGEN","DETAILS","COMMAND"]},_WHEEL_POINTER:{value:"wheel",writable:!1},_externalUpdate:{value:!0},isAnimating:{value:!1},isMoving:{value:!1},frame:{value:function(){this.isAnimating&&this._animationInterval(),this._externalUpdate=!1}},_pointerSpeedMultiplier:{value:1},pointerSpeedMultiplier:{get:function(){return this._pointerSpeedMultiplier},set:function(n){this._pointerSpeedMultiplier=n}},pointerStartEventPosition:{value:null},_shouldDispatchTranslate:{value:!1},_isSelfUpdate:{value:!1},_allowFloats:{value:!1},allowFloats:{get:function(){return this._allowFloats},set:function(n){this._allowFloats!==n&&(this._allowFloats=n,this.translateX=this._translateX,this.translateY=this._translateY)}},_translateX:{value:0},translateX:{get:function(){return this._translateX},set:function(n){if("vertical"===this._axis)this._translateX=this._minTranslateX||0;else{var s=isNaN(n)?0:this._allowFloats?parseFloat(n):n>>0;null!==this._minTranslateX&&this._minTranslateX>s&&(s=this._minTranslateX),null!==this._maxTranslateX&&s>this._maxTranslateX&&(s=this._maxTranslateX),this._isSelfUpdate||(this.isAnimating=!1),this._translateX=s}}},_translateY:{value:0},translateY:{get:function(){return this._translateY},set:function(n){if("horizontal"===this._axis)this._translateY=this._minTranslateY||0;else{var s=isNaN(n)?0:this._allowFloats?parseFloat(n):n>>0;null!==this._minTranslateY&&this._minTranslateY>s&&(s=this._minTranslateY),null!==this._maxTranslateY&&s>this._maxTranslateY&&(s=this._maxTranslateY),this._isSelfUpdate||(this.isAnimating=!1),this._translateY=s}}},_minTranslateX:{value:null},minTranslateX:{get:function(){return this._minTranslateX},set:function(n){null!==n&&(n=parseFloat(n)),this._minTranslateX!=n&&(null!==n&&n>this._translateX&&(this.translateX=n),this._minTranslateX=n)}},_maxTranslateX:{value:null},maxTranslateX:{get:function(){return this._maxTranslateX},set:function(n){null!==n&&(n=parseFloat(n)),this._maxTranslateX!=n&&(null!==n&&this._translateX>n&&(this.translateX=n),this._maxTranslateX=n)}},_minTranslateY:{value:null},minTranslateY:{get:function(){return this._minTranslateY},set:function(n){null!==n&&(n=parseFloat(n)),this._minTranslateY!=n&&(null!==n&&n>this._translateY&&(this.translateY=n),this._minTranslateY=n)}},_maxTranslateY:{value:null},maxTranslateY:{get:function(){return this._maxTranslateY},set:function(n){null!==n&&(n=parseFloat(n)),this._maxTranslateY!=n&&(null!==n&&this._translateY>n&&(this.translateY=n),this._maxTranslateY=n)}},_axis:{value:"both"},axis:{get:function(){return this._axis},set:function(n){switch(n){case"vertical":case"horizontal":this._axis=n,this.translateX=this._translateX,this.translateY=this._translateY;break;default:this._axis="both"}}},invertAxis:{depends:["invertXAxis","invertYAxis"],get:function(){return this._invertXAxis===this._invertYAxis?this._invertXAxis:null},set:function(n){this.invertXAxis=n,this.invertYAxis=n}},_invertXAxis:{value:!1},invertXAxis:{get:function(){return this._invertXAxis},set:function(n){this._invertXAxis=!!n}},_invertYAxis:{value:!1},invertYAxis:{get:function(){return this._invertYAxis},set:function(n){this._invertYAxis=!!n}},startTranslateSpeed:{value:500},startTranslateRadius:{value:8},_hasMomentum:{value:!0},hasMomentum:{get:function(){return this._hasMomentum},set:function(n){this._hasMomentum=n?!0:!1}},__momentumDuration:{value:650},_momentumDuration:{get:function(){return this.__momentumDuration},set:function(n){this.__momentumDuration=isNaN(n)?1:n>>0,1>this.__momentumDuration&&(this.__momentumDuration=1)}},_pointerX:{value:null},_pointerY:{value:null},_touchIdentifier:{value:null},_isFirstMove:{value:!1},_start:{value:function(n,s,e){this.pointerStartEventPosition={pageX:n,pageY:s,target:e},this._pointerX=n,this._pointerY=s,window.Touch?(document.addEventListener("touchend",this,!0),this._element.addEventListener("touchmove",this,!1)):(document.addEventListener("mouseup",this,!0),this._element.addEventListener("mousemove",this,!1)),this.isAnimating=!1,this._isFirstMove=!0}},_observedPointer:{value:null},_shouldPreventDefault:{value:function(n){return!!n.target.tagName&&-1===t._NATIVE_ELEMENTS.indexOf(n.target.tagName)&&!n.target.isContentEditable}},captureMousedown:{value:function(n){0===n.button&&(this._observedPointer="mouse",this._start(n.clientX,n.clientY,n.target))}},handleMousedown:{value:function(n){0!==n.button||this.eventManager.componentClaimingPointer(this._observedPointer)||this.eventManager.claimPointer(this._observedPointer,this)}},handleMousemove:{value:function(n){this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?(n.preventDefault(),this._firstMove()):("both"===this.axis||this._analyzeMovement(n))&&this._stealPointer()&&(n.preventDefault(),this._firstMove())}},captureMousemove:{value:function(n){this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?(n.preventDefault(),this._move(n.clientX,n.clientY)):("both"===this.axis||this._analyzeMovement(n))&&this._stealPointer()&&(n.preventDefault(),this._move(n.clientX,n.clientY))}},captureMouseup:{value:function(n){this._end(n)}},_releaseInterest:{value:function(){window.Touch?(document.removeEventListener("touchend",this,!0),this._isFirstMove?this._element.removeEventListener("touchmove",this,!1):document.removeEventListener("touchmove",this,!0)):(document.removeEventListener("mouseup",this,!0),this._isFirstMove?this._element.removeEventListener("mousemove",this,!1):document.removeEventListener("mousemove",this,!0)),this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this.eventManager.forfeitPointer(this._observedPointer,this),this._observedPointer=null}},captureTouchstart:{value:function(n){null!==this._observedPointer&&this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)||n.targetTouches&&1===n.targetTouches.length&&(this._observedPointer=n.targetTouches[0].identifier,this._start(n.targetTouches[0].clientX,n.targetTouches[0].clientY,n.targetTouches[0].target))}},handleTouchstart:{value:function(n){this.eventManager.componentClaimingPointer(this._observedPointer)||n.targetTouches&&1===n.targetTouches.length&&(this._shouldPreventDefault(n)&&n.preventDefault(),this.eventManager.claimPointer(this._observedPointer,this))}},handleTouchmove:{value:function(n){this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?(n.preventDefault(),this._firstMove()):("both"===this.axis||this._analyzeMovement(n))&&this._stealPointer()&&(n.preventDefault(),this._firstMove())}},captureTouchmove:{value:function(n){for(var s=0,e=n.changedTouches.length;e>s&&n.changedTouches[s].identifier!==this._observedPointer;)s++;e>s&&(this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?(n.preventDefault(),this._move(n.changedTouches[s].clientX,n.changedTouches[s].clientY)):this._analyzeMovement(n.changedTouches[s]))}},captureTouchend:{value:function(n){for(var s=0,e=n.changedTouches.length;e>s&&n.changedTouches[s].identifier!==this._observedPointer;)s++;e>s&&this._end(n.changedTouches[s])}},_analyzeMovement:{value:function(n){var s=n.velocity;if(s){var e,a,t,o,p,l,i,r,c=.7853981633974483,h=2.356194490192345,d=-2.356194490192345,m=-.7853981633974483;if(l=s.speed,0!==s.speed&&!isNaN(s.speed))if(p=s.angle,"horizontal"===this.axis){if(t=c>=p&&p>=m,o=p>=h||d>=p,t||o)return this._stealPointer()}else if("vertical"===this.axis){if(e=m>=p&&p>=d,a=p>=c&&h>=p,e||a)return this._stealPointer()}else{if(l>=this.startTranslateSpeed)return this._stealPointer();if(i=this.pointerStartEventPosition.pageX-n.pageX,r=this.pointerStartEventPosition.pageY-n.pageY,i*i+r*r>this.startTranslateRadius*this.startTranslateRadius)return this._stealPointer()}}}},_stealPointer:{value:function(){return this.eventManager.claimPointer(this._observedPointer,this)}},_translateEndTimeout:{value:null},captureMousewheel:{value:function(){this.eventManager.componentClaimingPointer(this._WHEEL_POINTER)||this.eventManager.claimPointer(this._WHEEL_POINTER,this.component)}},handleMousewheel:{value:function(n){var s=this;if(this.eventManager.isPointerClaimedByComponent(this._WHEEL_POINTER,this.component)){var e=this._translateY;this._dispatchTranslateStart(),this.translateY=this._translateY-20*n.wheelDeltaY/120,this._dispatchTranslate(),window.clearTimeout(this._translateEndTimeout),this._translateEndTimeout=window.setTimeout(function(){s._dispatchTranslateEnd()},400),e!==this._translateY&&this._shouldPreventDefault(n)&&n.preventDefault(),this.eventManager.forfeitPointer(this._WHEEL_POINTER,this.component)}}},_firstMove:{value:function(){this._isFirstMove&&(this._dispatchTranslateStart(this._translateX,this._translateY),this._isFirstMove=!1,this.isMoving=!0,window.Touch?(document.addEventListener("touchmove",this,!0),this._element.removeEventListener("touchmove",this,!1)):(document.addEventListener("mousemove",this,!0),this._element.removeEventListener("mousemove",this,!1)))}},_move:{value:function(n,s){var e;this._isSelfUpdate=!0,"vertical"!=this._axis&&(e=this._invertXAxis?this._pointerX-n:n-this._pointerX,this.translateX+=e*this._pointerSpeedMultiplier),"horizontal"!=this._axis&&(e=this._invertYAxis?this._pointerY-s:s-this._pointerY,this.translateY+=e*this._pointerSpeedMultiplier),this._isSelfUpdate=!1,this._pointerX=n,this._pointerY=s,this._shouldDispatchTranslate&&this._dispatchTranslate()}},_bezierTValue:{value:function(n,s,e,a,t){var o,p,l,i,r=1-3*a+3*s,c=3*a-6*s,h=3*s,d=.5;for(p=0;10>p;p++)i=d*d,o=3*r*i+2*c*d+h,l=1-d,d-=(3*(l*l*d*s+l*i*a)+i*d-n)/o;return i=d*d,l=1-d,3*(l*l*d*e+l*i*t)+i*d}},_dispatchTranslateStart:{value:function(n,s){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateStart",!0,!0,null),e.translateX=n,e.translateY=s,this.dispatchEvent(e)}},_dispatchTranslateEnd:{value:function(){var n=document.createEvent("CustomEvent");n.initCustomEvent("translateEnd",!0,!0,null),n.translateX=this._translateX,n.translateY=this._translateY,this.dispatchEvent(n)}},_dispatchTranslate:{value:function(){var n=document.createEvent("CustomEvent");n.initCustomEvent("translate",!0,!0,null),n.translateX=this._translateX,n.translateY=this._translateY,this.dispatchEvent(n)}},animateBouncingX:{value:!1,enumerable:!1},startTimeBounceX:{value:!1,enumerable:!1},animateBouncingY:{value:!1,enumerable:!1},startTimeBounceY:{value:!1,enumerable:!1},animateMomentum:{value:!1,enumerable:!1},startTime:{value:null,enumerable:!1},startX:{value:null,enumerable:!1},posX:{value:null,enumerable:!1},endX:{value:null,enumerable:!1},startY:{value:null,enumerable:!1},posY:{value:null,enumerable:!1},endY:{value:null,enumerable:!1},translateStrideX:{value:null},translateStrideY:{value:null},translateStrideDuration:{value:330},_animationInterval:{value:function(){var n,s,e,a,t=Date.now(),o=!1;this.animateMomentum&&(n=t-this.startTime,this.__momentumDuration>n?(this.posX=this.startX-(this.momentumX+this.momentumX*(this.__momentumDuration-n)/this.__momentumDuration)*n/1e3/2,this.posY=this.startY-(this.momentumY+this.momentumY*(this.__momentumDuration-n)/this.__momentumDuration)*n/1e3/2,this.translateStrideX&&null===this.startStrideXTime&&(this.__momentumDuration-n<this.translateStrideDuration||Math.abs(this.posX-this.endX)<.75*this.translateStrideX)&&(this.startStrideXTime=t),this.translateStrideY&&null===this.startStrideYTime&&(this.__momentumDuration-n<this.translateStrideDuration||Math.abs(this.posY-this.endY)<.75*this.translateStrideY)&&(this.startStrideYTime=t)):this.animateMomentum=!1),s=Math.round(this.endX/this.translateStrideX),this.startStrideXTime&&t-this.startStrideXTime>0&&(t-this.startStrideXTime<this.translateStrideDuration?(n=this._bezierTValue((t-this.startStrideXTime)/this.translateStrideDuration,.275,0,.275,1),this.posX=this.posX*(1-n)+s*this.translateStrideX*n,o=!0):this.posX=s*this.translateStrideX),s=Math.round(this.endY/this.translateStrideY),this.startStrideYTime&&t-this.startStrideYTime>0&&(t-this.startStrideYTime<this.translateStrideDuration?(n=this._bezierTValue((t-this.startStrideYTime)/this.translateStrideDuration,.275,0,.275,1),this.posY=this.posY*(1-n)+s*this.translateStrideY*n,o=!0):this.posY=s*this.translateStrideY),e=this.posX,a=this.posY,this._isSelfUpdate=!0,this.translateX=e,this.translateY=a,this._shouldDispatchTranslate&&this._dispatchTranslate(),this._isSelfUpdate=!1,this.isAnimating=this.animateMomentum||o,this.isAnimating?this.needsFrame=!0:this._dispatchTranslateEnd()}},_end:{value:function(n){this.startTime=Date.now(),this.endX=this.posX=this.startX=this._translateX,this.endY=this.posY=this.startY=this._translateY,this._hasMomentum&&(n.velocity.speed>40||this.translateStrideX||this.translateStrideY)?(this.momentumX="vertical"!=this._axis?n.velocity.x*this._pointerSpeedMultiplier*(this._invertXAxis?1:-1):0,this.momentumY="horizontal"!=this._axis?n.velocity.y*this._pointerSpeedMultiplier*(this._invertYAxis?1:-1):0,this.endX=this.startX-this.momentumX*this.__momentumDuration/2e3,this.endY=this.startY-this.momentumY*this.__momentumDuration/2e3,this.startStrideXTime=null,this.startStrideYTime=null,this.animateMomentum=!0):this.animateMomentum=!1,this.animateMomentum?this._animationInterval():this._isFirstMove||(this.isMoving=!1,this._dispatchTranslateEnd()),this._releaseInterest()}},surrenderPointer:{value:function(){return!this.isMoving}},eventManager:{get:function(){return a}},load:{value:function(){window.Touch?(this._element.addEventListener("touchstart",this,!0),this._element.addEventListener("touchstart",this,!1)):(this._element.addEventListener("mousedown",this,!0),this._element.addEventListener("mousedown",this,!1),this._element.addEventListener("mousewheel",this,!1),this._element.addEventListener("mousewheel",this,!0)),this.eventManager.isStoringPointerEvents=!0}},addEventListener:{value:function(n,s,a){e.addEventListener.call(this,n,s,a),"translate"===n&&(this._shouldDispatchTranslate=!0)}}})}});