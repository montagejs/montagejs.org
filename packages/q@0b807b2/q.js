(function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else Q=e()})(function(){"use strict";function e(e){var t=Function.call;return function(){return t.apply(e,arguments)}}function t(e){return e===Object(e)}function n(e){return"[object StopIteration]"===_t(e)||e instanceof st}function i(e,t){if(rt&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(yt)){for(var n=[],i=t;i;i=i.source)i.stack&&n.unshift(i.stack);n.unshift(e.stack);var a=n.join("\n"+yt+"\n");e.stack=r(a)}}function r(e){for(var t=e.split("\n"),n=[],i=0;t.length>i;++i){var r=t[i];s(r)||a(r)||!r||n.push(r)}return n.join("\n")}function a(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function o(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var i=/.*@(.+):(\d+)$/.exec(e);return i?[i[1],Number(i[2])]:void 0}function s(e){var t=o(e);if(!t)return!1;var n=t[0],i=t[1];return n===ot&&i>=lt&&Tt>=i}function l(){if(rt)try{throw Error()}catch(e){var t=e.stack.split("\n"),n=t[0].indexOf("@")>0?t[1]:t[2],i=o(n);if(!i)return;return ot=i[0],i[1]}}function u(e,t,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+n+" instead.",Error("").stack),e.apply(e,arguments)}}function c(e){return M(e)}function h(){function e(e){t=e,a.source=e,dt(n,function(t,n){ct(function(){e.promiseDispatch.apply(e,n)})},void 0),n=void 0,i=void 0}var t,n=[],i=[],r=ft(h.prototype),a=ft(p.prototype);if(a.promiseDispatch=function(e,r,a){var o=ht(arguments);n?(n.push(o),"when"===r&&a[1]&&i.push(a[1])):ct(function(){t.promiseDispatch.apply(t,o)})},a.valueOf=u(function(){if(n)return a;var e=m(t);return f(e)&&(t=e),e},"valueOf","inspect"),a.inspect=function(){return t?t.inspect():{state:"pending"}},c.longStackSupport&&rt)try{throw Error()}catch(o){a.stack=o.stack.substring(o.stack.indexOf("\n")+1)}return r.promise=a,r.resolve=function(n){t||e(M(n))},r.fulfill=function(n){t||e(T(n))},r.reject=function(n){t||e(S(n))},r.notify=function(e){t||dt(i,function(t,n){ct(function(){n(e)})},void 0)},r}function d(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=h();return F(e,t.resolve,t.reject,t.notify).fail(t.reject),t.promise}function p(e,t,n){void 0===t&&(t=function(e){return S(Error("Promise does not support operation: "+e))}),void 0===n&&(n=function(){return{state:"unknown"}});var i=ft(p.prototype);if(i.promiseDispatch=function(n,r,a){var o;try{o=e[r]?e[r].apply(i,a):t.call(i,r,a)}catch(s){o=S(s)}n&&n(o)},i.inspect=n,n){var r=n();"rejected"===r.state&&(i.exception=r.reason),i.valueOf=u(function(){var e=n();return"pending"===e.state||"rejected"===e.state?i:e.value})}return i}function m(e){if(f(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function f(e){return t(e)&&"function"==typeof e.promiseDispatch&&"function"==typeof e.inspect}function v(e){return t(e)&&"function"==typeof e.then}function g(e){return f(e)&&"pending"===e.inspect().state}function _(e){return!f(e)||"fulfilled"===e.inspect().state}function b(e){return f(e)&&"rejected"===e.inspect().state}function y(){Pt||"undefined"==typeof window||window.Touch||!window.console||console.warn("[Q] Unhandled rejection reasons (should be empty):",wt),Pt=!0}function w(){for(var e=0;wt.length>e;e++){var t=wt[e];t&&t.stack!==void 0?console.warn("Unhandled rejection reason:",t.stack):console.warn("Unhandled rejection reason (no stack):",t)}}function E(){wt.length=0,Et.length=0,Pt=!1,Ct||(Ct=!0,"undefined"!=typeof process&&process.on&&process.on("exit",w))}function P(e,t){Ct&&(Et.push(e),wt.push(t),y())}function C(e){if(Ct){var t=pt(Et,e);-1!==t&&(Et.splice(t,1),wt.splice(t,1))}}function S(e){var t=p({when:function(t){return t&&C(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return P(t,e),t}function T(e){return p({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return null===t||void 0===t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return gt(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function M(e){return f(e)?e:v(e)?D(e):T(e)}function D(e){var t=h();return ct(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function O(e){return p({isDef:function(){}},function(t,n){return z(e,t,n)},function(){return M(e).inspect()})}function x(e,t,n,i){return c(e).then(t,n,i)}function L(e,t,n){return x(e,function(e){return U(e).then(function(e){return t.apply(void 0,e)},n)},n)}function A(e){return function(){function t(e,t){var o;if(bt){try{o=i[e](t)}catch(s){return S(s)}return o.done?o.value:x(o.value,r,a)}try{o=i[e](t)}catch(s){return n(s)?s.value:S(s)}return x(o,r,a)}var i=e.apply(this,arguments),r=t.bind(t,"send"),a=t.bind(t,"throw");return r()}}function I(e){c.done(c.async(e)())}function j(e){throw new st(e)}function k(e){return function(){return L([this,U(arguments)],function(t,n){return e.apply(t,n)})}}function z(e,t,n){var i=h();return ct(function(){M(e).promiseDispatch(i.resolve,t,n)}),i.promise}function R(e){return function(t){var n=ht(arguments,1);return z(t,e,n)}}function N(e,t){var n=ht(arguments,2);return St(e,t,n)}function B(e,t){return z(e,"apply",[void 0,t])}function F(e){var t=ht(arguments,1);return B(e,t)}function q(e){var t=ht(arguments,1);return function(){var n=t.concat(ht(arguments));return z(e,"apply",[this,n])}}function U(e){return x(e,function(e){var t=0,n=h();return dt(e,function(i,r,a){var o;f(r)&&"fulfilled"===(o=r.inspect()).state?e[a]=o.value:(++t,x(r,function(i){e[a]=i,0===--t&&n.resolve(e)},n.reject))},void 0),0===t&&n.resolve(e),n.promise})}function W(e){return x(e,function(e){return e=mt(e,M),x(U(mt(e,function(e){return x(e,ut,ut)})),function(){return e})})}function Y(e){return x(e,function(e){return U(mt(e,function(t,n){return x(t,function(t){return e[n]={state:"fulfilled",value:t},e[n]},function(t){return e[n]={state:"rejected",reason:t},e[n]})})).thenResolve(e)})}function V(e,t){return x(e,void 0,t)}function K(e,t){return x(e,void 0,void 0,t)}function X(e,t){return x(e,function(e){return x(t(),function(){return e})},function(e){return x(t(),function(){return S(e)})})}function H(e,t,n,r){var a=function(t){ct(function(){if(i(t,e),!c.onerror)throw t;c.onerror(t)})},o=t||n||r?x(e,t,n,r):e;"object"==typeof process&&process&&process.domain&&(a=process.domain.bind(a)),V(o,a)}function G(e,t,n){var i=h(),r=setTimeout(function(){i.reject(Error(n||"Timed out after "+t+" ms"))},t);return x(e,function(e){clearTimeout(r),i.resolve(e)},function(e){clearTimeout(r),i.reject(e)},i.notify),i.promise}function J(e,t){void 0===t&&(t=e,e=void 0);var n=h();return x(e,void 0,void 0,n.notify),setTimeout(function(){n.resolve(e)},t),n.promise}function $(e,t){var n=ht(t),i=h();return n.push(i.makeNodeResolver()),B(e,n).fail(i.reject),i.promise}function Z(e){var t=ht(arguments,1),n=h();return t.push(n.makeNodeResolver()),B(e,t).fail(n.reject),n.promise}function Q(e){var t=ht(arguments,1);return function(){var n=t.concat(ht(arguments)),i=h();return n.push(i.makeNodeResolver()),B(e,n).fail(i.reject),i.promise}}function et(e,t){var n=ht(arguments,2);return function(){function i(){return e.apply(t,arguments)}var r=n.concat(ht(arguments)),a=h();return r.push(a.makeNodeResolver()),B(i,r).fail(a.reject),a.promise}}function tt(e,t,n){var i=ht(n||[]),r=h();return i.push(r.makeNodeResolver()),St(e,t,i).fail(r.reject),r.promise}function nt(e,t){var n=ht(arguments,2),i=h();return n.push(i.makeNodeResolver()),St(e,t,n).fail(i.reject),i.promise}function it(e,t){return t?(e.then(function(e){ct(function(){t(null,e)})},function(e){ct(function(){t(e)})}),void 0):e}var rt=!1;try{throw Error()}catch(at){rt=!!at.stack}var ot,st,lt=l(),ut=function(){},ct=function(){function e(){for(;t.next;){t=t.next;var n=t.task;t.task=void 0;var r=t.domain;r&&(t.domain=void 0,r.enter());try{n()}catch(o){if(a)throw r&&r.exit(),setTimeout(e,0),r&&r.enter(),o;setTimeout(function(){throw o},0)}r&&r.exit()}i=!1}var t={task:void 0,next:null},n=t,i=!1,r=void 0,a=!1;if(ct=function(e){n=n.next={task:e,domain:a&&process.domain,next:null},i||(i=!0,r())},"undefined"!=typeof process&&process.nextTick)a=!0,r=function(){process.nextTick(e)};else if("function"==typeof setImmediate)r="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var o=new MessageChannel;o.port1.onmessage=e,r=function(){o.port2.postMessage(0)}}else r=function(){setTimeout(e,0)};return ct}(),ht=e(Array.prototype.slice),dt=e(Array.prototype.reduce||function(e,t){var n=0,i=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=i)throw new TypeError}for(;i>n;n++)n in this&&(t=e(t,this[n],n));return t}),pt=e(Array.prototype.indexOf||function(e){for(var t=0;this.length>t;t++)if(this[t]===e)return t;return-1}),mt=e(Array.prototype.map||function(e,t){var n=this,i=[];return dt(n,function(r,a,o){i.push(e.call(t,a,o,n))},void 0),i}),ft=Object.create||function(e){function t(){}return t.prototype=e,new t},vt=e(Object.prototype.hasOwnProperty),gt=Object.keys||function(e){var t=[];for(var n in e)vt(e,n)&&t.push(n);return t},_t=e(Object.prototype.toString);st="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var bt;try{Function("(function* (){ yield 1; })"),bt=!0}catch(at){bt=!1}var yt="From previous event:";c.nextTick=ct,c.longStackSupport=!1,c.defer=h,h.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(ht(arguments,1)):e.resolve(n)}},c.promise=d,c.makePromise=p,p.prototype.then=function(e,t,n){function r(t){try{return"function"==typeof e?e(t):t}catch(n){return S(n)}}function a(e){if("function"==typeof t){i(e,s);try{return t(e)}catch(n){return S(n)}}return S(e)}function o(e){return"function"==typeof n?n(e):e}var s=this,l=h(),u=!1;return ct(function(){s.promiseDispatch(function(e){u||(u=!0,l.resolve(r(e)))},"when",[function(e){u||(u=!0,l.resolve(a(e)))}])}),s.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=o(e)}catch(i){if(n=!0,!c.onerror)throw i;c.onerror(i)}n||l.notify(t)}]),l.promise},p.prototype.thenResolve=function(e){return x(this,function(){return e})},p.prototype.thenReject=function(e){return x(this,function(){throw e})},dt(["isFulfilled","isRejected","isPending","dispatch","when","spread","get","set","del","delete","post","send","mapply","invoke","mcall","keys","fapply","fcall","fbind","all","allResolved","timeout","delay","catch","finally","fail","fin","progress","done","nfcall","nfapply","nfbind","denodeify","nbind","npost","nsend","nmapply","ninvoke","nmcall","nodeify"],function(e,t){p.prototype[t]=function(){return c[t].apply(c,[this].concat(ht(arguments)))}},void 0),p.prototype.toSource=function(){return""+this},p.prototype.toString=function(){return"[object Promise]"},c.nearer=m,c.isPromise=f,c.isPromiseAlike=v,c.isPending=g,c.isFulfilled=_,c.isRejected=b;var wt=[],Et=[],Pt=!1,Ct=!0;c.resetUnhandledRejections=E,c.getUnhandledReasons=function(){return wt.slice()},c.stopUnhandledRejectionTracking=function(){E(),"undefined"!=typeof process&&process.on&&process.removeListener("exit",w),Ct=!1},E(),c.reject=S,c.fulfill=T,c.resolve=M,c.master=O,c.when=x,c.spread=L,c.async=A,c.spawn=I,c["return"]=j,c.promised=k,c.dispatch=z,c.dispatcher=R,c.get=R("get"),c.set=R("set"),c["delete"]=c.del=R("delete");var St=c.post=R("post");c.mapply=St,c.send=N,c.invoke=N,c.mcall=N,c.fapply=B,c["try"]=F,c.fcall=F,c.fbind=q,c.keys=R("keys"),c.all=U,c.allResolved=u(W,"allResolved","allSettled"),c.allSettled=Y,c["catch"]=c.fail=V,c.progress=K,c["finally"]=c.fin=X,c.done=H,c.timeout=G,c.delay=J,c.nfapply=$,c.nfcall=Z,c.nfbind=Q,c.denodeify=c.nfbind,c.nbind=et,c.npost=tt,c.nmapply=tt,c.nsend=nt,c.ninvoke=c.nsend,c.nmcall=c.nsend,c.nodeify=it;var Tt=l();return c});