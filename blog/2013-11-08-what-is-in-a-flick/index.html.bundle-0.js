BUNDLE=[["index.html.bundle-1-0.js"]],"undefined"!=typeof window&&("ontouchstart"in window||(window.Touch=null),document._montageTiming={},document._montageTiming.loadStartTime=Date.now(),window.addEventListener("DOMContentLoaded",function(){var e=1e3;document._montageStartBootstrappingTimeout=setTimeout(function(){document._montageStartBootstrappingTimeout=null;var e=document.documentElement;e.classList?e.classList.add("montage-app-bootstrapping"):e.className=e.className+" montage-app-bootstrapping",document._montageTiming.bootstrappingStartTime=Date.now()},e)})),function(e){"undefined"!=typeof require?e.call("undefined"!=typeof global?global:this,require,exports,module):e({},{},{})}(function(e,t){global=this,t.initMontage=function(){var e=t.getPlatform();e.bootstrap(function(n,r,i){var a=e.getParams(),s=e.getConfig(),l=i.resolve(n.getLocation(),a.montageLocation);s.makeLoader=function(e){return t.ReelLoader(e,n.makeLoader(e))},s.makeCompiler=function(e){return t.MetaCompiler(e,t.SerializationCompiler(e,t.TemplateCompiler(e,n.makeCompiler(e))))};var c=i.resolve(s.location,a["package"]||"."),u=a.applicationHash;if("object"==typeof BUNDLE){var h={},d=function(e){return h[e]=h[e]||r.defer()};global.bundleLoaded=function(e){d(e).resolve()};var p=r.defer();s.preloaded=p.promise;var f=r.resolve();BUNDLE.forEach(function(e){f=f.then(function(){return r.all(e.map(function(e){return o.load(e),d(e).promise}))})}),p.resolve(f.then(function(){delete BUNDLE,delete bundleLoaded}))}var m;if("remoteTrigger"in a){var g=r.defer();window.postMessage({type:"montageReady"},"*");var v=function(e){if(a.remoteTrigger===e.origin&&(e.source===window||e.source===window.parent))switch(e.data.type){case"montageInit":window.removeEventListener("message",v),g.resolve([e.data.location,e.data.injections]);break;case"isMontageReady":window.postMessage({type:"montageReady"},"*")}};window.addEventListener("message",v),m=g.promise.spread(function(e,t){var r=n.loadPackage({location:e,hash:u},s);return t&&(r=r.then(function(n){e=i.resolve(e,".");var r,a,o=t.packageDescriptions,s=t.packageDescriptionLocations,l=t.mappings,c=t.dependencies;if(o)for(a=o.length,r=0;a>r;r++)n.injectPackageDescription(o[r].location,o[r].description);if(s)for(a=s.length,r=0;a>r;r++)n.injectPackageDescriptionLocation(s[r].location,s[r].descriptionLocation);if(l)for(a=l.length,r=0;a>r;r++)n.injectMapping(l[r].dependency,l[r].name);if(c)for(a=c.length,r=0;a>r;r++)n.injectDependency(c[r].name,c[r].version);return n})),r})}else{if("autoPackage"in a)n.injectPackageDescription(c,{dependencies:{montage:"*"}},s);else if(".json"===c.slice(c.length-5)){var b=c;c=i.resolve(c,"."),n.injectPackageDescriptionLocation(c,b,s)}m=n.loadPackage({location:c,hash:u},s)}m.then(function(t){t.loadPackage({location:l,hash:a.montageHash}).then(function(e){var t;return t=a.promiseLocation?i.resolve(n.getLocation(),a.promiseLocation):i.resolve(l,"packages/mr/packages/q"),[e,e.loadPackage({location:t,hash:a.promiseHash})]}).spread(function(n,o){n.inject("core/mini-url",i),n.inject("core/promise",{Promise:r}),o.inject("q",r),s.lint=function(e){n.async("core/jshint").then(function(t){t.JSHINT(e.text)||(console.warn("JSHint Error: "+e.location),t.JSHINT.errors.forEach(function(e){e&&(console.warn("Problem at line "+e.line+" character "+e.character+": "+e.reason),e.evidence&&console.warn("    "+e.evidence))}))}).done()},global.require=t,global.montageRequire=n,e.initMontage(n,t,a)})}).done()})};var n=/((.*)\.reel)\/\2$/,r=function(e,t){return t};t.SerializationCompiler=function(e,t){return function(e){if(t(e),e.factory){var i=e.factory;return e.factory=function(e,t,a){i.call(this,e,t,a);for(var o in t){var s=t[o];if(s instanceof Object)if(s.hasOwnProperty("_montage_metadata")&&!s._montage_metadata.isInstance)s._montage_metadata.aliases.push(o),s._montage_metadata.objectName=o;else if(!Object.isSealed(s)){var l=a.id.replace(n,r);Object.defineProperty(s,"_montage_metadata",{value:{require:e,module:l,moduleId:l,property:o,objectName:o,aliases:[o],isInstance:!1}})}}},e}}};var i=/([^\/]+)\.reel$/;t.ReelLoader=function(e,t){return function(e,n){var r=i.exec(e);return r?(n.redirect=e+"/"+r[1],n):t(e,n)}};var a=/\.meta/;t.MetaCompiler=function(e,t){return function(e){var n=(e.location||"").match(a);return n?(e.exports=JSON.parse(e.text),e):t(e)}},t.TemplateCompiler=function(e,t){return function(e){if(e.location){var n=e.location.match(/(.*\/)?(?=[^\/]+\.html(?:\.load\.js)?$)/);return n?(e.dependencies=e.dependencies||[],e.exports={directory:n[1],content:e.text},Object.defineProperty(e.exports,"root",{get:function(){return"object"==typeof console&&console.warn("'root' property is deprecated on template modules.  Use 'directory' instead of root[1]"),n}}),e):(t(e),void 0)}}},t.getPlatform=function(){if("undefined"!=typeof window&&window&&window.document)return o;if("undefined"!=typeof process)return e("./node.js");throw Error("Platform not supported.")};var o={makeResolve:function(){var e=document.querySelector("head"),t=document.createElement("base"),n=document.createElement("a");return t.href="",function(r,i){var a=e.querySelector("base");if(a||(e.appendChild(t),a=t),r+="",!/^[\w\-]+:/.test(r))throw Error("Can't resolve from a relative location: "+JSON.stringify(r)+" "+JSON.stringify(i));var o=a.href;a.href=r,n.href=i;var s=n.href;return a.href=o,a===t&&e.removeChild(a),s}},load:function(e){var t=document.createElement("script");t.src=e,t.onload=function(){t.parentNode.removeChild(t)},document.getElementsByTagName("head")[0].appendChild(t)},getConfig:function(){return{location:""+window.location}},getParams:function(){var e,t,n,r,i,a,o;if(!this._params){this._params={};var s=document.getElementsByTagName("script");for(e=0;s.length>e;e++)if(r=s[e],i=!1,r.src&&(n=r.src.match(/^(.*)montage.js(?:[\?\.]|$)/i))&&(this._params.montageLocation=n[1],i=!0),r.hasAttribute("data-montage-location")&&(this._params.montageLocation=r.getAttribute("data-montage-location"),i=!0),i){if(r.dataset)for(o in r.dataset)this._params[o]=r.dataset[o];else if(r.attributes){var l=/-([a-z])/g,c=function(e,t){return t.toUpperCase()};for(t=0;r.attributes.length>t;t++)a=r.attributes[t],n=a.name.match(/^data-(.*)$/),n&&(this._params[n[1].replace(l,c)]=a.value)}r.parentNode.removeChild(r);break}}return this._params},bootstrap:function(e){function t(){document.removeEventListener("DOMContentLoaded",t,!0),s=!0,i()}function n(e){if(!g[e]&&m[e]){var t=g[e]={};g[e]=m[e](n,t)||t}return g[e]}function r(){c=n("mini-url"),l=n("promise"),a=n("require"),delete global.bootstrap,i()}function i(){s&&a&&e(a,l,c)}var a,s,l,c,u=this.getParams(),h=this.makeResolve();/interactive|complete/.test(document.readyState)?t():document.addEventListener("DOMContentLoaded",t,!0);var d={require:"packages/mr/require.js","require/browser":"packages/mr/browser.js",promise:"packages/mr/packages/q/q.js"};if("undefined"==typeof BUNDLE){var p=h(window.location,u.montageLocation);for(var f in d)o.load(h(p,d[f]))}var m={};global.bootstrap=function(e,t){m[e]=t,delete d[e];for(var e in d)return;delete global.bootstrap,r()},global.bootstrap("mini-url",function(e,t){t.resolve=h});var g={}},initMontage:function(e,t,n){var r=["core/core","core/event/event-manager","core/serialization/deserializer/montage-reviver","core/logger"],i=e("core/promise").Promise;return i.all(r.map(e.deepLoad)).then(function(){r.forEach(e);var a,o,s=e("core/core").Montage,l=e("core/event/event-manager").EventManager,c=e("core/serialization/deserializer/montage-reviver").MontageReviver,u=e("core/logger").logger;u("Promise stacktrace support",function(e){i.longStackSupport=!!e}),a=(new l).initWithWindow(window),"function"==typeof global.montageWillLoad&&global.montageWillLoad();var h,d,p=t.packageDescription.applicationPrototype;return p?(h=c.parseObjectLocationId(p),d=t.async(h.moduleId)):d=e.async("core/application"),d.then(function(e){var r=e[h?h.objectName:"Application"];o=new r,Object.defineProperty(window.document,"application",{get:s.deprecate(null,function(){return e.application},'document.application is deprecated, use require("montage/core/application").application instead.')}),a.application=o,o.eventManager=a,o._load(t,function(){n.module&&t.async(n.module).done(),"function"==typeof global.montageDidLoad&&global.montageDidLoad()})})}).done()}};"undefined"!=typeof window?global.__MONTAGE_LOADED__?console.warn("Montage already loaded!"):(global.__MONTAGE_LOADED__=!0,t.initMontage()):t.getPlatform()}),function(e){if("undefined"!=typeof bootstrap)"undefined"!=typeof window?bootstrap("require",function(t,n){var r=t("promise"),i=t("mini-url");e(n,r,i),t("require/browser")}):bootstrap("require",function(t,n){var r=t("promise").Promise,i=t("mini-url");e(n,r,i)});else{if("undefined"==typeof process)throw Error("Can't support require on this platform");var t=require("q"),n=require("url");e(exports,t,n),require("./node")}}(function(e,t,n){function r(t,r){if(r=r||{},"string"==typeof t&&(t={location:t}),t.main&&(t.location=r.mainPackageLocation),t.name&&r.registry&&r.registry[t.name]&&(t.location=r.registry[t.name]),!t.location&&r.packagesDirectory&&t.name&&(t.location=n.resolve(r.packagesDirectory,t.name+"/")),!t.location)return t;if(/\/$/.test(t.location)||(t.location+="/"),!e.isAbsolute(t.location)){if(!r.location)throw Error("Dependency locations must be fully qualified: "+JSON.stringify(t));t.location=n.resolve(r.location,t.location)}return t.name&&(r.registry[t.name]=t.location),t}function i(t,i,a){/\/$/.test(t)||(t+="/");var o=Object.create(a);o.name=i.name,o.location=t||e.getLocation(),o.packageDescription=i,o.useScriptInjection=i.useScriptInjection,void 0!==i.production&&(o.production=i.production);var l=o.modules=o.modules||{},c=o.registry;void 0===o.name||c[o.name]||(c[o.name]=o.location);var u=i.overlay||{};(o.overlays||e.overlays).forEach(function(e){if(u[e]){var t=u[e];for(var n in t)i[n]=t[n]}}),delete i.overlay,i.directories=i.directories||{},i.directories.lib=void 0===i.directories.lib?"./":i.directories.lib;var h=i.directories.lib;o.lib=n.resolve(t,"./"+h);var d=i.directories.packages||"node_modules";d=n.resolve(t,d+"/"),o.packagesDirectory=d,void 0!==i.main&&(l[""]={id:"",redirect:s(i.main),location:o.location},i.name!==l[""].redirect&&(l[i.name]={id:i.name,redirect:"",location:n.resolve(t,i.name)}));var p=i.redirects;void 0!==p&&Object.keys(p).forEach(function(e){l[e]={id:e,redirect:p[e],location:n.resolve(t,e)}});var f=i.mappings||{};return[i.dependencies,o.production?null:i.devDependencies].forEach(function(e){e&&Object.keys(e).forEach(function(t){f[t]||(f[t]={name:t,version:e[t]})})}),Object.keys(f).forEach(function(e){f[e]=r(f[e],o,e)}),o.mappings=f,o}function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function o(e,t){e+="";var n=e.split("/"),r=[];if(n.length&&"."===n[0]||".."===n[0]){var i=t.split("/");i.pop(),n.unshift.apply(n,i)}for(var a=0,o=n.length;o>a;a++){var s=n[a];""===s||"."===s||(".."===s?r.length&&r.pop():r.push(s))}return r.join("/")}if(!this)throw Error("Require does not work in strict mode.");e.makeRequire=function(i){function c(e){var t=e.toLowerCase();return a(g,t)||(g[t]={id:e,display:(i.name||i.location)+"#"+e,require:m}),g[t]}function u(e,t){var r=c(e);r.exports=t,r.location=n.resolve(i.location,e),r.directory=n.resolve(r.location,"./"),r.injected=!0,delete r.redirect,delete r.mappingRedirect}function h(e,n,r){var i=c(e);return r=r||{},a(r,e)?void 0:(r[e]=!0,v(e,n).then(function(){return t.all(i.dependencies.map(function(t){t=o(t,e);var n=c(t),i=n.dependees=n.dependees||{};return i[e]=!0,h(t,e,r)}))},function(e){i.error=e}))}function d(e,t){var r=c(e);if(r.id!==e)throw Error("Can't require module "+JSON.stringify(r.id)+" by alternate spelling "+JSON.stringify(e));if(r.error){var i=Error("Can't require module "+JSON.stringify(r.id)+" via "+JSON.stringify(t)+" because "+r.error.message);throw i.cause=r.error,i}if(void 0!==r.redirect)return d(r.redirect,t);if(void 0!==r.mappingRedirect)return r.mappingRequire(r.mappingRedirect,t);if(void 0!==r.exports)return r.exports;if(void 0===r.factory)throw Error("Can't require module "+JSON.stringify(e)+" via "+JSON.stringify(t));r.directory=n.resolve(r.location,"./"),r.exports={};var a=r.factory.call(void 0,f(e),r.exports,r);return void 0!==a&&(r.exports=a),r.exports}function p(e,t,n){var r=i.location;if(t.location===r)return e;var o=!!n;if(n=n||{},a(n,r))return null;n[r]=!0;for(var s in i.mappings){var l=i.mappings[s];if(r=l.location,i.hasPackage(r)){var c=i.getPackage(r),u=c.identify(e,t,n);if(null!==u)return""===u?s:s+"/"+u}}if(o)return null;throw Error("Can't identify "+e+" from "+t.location)}function f(t){var n=function(e){var n=o(e,t);return d(n,t)};return n.async=function(e){var r=o(e,t);return c(e),h(r,t).then(function(){return n(r)})},n.resolve=function(e){return s(o(e,t))},n.getModule=c,n.getModuleDescriptor=c,n.load=v,n.deepLoad=h,n.loadPackage=function(t,n){return n?e.loadPackage(t,n):i.loadPackage(t,i)},n.hasPackage=function(e){return i.hasPackage(e)},n.getPackage=function(e){return i.getPackage(e)},n.isMainPackage=function(){return n.location===i.mainPackageLocation},n.injectPackageDescription=function(t,n){e.injectPackageDescription(t,n,i)},n.injectPackageDescriptionLocation=function(t,n){e.injectPackageDescriptionLocation(t,n,i)},n.injectMapping=function(e,t){e=r(e,i,t),t=t||e.name,i.mappings[t]=e},n.injectDependency=function(e){n.injectMapping({name:e},e)},n.identify=p,n.inject=u,i.exposedConfigs.forEach(function(e){n[e]=i[e]}),n.config=i,n.read=i.read,n}var m;i=i||{},i.location=n.resolve(i.location||e.getLocation(),"./"),i.lib=n.resolve(i.location,i.lib||"./"),i.paths=i.paths||[i.lib],i.mappings=i.mappings||{},i.exposedConfigs=i.exposedConfigs||e.exposedConfigs,i.makeLoader=i.makeLoader||e.makeLoader,i.load=i.load||i.makeLoader(i),i.makeCompiler=i.makeCompiler||e.makeCompiler,i.compile=i.compile||i.makeCompiler(i),i.parseDependencies=i.parseDependencies||e.parseDependencies,i.read=i.read||e.read;var g=i.modules=i.modules||{},v=l(function(e){var n=c(e);return t.fcall(function(){return void 0===n.factory&&void 0===n.exports&&void 0===n.redirect?t.fcall(i.load,e,n):void 0}).then(function(){i.compile(n);var e=n.dependencies=n.dependencies||[];void 0!==n.redirect&&e.push(n.redirect),void 0!==n.extraDependencies&&Array.prototype.push.apply(n.dependencies,n.extraDependencies)})});return m=f("")},e.injectPackageDescription=function(e,n,r){var i=r.descriptions=r.descriptions||{};i[e]=t.resolve(n)},e.injectPackageDescriptionLocation=function(e,t,n){var r=n.descriptionLocations=n.descriptionLocations||{};r[e]=t},e.loadPackageDescription=function(t,r){var i=t.location,a=r.descriptions=r.descriptions||{};if(void 0===a[i]){var o,s=r.descriptionLocations=r.descriptionLocations||{};o=s[i]?s[i]:n.resolve(i,"package.json"),a[i]=(r.read||e.read)(o).then(function(e){try{return JSON.parse(e)}catch(t){throw t.message=t.message+" in "+JSON.stringify(o),t}})}return a[i]},e.loadPackage=function(t,n){if(t=r(t,n),!t.location)throw Error("Can't find dependency: "+JSON.stringify(t));var a=t.location;n=Object.create(n||null);var o=n.loadingPackages=n.loadingPackages||{},s=n.packages={};n.registry=n.registry||Object.create(null),n.mainPackageLocation=a,n.hasPackage=function(e){if(e=r(e,n),!e.location)return!1;var t=e.location;return!!s[t]},n.getPackage=function(e){if(e=r(e,n),!e.location)throw Error("Can't find dependency: "+JSON.stringify(e)+" from "+n.location);var t=e.location;if(!s[t])throw o[t]?Error("Dependency has not finished loading: "+JSON.stringify(e)):Error("Dependency was not loaded: "+JSON.stringify(e));return s[t]},n.loadPackage=function(t,a){if(t=r(t,a),!t.location)throw Error("Can't find dependency: "+JSON.stringify(t)+" from "+n.location);var l=t.location;return o[l]||(o[l]=e.loadPackageDescription(t,n).then(function(t){var r=i(l,t,n),a=e.makeRequire(r);return s[l]=a,a})),o[l]};var l=n.loadPackage(t);return l.location=a,l.async=function(e,t){return l.then(function(n){return n.async(e,t)})},l},e.resolve=o,e.base=function(e){return(e+"").replace(/(.+?)\/+$/,"$1").match(/([^\/]+$|^\/$|^$)/)[1]},e.isAbsolute=function(e){return/^[\w\-]+:/.test(e)},e.parseDependencies=function(e){var t={};return(e+"").replace(/(?:^|[^\w\$_.])require\s*\(\s*["']([^"']*)["']\s*\)/g,function(e,n){t[n]=!0}),Object.keys(t)},e.DependenciesCompiler=function(t,n){return function(r){return r.dependencies||void 0===r.text||(r.dependencies=t.parseDependencies(r.text)),n(r),r&&!r.dependencies&&(r.dependencies=r.text||r.factory?e.parseDependencies(r.text||r.factory):[]),r}},e.ShebangCompiler=function(e,t){return function(e){e.text&&(e.text=e.text.replace(/^#!/,"//#!")),t(e)}},e.LintCompiler=function(e,n){return function(r){try{n(r)}catch(i){throw e.lint&&t.nextTick(function(){e.lint(r)}),i}}},e.exposedConfigs=["paths","mappings","location","packageDescription","packages","modules"],e.makeCompiler=function(t){return e.JsonCompiler(t,e.ShebangCompiler(t,e.DependenciesCompiler(t,e.LintCompiler(t,e.Compiler(t)))))},e.JsonCompiler=function(e,t){return function(e){var n=(e.location||"").match(/\.json$/);return n?(e.exports=JSON.parse(e.text),e):t(e)}},e.MappingsLoader=function(t,n){return t.mappings=t.mappings||{},t.name=t.name,function(r,i){var a=t.mappings,o=Object.keys(a),s=o.length;if(e.isAbsolute(r))return n(r,i);void 0!==t.name&&0===r.indexOf(t.name)&&"/"===r.charAt(t.name.length)&&console.warn("Package reflexive module ignored:",r);var l,c;for(l=0;s>l;l++)if(c=o[l],r===c||0===r.indexOf(c)&&"/"===r.charAt(c.length)){var u=a[c],h=r.slice(c.length+1);return t.loadPackage(u,t).then(function(e){return i.mappingRedirect=h,i.mappingRequire=e,e.deepLoad(h,t.location)})}return n(r,i)}},e.ExtensionsLoader=function(t,n){var r=t.extensions||["js"],i=r.reduceRight(function(e,t){return function(r,i){return n(r+"."+t,i).fail(function(t){if(/^Can't find /.test(t.message))return e(r,i);throw t})}},function(e){throw Error("Can't find "+JSON.stringify(e)+" with extensions "+JSON.stringify(r)+" in package at "+JSON.stringify(t.location))});return function(t,r){return-1!==e.base(t).indexOf(".")?n(t,r):i(t,r)}},e.PathsLoader=function(t,r){var i=t.paths.reduceRight(function(e,t){return function(i,a){var o=n.resolve(t,i);return r(o,a).fail(function(t){if(/^Can't find /.test(t.message))return e(i,a);throw t})}},function(e){throw Error("Can't find "+JSON.stringify(e)+" from paths "+JSON.stringify(t.paths)+" in package at "+JSON.stringify(t.location))});return function(t,n){return e.isAbsolute(t)?r(t,n):i(t,n)}},e.MemoizedLoader=function(e,t){var n=e.cache=e.cache||{};return l(t,n)};var s=function(e){var t=/^(.*)\.js$/.exec(e);return t&&(e=t[1]),e},l=function(e,n){return n=n||{},function(r,i){return a(n,r)||(n[r]=t.fcall(e,r,i)),n[r]}}}),bootstrap("require/browser",function(e){function t(e){return 200===e.status||0===e.status&&e.responseText}var n=e("require"),r=e("promise"),i=e("mini-url"),a="GET",o="application/javascript",s="file:",l=void 0!==l?l:window;n.getLocation=function(){return i.resolve(window.location,".")},n.overlays=["window","browser","montage"],n.read=function(e){function n(){t(c)?u.resolve(c.responseText):l()}function l(){u.reject(Error("Can't XHR "+JSON.stringify(e)))}if(0===i.resolve(window.location,e).indexOf(s))throw Error("XHR does not function for file: protocol");var c=new XMLHttpRequest,u=r.defer();try{c.open(a,e,!0),c.overrideMimeType&&c.overrideMimeType(o),c.onreadystatechange=function(){4===c.readyState&&n()},c.onload=c.load=n,c.onerror=c.error=l}catch(h){u.reject(h.message,h)}return c.send(),u.promise};var c=eval;l.navigator&&l.navigator.userAgent.indexOf("Firefox")>=0&&(c=Function("_","return eval(_)"));var u="__FILE__",h="__",d="(function ",p="(require, exports, module) {",f="//*/\n})\n//@ sourceURL=";n.Compiler=function(e){return function(t){if(t.factory||void 0===t.text)return t;if(e.useScriptInjection)throw Error("Can't use eval.");var n=u+t.location.replace(/\.\w+$|\W/g,h);try{t.factory=c(d+n+p+t.text+f+t.location)}catch(r){throw r.message=r.message+" in "+t.location,r}t.factory.displayName=n}},n.XhrLoader=function(e){return function(t,n){return e.read(t).then(function(e){n.type="javascript",n.text=e,n.location=t})}};var m={},g=function(e,t){return m[e]=m[e]||{},m[e][t]=m[e][t]||r.defer(),m[e][t]},v=function(e,t,r){r&&r.isPending()?r.then(function(){t.isPending()&&n.loadScript(e)}).done():t.isPending()&&n.loadScript(e)};montageDefine=function(e,t,n){g(e,t).resolve(n)},n.loadScript=function(e){var t=document.createElement("script");t.onload=function(){t.parentNode.removeChild(t)},t.onerror=function(){t.parentNode.removeChild(t)},t.src=e,t.defer=!0,document.getElementsByTagName("head")[0].appendChild(t)},n.ScriptLoader=function(e){var t=e.packageDescription.hash;return function(n,a){return r.fcall(function(){if(m[t]&&m[t][a.id])return m[t][a.id].promise;/\.js$/.test(n)?n=n.replace(/\.js/,".load.js"):n+=".load.js";var r=g(t,a.id).promise;return v(n,r,e.preloaded),r}).then(function(e){delete m[t][a.id];for(var r in e)a[r]=e[r];a.location=n,a.directory=i.resolve(n,".")})}};var b=n.loadPackageDescription;n.loadPackageDescription=function(e,t){if(e.hash){var n=g(e.hash,"package.json").promise,r=i.resolve(e.location,"package.json.load.js");return v(r,n,t.preloaded),n.get("exports")}return b(e,t)},n.makeLoader=function(e){var t;return t=e.useScriptInjection?n.ScriptLoader:n.XhrLoader,n.MappingsLoader(e,n.ExtensionsLoader(e,n.PathsLoader(e,n.MemoizedLoader(e,t(e)))))}}),function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else Q=e()}(function(){"use strict";function e(e){return function(){return K.apply(e,arguments)}}function t(e){return e===Object(e)}function n(e){return"[object StopIteration]"===rt(e)||e instanceof H}function r(e,t){if(W&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(at)){for(var n=[],r=t;r;r=r.source)r.stack&&n.unshift(r.stack);n.unshift(e.stack);var a=n.join("\n"+at+"\n");e.stack=i(a)}}function i(e){for(var t=e.split("\n"),n=[],r=0;t.length>r;++r){var i=t[r];s(i)||a(i)||!i||n.push(i)}return n.join("\n")}function a(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function o(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(e);return r?[r[1],Number(r[2])]:void 0}function s(e){var t=o(e);if(!t)return!1;var n=t[0],r=t[1];return n===U&&r>=Y&&ut>=r}function l(){if(W)try{throw Error()}catch(e){var t=e.stack.split("\n"),n=t[0].indexOf("@")>0?t[1]:t[2],r=o(n);if(!r)return;return U=r[0],r[1]}}function c(e,t,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+n+" instead.",Error("").stack),e.apply(e,arguments)}}function u(e){return v(e)?e:b(e)?k(e):O(e)}function h(){function e(e){t=e,a.source=e,J(n,function(t,n){X(function(){e.promiseDispatch.apply(e,n)})},void 0),n=void 0,r=void 0}var t,n=[],r=[],i=et(h.prototype),a=et(f.prototype);if(a.promiseDispatch=function(e,i,a){var o=Z(arguments);n?(n.push(o),"when"===i&&a[1]&&r.push(a[1])):X(function(){t.promiseDispatch.apply(t,o)})},a.valueOf=c(function(){if(n)return a;var e=g(t);return v(e)&&(t=e),e},"valueOf","inspect"),a.inspect=function(){return t?t.inspect():{state:"pending"}},u.longStackSupport&&W)try{throw Error()}catch(o){a.stack=o.stack.substring(o.stack.indexOf("\n")+1)}return i.promise=a,i.resolve=function(n){t||e(u(n))},i.fulfill=function(n){t||e(O(n))},i.reject=function(n){t||e(S(n))},i.notify=function(e){t||J(r,function(t,n){X(function(){n(e)})},void 0)},i}function d(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=h();try{e(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}return t.promise}function p(e){return d(function(t,n){for(var r=0,i=e.length;i>r;r++)u(e[r]).then(t,n)})}function f(e,t,n){void 0===t&&(t=function(e){return S(Error("Promise does not support operation: "+e))}),void 0===n&&(n=function(){return{state:"unknown"}});var r=et(f.prototype);if(r.promiseDispatch=function(n,i,a){var o;try{o=e[i]?e[i].apply(r,a):t.call(r,i,a)}catch(s){o=S(s)}n&&n(o)},r.inspect=n,n){var i=n();"rejected"===i.state&&(r.exception=i.reason),r.valueOf=c(function(){var e=n();return"pending"===e.state||"rejected"===e.state?r:e.value})}return r}function m(e,t,n,r){return u(e).then(t,n,r)}function g(e){if(v(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function v(e){return t(e)&&"function"==typeof e.promiseDispatch&&"function"==typeof e.inspect}function b(e){return t(e)&&"function"==typeof e.then}function y(e){return v(e)&&"pending"===e.inspect().state}function _(e){return!v(e)||"fulfilled"===e.inspect().state}function w(e){return v(e)&&"rejected"===e.inspect().state}function C(){lt||"undefined"==typeof window||window.Touch||!window.console||console.warn("[Q] Unhandled rejection reasons (should be empty):",ot),lt=!0}function x(){for(var e=0;ot.length>e;e++){var t=ot[e];console.warn("Unhandled rejection reason:",t)}}function L(){ot.length=0,st.length=0,lt=!1,ct||(ct=!0,"undefined"!=typeof process&&process.on&&process.on("exit",x))}function M(e,t){ct&&(st.push(e),t&&void 0!==t.stack?ot.push(t.stack):ot.push("(no stack) "+t),C())}function E(e){if(ct){var t=$(st,e);-1!==t&&(st.splice(t,1),ot.splice(t,1))}}function S(e){var t=f({when:function(t){return t&&E(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return M(t,e),t}function O(e){return f({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return null===t||void 0===t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return nt(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function k(e){var t=h();return X(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function T(e){return f({isDef:function(){}},function(t,n){return B(e,t,n)},function(){return u(e).inspect()})}function z(e,t,n){return u(e).spread(t,n)}function j(e){return function(){function t(e,t){var o;if(it){try{o=r[e](t)}catch(s){return S(s)}return o.done?o.value:m(o.value,i,a)}try{o=r[e](t)}catch(s){return n(s)?s.value:S(s)}return m(o,i,a)}var r=e.apply(this,arguments),i=t.bind(t,"next"),a=t.bind(t,"throw");return i()}}function P(e){u.done(u.async(e)())}function D(e){throw new H(e)}function A(e){return function(){return z([this,R(arguments)],function(t,n){return e.apply(t,n)})}}function B(e,t,n){return u(e).dispatch(t,n)}function R(e){return m(e,function(e){var t=0,n=h();return J(e,function(r,i,a){var o;v(i)&&"fulfilled"===(o=i.inspect()).state?e[a]=o.value:(++t,m(i,function(r){e[a]=r,0===--t&&n.resolve(e)},n.reject,function(e){n.notify({index:a,value:e})}))},void 0),0===t&&n.resolve(e),n.promise})}function I(e){return m(e,function(e){return e=Q(e,u),m(R(Q(e,function(e){return m(e,G,G)})),function(){return e})})}function F(e){return u(e).allSettled()}function N(e,t){return u(e).then(void 0,void 0,t)}function q(e,t){return u(e).nodeify(t)}var W=!1;try{throw Error()}catch(V){W=!!V.stack}var U,H,Y=l(),G=function(){},X=function(){function e(){for(;t.next;){t=t.next;var n=t.task;t.task=void 0;var i=t.domain;i&&(t.domain=void 0,i.enter());try{n()}catch(o){if(a)throw i&&i.exit(),setTimeout(e,0),i&&i.enter(),o;setTimeout(function(){throw o},0)}i&&i.exit()}r=!1}var t={task:void 0,next:null},n=t,r=!1,i=void 0,a=!1;if(X=function(e){n=n.next={task:e,domain:a&&process.domain,next:null},r||(r=!0,i())},"undefined"!=typeof process&&process.nextTick)a=!0,i=function(){process.nextTick(e)};else if("function"==typeof setImmediate)i="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var o=new MessageChannel;o.port1.onmessage=function(){i=s,o.port1.onmessage=e,e()};var s=function(){o.port2.postMessage(0)};i=function(){setTimeout(e,0),s()}}else i=function(){setTimeout(e,0)};return X}(),K=Function.call,Z=e(Array.prototype.slice),J=e(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}for(;r>n;n++)n in this&&(t=e(t,this[n],n));return t}),$=e(Array.prototype.indexOf||function(e){for(var t=0;this.length>t;t++)if(this[t]===e)return t;return-1}),Q=e(Array.prototype.map||function(e,t){var n=this,r=[];return J(n,function(i,a,o){r.push(e.call(t,a,o,n))},void 0),r}),et=Object.create||function(e){function t(){}return t.prototype=e,new t},tt=e(Object.prototype.hasOwnProperty),nt=Object.keys||function(e){var t=[];for(var n in e)tt(e,n)&&t.push(n);return t},rt=e(Object.prototype.toString);H="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var it;try{Function("(function* (){ yield 1; })"),it=!0}catch(V){it=!1}var at="From previous event:";u.resolve=u,u.nextTick=X,u.longStackSupport=!1,u.defer=h,h.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(Z(arguments,1)):e.resolve(n)}},u.promise=d,u.passByCopy=function(e){return e},f.prototype.passByCopy=function(){return this},u.join=function(e,t){return u(e).join(t)},f.prototype.join=function(e){return u([this,e]).spread(function(e,t){if(e===t)return e;throw Error("Can't join: not the same: "+e+" "+t)})},u.race=p,f.prototype.race=function(){return this.then(u.race)},u.makePromise=f,f.prototype.toString=function(){return"[object Promise]"},f.prototype.then=function(e,t,n){function i(t){try{return"function"==typeof e?e(t):t}catch(n){return S(n)}}function a(e){if("function"==typeof t){r(e,s);try{return t(e)}catch(n){return S(n)}}return S(e)}function o(e){return"function"==typeof n?n(e):e}var s=this,l=h(),c=!1;return X(function(){s.promiseDispatch(function(e){c||(c=!0,l.resolve(i(e)))},"when",[function(e){c||(c=!0,l.resolve(a(e)))}])}),s.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=o(e)}catch(r){if(n=!0,!u.onerror)throw r;u.onerror(r)}n||l.notify(t)}]),l.promise},u.when=m,f.prototype.thenResolve=function(e){return this.then(function(){return e})},u.thenResolve=function(e,t){return u(e).thenResolve(t)},f.prototype.thenReject=function(e){return this.then(function(){throw e})},u.thenReject=function(e,t){return u(e).thenReject(t)},u.nearer=g,u.isPromise=v,u.isPromiseAlike=b,u.isPending=y,f.prototype.isPending=function(){return"pending"===this.inspect().state},u.isFulfilled=_,f.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},u.isRejected=w,f.prototype.isRejected=function(){return"rejected"===this.inspect().state};var ot=[],st=[],lt=!1,ct=!0;u.resetUnhandledRejections=L,u.getUnhandledReasons=function(){return ot.slice()},u.stopUnhandledRejectionTracking=function(){L(),"undefined"!=typeof process&&process.on&&process.removeListener("exit",x),ct=!1},L(),u.reject=S,u.fulfill=O,u.master=T,u.spread=z,f.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},u.async=j,u.spawn=P,u["return"]=D,u.promised=A,u.dispatch=B,f.prototype.dispatch=function(e,t){var n=this,r=h();return X(function(){n.promiseDispatch(r.resolve,e,t)}),r.promise},u.get=function(e,t){return u(e).dispatch("get",[t])},f.prototype.get=function(e){return this.dispatch("get",[e])},u.set=function(e,t,n){return u(e).dispatch("set",[t,n])},f.prototype.set=function(e,t){return this.dispatch("set",[e,t])},u.del=u["delete"]=function(e,t){return u(e).dispatch("delete",[t])},f.prototype.del=f.prototype["delete"]=function(e){return this.dispatch("delete",[e])},u.mapply=u.post=function(e,t,n){return u(e).dispatch("post",[t,n])},f.prototype.mapply=f.prototype.post=function(e,t){return this.dispatch("post",[e,t])},u.send=u.mcall=u.invoke=function(e,t){return u(e).dispatch("post",[t,Z(arguments,2)])
},f.prototype.send=f.prototype.mcall=f.prototype.invoke=function(e){return this.dispatch("post",[e,Z(arguments,1)])},u.fapply=function(e,t){return u(e).dispatch("apply",[void 0,t])},f.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},u["try"]=u.fcall=function(e){return u(e).dispatch("apply",[void 0,Z(arguments,1)])},f.prototype.fcall=function(){return this.dispatch("apply",[void 0,Z(arguments)])},u.fbind=function(e){var t=u(e),n=Z(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(Z(arguments))])}},f.prototype.fbind=function(){var e=this,t=Z(arguments);return function(){return e.dispatch("apply",[this,t.concat(Z(arguments))])}},u.keys=function(e){return u(e).dispatch("keys",[])},f.prototype.keys=function(){return this.dispatch("keys",[])},u.all=R,f.prototype.all=function(){return R(this)},u.allResolved=c(I,"allResolved","allSettled"),f.prototype.allResolved=function(){return I(this)},u.allSettled=F,f.prototype.allSettled=function(){return this.then(function(e){return R(Q(e,function(e){function t(){return e.inspect()}return e=u(e),e.then(t,t)}))})},u.fail=u["catch"]=function(e,t){return u(e).then(void 0,t)},f.prototype.fail=f.prototype["catch"]=function(e){return this.then(void 0,e)},u.progress=N,f.prototype.progress=function(e){return this.then(void 0,void 0,e)},u.fin=u["finally"]=function(e,t){return u(e)["finally"](t)},f.prototype.fin=f.prototype["finally"]=function(e){return e=u(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},u.done=function(e,t,n,r){return u(e).done(t,n,r)},f.prototype.done=function(e,t,n){var i=function(e){X(function(){if(r(e,a),!u.onerror)throw e;u.onerror(e)})},a=e||t||n?this.then(e,t,n):this;"object"==typeof process&&process&&process.domain&&(i=process.domain.bind(i)),a.then(void 0,i)},u.timeout=function(e,t,n){return u(e).timeout(t,n)},f.prototype.timeout=function(e,t){var n=h(),r=setTimeout(function(){n.reject(Error(t||"Timed out after "+e+" ms"))},e);return this.then(function(e){clearTimeout(r),n.resolve(e)},function(e){clearTimeout(r),n.reject(e)},n.notify),n.promise},u.delay=function(e,t){return void 0===t&&(t=e,e=void 0),u(e).delay(t)},f.prototype.delay=function(e){return this.then(function(t){var n=h();return setTimeout(function(){n.resolve(t)},e),n.promise})},u.nfapply=function(e,t){return u(e).nfapply(t)},f.prototype.nfapply=function(e){var t=h(),n=Z(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},u.nfcall=function(e){var t=Z(arguments,1);return u(e).nfapply(t)},f.prototype.nfcall=function(){var e=Z(arguments),t=h();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},u.nfbind=u.denodeify=function(e){var t=Z(arguments,1);return function(){var n=t.concat(Z(arguments)),r=h();return n.push(r.makeNodeResolver()),u(e).fapply(n).fail(r.reject),r.promise}},f.prototype.nfbind=f.prototype.denodeify=function(){var e=Z(arguments);return e.unshift(this),u.denodeify.apply(void 0,e)},u.nbind=function(e,t){var n=Z(arguments,2);return function(){function r(){return e.apply(t,arguments)}var i=n.concat(Z(arguments)),a=h();return i.push(a.makeNodeResolver()),u(r).fapply(i).fail(a.reject),a.promise}},f.prototype.nbind=function(){var e=Z(arguments,0);return e.unshift(this),u.nbind.apply(void 0,e)},u.nmapply=u.npost=function(e,t,n){return u(e).npost(t,n)},f.prototype.nmapply=f.prototype.npost=function(e,t){var n=Z(t||[]),r=h();return n.push(r.makeNodeResolver()),this.dispatch("post",[e,n]).fail(r.reject),r.promise},u.nsend=u.nmcall=u.ninvoke=function(e,t){var n=Z(arguments,2),r=h();return n.push(r.makeNodeResolver()),u(e).dispatch("post",[t,n]).fail(r.reject),r.promise},f.prototype.nsend=f.prototype.nmcall=f.prototype.ninvoke=function(e){var t=Z(arguments,1),n=h();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},u.nodeify=q,f.prototype.nodeify=function(e){return e?(this.then(function(t){X(function(){e(null,t)})},function(t){X(function(){e(t)})}),void 0):this};var ut=l();return u}),montageDefine("5f061ed","package.json",{exports:{name:"flick-example",version:"0.1.0",dependencies:{montage:"~0.13.2",digit:"~0.3.1"},devDependencies:{"montage-testing":"0.2.0"},exclude:["run-tests.html","test"],bundle:["ui/main.reel"],directories:{lib:"./"},hash:"5f061ed",mappings:{montage:{name:"montage",hash:"e2fc70c",location:"packages/montage@e2fc70c/"},digit:{name:"digit",hash:"7cdc4bc",location:"packages/digit@7cdc4bc/"}},production:!0,useScriptInjection:!0}}),montageDefine("e2fc70c","package.json",{exports:{name:"montage",version:"0.13.6",description:"A UI Framework",repository:{type:"git",url:"https://github.com/montagejs/montage.git"},main:"core/core",dependencies:{collections:"0.2.0",frb:"0.2.14",mousse:"0.1.2",htmlparser2:"3.0.5"},devDependencies:{"montage-testing":"~0.2.0",mr:"~0.13.0",q:"0.9.6","q-io":"~1.7.2",jshint:"~2.0.1"},scripts:{test:"node test/node/node-spec.js",jsdoc:"node ../montagejs.org/build/jsdoc/jsdoc.js -out $PWD/builds/jsdoc/ montage@npm-link"},exclude:["etc","lab","node.js","test","tools"],mappings:{mr:{name:"mr",hash:"15de206",location:"../mr@15de206/"},q:{name:"q",hash:"13a66b6",location:"../q@13a66b6/"},collections:{name:"collections",hash:"f814a7b",location:"../collections@f814a7b/"},frb:{name:"frb",hash:"51f539f",location:"../frb@51f539f/"},mousse:{name:"mousse",hash:"7ee841b",location:"../mousse@7ee841b/"},htmlparser2:{name:"htmlparser2",hash:"cc8bb89",location:"../htmlparser2@cc8bb89/"}},directories:{lib:"./"},hash:"e2fc70c",production:!0,useScriptInjection:!0}}),montageDefine("f814a7b","package.json",{exports:{name:"collections",version:"0.2.0",description:"data structures with idiomatic JavaScript collection interfaces",homepage:"http://github.com/montagejs/collections",author:{name:"Kris Kowal",email:"kris@cixar.com",url:"http://github.com/kriskowal"},keywords:["collections","data structures","observable","list","set","map","splay"],bugs:{url:"http://github.com/montagejs/collections/issues"},licenses:[{type:"MIT",url:"https://raw.github.com/montagejs/collections/master/LICENSE.md"}],repository:{type:"git",url:"http://github.com/montagejs/collections.git"},dependencies:{"weak-map":"1.0.0"},devDependencies:{"jasmine-node":"*",istanbul:"*",opener:"*"},scripts:{test:"jasmine-node spec",cover:"istanbul cover node_modules/jasmine-node/bin/jasmine-node spec && istanbul report html && opener coverage/index.html"},readme:'[![Build Status](https://travis-ci.org/montagejs/collections.png?branch=master)](http://travis-ci.org/montagejs/collections)\n\n# Collections\n\nThis package contains JavaScript implementations of common data\nstructures with idiomatic iterfaces, including extensions for Array and\nObject.\n\nYou can use these Node Packaged Modules with Node.js, [Browserify][],\n[Mr][], or any compatible CommonJS module loader.  Using a module loader\nor bundler when using Collections in web browsers has the advantage of\nonly incorporating the modules you need.  However, you can just embed\n`<script src="collections/collections.min.js">` and *all* of the\ncollections will be introduced as globals.  :warning:\n`require("collections")` is not supported.\n\n```\nnpm install collections --save\n```\n\n[Browserify]: https://github.com/substack/node-browserify\n[Mr]: https://github.com/montagejs/mr\n\n\n## Collections\n\n### List(values, equals, getDefault)\n\n```javascript\nvar List = require("collections/list");\n```\n\nAn ordered collection of values with fast insertion and deletion and\nforward and backward traversal, backed by a cyclic doubly linked\nlist with a head node.  Lists support most of the Array interface,\nexcept that they use and return nodes instead of integer indicies in\nanalogous functions.\n\nLists have a `head` `Node`. The node type is available as `Node` on\nthe list prototype and can be overridden by inheritors.  Each node\nhas `prev` and `next` properties.\n\n### Set(values, equals, hash, getDefault)\n\n```javascript\nvar Set = require("collections/set");\n```\n\nA collection of unique values.  The set can be iterated in the order\nof insertion.  With a good hash function for the stored values,\ninsertion and removal are fast regardless of the size of the\ncollection.  Values may be objects.  The `equals` and `hash`\nfunctions can be overridden to provide alternate definitions of\n"unique".  `Set` is backed by `FastSet` and `List`.\n\n### Map(map, equals, hash, getDefault)\n\n```javascript\nvar Map = require("collections/map");\n```\n\nA collection of key and value entries with unique keys.  Keys may be\nobjects.  The collection iterates in the order of insertion.  `Map`\nis backed by `Set`.\n\n### MultiMap(map, getDefault, equals, hash)\n\n```javascript\nvar MultiMap = require("collections/multi-map");\n```\n\nA collection of keys mapped to collections of values.  The default\n`getDefault` collection is an `Array`, but it can be a `List` or any\nother array-like object.  `MultiMap` inherits `Map` but overrides\nthe `getDefault(key)` provider.\n\n### WeakMap()\n\n```javascript\nvar WeakMap = require("collections/weak-map");\n```\n\nA non-iterable collection of key value pairs.  Keys must objects and\ndo not benefit from `hash` functions.  Some engines already\nimplement `WeakMap`.  The non-iterable requirement makes it possible\nfor weak maps to collect garbage when the key is no longer\navailable, without betraying when the key is collected.  The shimmed\nimplementation undetectably annotates the given key and thus does\nnot necessarily leak memory, but cannot collect certain reference\ngraphs.  This WeakMap shim was implemented by Mark Miller of Google.\n\n### SortedSet(values, equals, compare, getDefault)\n\n```javascript\nvar SortedSet = require("collections/sorted-set");\n```\n\nA collection of unique values stored in stored order, backed by a\nsplay tree.  The `equals` and `compare` functions can be overridden\nto provide alternate definitions of "unique".\n\nThe `compare` method *must* provide a total order of all unique\nvalues.  That is, if `compare(a, b) === 0`, it *must* follow that\n`equals(a, b)`.\n\n### SortedMap(map, equals, compare, getDefault)\n\n```javascript\nvar SortedMap = require("collections/sorted-map");\n```\n\nA collection of key value pairs stored in sorted order.  `SortedMap`\nis backed by `SortedSet` and the `GenericMap` mixin.\n\n### LruSet(values, maxLength, equals, hash, getDefault)\n\n```javascript\nvar LruSet = require("collections/lru-set");\n```\n\nA cache with the Least-Recently-Used strategy for truncating its\ncontent when it’s length exceeds `maxLength`.  `LruSet` is backed by\na `Set` and takes advantage of the already tracked insertion order.\nBoth getting and setting a value constitute usage, but checking\nwhether the set has a value and iterating values do not.\n\n### LruMap(map, maxLength, equals, hash, getDefault)\n\n```javascript\nvar LruMap = require("collections/lru-map");\n```\n\nA cache of entries backed by an `LruSet`.\n\n### SortedArray(values, equals, compare, getDefault)\n\n```javascript\nvar SortedArray = require("collections/sorted-array");\n```\n\nA collection of values stored in a stable sorted order, backed by an\narray.\n\n### SortedArraySet(values, equals, compare, getDefault)\n\n```javascript\nvar SortedArraySet = require("collections/sorted-array-set");\n```\n\nA collection of unique values stored in sorted order, backed by a\nplain array.  If the given values are an actual array, the sorted\narray set takes ownership of that array and retains its content.  A\nsorted array set performs better than a sorted set when it has\nroughly less than 100 values.\n\n### SortedArrayMap(values, equals, compare, getDefault)\n\n```javascript\nvar SortedArrayMap = require("collections/sorted-array-map");\n```\n\nA collection of key value pairs stored in sorted order, backed by a\nsorted array set.\n\n### FastSet(values, equals, hash, getDefault)\n\n```javascript\nvar FastSet = require("collections/fast-set");\n```\n\nA collection of unique values stored like a hash table.  The\nunderlying storage is a `Dict` that maps hashes to lists of values\nthat share the same hash.  Values may be objects.  The `equals` and\n`hash` functions can be overridden to provide alternate definitions\nof "unique".\n\n### FastMap(map, equals, hash, getDefault)\n\n```javascript\nvar FastMap = require("collections/fast-map");\n```\n\nA collection of key and value entries with unique keys, backed by a\nset.  Keys may be objects.  `FastMap` is backed by `FastSet` and the\n`GenericMap` mixin.\n\n### Dict(values, getDefault)\n\n```javascript\nvar Dict = require("collections/dict");\n```\n\nA collection of string to value mappings backed by a plain\nJavaScript object.  The keys are mangled to prevent collisions with\nJavaScript properties.\n\n### Heap(values, equals, compare)\n\n```javascript\nvar Heap = require("collections/heap");\n```\n\nA collection that can always quickly (constant time) report its\nlargest value, with reasonable performance for incremental changes\n(logarithmic), using a contiguous array as its backing storage.\nHowever, it does not track the sorted order of its elements.\n\n### Iterator(iterable)\n\n```javascript\nvar Iterator = require("collections/iterator");\n```\n\nA wrapper for any iterable that implements `iterate` or iterator the\nimplements `next`, providing a rich lazy traversal interface.\n\n### Array\n\n```javascript\nrequire("collections/shim-array");\n```\n\nAn ordered collection of values with fast random access, push, and\npop, but slow splice. The `array` module provides extensions so it\nhosts all the expressiveness of other collections.  The `shim-array`\nmodule shims EcmaScript 5 methods onto the array prototype if they\nare not natively implemented.\n\n### Object\n\n```javascript\nrequire("collections/shim-object");\n```\n\nCan be used as a mapping of owned string keys to arbitrary values.\nThe `object` module provides extensions for the `Object` constructor\nthat support the map collection interface and can delegate to\nmethods of collections, allowing them to gracefully handle both\nobject literals and collections.\n\n## Constructor Arguments\n\nFor all of these constructors, the argument `values` is an optional\ncollection of initial values, and may be an array.  If the `values` are\nin a map collection, the the values are taken, but the keys are ignored.\n\n### map\n\nThe `map` argument is an optional collection to copy shallowly into\nthe new mapping.  The `map` may be an object literal.  If `map`\nimplements `keys`, it is treated as a mapping itself and copied.\nOtherwise, if `map` implements `forEach`, it may be any collection\nof `[key, value]` pairs.\n\n`equals(x, y)`, `compare(x, y)`, and `hash(value)` are all optional\narguments overriding the meaning of equality, comparability, and\nconsistent hashing for the purposes of the collection.  `equals` must\nreturn a boolean.  `compare` must return an integer with the same\nrelationship to zero as x to y.  `hash` should consistently return the\nsame string for any given object.\n\n### equals(x, y)\n\nThe default `equals` operator is implemented in terms of `===`, but\ntreats `NaN` as equal to itself and `-0` as distinct from `+0`.  It\nalso delegates to an `equals` method of either the left or right\nargument if one exists.  The default equality operator is shimmed as\n`Object.equals`.\n\n### compare(x, y)\n\nThe default `compare` operator is implemented in terms of `<` and\n`>`.  It delegates to the `compare` method of either the left or\nright argument if one exists.  It inverts the result if it uses the\nfalls to the right argument.  The default comparator is shimmed as\n`Object.compare`.\n\n### hash(value)\n\nThe default `hash` operator uses `toString` for values and provides\na [Unique Label][] for arbitrary objects.  The default hash is\nshimmed as `Object.hash`.\n\n[Unique Label]: (http://wiki.ecmascript.org/doku.php?id=harmony:weak_maps#unique_labeler)\n\n### getDefault(key or value)\n\nThe default `getDefault` function is `Function.noop`, which returns\n`undefined`.  The fallback function is used when you `get` a\nnonexistant value from any collection.  The `getDefault` function\nbecomes a member of the collection object, so `getDefault` is called\nwith the collection as `this`, so you can also use it to guarantee\nthat default values in a collection are retained, as in `MultiMap`.\n\n\n## Collection Methods\n\nWhere these methods coincide with the specification of an existing\nmethod of Array, Array is noted as an implementation.  `Array+` refers\nto shimmed arrays, as installed with the `array` module.  `Object`\nrefers to methods implemented on the `Object` constructor function, as\nopposed to the `Object.prototype`.  `Object+` in turn refers to methods\nshimmed on the object constructor by the `object` module.  These\nfunctions accept the object as the first argument instead of the `this`\nimplied argument.  ~~Strikethrough~~ indicates an implementation that\nshould exist but has not yet been made (Send a pull request!).\n\nThese are all of the collections:\n\n(Array, Array+, Object+, Iterator, List, Set, Map, MultiMap, WeakMap,\nSortedSet, SortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\nSortedArrayMap, FastSet, FastMap, Dict)\n\n### has\n\n#### has(key)\n\nWhether a value for the given key exists.\n\n(Object+, Map, MultiMap, SortedMap, LruMap, SortedArrayMap, FastMap,\nDict)\n\n#### has(value, opt_equals)\n\nWhether a value exists in this collection.  This is slow for list\n(linear), but fast (logarithmic) for SortedSet and SortedArraySet,\nand very fast (constant) for Set.\n\n(Array+, List, Set, SortedSet, LruSet, SortedArray, SortedArraySet,\nFastSet)\n\n### get\n\n#### get(key or index)\n\nThe value for a key.  If a Map or SortedMap lacks a key, returns\n`getDefault(key)`.\n\n(Array+, Map, SortedMap, SortedArrayMap, WeakMap, Object+)\n\n#### get(value)\n\nGets the equivalent value, or falls back to `getDefault(value)`.\n\n(List, Set, SortedSet, LruSet, SortedArray, SortedArraySet, FastSet)\n\n### set(key or index, value)\n\nSets the value for a key.\n\n(Map, MultiMap, WeakMap, SortedMap, LruMap, SortedArrayMap, FastMap,\nDict)\n\n### add\n\n#### add(value)\n\nAdds a value.  Ignores the operation and returns false if an\nequivalent value already exists.\n\n(Array+, List, Set, SortedSet, LruSet, SortedArray, SortedArraySet,\nFastSet, Heap)\n\n#### add(value, key)\n\nAliases `set(key, value)`, to assist generic methods used for maps,\nsets, and other collections.\n\n### addEach\n\n#### addEach(values)\n\nCopies values from another collection to this one.\n\n(Array+, List, Set, SortedSet, LruSet, SortedArray, SortedArraySet,\nFastSet, Heap)\n\n#### addEach(mapping)\n\nCopies entries from another collection to this map.  If the mapping\nimplements `keys` (indicating that it is a mapping) and `forEach`,\nall of the key value pairs are copied.  If the mapping only\nimplements `forEach`, it is assumed to contain `[key, value]` arrays\nwhich are copied instead.\n\n(Object+, Map, MultiMap, SortedMap, LruMap, SortedArrayMap, FastMap,\nDict)\n\n### delete\n\n#### delete(key)\n\nDeletes the value for a given key.  Returns whether the key was\nfound.\n\n(Map, MultiMap, WeakMap, SortedMap, LruMap, SortedArrayMap, FastMap,\nDict)\n\n#### delete(value)\n\nDeletes a value.  Returns whether the value was found.\n\n(Set, SortedSet, LruSet, SortedArray, SortedArraySet, FastSet, Heap)\n\n#### delete(value, equals)\n\nDeletes the equivalent value.  Returns whether the value was found.\n\n(Array+, List)\n\n### deleteEach(values or keys)\n\nDeletes every value or every value for each key.\n\n(Array+, List, Set, Map, MultiMap, SortedSet, SortedMap,\nLruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\nFastSet, FastMap, Dict, Heap)\n\n### indexOf(value)\n\nReturns the position in the collection of a value, or `-1` if it is\nnot found.  Returns the position of the first of equivalent values.\nFor an Array this takes linear time.  For a SortedArray and\nSortedArraySet, it takes logarithmic time to perform a binary\nsearch.  For a SortedSet, this takes ammortized logarithmic time\nsince it incrementally updates the number of nodes under each\nsubtree as it rotates.\n\n(Array, ~~List~~, SortedSet, SortedArray, SortedArraySet)\n\n### lastIndexOf(value)\n\nReturns the position in the collection of a value, or `-1` if it is\nnot found.  Returns the position of the last of equivalent values.\n\n(Array, ~~List~~, SortedArray, SortedArraySet)\n\n### find(value, opt_equals)\n\nFinds a value.  For List and SortedSet, returns the node at which\nthe value was found.  For SortedSet, the optional `equals` argument\nis ignored.\n\n(Array+, List, SortedSet)\n\n### findLast(value, opt_equals)\n\nFinds the last equivalent value, returning the node at which the\nvalue was found.\n\n(Array+, List, SortedArray, SortedArraySet)\n\n### findLeast()\n\nFinds the smallest value, returning the node at which it was found,\nor undefined.  This is fast (logarithmic) and performs no rotations.\n\n(SortedSet)\n\n### findLeastGreaterThan(value)\n\nFinds the smallest value greater than the given value.  This is fast\n(logarithic) but does cause rotations.\n\n(SortedSet)\n\n### findLeastGreaterThanOrEqual(value)\n\nFinds the smallest value greater than or equal to the given value.\nThis is fast (logarithmic) but does cause rotations.\n\n(SortedSet)\n\n### findGreatest()\n\n(SortedSet)\n\n### findGreatestLessThan(value)\n\n(SortedSet)\n\n### findGreatestLessThanOrEqual(value)\n\n(SortedSet)\n\n### push\n\n#### push(...values)\n\nAdds values to the end of a collection.\n\n(Array, List)\n\n#### push(...values) for non-dequeues\n\nAdds values to their proper places in a collection.\nThis method exists only to have the same interface as other\ncollections.\n\n(Set, SortedSet, LruSet, SortedArray, SortedArraySet, FastSet, Heap)\n\n### unshift\n\n#### unshift(...values)\n\nAdds values to the beginning of a collection.\n\n(Array, List)\n\n#### unshift(...values) for non-dequeues\n\nAdds values to their proper places in a collection.\nThis method exists only to have the same interface as other\ncollections.\n\n(Set, SortedSet, LruSet, SortedArray, SortedArraySet, FastSet)\n\n### pop()\n\nRemoves and returns the value at the end of a collection.  For a\nHeap, this means the greatest contained value, as defined by the\ncomparator.\n\n(Array, List, Set, SortedSet, LruSet, SortedArray, SortedArraySet,\nHeap)\n\n### shift()\n\nRemoves and returns the value at the beginning of a collection.\n\n(Array, List, Set, SortedSet, LruSet, SortedArray, SortedArraySet)\n\n### peek()\n\nReturns the last value in an ordered collection.\n\n(List)\n\n### poke(value)\n\nReplaces the last value in an ordered collection.\n\n(List)\n\n### slice(start, end)\n\nReturns an array of the values contained in the\nhalf-open interval [start, end), that is, including the start and\nexcluding the end.  For lists and arrays, both terms may be numeric\npositive or negative indicies.  For a list, either term may be a\nnode.\n\n(Array, List, SortedSet, SortedArray, SortedArraySet)\n\n### splice(start, length, ...values)\n\nWorks as with an array, but for a list, the start may be an index or\na node.\n\n(Array, List, SortedArray, SortedSet, SortedArraySet)\n\n### swap(start, length, values)\n\nPerforms a splice without variadic arguments.\n\n(Array+, List, SortedArray, SortedSet, SortedArraySet)\n\n### clear()\n\nDeletes the all values.\n\n(Array+, Object+, List, Set, Map, MultiMap, SortedSet,\nSortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\nSortedArrayMap, FastSet, FastMap, Dict, Heap)\n\n### sort(compare)\n\nSorts a collection in place.  The comparator by only be a function.\nThe default comparator coerces unlike types rather than fail to\ncompare.\n\n(Array)\n\n### sorted(compare, by, order)\n\nReturns a collection as an array in sorted order.  Accepts an\noptional `compare(x, y)` function, `by(property(x))` function, and\n`order` indicator, `-1` for descending, `1` for ascending, `0` for\nstable.\n\nInstead of a `compare` function, the comparator can be an object\nwith `compare` and `by` functions.  The default `compare` value is\n`Object.compare`.\n\nThe `by` function must be a function that accepts a value from the\ncollection and returns a representative value on which to sort.\n\n(Array+, List, Set, Map, SortedSet, LruSet, SortedArray,\nSortedArraySet, FastSet, Heap)\n\n### group(callback, thisp, equals)\n\nReturns an array of [key, equivalence class] pairs where every\nelement from the collection is placed into an equivalence class\nif they have the same corresponding return value from the given\ncallback.\n\n(Array+, Object+, List, Set, Map, MultiMap, SortedSet,\nSortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\nSortedArrayMap, FastSet, FastMap, Dict, Heap, Iterator)\n\n### reverse()\n\nReverses a collection in place.\n\n(Array, List)\n\n### reversed()\n\nReturns a collection of the same type with this collection\'s\ncontents in reverse order.\n\n(Array, List)\n\n### enumerate(start=0)\n\nReturns an array of [index, value] pairs from the source collection,\nstarting with the given index.\n\n### join(delimiter="")\n\nReturns a string of all the values in the collection joined.\n\n(Array, List, Set, SortedSet, LruSet, SortedArray, SortedArraySet,\nFastSet, Heap, Iterator)\n\n### concat(...iterables)\n\nProduces a new collection of the same type containing all the values\nof itself and the values of any number of other collections.  Favors\nthe last of duplicate values.  For map-like objects, the given\niterables are treated as map-like objects and each successively\nupdates the result.  Array is like a map from index to value.  List,\nSet, and SortedSet are like maps from nodes to values.\n\n(Array, ~~Object+~~, Iterator, List, Set, Map, MultiMap,\nSortedSet, SortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\nSortedArrayMap, FastSet, FastMap, Dict, Heap)\n\n### keys()\n\nReturns an array of the keys.\n\n(Object, Map, MultiMap, SortedMap, LruMap, SortedArrayMap, FastMap,\nDict)\n\n### values()\n\nReturns an array of the values\n\n(Object+, Map, MultiMap, SortedMap, LruMap, SortedArrayMap, FastMap,\nDict)\n\n### entries()\n\nReturns an array of `[key, value]` pairs for each entry.\n\n(Object+, Map, MultiMap, SortedMap, LruMap, SortedArrayMap, FastMap,\nDict)\n\n### reduce(callback(result, value, key, object, depth), basis, thisp)\n\n(Array, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\nLruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\nFastSet, FastMap, Dict, Heap)\n\n### reduceRight(callback(result, value, key, object, depth), basis, thisp)\n\n(Array, List, SortedSet, ~~SortedMap~~, SortedArray, SortedArraySet,\n~~SortedArrayMap~~, Heap)\n\n### forEach(callback(value, key, object, depth), thisp)\n\nCalls the callback for each value in the collection.  The iteration\nof lists is resilient to changes to the list.  Particularly, nodes\nadded after the current node will be visited and nodes added before\nthe current node will be ignored, and no node will be visited twice.\n\n(Array, Object+, Iterator, List, Set, Map, MultiMap, WeakMap,\nSortedSet, SortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\nSortedArrayMap, FastSet, FastMap, Dict, Heap)\n\n### map(callback(value, key, object, depth), thisp)\n\n(Array, Object+, Iterator, List, Set, Map, MultiMap, WeakMap,\nSortedSet, SortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\nSortedArrayMap, FastSet, FastMap, Dict, Heap)\n\n### toArray()\n\n(Array+, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\nLruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\nFastSet, FastMap, Dict, Heap)\n\n### toObject()\n\nConverts any collection to an object, treating this collection as a\nmap-like object.  Array is like a map from index to value.\n\n(Array+ Iterator, List, Map, MultiMap, SortedMap, LruMap,\nSortedArrayMap, FastMap, Dict, Heap)\n\n### filter(callback(value, key, object, depth), thisp)\n\n(Array, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\nLruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\nFastSet, FastMap, Dict, Heap)\n\n### every(callback(value, key, object, depth), thisp)\n\nWhether every value passes a given guard.  Stops evaluating the\nguard after the first failure.  Iterators stop consuming after the\nthe first failure.\n\n(Array, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\nLruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\nFastSet, FastMap, Dict, Heap)\n\n### some(callback(value, key, object, depth), thisp)\n\nWhether there is a value that passes a given guard.  Stops\nevaluating the guard after the first success.  Iterators stop\nconsuming after the first success.\n\n(Array, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\nLruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\nFastSet, FastMap, Dict, Heap)\n\n### any()\n\nWhether any value is truthy.\n\n(Array+, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\nLruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\nFastSet, FastMap, Dict, Heap)\n\n### all()\n\nWhether all values are truthy.\n\n(Array+, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\nLruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\nFastSet, FastMap, Dict, Heap)\n\n### min()\n\nThe smallest value.  This is fast for sorted collections (logarithic\nfor SortedSet, constant for SortedArray, SortedArraySet, and\nSortedArrayMap), but slow for everything else (linear).\n\n(Array+, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\nLruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\nFastSet, FastMap, Dict)\n\n### max()\n\nThe largest value.  This is fast for sorted collections (logarithic\nfor SortedSet, constant for SortedArray, SortedArraySet, and\nSortedArrayMap), but slow for everything else (linear).\n\n(Array+, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\nLruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\nFastSet, FastMap, Dict, Heap)\n\n### one()\n\nAny single value, or throws an exception if there are no values.\nThis is very fast (constant) for all collections.  For a sorted set,\nthe value is not deterministic and depends on what value was most\nrecently accessed.\n\n(Array+, List, Set, Map, MultiMap, SortedSet, SortedMap, LruSet,\nLruMap, SortedArray, SortedArray, SortedArraySet, SortedArrayMap,\nFastSet, FastMap, Dict, Heap)\n\n### only()\n\nThe one and only value, or throws an exception if there are no\nvalues or more than one value.\n\n(Array+, List, Set, Map, MultiMap, SortedSet, SortedMap, LruSet,\nLruMap, SortedArray, SortedArray, SortedArraySet, SortedArrayMap,\nFastSet, FastMap, Dict, Heap)\n\n### sum()\n\n(Array+, Iterator, List, Set, Map, MultiMap, SortedSet,\nSortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\nSortedArrayMap, FastSet, FastMap, Dict)\n\n### average()\n\n(Array+, Iterator, List, Set, Map, MultiMap, SortedSet,\nSortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\nSortedArrayMap, FastSet, FastMap, Dict)\n\n### flatten()\n\n(Array+, Iterator, List, Set, Map, MultiMap, SortedSet,\nSortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\nSortedArrayMap, FastSet, FastMap, Dict, Heap)\n\n### zip(...collections)\n\n(Array+, Iterator, List, Set, Map, MultiMap, SortedSet,\nSortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\nSortedArrayMap, FastSet, FastMap, Dict, Heap)\n\n### enumrate(zero)\n\n(Array+, Iterator, List, Set, Map, MultiMap, SortedSet, SortedMap,\nLruSet, LruMap, SortedArray, SortedArraySet, SortedArrayMap,\nFastSet, FastMap, Dict, Heap)\n\n### clone(depth, memo)\n\nReplicates the collection.  Clones the values deeply, to the\nspecified depth, using the memo to resolve reference cycles.  (which\nmust the `has` and `set` parts of the Map interface, allowing\nobjects for keys)  The default depth is infinite and the default\nmemo is a WeakMap.\n\n`Object.clone` can replicate object literals inheriting directly\nfrom `Object.prototype` or `null`, or any object that implements\n`clone` on its prototype.  Any other object causes `clone` to throw\nan exception.\n\nThe `clone` method on any other objects is not intended to be used\ndirectly since they do not necessarily supply a default depth and\nmemo.\n\n(Array+, Object+, List, Set, Map, MultiMap, SortedSet,\nSortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\nSortedArrayMap, FastSet, FastMap, Dict, Heap)\n\n### constructClone(values)\n\nReplicates a collection shallowly.  This is used by each `clone`\nimplementation to create a new collection of the same type, with the\nsame options (`equals`, `compare`, `hash` options), but it leaves\nthe job of deeply cloning the values to the more general `clone`\nmethod.\n\n(Array+, Object+, List, Set, Map, MultiMap, SortedSet,\nSortedMap, LruSet, LruMap, SortedArray, SortedArraySet,\nSortedArrayMap, FastSet, FastMap, Dict, Heap)\n\n### equals(that, equals)\n\n(Array+, Object+, List, Set, Map, MultiMap, SortedSet, SortedMap,\nLruSet, LruMap, ~~SortedArray~~, SortedArraySet, SortedArrayMap,\nFastSet, FastMap, Dict)\n\n### compare(that)\n\n(Array+, Object+, List, ~~SortedArray~~, ~~SortedArraySet~~)\n\n### iterate\n\n#### iterate()\n\nProduces an iterator with a `next` method.  You may elect to get\nricher iterators by wrapping this iterator with an `Iterator` from\nthe `iterator` module.  Iteration order of lists is resilient to\nchanges to the list.\n\n(Array+, Iterator, List, Set, SortedSet, LruSet, SortedArray,\nSortedArraySet, FastSet)\n\n#### iterate(start, end)\n\nReturns an iterator for all values at indicies in the half-open\ninterval [start, end), that is, greater than start, and less than\nend.\n\n(Array+)\n\n#### iterate(start, end)\n\nReturns an iterator for all values in the half-open interval [start,\nend), that is, greater than start, and less than end.  The iterator\nis resilient against changes to the data.\n\n(SortedSet)\n\n### log(charmap, callback(node, write, writeAbove), log, logger)\n\nWrites a tree describing the internal state of the data structure to\nthe console.\n\n`charmap` is an object that notes which characters to use to draw\nlines.  By default, this is the `TreeLog.unicodeRound` property from the\n`tree-log` module.  `TreeLog.unicodeSharp` and `TreeLog.ascii` are\nalternatives.  The properties are:\n\n-   intersection: ╋\n-   through: ━\n-   branchUp: ┻\n-   branchDown: ┳\n-   fromBelow: ╭\n-   fromAbove: ╰\n-   fromBoth: ┣\n-   strafe: ┃\n\n`callback` is a customizable function for rendering each node of the tree.\nBy default, it just writes the value of the node.  It accepts the node and\na writer functions.  The `write` function produces the line on which the\nnode joins the tree, and each subsequent line.  The `writeAbove` function\ncan write lines before the branch.\n\n`log` and `logger` default to `console.log` and `console`.  To write\nthe representation to an array instead, they can be `array.push` and\n`array`.\n\n(SortedSet)\n\n\n### Iterator\n\n#### dropWhile(callback(value, index, iterator), thisp)\n\n#### takeWhile(callback(value, index, iterator), thisp)\n\n#### mapIterator(callback(value, index, iterator))\n\nReturns an iterator for a mapping on the source values.  Values are\nconsumed on demand.\n\n#### filterIterator(callback(value, index, iterator))\n\nReturns an iterator for those values from the source that pass the\ngiven guard.  Values are consumed on demand.\n\n#### zipIterator(...iterables)\n\nReturns an iterator that incrementally combines the respective\nvalues of the given iterations.\n\n#### enumerateIterator(start = 0)\n\nReturns an iterator that provides [index, value] pairs from the\nsource iteration.\n\n\n### Iterator utilities\n\n#### cycle(iterable, times)\n\n#### concat(iterables)\n\n#### transpose(iterables)\n\n#### zip(...iterables)\n\nVariadic transpose.\n\n#### chain(...iterables)\n\nVariadic concat.\n\n#### range(start, stop, step)\n\nIterates from start to stop by step.\n\n#### count(start, step)\n\nIterates from start by step, indefinitely.\n\n#### repeat(value, times)\n\nRepeats the given value either finite times or indefinitely.\n\n\n## Change Listeners\n\nAll collections support change listeners.  There are three types of\nchanges.  Property changes, map changes, and range changes.\n\n### Property Changes\n\n`PropertyChanges` from the `listen/property-changes` module can\nconfigure listeners for property changes to specific keys of any object.\n\nWith the `listen/array-changes` module required, `PropertyChanges` can\nalso listen to changes to the length and indexed properties of an array.\nThe only caveat is that watched arrays can only modify their contents\nwith method calls like `array.push`.  All methods of a watched array\nsupport change dispatch.  In addition, arrays have a `set` method to\nmake setting the value at a particular index observable.\n\n-   PropertyChanges.addOwnPropertyChangeListener(object, key, listener, before)\n-   PropertyChanges.removeOwnPropertyChangeListener(object, key, listener, before)\n-   PropertyChanges.dispatchOwnPropertyChange(object, key, value, before)\n-   PropertyChanges.addBeforeOwnPropertyChangeListener(object, key, listener)\n-   PropertyChanges.removeBeforeOwnPropertyChangeListener(object, key, listener)\n-   PropertyChanges.dispatchBeforeOwnPropertyChange(object, key, value)\n-   PropertyChanges.getOwnPropertyChangeDescriptor(object, key)\n\nAll of these functions delegate to methods of the same name if one\nexists on the object.\n\n-   object.addOwnPropertyChangeListener(key, listener, before)\n-   object.removeOwnPropertyChangeListener(key, listener, before)\n-   object.dispatchOwnPropertyChange(key, value, before)\n-   object.addBeforeOwnPropertyChangeListener(key, listener)\n-   object.removeBeforeOwnPropertyChangeListener(key, listener)\n-   object.dispatchBeforeOwnPropertyChange(key, value)\n-   object.getOwnPropertyChangeDescriptor(key)\n\nAdditionally, `PropertyChanges.prototype` can be **mixed into** other\ntypes of objects to support the property change dispatch interface.  All\ncollections support this interface.\n\nThe **listener** for a property change receives the arguments `value`,\n`key`, and `object`, just as a `forEach` or `map` callback.  The\nlistener may alternately be a delegate object that implements one of\nthese methods:\n\n-   listener.handle + **key** + Change **or** WillChange\n-   listener.handleProperty + Change **or** WillChange\n-   listener.call\n\n### Map Changes\n\nA map change listener receives notifications for the creation, removal,\nor updates for any entry in a map data structure.\n\nWith the `listen/array-changes` module required, `Array` can also\ndispatch map changes for the values at each index.\n\n-   collection.addMapChangeListener(listener, token, before)\n-   collection.removeMapChangeListener(listener, token, before)\n-   collection.dispatchMapChange(key, value, before)\n-   collection.addBeforeMapChangeListener(listener)\n-   collection.removeBeforeMapChangeListener(listener)\n-   collection.dispatchBeforeMapChange(key, value)\n-   collection.getMapChangeDescriptor()\n\nThe **listener** for a map change receives the `value`, `key`, and\ncollection `object` as arguments, the same pattern as a `forEach` or\n`map` callback.  In the after change phase, a value of `undefined` may\nindicate that the value was deleted or set to `undefined`.  In the\nbefore change phase, a value of `undefined` may indicate the the value\nwas added or was previously `undefined`.\n\nThe listener may be a delegate object with one of the following methods,\nin order of precedence:\n\n-   listener.handleMap + Change **or** WillChange\n-   listener.handle + **token** + Map + Change **or** WillChange\n-   listener.call\n\nThe `listen/map-changes` module exports a map changes **mixin**.  The\nmethods of `MaxChanges.prototype` can be copied to any collection that\nneeds this interface.  Its mutation methods will then need to dispatch\nmap changes.\n\n### Range Changes\n\nA range change listener receives notifications when a range of values at\na particular position is added, removed, or replaced within an ordered\ncollection.\n\n-   collection.**add**RangeChange**Listener**(listener, token, before)\n-   collection.**remove**RangeChange**Listener**(listener, token, before)\n-   collection.**dispatch**RangeChange(plus, minus, index, before)\n-   collection.add**Before**RangeChange**Listener**(listener)\n-   collection.remove**Before**RangeChange**Listener**(listener)\n-   collection.dispatch**Before**RangeChange(plus, minus, index)\n-   collection.**get**RangeChange**Descriptor**()\n\nThe **listener** for a range change is a function that accepts `plus`,\n`minus`, and `index` arguments.  `plus` and `minus` are the values that\nwere added or removed at the `index`.  Whatever operation caused these\nchanges is equivalent to:\n\n```javascript\nvar minus = collection.splice(index, minus.length, ...plus)\n```\n\nThe listener can alternately be a delegate object with one of the\nfollowing methods in order of precedence:\n\n-   handle + **token** + Range + Change **or** WillChange\n-   handleRange + Change **or** WillChange\n-   call\n\nThe following support range change dispatch:\n\n-   `Array` with `require("collections/listen/array-changes")`\n-   `SortedSet`\n-   `SortedArray`\n-   `SortedArraySet`\n\nThe `listen/range-changes` module exports a range changes **mixin**.\nThe methods of `RangeChanges.prototype` can be copied to any collection\nthat needs this interface.  Its mutation methods will need to dispatch\nthe range changes.\n\nAll **descriptors** are objects with the properties `changeListeners`\nand `willChangeListeners`.  Both are arrays of listener functions or\nobjects, in the order in which they were added.\n\n\n## Miscellanea\n\n### Set and Map\n\nSet and map are like hash tables, but not implemented with a block of\nmemory as they would be in a lower-level language.  Most of the work of\nproviding fast insertion and lookup based on a hash is performed by the\nunderlying plain JavaScript object.  Each key of the object is a hash\nstring and each value is a List of values with that hash.  The inner\nlist resolves collisions.  With a good `hash` method, the use of the\nlist can be avoided.\n\nSets and maps both have a `log` function that displays the internal\nstructure of the bucket list in an NPM-style.\n\n```\n┣━┳ 1\n┃ ┗━━ {"key":1,"value":"a"}\n┣━┳ 2\n┃ ┣━━ {"key":2,"value":"c"}\n┃ ┗━━ {"key":2,"value":"d"}\n┗━┳ 3\n  ┗━━ {"key":3,"value":"b"}\n```\n\n\n### Sorted Set and Sorted Map\n\nA binary splay tree is a balanced binary tree that rotates the most\nfrequently used entries toward the root such that they can be accessed the\nmost quickly.  `sorted-set` and `sorted-map` are backed by a splay tree.\n\nAll map implementations use an underlying set implementation.  Any map\ncan be implemented trivially atop a set by wrapping `compare`, `equals`,\nor `hash` to operate on the key of an entry.\n\nThe sorted set has a `root` node.  Each node has a `left` and `right`\nproperty, which may be null.  Nodes are returned by all of the "find"\nfunctions, and provided as the `key` argument to callbacks.\n\nBoth `sorted-set` and `sorted-map` implement a `log` function which can\nproduce NPM-style visualizations of the internal state of the sorted\ntree.\n\n```\n> set.log(SortedSet.ascii)\n  .-+ -3\n  | \'-- -2\n.-+ -1\n+ 0\n| .-- 1\n\'-+ 2\n  \'-- 3\n```\n\n```\n> set.log(SortedSet.unicodeRound)\n  ╭━┳ -3\n  ┃ ╰━━ -2\n╭━┻ -1\n╋ 0\n┃ ╭━┳ 1\n┃ ┃ ╰━━ 2\n╰━┻ 3\n```\n\n\n### Object and Function Shims\n\nThe collection methods on the `Object` constructor all polymorphically\ndelegate to the corresponding method of any object that implements the\nmethod of the same name.  So, `Object.has` can be used to check whether\na key exists on an object, or in any collection that implements `has`.\nThis permits the `Object` interface to be agnostic of the input type.\n\n`Array.from` creates an array from any iterable.\n\n`Array.unzip` transposes a collection of arrays, so rows become columns.\n\n`Array.empty` is an empty array, frozen if possible.  Do not modify it.\n\n`Object.from` creates an object from any map or collection.  For arrays\nand array-like collections, uses the index for the key.\n\n`Object.empty` is an empty object literal.\n\n`Object.isObject(value)` tests whether it is safe to attempt to access\nproperties of a given value.\n\n`Object.is(x, y)` compares objects for exact identity and is a good\nalternative to `Object.equals` in many collections.\n\n`Object.getValueOf(value)` safely and idempotently returns the value of\nan object or value by only calling the `valueOf()` if the value\nimplements that method.\n\n`Object.owns` is a shorthand for `Object.prototype.hasOwnProperty.call`.\n\n`Object.can(value, name)` checks whether an object implements a method\non its prototype chain.  An owned function property does not qualify as\na method, to aid in distinguishing "static" functions.\n\n`Object.concat(...maps)` and `Object.from(entries)` construct an object\nby adding the entries of other objects in order.  The maps can be other\nobjects, arrays of entries, or map alike collections.\n\n`Function.noop` is returns undefined.\n\n`Function.identity` returns its first argument.\n\n`Function.by(relation)` creates a comparator from a relation function.\n\n`Function.get(key)` creates a relation that returns the value for the\nproperty of a given object.\n\n\n### References\n\n- a SplayTree impementation buried in Fedor Indutny’s super-secret\n  [Callgrind](https://github.com/indutny/callgrind.js). This\n  implementation uses parent references.\n- a SplayTree implementation adapted by [Paolo\n  Fragomeni](https://github.com/hij1nx/forest) from the V8 project and\n  based on the top-down splaying algorithm from "Self-adjusting Binary\n  Search Trees" by Sleator and Tarjan. This does not use or require\n  parent references, so I favored it over Fedor Indutny’s style.\n- the interface of ECMAScript harmony [simple maps and\n  sets](http://wiki.ecmascript.org/doku.php?id=harmony:simple_maps_and_sets)\n- a SplayTree implementation from [JavaScript data\n  structures](derrickburns/Javascript-Data-Structures) mainted by\n  Derrick Burns that supports change-resilient iterators and a\n  comprehensive set of introspection functions.\n\n### Future work\n\nGoals\n\n- make array dispatch length property changes between range changes to\n  be consistent with List.\n- automate the generation of the method support tables in readme and\n  normalize declaration order\n- comprehensive specs and spec coverage tests\n- array set (a set, for fast lookup, backed by an array for meaningful\n  range changes)\n- fast list splicing\n- dict map changes\n- revise map changes to use separate handlers for add/delete\n- revise tokens for range and map changes to specify complete alternate\n  delegate methods, particularly for forwarding directly to dispatch\n- implement on/once/off listeners\n- Make it easier to created a SortedSet with a criterion like\n  Function.by(Function.get(\'name\'))\n- evaluate exposing observeProperty, observeRangeChange, and observeMapChange\n  instead of the aEL/rEL inspired API FRB exposes today, to minimize\n  book-keeping and garbage collection\n\nMore possible collections\n\n- sorted-list (sorted, can contain duplicates, perhaps backed by splay\n  tree with relaxation on the uniqueness invariant)\n- sorted-multi-map (sorted, can contain duplicate entries)\n- buffer (backed by a circular array, emits cull events)\n- emit cull events in LRU cache set and map\n- trie-set\n- trie-map\n- immutable-* (mutation functions return new objects that largely share\n  the previous version\'s internal state, some perhaps backed by a hash\n  trie)\n\n',readmeFilename:"README.md",_id:"collections@0.2.0",dist:{shasum:"5ce1ae51720d433ec9672fde95c16764f75a9b90"},_from:"collections@0.2.0",_resolved:"https://registry.npmjs.org/collections/-/collections-0.2.0.tgz",directories:{lib:"./"},hash:"f814a7b",mappings:{"weak-map":{name:"weak-map",hash:"3b7d56f",location:"../weak-map@3b7d56f/"}},production:!0,useScriptInjection:!0}}),montageDefine("7ee841b","package.json",{exports:{name:"mousse",version:"0.1.2",description:"Deserialization of JavaScript objects",keywords:["deserialization","serialization"],author:{name:"António Afonso",email:"antonio.afonso@gmail.com",url:"http://github.com/aadsm/"},contributors:[{name:"António Afonso",email:"antonio.afonso@gmail.com",url:"http://github.com/aadsm/"}],bugs:{url:"http://github.com/montagejs/mousse/issues"},licenses:[{type:"BSD",url:"http://github.com/montagejs/mousse/raw/master/LICENSE.md"}],repository:{type:"git",url:"http://github.com/montagejs/mousse.git"},main:"mousse",dependencies:{q:"~0.8.0",collections:"~0.1.14"},devDependencies:{"jasmine-node":"~1.1.0"},scripts:{test:"./node_modules/.bin/jasmine-node spec"},readme:'# Mousse\n\nA serialization library that serializes graphs of JavaScript objects.\n\nIts main purpose is to provide the features that are missing in JSON and a mechanism to easily extend the serialization format with new types or custom JavaScript objects.\n\nThis is the library used by the Montage framework to manage the serialization of objects in its templates.\n\n## What it does that JSON doesn\'t\n\n * Named objects\n * References and circular references (no more `TypeError: Converting circular structure to JSON`)\n * Regular Expressions\n * Custom Types\n * Asynchronous revivers\n\n## API Reference\n\n**`Serializer()`**\n\n-   **`serializeObject(object)`**\n\n    Serializes an object into a string.\n\n-   **`serialize(objects)`**\n\n    Serializes objects into a string, each object is passed with a label associated with it. Objects are passed in an object literal `{label1: object1, label2: object2, ..., labelN: objectN}`.\n\n-   **`setSerializationIndentation(indentation)`**\n\n    Set the indentation level of the serialization string (in number of spaces).\n\n**`Deserializer(serializationString)`**\n\n-   _**`constructor`**_\n\n    Creates a deserialization object to deserialize the objects serialized in `serializationString`.\n\n-   **`deserializeObject()`**\n\n    Returns a promise for an object that was serialized with `serializeObject`.\n\n-   **`deserialize(instances)`**\n\n    Returns a promise for the objects that were serialized with `serialize`. This result is an object literal with the deserialized objects and their respective labels: `{label1: object1, label2: object2, ..., labelN: objectN}`.\n\n    The `instances` parameter allows to override the deserialization of specific objects by using the instance passed instead, they are passed in an object literal: `{label1: object1, label2: object2, ..., labelN: objectN}`.\n\n## Serialization of JavaScript objects\n### Multiple Objects\n```javascript\nvar Serializer = require("mousse").Serializer;\n\nvar object = {\n    x: 2,\n    y: 4\n};\n\nvar array = [1, 2, 3];\n\nvar serializationString = new Serializer().serialize({foo: object, bar: array});\n```\n\n### Single Object\n\nWhen serializing a single object there\'s no need to provide a label:\n\n```javascript\nvar Serializer = require("mousse").Serializer;\n\nvar object = {\n    x: 2,\n    y: 4\n};\n\nvar serializationString = new Serializer().serializeObject(object);\n```\n\nThere\'s also a shorthand function to serialize a single object:\n\n```javascript\nvar serialize = require("mousse").serialize;\n\nvar object = {\n    x: 2,\n    y: 4\n};\n\nvar serializationString = serialize(object);\n```\n\n## Deserialization of JavaScript objects\n### Multiple Objects\n```javascript\nvar Deserializer = require("mousse").Deserializer,\n    deserializer = new Deserializer(serializationString);\n\ndeserializer.deserialize()\n.then(function(objects) {\n    // deserialized objects are in objects\n});\n```\n\n### Single Object\n```javascript\nvar Deserializer = require("mousse").Deserializer,\n    deserializer = new Deserializer(serializationString);\n\ndeserializer.deserializeObject()\n.then(function(object) {\n    //\n});\n```\n\nAgain, like for serialization, there\'s a shorthand function to deserialize a single object:\n```javascript\nvar Deserializer = require("mousse").deserialize;\n\ndeserialize(serializationString)\n.then(function(object) {\n    //\n});\n```\n\nConsecutive calls to `deserializer.deserialize()` will create a new set of objects from the serialization.\n\n## Serialization Format\n\nThe serialization format is inspired by JSON and it may even be considered as an extension. By itself the format is a JSON valid object.\n\nInstead of only serializing a single object, Mousse is able to serialize several independent objects by providing a label for each one. We can look at it as a dictionary.\n\nThe base format of the serialization is thus an object with as many entries as labeled objects:\n```javascript\n{\n    "label1": {\n        "value": <object1 serialization>\n    },\n\n    "label2": {\n        "value": <object2 serialization>\n    },\n\n    ...,\n\n    "labelN": {\n        "value": <objectN serialization>\n    }\n}\n```\nThe following JavaScript objects are supported:\n\n    * string\n    * number\n    * boolean\n    * null\n    * array\n    * object literal\n    * regular expression\n    * references\n\nNative JavaScript objects are stored just like their JSON representation with the exception of regular expressions (which are not supported by JSON).\n\n### String\n```javascript\nserialize({string: "a string"})\n\n{\n    "string": {\n        "value": "a string"\n    }\n}\n```\n### Number\n```javascript\nserialize({number: 42})\n\n{\n    "number": {\n        "value": 42\n    }\n}\n```\n### Boolean\n```javascript\nserialize({bool: true})\n\n{\n    "bool": {\n        "value": true\n    }\n}\n```\n### Null\n```javascript\nserialize({nil: null})\n\n{\n    "nil": {\n        "value": null\n    }\n}\n```\n### Array\n```javascript\nserialize({array: [1, 2, 3]})\n\n{\n    "array": {\n        "value": [1, 2, 3]\n    }\n}\n```\n### Object Literal\n```javascript\nserialize({object: {x: 2, y: 4}})\n\n{\n    "object": {\n        "value": {\n            "x": 2,\n            "y": 4\n        }\n    }\n}\n```\n### Regular Expression\n```javascript\nserialize({regexp: /regexp/gi})\n\n{\n    "regexp": {\n        "value": {"/": {\n            "source": "regexp",\n            "flags": "gi"\n        }}\n    }\n}\n```\n### References\n\nSince objects have labels it is possible to serialize a reference to an object instead of serializing the entire object again as it happens in JSON:\n```javascript\nvar manager = {\n    name: "Foo"\n}\n\nvar employee = {\n    name: "Bar",\n    manager: manager\n}\n\nserialize({manager: manager, employee: employee})\n\n{\n    "manager": {\n        "value": {\n            "name": "Foo"\n        }\n    },\n\n    "employee": {\n        "value": {\n            "name": "Bar",\n            "manager": {"@": "manager"}\n        }\n    }\n}\n```\nReferences also solves cycles in an object graph:\n```javascript\nvar object = {};\nobject.self = object;\n\nserialize({object: object});\n\n{\n    "object": {\n        "value": {\n            "self": {"@": "object"}\n        }\n    }\n}\n```\nWhen an object is referred more than once it will automatically be assigned a label and only references will be used to refer to it.\n```javascript\nvar array = [1, 2, 3];\nvar object = {\n    foo: array,\n    bar: array\n}\n\nserialize({object: object});\n\n{\n    "object": {\n        "value": {\n            "foo": {"@": "array"},\n            "bar": {"@": "array"}\n        }\n    },\n\n    "array": {\n        "value": [1, 2, 3]\n    }\n}\n```\n## Custom Objects\n\nRoot objects with the `value` property represent JavaScript objects. It is possible to define other types of objects by adding the necessary logic to recognize them and create them.\n\n### Serialization\n\nThe logic to serialize a custom object is handled by the Visitor object. This is the object that visits the graph of objects traversed during serialization and knows what data to store for each type.\nThe interface expects a `getTypeOf` function that returns the type of the object and a `visit<Type>` function that knows what data to store from the object. Multiple `visit<Type>` can be defined as long as `getTypeOf` returns different types.\n\n```javascript\nVisitor.addCustomObjectVisitor({\n    getTypeOf: function(value) {\n        if (value instanceof Map) {\n            return "Map";\n        }\n    },\n\n    visitMap: function(malker, visitor, object, name) {\n        var map = visitor.builder.createCustomObject();\n            mapData = object.toObject();\n\n        malker.visit("map", "type");\n        malker.visit(mapData, "object");\n\n        visitor.storeValue(map, object, name);\n    }\n});\n```\nThe result of the serialization is:\n```javascript\n{\n    "root": {\n        "type": "map",\n        "object": {/* map data */}\n    }\n}\n```\n\n### Deserialization\n\nThe logic to deserialize a custom object is handled by the `Reviver` object. This is the object that knows how to revive objects. The interface expects a `getTypeOf` function that returns the type of the object and a `revive<Type>` function that knows how to revive the object. Multiple `revive<Type>` can be defined as long as `getTypeOf` returns different types.\n\nExample to deserialize:\n```javascript\n{\n    "root": {\n        "type": "map",\n        "object": {/* map data */}\n    }\n}\n```\n```javascript\nReviver.addCustomObjectReviver({\n    getTypeOf: function(value) {\n        if (value.type === "map") {\n            return "Map";\n        }\n    },\n\n    reviveMap: function(value, context, label) {\n        var map = new Map(value.object);\n\n        if (label) {\n            context.setObjectLabel(map, label);\n        }\n\n        return map;\n    }\n});\n```\nThe result of the deserialization is:\n```javascript\n{\n    root: <Map Object>\n}\n```\n\nReviver functions can be asynchronous by returning a promise to the revived value.\n\n### Context\n\nThe `context` object is given as the second parameter to all `revive*` functions and it is used to set labels on deserialized objects, so they can be accessed after the deserialization, and to get objects that were serialized under a specific label.\n\n * `setObjectLabel(object, label)` - Defines the label of `object`.\n * `getObject(label)` - Returns the object with label `label`.\n\n## Extending the Serialization Format\n\nThe Mousse serialization format can be extended by extending the Builder and Visitor objects.\n\n### Serialization\n\nDuring serialization an AST-like object is created that holds all the data needed to be serialized. It is the role of the `Visitor` to create this AST.\n\nWhen the AST is finished it is the role of the `Builder` to generate an output format by reading the AST. The `Builder` presented in Mousse generates JSON but it should be possible to create a Builder that generates another format, for instance XML.\n\nThe `Builder` provides the necessary methods to create the AST Nodes:\n\n * `createObjectLiteral()`\n * `createArray()`\n * `createObjectReference()`\n * `createRegExp(regexp)`\n * `createString(string)`\n * `createNumber(number)`\n * `createBoolean(value)`\n * `createNull()`\n * `createCustomObject()`\n\nThese are the JavaScript objects that Mousse supports. In order to create new ones it is necessary to extend the `Builder` and the `Visitor`.\n\nTo extend the serialization format to know about DOM elements and to serialize them into `{"#" "<element id>"}` we need to:\n\n#### Create the AST node\n```javascript\nfunction ElementReference(root, id) {\n    Value.call(this, root, id);\n}\n\nElementReference.prototype = Object.create(Value.prototype, {\n    constructor: {value: ElementReference},\n\n    _getSerializationValue: {\n        value: function() {\n            return {"#": this.value};\n        }\n    }\n});\n```\n#### Extend the Builder object\n```javascript\nfunction ExtendedBuilder() {\n    Builder.call(this);\n}\n\nExtendedBuilder.prototype = Object.create(Builder.prototype, {\n    constructor: {value: ExtendedBuilder},\n\n    createElementReference: {\n        value: function(id) {\n            return new ElementReference(this._root, id);\n        }\n    }\n});\n```\n#### Extend the Visitor object\n```javascript\nfunction ExtendedVisitor(builder, labeler) {\n    Visitor.call(this, builder, labeler);\n}\n\nExtendedVisitor.prototype = Object.create(Visitor.prototype, {\n    constructor: {value: ExtendedVisitor},\n\n    getTypeOf: {\n        value: function(object) {\n            if (!!(object && 1 === object.nodeType)) {\n                return "ElementReference";\n            }\n        }\n    },\n\n    visitElementReference: {\n        value: function(malker, object, name) {\n            var elementReference,\n                id = object.id;\n\n            elementReference = this.builder.createElementReference(id);\n            this.storeValue(elementReference, object, name);\n        }\n    }\n});\n```\n### Deserialization\n\nDeserialization is handled by the `Reviver` and as such this object needs to be extended to understand the new syntax added to the serialization (`{"#": "<element id>"}`).\n```javascript\nExtendedReviver.prototype = Object.create(Reviver.prototype, {\n    constructor: {value: ExtendedReviver},\n\n    getTypeOf: {\n        value: function(value) {\n            if (value !== null && typeof value === "object"\n                && Object.keys(value).length === 1 && "#" in value) {\n                return "ElementReference";\n            } else {\n                return Reviver.prototype.getTypeOf.call(this, value);\n            }\n        }\n    },\n\n    reviveElementReference: {\n        value: function(value, context, label) {\n            var elementId = value["#"],\n                element = document.getElementById(elementId);\n\n            if (label) {\n                context.setObjectLabel(element, label);\n            }\n\n            return element;\n        }\n    }\n});\n```\n\n## Known Issues\n\nNot possible to serialize literal objects that can be mistaken as a reference or a regexp - `{"@": "label"}` and `{"/": {"source": "regexp"}}`).\n\n',readmeFilename:"README.md",_id:"mousse@0.1.2",dist:{shasum:"91c6333e022c9645047f4cf3582688aa65e5c008"},_from:"mousse@0.1.2",_resolved:"https://registry.npmjs.org/mousse/-/mousse-0.1.2.tgz",directories:{lib:"./"},hash:"7ee841b",mappings:{q:{name:"q",hash:"13a66b6",location:"../q@13a66b6/"},collections:{name:"collections",hash:"f814a7b",location:"../collections@f814a7b/"}},production:!0,useScriptInjection:!0}}),montageDefine("3b7d56f","package.json",{exports:{name:"weak-map",version:"1.0.0",main:"weak-map.js",readme:"ERROR: No README data found!",_id:"weak-map@1.0.0",dist:{shasum:"b66e56a9df0bd25a76bbf1b514db129080614a37"},_from:"weak-map@1.0.0",_resolved:"https://registry.npmjs.org/weak-map/-/weak-map-1.0.0.tgz",directories:{lib:"./"},hash:"3b7d56f",mappings:{},production:!0,useScriptInjection:!0}}),montageDefine("13a66b6","package.json",{exports:{name:"q",version:"0.9.7",description:"A library for promises (CommonJS/Promises/A,B,D)",homepage:"https://github.com/kriskowal/q",author:"Kris Kowal <kris@cixar.com> (https://github.com/kriskowal)",keywords:["q","promise","promises","promises-a","promises-aplus","deferred","future","async","flow control","fluent","browser","node"],contributors:["Kris Kowal <kris@cixar.com> (https://github.com/kriskowal)","Irakli Gozalishvili <rfobic@gmail.com> (http://jeditoolkit.com)","Domenic Denicola <domenic@domenicdenicola.com> (http://domenicdenicola.com)"],bugs:{mail:"kris@cixar.com",url:"http://github.com/kriskowal/q/issues"},license:{type:"MIT",url:"http://github.com/kriskowal/q/raw/master/LICENSE"},main:"q.js",repository:{type:"git",url:"git://github.com/kriskowal/q.git"},engines:{node:">=0.6.0",teleport:">=0.2.0"},dependencies:{},devDependencies:{jshint:"~2.1.9",cover:"*","jasmine-node":"1.11.0",opener:"*","promises-aplus-tests":"1.x",grunt:"~0.4.1","grunt-cli":"~0.1.9","grunt-contrib-uglify":"~0.2.2",matcha:"~0.2.0"},scripts:{test:"jasmine-node spec && promises-aplus-tests spec/aplus-adapter","test-browser":"opener spec/q-spec.html",benchmark:"matcha",lint:"jshint q.js",cover:"cover run node_modules/jasmine-node/bin/jasmine-node spec && cover report html && opener cover_html/index.html",minify:"grunt",prepublish:"grunt"},directories:{test:"./spec",lib:"./"},hash:"13a66b6",mappings:{},production:!0,useScriptInjection:!0}}),montageDefine("51f539f","package.json",{exports:{name:"frb",version:"0.2.14",description:"Functional reactive bindings",keywords:["functional","reactive","bindings","observe","change"],author:{name:"Kris Kowal",email:"kris@cixar.com",url:"http://github.com/kriskowal/"},contributors:[{name:"Kris Kowal",email:"kris@cixar.com",url:"http://github.com/kriskowal/"}],bugs:{url:"http://github.com/kriskowal/frb/issues"},licenses:[{type:"MIT",url:"http://github.com/kriskowal/frb/raw/master/LICENSE.md"}],repository:{type:"git",url:"http://github.com/kriskowal/frb.git"},main:"bindings",dependencies:{collections:"~0.2.0"},devDependencies:{"jasmine-node":"1.x.x",pegjs:"git://github.com/dmajda/pegjs.git"},scripts:{test:"jasmine-node spec","build-parser":"pegjs --allowed-start-rules expression,sheet grammar.pegjs"},readme:'\n<img src="frb.png" align="right" alt="FRB Logo">\n\n# Functional Reactive Bindings\n\nIn their simplest form, bindings provide the illusion that two objects\nhave the same property.  Changing the property on one object causes the\nsame change in the other.  This is useful for coordinating state between\nviews and models, among other entangled objects.  For example, if you\nenter text into a text field, the same text might be added to the\ncorresponding database record.\n\n```javascript\nbind(object, "a.b", {"<->": "c.d"});\n```\n\nFunctional Reactive Bindings go farther.  They can gracefully bind long\nproperty paths and the contents of collections.  They can also\nincrementally update the results of chains of queries including maps,\nflattened arrays, sums, and averages.  They can also add and remove\nelements from sets based on the changes to a flag.  FRB makes it easy to\nincrementally ensure consistent state.\n\n```javascript\nbind(company, "payroll", {"<-": "departments.map{employees.sum{salary}}.sum()"});\nbind(document, "body.classList.has(\'dark\')", {"<-": "darkMode", source: viewModel});\n```\n\nFRB is built from a combination of powerful functional and generic\nbuilding blocks, making it reliable, easy to extend, and easy to\nmaintain.\n\n\n## Getting Started\n\n`frb` is a CommonJS package, with JavaScript modules suitable for use\nwith [Node.js][] on the server side or [Mr][] on the client side. \n\n```\n❯ npm install frb\n```\n\n\n\n\n## Tutorial\n\nIn this example, we bind `model.content` to `document.body.innerHTML`.\n\n```javascript\nvar bind = require("frb/bind");\nvar model = {content: "Hello, World!"};\nvar cancelBinding = bind(document, "body.innerHTML", {\n    "<-": "content",\n    "source": model\n});\n```\n\nWhen a source property is bound to a target property, the target gets\nreassigned to the source any time the source changes.\n\n```javascript\nmodel.content = "Farewell.";\nexpect(document.body.innerHTML).toBe("Farewell.");\n```\n\nBindings can be recursively detached from the objects they observe with\nthe returned cancel function.\n\n```javascript\ncancelBinding();\nmodel.content = "Hello again!"; // doesn\'t take\nexpect(document.body.innerHTML).toBe("Farewell.");\n```\n\n### Two-way Bindings\n\nBindings can go one way or in both directions.  Declare one-way\nbindings with the ```<-``` property, and two-way bindings with the\n```<->``` property.\n\nIn this example, the "foo" and "bar" properties of an object will be\ninexorably intertwined.\n\n```javascript\nvar object = {};\nvar cancel = bind(object, "foo", {"<->": "bar"});\n\n// <-\nobject.bar = 10;\nexpect(object.foo).toBe(10);\n\n// ->\nobject.foo = 20;\nexpect(object.bar).toBe(20);\n```\n\n### Right-to-left\n\nNote that even with a two-way binding, the right-to-left binding\nprecedes the left-to-right.  In this example, "foo" and "bar" are bound\ntogether, but both have initial values.\n\n```javascript\nvar object = {foo: 10, bar: 20};\nvar cancel = bind(object, "foo", {"<->": "bar"});\nexpect(object.foo).toBe(20);\nexpect(object.bar).toBe(20);\n```\n\nThe right-to-left assignment of `bar` to `foo` happens first, so the\ninitial value of `foo` gets lost.\n\n### Properties\n\nBindings can follow deeply nested chains, on both the left and the right\nside.\n\nIn this example, we have two object graphs, `foo`, and `bar`, with the\nsame structure and initial values.  This binds `bar.a.b` to `foo.a.b`\nand also the other way around.\n\n```javascript\nvar foo = {a: {b: 10}};\nvar bar = {a: {b: 10}};\nvar cancel = bind(foo, "a.b", {\n    "<->": "a.b",\n    source: bar\n});\n// <-\nbar.a.b = 20;\nexpect(foo.a.b).toBe(20);\n// ->\nfoo.a.b = 30;\nexpect(bar.a.b).toBe(30);\n```\n\n### Structure changes\n\nChanges to the structure of either side of the binding are no matter.\nAll of the orphaned event listeners will automatically be canceled, and\nthe binders and observers will reattach to the new object graph.\n\nContinuing from the previous example, we store and replace the `a`\nobject from one side of the binding.  The old `b` property is now\norphaned, and the old `b` property adopted in its place.\n\n```javascript\nvar a = foo.a;\nexpect(a.b).toBe(30); // from before\n\nfoo.a = {}; // orphan a and replace\nfoo.a.b = 40;\n// ->\nexpect(bar.a.b).toBe(40); // updated\n\nbar.a.b = 50;\n// <-\nexpect(foo.a.b).toBe(50); // new one updated\nexpect(a.b).toBe(30); // from before it was orphaned\n```\n\n### Sum\n\nSome advanced queries are possible with one-way bindings from\ncollections.  FRB updates sums incrementally.  When values are added or\nremoved from the array, the sum of only those values is taken and added\nor removed from the last known sum.\n\n```javascript\nvar object = {array: [1, 2, 3]};\nbind(object, "sum", {"<-": "array.sum()"});\nexpect(object.sum).toEqual(6);\n```\n\n### Average\n\nThe arithmetic mean of a collection can be updated incrementally.  Each\ntime the array changes, the added and removed values adjust the last\nknown sum and count of values in the array.\n\n```javascript\nvar object = {array: [1, 2, 3]};\nbind(object, "average", {"<-": "array.average()"});\nexpect(object.average).toEqual(2);\n```\n\n### Last\n\nFRB provides an operator for watching the last value in an Array.\n\n```javascript\nvar array = [1, 2, 3];\nvar object = {array: array, last: null};\nBindings.defineBinding(object, "last", {"<-": "array.last()"});\nexpect(object.last).toBe(3);\n\narray.push(4);\nexpect(object.last).toBe(4);\n```\n\nWhen the dust settles, `array.last()` is equivalent to\n`array[array.length - 1]`, but the `last` observer guarantees that it\nwill not jitter between the ultimate value and null or the penultimate\nvalue of the collection.  With `array[array.length]`, the underlying may\nnot change its content and length atomically.\n\n```javascript\nvar changed = jasmine.createSpy();\nPropertyChanges.addOwnPropertyChangeListener(object, "last", changed);\narray.unshift(0);\narray.splice(3, 0, 3.5);\nexpect(object.last).toBe(4);\nexpect(changed).not.toHaveBeenCalled();\n\narray.pop();\nexpect(object.last).toBe(3);\n\narray.clear();\nexpect(object.last).toBe(null);\n```\n\n### Only\n\nFRB provides an `only` operator, which can either observe or bind the\nonly element of a collection.  The `only` observer watches a collection\nfor when there is only one value in that collection and emits that\nvalue..  If there are multiple values, it emits null.\n\n```javascript\nvar object = {array: [], only: null};\nBindings.defineBindings(object, {\n    only: {"<->": "array.only()"}\n});\n\nobject.array = [1];\nexpect(object.only).toBe(1);\n\nobject.array.pop();\nexpect(object.only).toBe(undefined);\n\nobject.array = [1, 2, 3];\nexpect(object.only).toBe(undefined);\n```\n\nTHe `only` binder watches a value.  When the value is null, it does\nnothing.  Otherwise, it will update the bound collection such that it\nonly contains that value.  If the collection was empty, it adds the\nvalue.  Otherwise, if the collection did not have the value, it replaces\nthe collection\'s content with the one value.  Otherwise, it removes\neverything but the value it already contains.  Regardless of the means,\nthe end result is the same.  If the value is non-null, it will be the\nonly value in the collection.\n\n```javascript\nobject.only = 2;\nexpect(object.array.slice()).toEqual([2]);\n// Note that slice() is necessary only because the testing scaffold\n// does not consider an observable array equivalent to a plain array\n// with the same content\n\nobject.only = null;\nobject.array.push(3);\nexpect(object.array.slice()).toEqual([2, 3]);\n```\n\n### Map\n\nYou can also create mappings from one array to a new array and an\nexpression to evaluate on each value.  The mapped array is bound once,\nand all changes to the source array are incrementally updated in the\ntarget array.\n\n```javascript\nvar object = {objects: [\n    {number: 10},\n    {number: 20},\n    {number: 30}\n]};\nbind(object, "numbers", {"<-": "objects.map{number}"});\nexpect(object.numbers).toEqual([10, 20, 30]);\nobject.objects.push({number: 40});\nexpect(object.numbers).toEqual([10, 20, 30, 40]);\n```\n\nAny function, like `sum` or `average`, can be applied to the result of a\nmapping.  The straight-forward path would be\n`objects.map{number}.sum()`, but you can use a block with any function\nas a short hand, `objects.sum{number}`.\n\n### Filter\n\nA filter block generates an incrementally updated array filter.  The\nresulting array will contain only those elements from the source array\nthat pass the test deescribed in the block.  As values of the source\narray are added, removed, or changed such that they go from passing to\nfailing or failing to passing, the filtered array gets incrementally\nupdated to include or exclude those values in their proper positions, as\nif the whole array were regenerated with `array.filter` by brute force.\n\n```javascript\nvar object = {numbers: [1, 2, 3, 4, 5, 6]};\nbind(object, "evens", {"<-": "numbers.filter{!(%2)}"});\nexpect(object.evens).toEqual([2, 4, 6]);\nobject.numbers.push(7, 8);\nobject.numbers.shift();\nobject.numbers.shift();\nexpect(object.evens).toEqual([4, 6, 8]);\n```\n\n### Some and Every\n\nA `some` block incrementally tracks whether some of the values in a\ncollection meet a criterion.\n\n```javascript\nvar object = Bindings.defineBindings({\n    options: [\n        {checked: true},\n        {checked: false},\n        {checked: false}\n    ]\n}, {\n    anyChecked: {\n        "<-": "options.some{checked}"\n    }\n});\nexpect(object.anyChecked).toBe(true);\n```\n\nAn `every` block incrementally tracks whether all of the values in a\ncollection meet a criterion.\n\n```javascript\nvar object = Bindings.defineBindings({\n    options: [\n        {checked: true},\n        {checked: false},\n        {checked: false}\n    ]\n}, {\n    allChecked: {\n        "<-": "options.every{checked}"\n    }\n});\nexpect(object.allChecked).toBe(false);\n```\n\nYou can use a two-way binding on `some` and `every` blocks.\n\n```javascript\nvar object = Bindings.defineBindings({\n    options: [\n        {checked: true},\n        {checked: false},\n        {checked: false}\n    ]\n}, {\n    allChecked: {\n        "<->": "options.every{checked}"\n    },\n    noneChecked: {\n        "<->": "!options.some{checked}"\n    }\n});\n\nobject.noneChecked = true;\nexpect(object.options.every(function (option) {\n    return !option.checked\n}));\n\nobject.allChecked = true;\nexpect(object.noneChecked).toBe(false);\n```\n\nThe caveat of an `equals` binding applies.  If the condition for every\nelement of the collection is set to true, the condition will be bound\nincrementally to true on each element.  When the condition is set to\nfalse, the binding will simply be canceled.\n\n```javascript\nobject.allChecked = false;\nexpect(object.options.every(function (option) {\n    return option.checked; // still checked\n}));\n```\n\n### Sorted\n\nA sorted block generates an incrementally updated sorted array.  The\nresulting array will contain all of the values from the source except in\nsorted order.\n\n```javascript\nvar object = {numbers: [5, 2, 7, 3, 8, 1, 6, 4]};\nbind(object, "sorted", {"<-": "numbers.sorted{}"});\nexpect(object.sorted).toEqual([1, 2, 3, 4, 5, 6, 7, 8]);\n```\n\nThe block may specify a property or expression by which to compare\nvalues.\n\n```javascript\nvar object = {arrays: [[1, 2, 3], [1, 2], [], [1, 2, 3, 4], [1]]};\nbind(object, "sorted", {"<-": "arrays.sorted{-length}"});\nexpect(object.sorted.map(function (array) {\n    return array.slice(); // to clone\n})).toEqual([\n    [1, 2, 3, 4],\n    [1, 2, 3],\n    [1, 2],\n    [1],\n    []\n]);\n```\n\nThe sorted binding responds to changes to the sorted property by\nremoving them at their former place and adding them back at their new\nposition.\n\n```javascript\nobject.arrays[0].push(4, 5);\nexpect(object.sorted.map(function (array) {\n    return array.slice(); // to clone\n})).toEqual([\n    [1, 2, 3, 4, 5], // new\n    [1, 2, 3, 4],\n    // old\n    [1, 2],\n    [1],\n    []\n]);\n```\n\n### Unique and Sorted\n\nFRB can create a sorted index of unique values using `sortedSet` blocks.\n\n```javascript\nvar object = Bindings.defineBindings({\n    folks: [\n        {id: 4, name: "Bob"},\n        {id: 2, name: "Alice"},\n        {id: 3, name: "Bob"},\n        {id: 1, name: "Alice"},\n        {id: 1, name: "Alice"} // redundant\n    ]\n}, {\n    inOrder: {"<-": "folks.sortedSet{id}"},\n    byId: {"<-": "folks.map{[id, this]}.toMap()"},\n    byName: {"<-": "inOrder.toArray().group{name}.toMap()"}\n});\n\nexpect(object.inOrder.toArray()).toEqual([\n    object.byId.get(1),\n    object.byId.get(2),\n    object.byId.get(3),\n    object.byId.get(4)\n]);\n\nexpect(object.byName.get("Alice")).toEqual([\n    object.byId.get(1),\n    object.byId.get(2)\n]);\n```\n\nThe outcome is a `SortedSet` data structure, not an `Array`.  The sorted\nset is useful for fast lookups, inserts, and deletes on sorted, unique\ndata.  If you would prefer a sorted array of unique values, you can\ncombine other operators to the same effect.\n\n```javascript\nvar object = Bindings.defineBindings({\n    folks: [\n        {id: 4, name: "Bob"},\n        {id: 2, name: "Alice"},\n        {id: 3, name: "Bob"},\n        {id: 1, name: "Alice"},\n        {id: 1, name: "Alice"} // redundant\n    ]\n}, {\n    index: {"<-": "folks.group{id}.sorted{.0}.map{.1.last()}"}\n});\n\nexpect(object.index).toEqual([\n    {id: 1, name: "Alice"},\n    {id: 2, name: "Alice"},\n    {id: 3, name: "Bob"},\n    {id: 4, name: "Bob"}\n]);\n```\n\n\n### Min and Max\n\nA binding can observe the minimum or maximum of a collection.  FRB uses\na binary heap internally to incrementally track the minimum or maximum\nvalue of the collection.\n\n```javascript\nvar object = Bindings.defineBindings({}, {\n    min: {"<-": "values.min{}"},\n    max: {"<-": "values.max{}"}\n});\n\nexpect(object.min).toBe(undefined);\nexpect(object.max).toBe(undefined);\n\nobject.values = [2, 3, 2, 1, 2];\nexpect(object.min).toBe(1);\nexpect(object.max).toBe(3);\n```\n\nMin and max blocks accept an expression on which to compare values from\nthe collection.\n\n```javascript\nvar object = Bindings.defineBindings({}, {\n    loser: {"<-": "rounds.min{score}.player"},\n    winner: {"<-": "rounds.max{score}.player"}\n});\n\nobject.rounds = [\n    {score: 0, player: "Luke"},\n    {score: 100, player: "Obi Wan"},\n    {score: 250, player: "Vader"}\n];\nexpect(object.loser).toEqual("Luke");\nexpect(object.winner).toEqual("Vader");\n\nobject.rounds[1].score = 300;\nexpect(object.winner).toEqual("Obi Wan");\n```\n\n### Group\n\nFRB can incrementally track equivalence classes within in a collection.\nThe group block accepts an expression that determines the equivalence\nclass for each object in a collection.  The result is a nested data\nstructure: an array of [key, class] pairs, where each class is itself an\narray of all members of the collection that have the corresponding key.\n\n```javascript\nvar store = Bindings.defineBindings({}, {\n    "clothingByColor": {"<-": "clothing.group{color}"}\n});\nstore.clothing = [\n    {type: \'shirt\', color: \'blue\'},\n    {type: \'pants\', color: \'red\'},\n    {type: \'blazer\', color: \'blue\'},\n    {type: \'hat\', color: \'red\'}\n];\nexpect(store.clothingByColor).toEqual([\n    [\'blue\', [\n        {type: \'shirt\', color: \'blue\'},\n        {type: \'blazer\', color: \'blue\'}\n    ]],\n    [\'red\', [\n        {type: \'pants\', color: \'red\'},\n        {type: \'hat\', color: \'red\'}\n    ]]\n]);\n```\n\nTracking the positions of every key and every value in its equivalence\nclass can be expensive.  Internally, `group` blocks are implemented with\na `groupMap` block followed by an `entries()` observer.  The `groupMap`\nproduces a `Map` data structure and does not waste any time, but does\nnot produce range change events.  The `entries()` observer projects the\nmap of classes into the nested array data structure.\n\nYou can use the `groupMap` block directly.\n\n```javascript\nBindings.cancelBinding(store, "clothingByColor");\nBindings.defineBindings(store, {\n    "clothingByColor": {"<-": "clothing.groupMap{color}"}\n});\nvar blueClothes = store.clothingByColor.get(\'blue\');\nexpect(blueClothes).toEqual([\n    {type: \'shirt\', color: \'blue\'},\n    {type: \'blazer\', color: \'blue\'}\n]);\n\nstore.clothing.push({type: \'gloves\', color: \'blue\'});\nexpect(blueClothes).toEqual([\n    {type: \'shirt\', color: \'blue\'},\n    {type: \'blazer\', color: \'blue\'},\n    {type: \'gloves\', color: \'blue\'}\n]);\n```\n\nThe `group` and `groupMap` blocks both respect the type of the source\ncollection.  If instead of an array you were to use a `SortedSet`, the\nequivalence classes would each be sorted sets.  This is useful because\nreplacing values in a sorted set can be performed with much less waste\nthan with a large array.\n\n### View\n\nSuppose that your source is a large data store, like a `SortedSet` from\nthe [Collections][] package.  You might need to view a sliding window\nfrom that collection as an array.  The `view` binding reacts to changes\nto the collection and the position and length of the window.\n\n```javascript\nvar SortedSet = require("collections/sorted-set");\nvar controller = {\n    index: SortedSet([1, 2, 3, 4, 5, 6, 7, 8]),\n    start: 2,\n    length: 4\n};\nvar cancel = bind(controller, "view", {\n    "<-": "index.view(start, length)"\n});\n\nexpect(controller.view).toEqual([3, 4, 5, 6]);\n\n// change the window length\ncontroller.length = 3;\nexpect(controller.view).toEqual([3, 4, 5]);\n\n// change the window position\ncontroller.start = 5;\nexpect(controller.view).toEqual([6, 7, 8]);\n\n// add content behind the window\ncontroller.index.add(0);\nexpect(controller.view).toEqual([5, 6, 7]);\n```\n\n### Enumerate\n\nAn enumeration observer produces `[index, value]` pairs.  You can bind\nto the index or the value in subsequent stages.  The prefix dot\ndistinguishes the zeroeth property from the literal zero.\n\n```javascript\nvar object = {letters: [\'a\', \'b\', \'c\', \'d\']};\nbind(object, "lettersAtEvenIndexes", {\n    "<-": "letters.enumerate().filter{!(.0 % 2)}.map{.1}"\n});\nexpect(object.lettersAtEvenIndexes).toEqual([\'a\', \'c\']);\nobject.letters.shift();\nexpect(object.lettersAtEvenIndexes).toEqual([\'b\', \'d\']);\n```\n\n### Range\n\nA range observes a given length and produces and incrementally updates\nan array of consecutive integers starting with zero with that given\nlength.\n\n```javascript\nvar object = Bindings.defineBinding({}, "stack", {\n    "<-": "&range(length)"\n});\nexpect(object.stack).toEqual([]);\n\nobject.length = 3;\nexpect(object.stack).toEqual([0, 1, 2]);\n\nobject.length = 1;\nexpect(object.stack).toEqual([0]);\n```\n\n### Flatten\n\nYou can flatten nested arrays.  In this example, we have an array of\narrays and bind it to a flat array.\n\n```javascript\nvar arrays = [[1, 2, 3], [4, 5, 6]];\nvar object = {};\nbind(object, "flat", {\n    "<-": "flatten()",\n    source: arrays\n});\nexpect(object.flat).toEqual([1, 2, 3, 4, 5, 6]);\n```\n\nNote that changes to the inner and outer arrays are both projected into\nthe flattened array.\n\n```javascript\narrays.push([7, 8, 9]);\narrays[0].unshift(0);\nexpect(object.flat).toEqual([0, 1, 2, 3, 4, 5, 6, 7, 8, 9]);\n```\n\nAlso, as with all other bindings that produce arrays, the flattened\narray is never replaced, just incrementally updated.\n\n```javascript\nvar flat = object.flat;\narrays.splice(0, arrays.length);\nexpect(object.flat).toBe(flat); // === same object\n```\n\n### Concat\n\nYou can observe the concatenation of collection of dynamic arrays.\n\n```javascript\nvar object = Bindings.defineBinding({\n    head: 10,\n    tail: [20, 30]\n}, "flat", {\n    "<-": "[head].concat(tail)"\n});\nexpect(object.flat).toEqual([10, 20, 30]);\n```\n\nThe underlying mechanism is equivalent to `[[head], tail].flatten()`.\n\n### Reversed\n\nYou can bind the reversal of an array.\n\n```javascript\nvar object = {forward: [1, 2, 3]};\nbind(object, "backward", {\n    "<->": "forward.reversed()"\n});\nexpect(object.backward.slice()).toEqual([3, 2, 1]);\nobject.forward.push(4);\nexpect(object.forward.slice()).toEqual([1, 2, 3, 4]);\nexpect(object.backward.slice()).toEqual([4, 3, 2, 1]);\n```\n\nNote that you can do two-way bindings, ```<->``` with reversed arrays.\nChanges to either side are updated to the opposite side.\n\n```javascript\nobject.backward.pop();\nexpect(object.backward.slice()).toEqual([4, 3, 2]);\nexpect(object.forward.slice()).toEqual([2, 3, 4]);\n```\n\n### Has\n\nYou can bind a property to always reflect whether a collection contains\na particular value.\n\n```javascript\nvar object = {\n    haystack: [1, 2, 3],\n    needle: 3\n};\nbind(object, "hasNeedle", {"<-": "haystack.has(needle)"});\nexpect(object.hasNeedle).toBe(true);\nobject.haystack.pop(); // 3 comes off\nexpect(object.hasNeedle).toBe(false);\n```\n\nThe binding also reacts to changes to the value you seek.\n\n```javascript\n// Continued from above...\nobject.needle = 2;\nexpect(object.hasNeedle).toBe(true);\n```\n\n`has` bindings are not incremental, but with the right data-structure,\nupdates are cheap.  The [Collections][] package contains Lists, Sets,\nand OrderedSets that all can send content change notifications and thus\ncan be bound.\n\n```javascript\n// Continued from above...\nvar Set = require("collections/set");\nobject.haystack = new Set([1, 2, 3]);\nexpect(object.hasNeedle).toBe(true);\n```\n\n`has` bindings can also be left-to-right and bi-directional.\n\n```javascript\nbind(object, "hasNeedle", {"<->": "haystack.has(needle)"});\nobject.hasNeedle = false;\nexpect(object.haystack.has(2)).toBe(false);\n```\n\nThe collection on the left-hand-side must implement `has` or `contains`,\n`add`, and `delete` or `remove`.  FRB shims `Array` to have `has`,\n`add`, and `delete`, just like all the collections in [Collections][].\nIt happens that the `classList` properties of DOM elements, when they\nare supported, implement `add`, `remove`, and `contains`.\n\n```javascript\nvar model = {darkMode: false};\nbind(document.body, "classList.has(\'dark\')", {\n    "<-": "darkMode",\n    source: model\n});\n```\n\nThe DOM `classList` does not however implement\n`addContentChangeListener` or `removeContentChangeListener`, so it\ncannot be used on the right-hand-side of a binding, and such bindings\ncannot be bidirectional.  With some DOM [Mutation Observers][], you\nmight be able to help FRB overcome this limitation in the future.\n\n### Get\n\nA binding can observe changes in key-to-value mappings in arrays and map\n[Collections][].\n\n```javascript\nvar object = {\n    array: [1, 2, 3],\n    second: null\n};\nvar cancel = bind(object, "second", {\n    "<->": "array.get(1)"\n});\nexpect(object.array.slice()).toEqual([1, 2, 3]);\nexpect(object.second).toBe(2);\n\nobject.array.shift();\nexpect(object.array.slice()).toEqual([2, 3]);\nexpect(object.second).toBe(3);\n\nobject.second = 4;\nexpect(object.array.slice()).toEqual([2, 4]);\n\ncancel();\nobject.array.shift();\nexpect(object.second).toBe(4); // still\n```\n\nThe source collection can be a Map, Dict, MultiMap, SortedMap,\nSortedArrayMap, or anything that implements `get` and\n`addMapChangeListener` as specified in [Collections][].  The key can\nalso be a variable.\n\n```javascript\nvar Map = require("collections/map");\nvar a = {id: 0}, b = {id: 1};\nvar object = {\n    source: Map([[a, 10], [b, 20]]),\n    key: null,\n    selected: null\n};\n\nvar cancel = bind(object, "selected", {\n    "<-": "source.get(key)"\n});\nexpect(object.selected).toBe(undefined);\n\nobject.key = a;\nexpect(object.selected).toBe(10);\n\nobject.key = b;\nexpect(object.selected).toBe(20);\n\nobject.source.set(b, 30);\nexpect(object.selected).toBe(30);\n\nvar SortedMap = require("collections/sorted-map");\nobject.source = SortedMap();\nexpect(object.selected).toBe(undefined);\n\nobject.source.set(b, 40);\nexpect(object.selected).toBe(40);\n\ncancel();\nobject.key = a; // no effect\nexpect(object.selected).toBe(40);\n```\n\nYou can also bind the entire content of a map-like collection to the\ncontent of another.  Bear in mind that the content of the source\nreplaces the content of the target initially.\n\n```javascript\nvar Map = require("collections/map");\nvar object = {\n    a: Map({a: 10}),\n    b: Map()\n};\nvar cancel = bind(object, "a.mapContent()", {"<->": "b.mapContent()"});\nexpect(object.a.toObject()).toEqual({});\nexpect(object.b.toObject()).toEqual({});\n\nobject.a.set(\'a\', 10);\nexpect(object.a.toObject()).toEqual({a: 10});\nexpect(object.b.toObject()).toEqual({a: 10});\n\nobject.b.set(\'b\', 20);\nexpect(object.a.toObject()).toEqual({a: 10, b: 20});\nexpect(object.b.toObject()).toEqual({a: 10, b: 20});\n```\n\nIn this case, the source of the binding is a different object than the\ntarget, so the binding descriptor specifies the alternate source.\n\n### Keys, Values, Entries\n\nIf the source of a binding is a map, FRB can also translate changes to\nthe map into changes on an array.  The `keys`, `values`, and `entries`\nobservers produce incrementally updated projections of the\nkey-value-mappings onto an array.\n\n```javascript\nvar Map = require("collections/map");\nvar object = Bindings.defineBindings({}, {\n    keys: {"<-": "map.keys()"},\n    values: {"<-": "map.values()"},\n    entries: {"<-": "map.entries()"}\n});\nobject.map = Map({a: 10, b: 20, c: 30});\nexpect(object.keys).toEqual([\'a\', \'b\', \'c\']);\nexpect(object.values).toEqual([10, 20, 30]);\nexpect(object.entries).toEqual([[\'a\', 10], [\'b\', 20], [\'c\', 30]]);\n\nobject.map.set(\'d\', 40);\nobject.map.delete(\'a\');\nexpect(object.keys).toEqual([\'b\', \'c\', \'d\']);\nexpect(object.values).toEqual([20, 30, 40]);\nexpect(object.entries).toEqual([[\'b\', 20], [\'c\', 30], [\'d\', 40]]);\n```\n\n### Coerce to Map\n\nRecords (Objects with a fixed shape), arrays of entries, and Maps\nthemselves can be coerced to an incrementally updated `Map` with the\n`toMap` operator.\n\n```javascript\nvar object = Bindings.defineBindings({}, {\n    map: {"<-": "entries.toMap()"}\n});\n\n// map property will persist across changes to entries\nvar map = object.map;\nexpect(map).not.toBe(null);\n\nobject.entries = {a: 10};\nexpect(map.keys()).toEqual([\'a\']);\nexpect(map.has(\'a\')).toBe(true);\nexpect(map.get(\'a\')).toBe(10);\n```\n\nThe `toMap` observer maintains the insertion order of the keys.\n\n```javascript\n// Continued...\nobject.entries = [[\'b\', 20], [\'c\', 30]];\nexpect(map.keys()).toEqual([\'b\', \'c\']);\n\nobject.entries.push(object.entries.shift());\nexpect(map.keys()).toEqual([\'c\', \'b\']);\n```\n\nIf the entries do not have unique keys, the last entry wins.  This is\nmanaged internally by observing, `entries.group{.0}.map{.1.last()}`.\n\n```javascript\n// Continued...\nobject.entries = [[\'a\', 10], [\'a\', 20]];\nexpect(map.get(\'a\')).toEqual(20);\nobject.entries.pop();\nexpect(map.get(\'a\')).toEqual(10);\n```\n\n`toMap` binds the content of the output map to the content of the input\nmap and will clear and repopulate the output map if the input map is\nreplaced.\n\n```\n// Continued...\nobject.entries = new Map({a: 10});\nexpect(map.keys()).toEqual([\'a\']);\n```\n\n### Equals\n\nYou can bind to whether expressions are equal.\n\n```javascript\nvar fruit = {apples: 1, oranges: 2};\nbind(fruit, "equal", {"<-": "apples == oranges"});\nexpect(fruit.equal).toBe(false);\nfruit.orange = 1;\nexpect(fruit.equal).toBe(true);\n```\n\nEquality can be bound both directions.  In this example, we do a two-way\nbinding between whether a radio button is checked and a corresponding\nvalue in our model.\n\n```javascript\nvar component = {\n    orangeElement: {checked: false},\n    appleElement: {checked: true}\n};\nBindings.defineBindings(component, {\n    "orangeElement.checked": {"<->": "fruit == \'orange\'"},\n    "appleElement.checked": {"<->": "fruit == \'apple\'"},\n});\n\ncomponent.orangeElement.checked = true;\nexpect(component.fruit).toEqual("orange");\n\ncomponent.appleElement.checked = true;\nexpect(component.fruit).toEqual("apple");\n```\n\nBecause equality and assignment are interchanged in this language, you\ncan use either `=` or `==`.\n\nFRB also supports a comparison operator, `<=>`, which uses\n`Object.compare` to determines how two operands should be sorted in\nrelation to each other.\n\n### Array and Map Content\n\nIn JavaScript, arrays behave both like objects (in the sense that every\nindex is a property, but also like a map collection of index-to-value\npairs.  The [Collections][] package goes so far as to patch up the\n`Array` prototype so arrays can masquerade as maps, with the caveat that\n`delete(value)` behaves like a Set instead of a Map.\n\nThis duplicity is reflected in FRB.  You can access the values in an\narray using the object property notation or the mapped key notation.\n\n```javascript\nvar object = {\n    array: [1, 2, 3]\n};\nBindings.defineBindings(object, {\n    first: {"<-": "array.0"},\n    second: {"<-": "array.get(1)"}\n});\nexpect(object.first).toBe(1);\nexpect(object.second).toBe(2);\n```\n\nTo distinguish a numeric property of the source from a number literal,\nuse a dot.  To distingish a mapped index from an array literal, use an\nempty expression.\n\n```javascript\nvar array = [1, 2, 3];\nvar object = {};\nBindings.defineBindings(object, {\n    first: {\n        "<-": ".0",\n        source: array\n    },\n    second: {\n        "<-": "get(1)",\n        source: array\n    }\n});\nexpect(object.first).toBe(1);\nexpect(object.second).toBe(2);\n```\n\nUnlike property notation, map notation can observe a variable index.\n\n```javascript\nvar object = {\n    array: [1, 2, 3],\n    index: 0\n};\nBindings.defineBinding(object, "last", {\n    "<-": "array.get(array.length - 1)"\n});\nexpect(object.last).toBe(3);\n\nobject.array.pop();\nexpect(object.last).toBe(2);\n```\n\nYou can also bind *all* of the content of an array by range or by\nmapping.  The notation for binding ranged content is `rangeContent()`.\nEvery change to an Array or SortedSet dispatches range changes and any\ncollection that implements `splice` and `swap` can be a target for such\nchanges.\n\n```javascript\nvar SortedSet = require("collections/sorted-set");\nvar object = {\n    set: SortedSet(),\n    array: []\n};\nBindings.defineBindings(object, {\n    "array.rangeContent()": {"<-": "set"}\n});\nobject.set.addEach([5, 2, 6, 1, 4, 3]);\nexpect(object.array).toEqual([1, 2, 3, 4, 5, 6]);\n```\n\nThe notation for binding the content of any mapping collection using map\nchanges is `mapContent()`.  On the target of a binding, this will note\nwhen values are added or removed on each key of the source collection\nand apply the same change to the target.  The target and source can be\narrays or map collections.\n\n```javascript\nvar Map = require("collections/map");\nvar object = {\n    map: Map(),\n    array: []\n};\nBindings.defineBinding(object, "map.mapContent()", {\n    "<-": "array"\n});\nobject.array.push(1, 2, 3);\nexpect(object.map.toObject()).toEqual({\n    0: 1,\n    1: 2,\n    2: 3\n});\n```\n\n### Value\n\nA note about the source value: an empty path implies the source value.\nUsing empty paths and empty expressions is useful in some situations.\n\nIf a value is ommitted on either side of an operator, it implies the\nsource value.  The expression `sorted{}` indicates a sorted array, where\neach value is sorted by its own numeric value.  The expression\n`filter{!!}` would filter falsy values.  The operand is implied.\nSimilarly, `filter{!(%2)}` produces only even values.\n\nThis is why you can use `.0` to get the zeroth property of an array, to\ndistingiush the form from `0` which would be a numeric literal, and why\nyou can use `()[0]` to map the zeroeth key of a map or array, to\ndistinguish the form from `[0]` which would be an array literal.\n\n### With Context Value\n\nExpressions can be evaluated in the context of another value using a\nvariant of property notation.  A parenthesized expression can follow a\npath.\n\n```javascript\nvar object = {\n    context: {a: 10, b: 20}\n};\nBindings.defineBinding(object, "sum", {\n    "<-": "context.(a + b)"\n});\nexpect(object.sum).toBe(30);\n\nBindings.cancelBinding(object, "sum");\nobject.context.a = 20;\nexpect(object.sum).toBe(30); // unchanged\n```\n\nTo observe a constructed array or object literal, the expression does\nnot need parentheses.\n\n```javascript\nvar object = {\n    context: {a: 10, b: 20}\n};\nBindings.defineBindings(object, {\n    "duple": {"<-": "context.[a, b]"},\n    "pair": {"<-": "context.{key: a, value: b}"}\n});\nexpect(object.duple).toEqual([10, 20]);\nexpect(object.pair).toEqual({key: 10, value: 20});\n\nBindings.cancelBindings(object);\n```\n\n### Operators\n\nFRB can also recognize many operators.  These are in order of precedence\nunary `-` negation, `+` numeric coercion, and `!` logical negation and\nthen binary `**` power, `//` root, `%%` logarithm, `*`, `/`, `%` modulo,\n`%%` remainder, `+`, `-`, ```<```, ```>```, ```<=```, ```>=```, `=` or\n`==`, `!=`, `&&` and `||`.\n\n```javascript\nvar object = {height: 10};\nbind(object, "heightPx", {"<-": "height + \'px\'"});\nexpect(object.heightPx).toEqual("10px");\n```\n\nThe unary `+` operator coerces a value to a number. It is handy for\nbinding a string to a number.\n\n```javascript\nvar object = {\n    number: null,\n    string: null,\n};\nBindings.defineBinding(object, "+number", {\n    "<-": "string"\n});\nobject.string = \'10\';\nexpect(object.number).toBe(10);\n```\n\n### Functions\n\nFRB supports some common functions.  `startsWith`, `endsWith`, and\n`contains` all operate on strings.  `join` concatenates an array of\nstrings with a given delimiter (or empty string).  `split` breaks a\nstring between every delimiter (or just between every character).\n`join` and `split` are algebraic and can be bound as well as observed.\n\n### Conditional\n\nFRB supports the ternary conditional operator, if `?` then `:` else.\n\n```javascript\nvar object = Bindings.defineBindings({\n    condition: null,\n    consequent: 10,\n    alternate: 20\n}, {\n    choice: {"<->": "condition ? consequent : alternate"}\n});\n\nexpect(object.choice).toBe(undefined); // no choice made\n\nobject.condition = true;\nexpect(object.choice).toBe(10);\n\nobject.condition = false;\nexpect(object.choice).toBe(20);\n```\n\nThe ternary operator can bind in both directions.\n\n```javascript\nobject.choice = 30;\nexpect(object.alternate).toBe(30);\n\nobject.condition = true;\nobject.choice = 40;\nexpect(object.consequent).toBe(40);\n```\n\n### Algebra\n\nFRB can automatically invert algebraic operators as long as they operate\nstrictly on the left-most expressions on both the source and target are\nbindable properties.\n\nIn this example, the primary binding is ```notToBe <- !toBe```, and the\ninverse binding is automatically computed ```toBe <- !notToBe```.\n\n```javascript\nvar caesar = {toBe: false};\nbind(caesar, "notToBe", {"<->": "!toBe"});\nexpect(caesar.toBe).toEqual(false);\nexpect(caesar.notToBe).toEqual(true);\n\ncaesar.notToBe = false;\nexpect(caesar.toBe).toEqual(true);\n```\n\nFRB does algebra by rotating the expressions on one side of a binding to\nthe other until only one independent property remains (the left most\nexpression) on the target side of the equation.\n\n```\nconvert: y <- !x\nrevert: x <- !y\n```\n\n```\nconvert: y <- x + a\nrevert: x <- y - a\n```\n\nThe left-most independent variable on the right hand side becomes the\ndependent variable on the inverted binding.  At present, this only works\nfor numbers and when the left-most expression is a bindable property\nbecause it cannot assign a new value to the literal 10.  For example,\nFRB cannot yet implicitly revert ```y <-> 10 + x```.\n\n### Literals\n\nYou may have noticed literals in the previous examples.  String literals\ntake the form of any characters between single quotes.  Any character\ncan be escaped with a back slash.\n\n```javascript\nvar object = {};\nbind(object, "greeting", {"<-": "\'Hello, World!\'"});\nexpect(object.greeting).toBe("Hello, World!");\n```\n\nNumber literals are digits with an optional mantissa.\n\n```javascript\nbind(object, \'four\', {"<-": "2 + 2"});\n```\n\n### Tuples\n\nBindings can produce fixed-length arrays.  These are most useful in\nconjunction with mappings.  Tuples are comma-delimited and\nparantheses-enclosed.\n\n```javascript\nvar object = {array: [[1, 2, 3], [4, 5]]};\nbind(object, "summary", {"<-": "array.map{[length, sum()]}"});\nexpect(object.summary).toEqual([\n    [3, 6],\n    [2, 9]\n]);\n```\n\n### Records\n\nBindings can also produce fixed-shape objects.  The notation is\ncomma-delimited, colon-separated entries, enclosed by curly-braces.\n\n```javascript\nvar object = {array: [[1, 2, 3], [4, 5]]};\nbind(object, "summary", {\n    "<-": "array.map{{length: length, sum: sum()}}"\n});\nexpect(object.summary).toEqual([\n    {length: 3, sum: 6},\n    {length: 2, sum: 9}\n]);\n```\n\nThe left hand side of an entry in a record is any combination of letters\nor numbers.  The right side is any expression.\n\n### Parameters\n\nBindings can also involve parameters.  The source of parameters is by\ndefault the same as the source.  The source, in turn, defaults to the\nsame as the target object.  It can be specified on the binding\ndescriptor.  Parameters are declared by any expression following a\ndollar sign.\n\n```javascript\nvar object = {a: 10, b: 20, c: 30};\nbind(object, "foo", {\n    "<-": "[$a, $b, $c]"},\n    parameters: object\n});\n```\n\nBindings also react to changes to the parameters.\n\n```javascript\nobject.a = 0;\nobject.b = 1;\nobject.c = 2;\nexpect(object.foo).toEqual([0, 1, 2]);\n```\n\nThe degenerate case of the property language is an empty string.  This\nis a valid property path that observes the value itself.  So, as an\nemergent pattern, a `$` expression by itself corresponds to the whole\nparameters object.\n\n```javascript\nvar object = {};\nbind(object, "ten", {"<-": "$", parameters: 10});\nexpect(object.ten).toEqual(10);\n```\n\n### Elements and Components\n\nFRB provides a `#` notation for reaching into the DOM for an element.\nThis is handy for binding views and models on a controller object.\n\nThe `defineBindings` method accepts an optional final argument,\n`parameters`, which is shared by all bindings (unless shadowed by a more\nspecific parameters object on an individual descriptor).\n\nThe `parameters` can include a `document`.  The `document` may be any\nobject that implements `getElementById`.\n\nAdditionally, the `frb/dom` is an experiment that monkey-patches the DOM\nto make some properties of DOM elements observable, like the `value` or\n`checked` attribute of an `input` or `textarea element`.\n\n```javascript\nvar Bindings = require("frb");\nrequire("frb/dom");\n\nvar controller = Bindings.defineBindings({}, {\n\n    "fahrenheit": {"<->": "celsius * 1.8 + 32"},\n    "celsius": {"<->": "kelvin - 272.15"},\n\n    "#fahrenheit.value": {"<->": "+fahrenheit"},\n    "#celsius.value": {"<->": "+celsius"},\n    "#kelvin.value": {"<->": "+kelvin"}\n\n}, {\n    document: document\n});\n\ncontroller.celsius = 0;\n```\n\nOne caveat of this approach is that it can cause a lot of DOM repaint\nand reflow events.  The [Montage][] framework uses a synchronized draw\ncycle and a component object model to minimize the cost of computing CSS\nproperties on the DOM and performing repaints and reflows, deferring\nsuch operations to individual animation frames.\n\nFor a future release of Montage, FRB provides an alternate notation for\nreaching into the component object model, using its deserializer.  The\n`@` prefix refers to another component by its label.  Instead of\nproviding a `document`, Montage provides a `serialization`, which in\nturn implements `getObjectForLabel`.\n\n```javascript\nvar Bindings = require("frb");\n\nvar controller = Bindings.defineBindings({}, {\n\n    "fahrenheit": {"<->": "celsius * 1.8 + 32"},\n    "celsius": {"<->": "kelvin - 272.15"},\n\n    "@fahrenheit.value": {"<->": "+fahrenheit"},\n    "@celsius.value": {"<->": "+celsius"},\n    "@kelvin.value": {"<->": "+kelvin"}\n\n}, {\n    serializer: serializer\n});\n\ncontroller.celsius = 0;\n```\n\n### Observers\n\nFRB’s bindings use observers and binders internally.  You can create an\nobserver from a property path with the `observe` function exported by\nthe `frb/observe` module.\n\n```javascript\nvar results = [];\nvar object = {foo: {bar: 10}};\nvar cancel = observe(object, "foo.bar", function (value) {\n    results.push(value);\n});\n\nobject.foo.bar = 10;\nexpect(results).toEqual([10]);\n\nobject.foo.bar = 20;\nexpect(results).toEqual([10, 20]);\n```\n\nFor more complex cases, you can specify a descriptor instead of the\ncallback.  For example, to observe a property’s value *before it changes*, you can use the `beforeChange` flag.\n\n```javascript\nvar results = [];\nvar object = {foo: {bar: 10}};\nvar cancel = observe(object, "foo.bar", {\n    change: function (value) {\n        results.push(value);\n    },\n    beforeChange: true\n});\n\nexpect(results).toEqual([10]);\n\nobject.foo.bar = 20;\nexpect(results).toEqual([10, 10]);\n\nobject.foo.bar = 30;\nexpect(results).toEqual([10, 10, 20]);\n```\n\nIf the product of an observer is an array, that array is always updated\nincrementally.  It will only get emitted once.  If you want it to get\nemitted every time its content changes, you can use the `contentChange`\nflag.\n\n```javascript\nvar lastResult;\nvar array = [[1, 2, 3], [4, 5, 6]];\nobserve(array, "map{sum()}", {\n    change: function (sums) {\n        lastResult = sums.slice();\n        // 1. [6, 15]\n        // 2. [6, 15, 0]\n        // 3. [10, 15, 0]\n    },\n    contentChange: true\n});\n\nexpect(lastResult).toEqual([6, 15]);\n\narray.push([0]);\nexpect(lastResult).toEqual([6, 15, 0]);\n\narray[0].push(4);\nexpect(lastResult).toEqual([10, 15, 0]);\n```\n\n### Nested Observers\n\nTo get the same effect as the previous example, you would have to nest\nyour own content change observer.\n\n```javascript\nvar i = 0;\nvar array = [[1, 2, 3], [4, 5, 6]];\nvar cancel = observe(array, "map{sum()}", function (array) {\n    function contentChange() {\n        if (i === 0) {\n            expect(array.slice()).toEqual([6, 15]);\n        } else if (i === 1) {\n            expect(array.slice()).toEqual([6, 15, 0]);\n        } else if (i === 2) {\n            expect(array.slice()).toEqual([10, 15, 0]);\n        }\n        i++;\n    }\n    contentChange();\n    array.addContentChangeListener(contentChange);\n    return function cancelContentChange() {\n        array.removeContentChangeListener(contentChange);\n    };\n});\narray.push([0]);\narray[0].push(4);\ncancel();\n```\n\nThis illustrates one crucial aspect of the architecture.  Observers\nreturn cancelation functions.  You can also return a cancelation\nfunction inside a callback observer.  That canceler will get called each\ntime a new value is observed, or when the parent observer is canceled.\nThis makes it possible to nest observers.\n\n```javascript\nvar object = {foo: {bar: 10}};\nvar cancel = observe(object, "foo", function (foo) {\n    return observe(foo, "bar", function (bar) {\n        expect(bar).toBe(10);\n    });\n});\n```\n\n### Bindings\n\nFRB provides utilities for declaraing and managing multiple bindings on\nobjects.  The `frb` (`frb/bindings`) module exports this interface.\n\n```javascript\nvar Bindings = require("frb");\n```\n\nThe `Bindings` module provides `defineBindings` and `cancelBindings`,\n`defineBinding` and `cancelBinding`, as well as binding inspector\nmethods `getBindings` and `getBinding`.  All of these take a target\nobject as the first argument.\n\nThe `Bindings.defineBinding(target, descriptors)` method returns the\ntarget object for convenience.\n\n```javascript\nvar target = Bindings.defineBindings({}, {\n    "fahrenheit": {"<->": "celsius * 1.8 + 32"},\n    "celsius": {"<->": "kelvin - 272.15"}\n});\ntarget.celsius = 0;\nexpect(target.fahrenheit).toEqual(32);\nexpect(target.kelvin).toEqual(272.15);\n```\n\n`Bindings.getBindings` in that case would return an object with\n`fahrenheit` and `celsius` keys.  The values would be identical to the\ngiven binding descriptor objects, like `{"<->": "kelvin - 272.15"}`, but\nit also gets annotated with a `cancel` function and the default values\nfor any ommitted properties like `source` (same as `target`),\n`parameters` (same as `source`), and others.\n\n`Bindings.cancelBindings` cancels all bindings attached to an object and\nremoves them from the bindings descriptors object.\n\n```javascript\nBindings.cancelBindings(target);\nexpect(Bindings.getBindings(object)).toEqual({});\n```\n\n### Binding Descriptors\n\nBinding descriptors describe the source of a binding and additional\nparameters.  `Bindings.defineBindings` can set up bindings (```<-``` or\n```<->```), computed (```compute```) properties, and falls back to\ndefining ES5 properties with permissive defaults (`enumerable`,\n`writable`, and `configurable` all on by default).\n\nIf a descriptor has a ```<-``` or ```<->```, it is a binding descriptor.\nFRB creates a binding, adds the canceler to the descriptor, and adds the\ndescriptor to an internal table that tracks all of the bindings defined\non that object.\n\n```javascript\nvar object = Bindings.defineBindings({\n    darkMode: false,\n    document: document\n}, {\n    "document.body.classList.has(\'dark\')": {\n        "<-": "darkMode"\n    }\n});\n```\n\nYou can get all the binding descriptors with `Bindings.getBindings`, or a\nsingle binding descriptor with `Bindings.getBinding`.  `Bindings.cancel` cancels\nall the bindings to an object and `Bindings.cancelBinding` will cancel just\none.\n\n```javascript\n// Continued from above...\nvar bindings = Bindings.getBindings(object);\nvar descriptor = Bindings.getBinding(object, "document.body.classList.has(\'dark\')");\nBindings.cancelBinding(object, "document.body.classList.has(\'dark\')");\nBindings.cancelBindings(object);\nexpect(Object.keys(bindings)).toEqual([]);\n```\n\n### Converters\n\nA binding descriptor can have a `convert` function, a `revert` function,\nor alternately a `converter` object.  Converters are useful for\ntransformations that cannot be expressed in the property language, or\nare not reversible in the property language.\n\nIn this example, `a` and `b` are synchronized such that `a` is always\nhalf of `b`, regardless of which property gets updated.\n\n```javascript\nvar object = Bindings.defineBindings({\n    a: 10\n}, {\n    b: {\n        "<->": "a",\n        convert: function (a) {\n            return a * 2;\n        },\n        revert: function (b) {\n            return b / 2;\n        }\n    }\n});\nexpect(object.b).toEqual(20);\n\nobject.b = 10;\nexpect(object.a).toEqual(5);\n```\n\nConverter objects are useful for reusable or modular converter types and\nconverters that track additional state.\n\n```javascript\nfunction Multiplier(factor) {\n    this.factor = factor;\n}\nMultiplier.prototype.convert = function (value) {\n    return value * this.factor;\n};\nMultiplier.prototype.revert = function (value) {\n    return value / this.factor;\n};\n\nvar doubler = new Multiplier(2);\n\nvar object = Bindings.defineBindings({\n    a: 10\n}, {\n    b: {\n        "<->": "a",\n        converter: doubler\n    }\n});\nexpect(object.b).toEqual(20);\n\nobject.b = 10;\nexpect(object.a).toEqual(5);\n```\n\nReusable converters have an implied direction, from some source type to\na particular target type.  Sometimes the types on your binding are the\nother way around.  For that case, you can use the converter as a\nreverter.  This merely swaps the `convert` and `revert` methods.\n\n```javascript\nvar uriConverter = {\n    convert: encodeURI,\n    revert: decodeURI\n};\nvar model = Bindings.defineBindings({}, {\n    "title": {\n        "<->": "location",\n        reverter: uriConverter\n    }\n});\n\nmodel.title = "Hello, World!";\nexpect(model.location).toEqual("Hello,%20World!");\n\nmodel.location = "Hello,%20Dave.";\nexpect(model.title).toEqual("Hello, Dave.");\n```\n\n### Computed Properties\n\nA computed property is one that gets updated with a function call when\none of its arguments changes.  Like a converter, it is useful in cases\nwhere a transformation or computation cannot be expressed in the\nproperty language, but can additionally accept multiple arguments as\ninput.  A computed property can be used as the source for another\nbinding.\n\nIn this example, we create an object as the root of multiple bindings.\nThe object synchronizes the properties of a "form" object with the\nwindow’s search string, effectively navigating to a new page whenever\nthe "q" or "charset" values of the form change.\n\n```javascript\nBindings.defineBindings({\n    window: window,\n    form: {\n        q: "",\n        charset: "utf-8"\n    }\n}, {\n    queryString: {\n        args: ["form.q", "form.charset"],\n        compute: function (q, charset) {\n            return "?" + QS.stringify({\n                q: q,\n                charset: charset\n            });\n        }\n    },\n    "window.location.search": {\n        "<-": "queryString"\n    }\n});\n```\n\n### Debugging with Traces\n\nA binding can be configured to log when it changes and why.  The `trace`\nproperty on a descriptor instructs the binder to log changes to the\nconsole.\n\n```javascript\nBindings.defineBindings({\n    a: 10\n}, {\n    b: {\n        "<-": "a + 1",\n    }\n});\n```\n\n\n## Reference\n\nFunctional Reactive Bindings is an implementation of synchronous,\nincremental object-property and collection-content bindings for\nJavaScript.  It was ripped from the heart of the [Montage][] web\napplication framework and beaten into this new, slightly magical form.\nIt must prove itself worthy before it can return.\n\n-   **functional**: The implementation uses functional building blocks\n    to compose observers and binders.\n-   **generic**: The implementation uses generic methods on collections,\n    like `addContentChangeListener`, so any object can implement the\n    same interface and be used in a binding.\n-   **reactive**: The values of properties and contents of collections\n    react to changes in the objects and collections on which they\n    depend.\n-   **synchronous**: All bindings are made consistent in the statement\n    that causes the change.  The alternative is asynchronous, where\n    changes are queued up and consistency is restored in a later event.\n-   **incremental**: If you update an array, it produces a content\n    change which contains the values you added, removed, and the\n    location of the change.  Most bindings can be updated using only\n    these values.  For example, a sum is updated by decreasing by the\n    sum of the values removed, and increasing by the sum of the values\n    added.  FRB can incrementally update `map`, `reversed`, `flatten`,\n    `sum`, and `average` observers.  It can also incrementally update\n    `has` bindings.\n-   **unwrapped**: Rather than wrap objects and arrays with observable\n    containers, FRB modifies existing arrays and objects to make them\n    dispatch property and content changes.  For objects, this involves\n    installing getters and setters using the ES5 `Object.defineProperty`\n    method.  For arrays, this involves replacing all of the mutation\n    methods, like `push` and `pop`, with variants that dispatch change\n    notifications.  The methods are either replaced by swapping the\n    `__proto__` or adding the methods to the instance with\n    `Object.defineProperties`.  These techniques should [work][Define\n    Property] starting in Internet Explorer 9, Firefox 4, Safari 5,\n    Chrome 7, and Opera 12.\n\n\n### Architecture\n\n-   [Collections][] provides **property, mapped content, and ranged\n    content change events** for objects, arrays, and other collections.\n    For objects, this adds a property descriptor to the observed object.\n    For arrays, this either swaps the prototype or mixes methods into\n    the array so that all methods dispatch change events.  \n    Caveats: you have to use a `set` method on Arrays to dispatch\n    property and content change events.  Does not work in older Internet\n    Explorers since they support neither prototype assignment or ES5\n    property setters.\n-   **observer** functions for watching an entire object graph for\n    incremental changes, and gracefully rearranging and canceling those\n    observers as the graph changes.  Observers can be constructed\n    directly or with a very small query language that compiles to a tree\n    of functions so no parsing occurs while the graph is being watched.\n-   one- and two-way **bindings** using binder and obserer functions to\n    incrementally update objects.\n-   **declarative** interface for creating an object graph with\n    bindings, properties, and computed properties with dependencies.\n\n\n### Bindings\n\nThe highest level interface for FRB resembles the ES5 Object constructor\nand can be used to declare objects and define and cancel bindings on\nthem with extended property descriptors.\n\n```javascript\nvar Bindings = require("frb");\n\n// create an object\nvar object = Bindings.defineBindings({\n    foo: 0,\n    graph: [\n        {numbers: [1,2,3]},\n        {numbers: [4,5,6]}\n    ]\n}, {\n    bar: {"<->": "foo", enumerable: false},\n    numbers: {"<-": "graph.map{numbers}.flatten()"},\n    sum: {"<-": "numbers.sum()"},\n    reversed: {"<-": "numbers.reversed()"}\n});\n\nexpect(object.bar).toEqual(object.foo);\nobject.bar = 10;\nexpect(object.bar).toEqual(object.foo);\nexpect.foo = 20;\nexpect(object.bar).toEqual(object.foo);\n\n// note that the identity of the bound numbers array never\n// changes, because all of the changes to that array are\n// incrementally updated\nvar numbers = object.numbers;\n\n// first computation\nexpect(object.sum).toEqual(21);\n\n// adds an element to graph,\n// which pushes [7, 8, 9] to "graph.map{numbers}",\n// which splices [7, 8, 9] to the end of\n//  "graph.map{numbers}.flatten()",\n// which increments "sum()" by [7, 8, 9].sum()\nobject.graph.push({numbers: [7, 8, 9]});\nexpect(object.sum).toEqual(45);\n\n// splices [1] to the beginning of [1, 2, 3],\n// which splices [1] to the beginning of "...flatten()"\n// which increments "sum()" by [1].sum()\nobject.graph[0].numbers.unshift(1);\nexpect(object.sum).toEqual(46);\n\n// cancels the entire observer hierarchy, then attaches\n//  listeners to the new one.  updates the sum.\nobject.graph = [{numbers: [1,2,3]}];\nexpect(object.sum).toEqual(6);\n\nexpect(object.reversed).toEqual([3, 2, 1]);\n\nexpect(object.numbers).toBe(numbers) // still the same object\n\nBindings.cancelBindings(object); // cancels all bindings on this object and\n// their transitive observers and event listeners as deep as\n// they go\n```\n\n-   `Bindings.defineBindings(object, name, descriptor)`\n-   `Bindings.defineBinding(object, name, descriptor)`\n-   `Bindings.getBindings(object)`\n-   `Bindings.getBinding(object, name)`\n-   `Bindings.cancelBindings(object)`\n-   `Bindings.cancelBinding(object, name)`\n\nA binding descriptor contains:\n\n-   `target`: the\n-   `targetPath`: the target\n-   `targetSyntax`: the syntax tree for the target path\n-   `source`: the source object, which defaults to `target`\n-   `sourcePath`: the source path, from either ```<-``` or ```<->```\n-   `sourceSyntax`: the syntax tree for the source path\n-   `twoWay`: whether the binding goes in both directions, if ```<->```\n    was the source path.\n-   `parameters`: the parameters, which default to `source`.\n-   `convert`: a function that converts the source value to the target\n    value, useful for coercing strings to dates, for example.\n-   `revert`: a function that converts the target value to the source\n    value, useful for two-way bindings.\n-   `converter`: an object with `convert` and optionally also a `revert`\n    method.  The implementation binds these methods to their converter\n    and stores them in `covert` and `revert`.\n-   `serializable`: a note from the Montage Deserializer, to the [Montage\n    Serializer][], indicating that the binding came from a\n    serialization, and to a serialization it must return.\n-   `cancel`: a function to cancel the binding\n\n[Montage Serializer]: https://github.com/montagejs/mousse\n\n### Bind\n\nThe `bind` module provides direct access to the `bind` function.\n\n```javascript\nvar bind = require("frb/bind");\n\nvar source = [{numbers: [1,2,3]}, {numbers: [4,5,6]}];\nvar target = {};\nvar cancel = bind(target, "summary", {\n    "<-": "map{[numbers.sum(), numbers.average()]}",\n    source: source\n});\n\nexpect(target.summary).toEqual([\n    [6, 2],\n    [15, 5]\n]);\n\ncancel();\n```\n\n`bind` is built on top of `parse`, `compileBinder`, and\n`compileObserver`.\n\n### Compute\n\nThe `compute` module provides direct access to the `compute` function,\nused by `Bindings` to make computed properties.\n\n```javascript\nvar compute = require("frb/compute");\n\nvar source = {operands: [10, 20]};\nvar target = {};\nvar cancel = compute(target, "sum", {\n    source: source,\n    args: ["operands.0", "operands.1"],\n    compute: function (a, b) {\n        return a + b;\n    }\n});\n\nexpect(target.sum).toEqual(30);\n\n// change one operand\nsource.operands.set(1, 30); // needed to dispatch change notification\nexpect(target.sum).toEqual(40);\n```\n\n### Observe\n\nThe `observe` modules provides direct access to the `observe` function.\n`observe` is built on top of `parse` and `compileObserver`.\n`compileObserver` creates a tree of observers using the methods in the\n`observers` module.\n\n```javascript\nvar observe = require("frb/observe");\n\nvar source = [1, 2, 3];\nvar sum;\nvar cancel = observe(source, "sum()", function (newSum) {\n    sum = newSum;\n});\n\nexpect(sum).toBe(6);\n\nsource.push(4);\nexpect(sum).toBe(10);\n\nsource.unshift(0); // no change\nexpect(sum).toBe(10);\n\ncancel();\nsource.splice(0, source.length); // would change\nexpect(sum).toBe(10);\n```\n\n`observe` produces a cancelation hierarchy.  Each time a value is\nremoved from an array, the underlying observers are canceled.  Each time\na property is replaced, the underlying observer is canceled.  When new\nvalues are added or replaced, the observer produces a new canceler.  The\ncancel function returned by `observe` commands the entire underlying\ntree.\n\nObservers also optional accept a descriptor argument in place of a\ncallback.\n\n-   `set`: the change handler, receives `value` for most observers, but\n    also `key` and `object` for property changes.\n-   `parameters`: the value for `$` expressions.\n-   `beforeChange`: instructs an observer to emit the previous value\n    before a change occurs.\n-   `contentChange`: instructs an observer to emit an array every time\n    its content changes.  By default, arrays are only emitted once.\n\n```javascript\nvar object = {};\nvar cancel = observe(object, "array", {\n    change: function (value) {\n        // may return a cancel function for a nested observer\n    },\n    parameters: {},\n    beforeChange: false,\n    contentChange: true\n});\n\nobject.array = []; // emits []\nobject.array.push(10); // emits [10]\n```\n\n### Evaluate\n\nThe `compile-evaluator` module returns a function that accepts a syntax\ntree and returns an evaluator function.  The evaluator accepts a scope\n(which may include a value, parent scope, parameters, a document, and\ncomponents) and returns the corresponding value without all the cost or\nbenefit of setting up incremental observers.\n\n```javascript\nvar parse = require("frb/parse");\nvar compile = require("frb/compile-evaluator");\nvar Scope = require("frb/scope");\n\nvar syntax = parse("a.b");\nvar evaluate = compile(syntax);\nvar c = evaluate(new Scope({a: {b: 10}}))\nexpect(c).toBe(10);\n```\n\nThe `evaluate` module returns a function that accepts a path or syntax\ntree, a source value, and parameters and returns the corresponding\nvalue.\n\n```javascript\nvar evaluate = require("frb/evaluate");\nvar c = evaluate("a.b", {a: {b: 10}})\nexpect(c).toBe(10);\n```\n\n\n### Stringify\n\nThe `stringify` module returns a function that accepts a syntax tree and\nreturns the corresponding path in normal form.\n\n```javascript\nvar stringify = require("frb/stringify");\n\nvar syntax = {type: "and", args: [\n    {type: "property", args: [\n        {type: "value"},\n        {type: "literal", value: "a"}\n    ]},\n    {type: "property", args: [\n        {type: "value"},\n        {type: "literal", value: "b"}\n    ]}\n]};\n\nvar path = stringify(syntax);\nexpect(path).toBe("a && b");\n```\n\n\n### Grammar\n\n-   **expression** = **logical-or-expression**\n-   **conditional-expression** = **logical-or-expression** ( `?`\n    **expression** `:` **expression** )?\n-   **logical-or-expression** = **logical-and-expression** ( `||` *(or)*\n    **relation expression** )?\n-   **logical-and-expression** = **relation-expression** ( `&&` *(and)*\n    **relation-expression** )?\n-   **relation-expression** = **arithmetic expression** (\n    **relation-operator** **arithmetic-expression** )?\n    -   **relation-operator** = `==` *(equals)* or ```<``` *(lt)* or\n        ```<=``` *(le)* or ```>``` *(gt)* or ```>=``` *(ge)* or\n        ```<=>``` *(compare)*\n-   **arithmetic-expression** = **multiplicative-expresion** delimited by **arithmetic-operator**\n    -   **arithmetic-operator** = `+` *(add)* or `-` *(sub)*\n-   **multiplicative-expression** = **exponential-expression**\n    delimited by **multiplicative-operator**\n    -   **multiplicative-operator** = `*` *(mul)* or `/` *(div)* or\n        `%` *(mod)* or `rem` *(rem)*\n-   **exponential-expression** = **unary-expression** delimited by\n    **exponential-operator**\n    -   **exponential-operator** = `**` *(pow)* or `//` *(root)* or\n        `%%` *(log)*\n-   **unary-expression** = **unary-operator** ? **path-expression**\n    -   **unary-operator** = `+` *(number)* or `-` *(neg)* or `!` *(not)*\n-   **path-expression** =\n    -   **literal** *(literal with value)* or\n    -   **array-expression** *(tuple)* or\n    -   **object-expression** *(record)* or\n    -   `(` **expression** `)` **tail-expression** or\n    -   **property-name** **tail-expression** *(property)* or\n    -   **function-call** *(piped)* **tail-expression** or\n    -   **block-call** **tail-expression** or\n    -   `#` **element-id** **tail-expression** *(element by id)* or\n    -   `@` **component-label** **tail-expression** *(component by label)*\n    -   `&` **function-call** *(bare)* **tail-expression** or\n-   **tail-expression** =\n    -   **property-expression** or\n    -   **with-expression** or\n    -   **variable-property-expression**\n-   **property-expression** = `.` **property-name** **tail-expression**\n    *(property)*\n-   **with-expression** = `.`\n    -   `(` **expression** `)` **tail-expression** or\n    -   **array-expression** **tail-expression** or\n    -   **object-expression** **tail-expression**\n-   **variable-property-expression** = `[` **expression** `]`\n    **tail-expression** *(property)*\n-   **array-expression** = `[` ( **expression** or `()` *(value)* )\n    delimited by `,` `]` *(tuple with each expression in args array)*\n-   **object-expression** = `{` (**property-name** `:` **expression**)\n    delimited by `,` `}` *(record, with each expression as a value in an\n    args object instead of array)*\n-   **property-name** = ( **non-space-character** )+\n-   **function-call** = **function-name** `(` **expression** delimited\n    by `,` `)`\n    -   **function-name** = `flatten` or `reversed` or `enumerate` or\n        `sum` or `average` or `has` or `view` or `startsWith` or\n        `endsWith` or `contains` or `join` or `split` or `range` or\n        `keys` or `values` or `entries` *(eponymous syntax node types)*\n-   **block-call** = **function-name** `{` **expression** `}`\n    -   **block-name** = `map` *(mapBlock)* or `filter` *(filterBlock)*\n        or `some` *(someBlock)* or `every` *(everyBlock)* or `sorted`\n        *(sortedBlock)* or `sortedSet` *(sortedSetBlock)* or `min`\n        *(minBlock)* or `max` *(maxBlock)* or `group` *(groupBlock)* or\n        `groupMap` *(groupMapBlock)* or **function-name** *(map followed\n        by function-call)*\n-   **literal** = **string-literal** or **number-literal**\n    -   **number-literal** = **digits** ( `.` **digits** )? *(literal\n        and value is a number)*\n    -   **string-literal** = `\'` ( **non-quote-character** or `\\`\n        **character** ) `\'` *(literal and value is a string)*\n\nLegend:\n\n-   **terms-of-the-grammar**\n-   `tokens`\n-   *(corresponding syntax node type name)*\n-   (group)\n-   definition =\n-   or\n-   delimited by\n-   optional?\n-   any*\n-   some+\n\n### Semantics\n\nAn expression is observed with a source value and emits a target\none or more times.  All expressions emit an initial value.  Array\ntargets are always updated incrementally.  Numbers and boolean are\nemited anew each time their value changes.\n\nIf any operand is `null` or `undefine`, a binding will not emit an\nupdate.  Thus, if a binding’s source becomes invalid, it does not\ncorrupt its target but waits until a valid replacement becomes\navailable.\n\n-   Literals are interpreted as their corresponding value.\n-   Value terms provide the source.\n-   Parameters terms provide the parameters.\n-   In a path-expression, the first term is evaluated with the source\n    value.\n-   Each subsequent term of a path expression uses the target of the\n    previous as its source.\n-   A property-expression or variable-property-expression observes the\n    key of the source object using `Object.addPropertyChangeListener`.\n-   An element identifier (with the `#` prefix) uses the `document`\n    property of the `parameters` object and emits\n    `document.getElementById(id)`, or dies trying.  Changes to the\n    document are not observed.\n-   A component label (with the `@` prefix) uses the `serialization`\n    property of `parameters` object and emits\n    `serialization.getObjectForLable(label)`, or dies trying.  Changes\n    to the serialization are not observed.  This syntax exists to\n    support [Montage][] serializations.\n-   A "map" block observes the source array and emits a target array.\n    The target array is emitted once and all subsequent updates are\n    reflected as content changes that can be independently observed with\n    `addContentChangeListener`.  Each element of the target array\n    corresponds to the observed value of the block expression using the\n    respective element in the source array as the source value.\n-   A "map" function call receives a function as its argument rather\n    than a block.\n-   A "filter" block observes the source array and emits a target array\n    containing only those values from the source array that actively\n    pass the predicate described in the block expression useing the\n    respective element in the source array as the source value.  As with\n    "map", filters update the target array incrementally.\n-   A "some" block observes whether any of the values in the source\n    collection meet the given criterion.\n-   A "every" block observes whether all of the values in the source\n    collection meet the given criterion.\n-   A "sorted" block observes the sorted version of an array, by a\n    property of each value described in the block, or itself if empty.\n    Sorted arrays are incrementally updating as values are added and\n    deleted from the source.\n-   A "sortedSet" block observes a collection that emits range change\n    events, by way of a property of each value described in the block,\n    or itself if empty, emitting a `SortedSet` value exactly once.  If\n    the input is or becomes invalid, the sorted set is cleared, not\n    replaced.  The sorted set will always contain the last of each group\n    of equivalant values from the input.\n-   A "min" block observes the which of the values in a given collection\n    produces the smallest value through the given relation.\n-   A "max" block observes the which of the values in a given collection\n    produces the largest value through the given relation.\n-   A "group" block observes which values belong to corresponding\n    equivalence classes as determined by the result of a given\n    expression on each value.  The observer is responsible for adding\n    and removing classes as they are populated and depopulated.  Each\n    class tracks the key (result of the block expression for every\n    member of a class), and an the values of the corresponding class as\n    an array.  Values are added to the end of each array as they are\n    discovered.\n-   Any function call with a "block" implies calling the function on the\n    result of a "map" block.\n-   A "flatten" function call observes a source array and produces a\n    target array.  The source array must only contain inner arrays.  The\n    target array is emitted once and all subsequent updates can be\n    independently observed with `addContentChangeListener`.  The target\n    array will always contain the concatenation of all of the source\n    arrays.  Changes to the inner and outer source arrays are reflected\n    with incremental splices to the target array in their corresponding\n    positions.\n-   A "reversed" function call observes the source array and produces a\n    target array that contains the elements of the source array in\n    reverse order.  The target is incrementally updated.\n-   An "enumerate" expression observes [key, value] pairs from an array.\n    The output array of arrays is incrementally updated with range\n    changes from the source.\n-   A "view" function call observes a sliding window from the source,\n    from a start index (first argument) of a certain length (second\n    argument).  The source can be any collection that dispatches range\n    changes and the output will be an array of the given length.\n-   A "sum" function call observes the numeric sum of the source array.\n    Each alteration to the source array causes a new sum to be emitted,\n    but the sum is computed incrementally by observing the smaller sums\n    of the spliced values, added and removed.\n-   An "average" function call observes the average of the input values,\n    much like "sum".\n-   A "has" function call observes the source collection for whether it\n    contains an observed value.\n-   A "tuple" expression observes a source value and emits a single\n    target array with elements corresponding to the respective\n    expression in the tuple.  Each inner expression is evaluated with\n    the same source value as the outer expression.\n-   A "startsWith" function call observes whether the left string\n    starts with the right string.\n-   An "endsWith" function call observes whether the right string\n    ends with the right string.\n-   A "contains" function call observes whether the left string contains\n    the right string.\n-   A "join" function observes the left array joined by the right\n    delimiter, or an empty string.   This is not an incremental\n    operation.\n-   A "split" function observes the left string broken into an array\n    between the right delimiter, or an empty string.  This is not an\n    incremental operation.\n-   A "range" function call observes an array with the given length\n    containing sequential numbers starting with zero.  The output array\n    is updated incrementally and will dispatch one range change each\n    time the size changes by any difference.\n-   A "keys" function call observes an incrementally updated array of\n    the keys that a given map contains.  The keys are maintained in\n    insertion order.\n-   A "values" function call observes an incrementally updated array of\n    the values that a given map contains.  The values are maintained in\n    insertion order.\n-   An "entries" function call observes an incrementally updated array\n    of [key, value] pairs from a given mapping.  The entries are\n    retained in insertion order.\n\nUnary operators:\n\n-   "number" coerces the value to a number.\n-   "neg" converts a number to its negative.\n-   "not" converts a boolean to its logical opposite.\n\nBinary operators:\n\n-   "add" adds the left to the right\n-   "sub" subtracts the right from the left\n-   "mul" multiples the left to the right\n-   "div" divides the left by the right\n-   "mod" produces the left modula the right.  This is proper modula,\n    meaning a negative number that does not divide evenly into a\n    positive number will produce the difference between that number and\n    the next evenly divisible number in direction of negative infinity.\n-   "rem" produces the remainder of dividing the left by the right.  If\n    the left does not divide evenly into the right it will produce the\n    difference between that number and the next evenly divisible number\n    in the direction of zero.  That is to say, `rem` can produce\n    negative numbers.\n-   "pow" raises the left to the power of the right.\n-   "root" produces the "righth" root of the left.\n-   "log" produces the logarithm of the left on the right base.\n-   "lt" less than, as determined with `Object.compare(left, right) <\n    0`.\n-   "le" less than or equal, as determined with `Object.compare(left,\n    right) <= 0`.\n-   "gt" greater than, as determined with `Object.compare(left, right) >\n    0`.\n-   "ge" greater than or equal, as determined with `Object.compare(left,\n    right) >= 0`.\n-   "compare" as determined by `Object.compare(left, right)`.\n-   "equals" whether the left is equal to the right as determined by\n    `Object.equals(left, right)`.\n-   *Note: there is no "not equals" syntax node. The `!=` operator gets\n    converted into a "not" node around an "equals" node.\n-   "and" logical union\n-   "or" logical intersection\n\nTernary operator:\n\n-   "if" observes the condition (first argument, expression before the\n    `?`).  If the expression is true, the result observes the consequent\n    expression (second argument, between the question mark and the\n    colon), and if it is false, the result observes the alternate (the\n    third argument, after the colon).  If the condition is null or\n    undefined, the result is null or undefined.\n\nOn the left hand side of a binding, the last term has alternate\nsemantics.  Binders receive a target as well as a source.\n\n-   A "property" observes an object and a property name from the target,\n    and a value from the source.  When any of these change, the binder\n    upates the value for the property name of the object.\n-   A "get" observes a collection and a key from the target, and a value\n    from the source.  When any of these change, the binder updates the\n    value for the key on the collection using `collection.set(key,\n    value)`.  This is suitable for arrays and custom map\n    [Collections][].\n-   A "equals" expression observes a boolean value from the source.  If\n    that boolean becomes true, the equality expression is made true by\n    assigning the right expression to the left property of the equality,\n    turning the "equals" into an "assign" conceptually.  No action is\n    taken if the boolean becomes false.\n-   A "reversed" expression observes an indexed collection and maintains\n    a mirror array of that collection.\n-   A "has" function call observes a boolean value from the source, and\n    an collection and a sought value from the target.  When the value is\n    true and the value is absent in the collection, the binder uses the\n    `add` method of the collection (provided by a shim for arrays) to\n    make it true that the collection contains the sought value.  When\n    the value is false and the value does appear in the collection one\n    or more times, the binder uses the `delete` or `remove` method of\n    the collection to remove all occurrences of the sought value.\n-   An "if" binding observes the condition and binds the target either\n    to the consequent or alternate.  If the condition is null or\n    undefined, the target is not bound.\n\nIf the target expression ends with `.*`, the content of the target is\nbound instead of the property.  This is useful for binding the content\nof a non-array collection to the content of another indexed collection.\nThe collection can be any collection that implements the "observable\ncontent" interface including `dispatchContentChange(plus, minus,\nindex)`, `addContentChangeListener`, and `removeContentChangeListener`.\n\n### Language Interface\n\n```javascript\nvar parse = require("frb/parse");\nvar compileObserver = require("frb/compile-observer");\nvar compileBinder = require("frb/compile-binder");\n```\n\n-   `parse(text)` returns a syntax tree.\n-   `compileObserver(syntax)` returns an observer function of the form\n    `observe(callback, source, parameters)` which in turn returns a\n    `cancel()` function.  `compileObserver` visits the syntax tree and\n    creates functions for each node, using the `observers` module.\n-   `compileBinder(syntax)` returns a binder function of the form\n    `bind(observeValue, source, target, parameters)` which in turn\n    returns a `cancel()` function.  `compileBinder` visits the root node\n    of the syntax tree and delegates to `compileObserver` for its terms.\n    The root node must be a `property` at this time, but could\n    conceivably be any function with a clear inverse operation like\n    `map` and `reversed`.\n\n### Syntax Tree\n\nThe syntax tree is JSON serializable and has a "type" property.  Nodes\nhave the following types:\n\n-   `value` corresponds to observing the source value\n-   `parameters` corresponds to observing the parameters object\n-   `literal` has a `value` property and observes that value\n-   `element` has an `id` property and observes an element from the\n    `parameters.document`, by way of `getElementById`.\n-   `component` has a `label` property and observes a component from the\n    `parameters.serialization`, by way of `getObjectForLabel`.  This\n    feature support\'s [Montage][]’s serialization format.\n\nAll other node types have an "args" property that is an array of syntax\nnodes (or an "args" object for `record`).\n\n-   `property`: corresponds to observing a property named by the right\n    argument of the left argument.\n-   `get`: corresponds to observing the value for a key (second\n    argument) in a collection (first argument).\n-   `with`: corresponds to observing the right expression using the left\n    expression as the source.\n-   `has`: corresponds to whether the key (second argument) exists\n    within a collection (first argument)\n-   `mapBlock`: the left is the input, the right is an expression to\n    observe on each element of the input.\n-   `filterBlock`: the left is the input, the right is an expression to\n    determine whether the result is included in the output.\n-   `someBlock`: the left is the input, the right is a criterion.\n-   `everyBlock`: the left is the input, the right is a criterion.\n-   `sortedBlock`: the left is the input, the right is a relation on\n    each value of the input on which to compare to determine the order.\n-   `sortedSetBlock`: differs only in semantics from `sortedBlock`.\n-   `minBlock`: the left is the input, the right is a relation on each\n    value of the input by which to compare the value to others.\n-   `maxBlock`: the left is the input, the right is a relation on each\n    value of the input by which to compare the value to others.\n-   `groupBlock`: the left is the input, the right is an expression that\n    provides the key for an equivalence class for each value in the\n    input.  The output is an array of entries, `[key, class]`, with the\n    shared key of every value in the equivalence class.\n-   `groupMapBlock`: has the same input semantics as `groupBlock`, but\n    the output is a `Map` instance instead of an array of entries.\n-   `tuple`: has any number of arguments, each an expression to observe\n    in terms of the source value.\n-   `record`: as an args object. The keys are property names for the\n    resulting object, and the values are the corresponding syntax nodes\n    for the values.\n-   `view`: the arguments are the input, the start position, and the\n    length of the sliding window to view from the input.  The input may\n    correspond to any ranged content collection, like an array or sorted\n    set.\n-   `rangeContent`: corresponds to the content of an ordered collection\n    that can dispatch indexed range changes like an array or sorted set.\n    This indicates to a binder that it should replace the content of the\n    target instead of replacing the target property with the observed\n    content of the source.  A range content node has no effect on the\n    source.\n-   `mapContent`: corresponds to the content of a map-like collection\n    including arrays and all map [Collections][].  These collections\n    dispatch map changes, which create, read, update, or delete\n    key-to-value pairs.  This indicates to a binder to replace the\n    content of the target map-like collection with the observed content\n    of the source, instead of replacing the target collection.  A map\n    change node on the source side just passes the collection forward\n    without alteration.\n\nFor all operators, the "args" property are operands.  The node types for\nunary operators are:\n\n-   ```+```: `number`, arithmetic coercion\n-   ```-```: `neg`, arithmetic negation\n-   ```!```: `not`, logical negation\n\nFor all binary operators, the node types are:\n\n-   ```**```: `pow`, exponential power\n-   ```//```: `root`, of 2 square root, of 3 cube root, etc\n-   ```%%```: `log`, logarithm with base\n-   ```*```: `mul`, multiplication\n-   ```/```: `div`, division\n-   ```%```: `mod`, modulo (toward negative infinity, always positive)\n-   ```rem```: `rem`, remainder (toward zero, negative if negative)\n-   ```+```: `add`, addition\n-   ```-```: `sub`, subtraction\n-   ```<```: `lt`, less than\n-   ```<=```: `le`, less than or equal\n-   ```>```: `gt`, greater than\n-   ```>=```: `ge`, greater than or equal\n-   ```<=>```: `compare`\n-   ```==```: ``equals``, equality comparison and assignment\n-   ```!=``` produces unary negation and equality comparison or\n    assignment so does not have a corresponding node type.  The\n    simplification makes it easier to rotate the syntax tree\n    algebraically.\n-   ```&&```, `and`, logical and\n-   ```||```, `or`, logical or\n\nFor the ternary operator:\n\n-   ```?``` and ```:```: `if`, ternary conditional\n\nFor all function calls, the right hand side is a tuple of arguments.\n\n-   `reversed`\n-   `enumerate`\n-   `flatten`\n-   `sum`\n-   `average`\n-   `startsWith`\n-   `endsWith`\n-   `contains`\n-   `join`\n-   `split`\n-   `range`\n-   `keys`\n-   `values`\n-   `entries`\n\n\n### Observers and Binders\n\nThe `observers` module contains functions for making all of the\ndifferent types of observers, and utilities for creating new ones.\nAll of these functions are or return an observer function of the form\n`observe(emit, value, parameters)` which in turn returns `cancel()`.\n\n-   `observeValue`\n-   `observeParameters`\n-   `makeLiteralObserver(value)`\n-   `makeElementObserver(id)`\n-   `makeComponentObserver(label)`\n-   `makeRelationObserver(callback, thisp)` is unavailable through the\n    property binding language, translates a value through a JavaScript\n    function.\n-   `makeComputerObserver(observeArgs, compute, thisp)` applies\n    arguments to the computation function to get a new value.\n-   `makeConverterObserver(observeValue, convert, thisp)` calls the\n    converter function to transform a value to a converted value.\n-   `makePropertyObserver(observeObject, observeKey)`\n-   `makeGetObserver(observeCollection, observeKey)`\n-   `makeMapFunctionObserver(observeArray, observeFunction)`\n-   `makeMapBlockObserver(observeArray, observeRelation)`\n-   `makeFilterBlockObserver(observeArray, observePredicate)`\n-   `makeSortedBlockObserver(observeArray, observeRelation)`\n-   `makeEnumerationObserver(observeArray)`\n-   `makeFlattenObserver(observeOuterArray)`\n-   `makeTupleObserver(...observers)`\n-   `makeObserversObserver(observers)`\n-   `makeReversedObserver(observeArrayh)`\n-   `makeWindowObserver` is not presently available through the language\n    and is subject to change.  It is for watching a length from an array\n    starting at an observable index.\n-   `makeSumObserver(observeArray)`\n-   `makeAverageObserver(observeArray)`\n-   `makeParentObserver(observeExpression)`\n-   *etc*\n\nThese are utilities for making observer functions.\n\n-   `makeNonReplacing(observe)` accepts an array observer (the emitted\n    values must be arrays) and returns an array observer that will only\n    emit the target once and then incrementally update that target.  All\n    array observers use this decorator to handle the case where the\n    source value gets replaced.\n-   `makeArrayObserverMaker(setup)` generates an observer that uses an\n    array as its source and then incrementally updates a target value,\n    like `sum` and `average`.  The `setup(source, emit)` function must\n    return an object of the form `{contentChange, cancel}` and arrange\n    for `emit` to be called with new values when `contentChange(plus,\n    minus, index)` receives incremental updates.\n-   `makeUniq(callback)` wraps an emitter callback such that it only\n    forwards new values.  So, if a value is repeated, subsequent calls\n    are ignored.\n-   `autoCancelPrevious(callback)` accepts an observer callback and\n    returns an observer callback.  Observer callbacks may return\n    cancelation functions, so this decorator arranges for the previous\n    canceler to be called before producing a new one, and arranges for\n    the last canceler to be called when the whole tree is done.\n-   `once(callback)` accepts a canceler function and ensures that the\n    cancelation routine is only called once.\n\nThe `binders` module contains similar functions for binding an observed\nvalue to a bound value.  All binders are of the form `bind(observeValue,\nsource, target, parameters)` and return a `cancel()` function.\n\n-   `makePropertyBinder(observeObject, observeKey)`\n-   `makeGetBinder(observeCollection, observeKey)`\n-   `makeHasBinder(observeCollection, observeValue)`\n-   `makeEqualityBinder(observeLeft, observeRight)`\n-   `makeRangeContentBinder(observeTarget)`\n-   `makeMapContentBinder(observeTarget)`\n-   `makeReversedBinder(observeTarget)`\n\n\n[Collections]: https://github.com/montagejs/collections\n[Define Property]: http://kangax.github.com/es5-compat-table/#define-property-webkit-note\n[Montage]: https://github.com/montagejs/montage\n[Mr]: https://github.com/montagejs/mr\n[Mutation Observers]: https://developer.mozilla.org/en-US/docs/DOM/DOM_Mutation_Observers\n[Node.js]: http://nodejs.org/\n\n',readmeFilename:"README.md",_id:"frb@0.2.14",dist:{shasum:"ce12532b6e772a6264316629d17fa691df9c91bd"},_from:"frb@0.2.14",_resolved:"https://registry.npmjs.org/frb/-/frb-0.2.14.tgz",directories:{lib:"./"},hash:"51f539f",mappings:{collections:{name:"collections",hash:"f814a7b",location:"../collections@f814a7b/"}},production:!0,useScriptInjection:!0}}),montageDefine("5f061ed","index.html",{text:'<!DOCTYPE html>\n<html>\n<head>\n    <meta http-equiv=content-type content="text/html; charset=utf-8">\n    <title>flick-example</title>\n\n    <script src=packages/montage@e2fc70c/montage.js></script>\n    <script type=text/montage-serialization>{"owner":{"prototype":"montage/ui/loader.reel"}}</script>\n</head>\n<body>\n    <span class=loading></span>\n</body>\n</html>'}),montageDefine("e2fc70c","core/core",{dependencies:["collections/shim","core/shim/object","core/shim/array","core/shim/string","core/extras/object","core/extras/date","core/extras/element","core/extras/function","core/extras/regexp","core/extras/string","core/uuid","collections/listen/property-changes","core/bindings","core/paths","core/serialization/bindings","core/promise"],factory:function(e,t){function n(e,t){var a=i+t+r;
return e.hasOwnProperty(a)?e[a]:Object.defineProperty(e,a,{enumerable:!1,configurable:!1,writable:!0,value:Object.create(n(Object.getPrototypeOf(e),t))})[a]}e("collections/shim"),e("core/shim/object"),e("core/shim/array"),e("core/shim/string"),e("core/extras/object"),e("core/extras/date"),e("core/extras/element"),e("core/extras/function"),e("core/extras/regexp"),e("core/extras/string");var r="AttributeProperties",i="_",a="__proto__",o="value",s="enumerable",l="distinct",c="serializable",u=Array.prototype,h=Object.prototype,d=!0,p=t.Montage=function p(){};p.deprecate=function(e,t,n,r){var i=function(){var i=Error.stackTraceLimit;return Error.stackTraceLimit=2,"undefined"!=typeof console&&"function"==typeof console.warn&&(r?console.warn(n+" is deprecated, use "+r+" instead.",Error("").stack):console.warn(n,Error("").stack)),Error.stackTraceLimit=i,t.apply(e?e:this,arguments)};return i.deprecatedFunction=t,i},p.callDeprecatedFunction=function(e,t,n,r){var i,a,o=Error.stackTraceLimit;return Error.stackTraceLimit=2,"undefined"!=typeof console&&"function"==typeof console.warn&&(i=p.getInfoForObject(e).objectName,r?console.warn(n+" is deprecated, use "+r+" instead.",i):console.warn(n,i)),Error.stackTraceLimit=o,a=u.slice.call(arguments,4),t.apply(e?e:this,a)};var f={}.__proto__===Object.prototype,m={_montage_metadata:1,__state__:1},g=Object.getOwnPropertyNames(Function);if(Object.defineProperty(p,"specialize",{value:function(e,t){var n,r,i,a,o,s,l,c=this,u=void 0===this.specialize;if(e=e||Object.empty,t=t||Object.empty,n=e.constructor&&e.constructor.value?e.constructor.value:e.didCreate&&e.didCreate.value?p.deprecate(null,e.didCreate.value,"didCreate","constructor"):function(){return this.superForValue("constructor")()||this},f)n.__proto__=c;else{i=Object.getOwnPropertyNames(c);for(var s=0;i.length>s;s++)a=i[s],m.hasOwnProperty(a)||(o=Object.getOwnPropertyDescriptor(n,a),(!o||o.configurable)&&p.defineProperty(n,a,Object.getOwnPropertyDescriptor(c,a)));n.__constructorProto__=c,p.defineProperty(n,"isPrototypeOf",{value:function(e){for(;null!==e;){if(Object.getPrototypeOf(e)===this)return!0;e=Object.getPrototypeOf(e)}return!1},enumerable:!1})}if(r=Object.create(this.prototype),u){for(i=Object.getOwnPropertyNames(p),s=0;i.length>s;s++)a=i[s],o=Object.getOwnPropertyDescriptor(n,a),(!o||o.configurable)&&p.defineProperty(n,a,Object.getOwnPropertyDescriptor(p,a));for(i=Object.getOwnPropertyNames(p.prototype),s=0;i.length>s;s++)a=i[s],o=Object.getOwnPropertyDescriptor(n,a),(!o||o.configurable)&&p.defineProperty(r,a,Object.getOwnPropertyDescriptor(p.prototype,a))}if(p.defineProperties(r,e),d){l=function(e,t,n){function r(){return this===t&&console.warn("Deprecated - "+p.getInfoForObject(t).objectName+"."+n+" should be moved to constructorProperties"),e.apply(this,arguments)}return r.deprecatedFunction=e,r};for(a in e)g.has(a)?delete e[a]:(o=e[a],o.value&&"function"==typeof o.value&&!o.value.__isConstructor__?o.value=l(o.value,n,a):(o.get&&(o.get=l(o.get,n,a)),o.set&&(o.set=l(o.set,n,a))));p.defineProperties(n,e),p.defineProperty(n,"create",{value:function(){return new n},enumerable:!1}),r.hasOwnProperty("didCreate")||p.defineProperty(r,"didCreate",{value:n,enumerable:!1}),n.hasOwnProperty("didCreate")||p.defineProperty(n,"didCreate",{value:n,enumerable:!1})}return p.defineProperties(n,t),p.defineProperty(n,"__isConstructor__",{value:!0,enumerable:!1}),p.defineProperty(n,"_superCache",{value:{},enumerable:!1}),n.prototype=r,p.defineProperty(r,"constructor",{value:n,enumerable:!1}),n},writable:!0,configurable:!0,enumerable:!1}),!f){var v=Object.getPrototypeOf;Object.getPrototypeOf=function(e){return"function"==typeof e&&e.__constructorProto__?e.__constructorProto__:v.apply(Object,arguments)}}Object.defineProperty(p,"create",{configurable:!0,value:function(e,t){if(void 0!==e&&"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object prototype may only be an Object or null, not '"+e+"'");if(e=void 0===e?this:e,"function"==typeof e)return t?e.specialize(t):new e;var n=Object.create(e);return t&&p.defineProperties(n,t),n}});var b=[c];b.forEach(function(e){Object.defineProperty(Object.prototype,i+e+r,{enumerable:!1,configurable:!1,writable:!0,value:{}})}),Object.defineProperty(p,"defineProperty",{value:function(e,t,r){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object must be an object, not '"+e+"'");var d=o in r;if(l in r&&!d)throw"Cannot use distinct attribute on non-value property '"+t+"'";if(a in r)r.__proto__=d?"function"==typeof r.value?w:_:y;else{var p;p=d?"function"==typeof r.value?w:_:y;for(var f in p)f in r||(r[f]=p[f])}if(r.hasOwnProperty(s)||t.charAt(0)!==i||(r.enumerable=!1),r.hasOwnProperty(c)||(r.enumerable?r.get&&!r.set?r.serializable=!1:r.writable===!1&&(r.serializable=!1):r.serializable=!1),c in r&&(n(e,c)[t]=r.serializable),r.distinct!==!0||"object"!=typeof r.value){var m,g,v;if(e._superDependencies){if("function"==typeof r.value&&(m=e._superDependencies[t+".value"]))for(g=0,v=m.length;v>g;g++)delete m[g]._superCache[t+".value"];if("function"==typeof r.get&&(m=e._superDependencies[t+".get"]))for(g=0,v=m.length;v>g;g++)delete m[g]._superCache[t+".get"];if("function"==typeof r.set&&(m=e._superDependencies[t+".set"]))for(g=0,v=m.length;v>g;g++)delete m[g]._superCache[t+".set"]}return Object.defineProperty(e,t,r)}(function(e,t,n,r){var i=function(e,t,n){Object.defineProperty(e,t,{enumerable:!1,configurable:!0,writable:!0,value:n})};n.constructor===Object&&Object.getPrototypeOf(n)===h?0!==Object.keys(n).length?Object.defineProperty(r,e,{configurable:!0,get:function(){var e=this[t];if(!e){var r;e={};for(r in n)e[r]=n[r];this.hasOwnProperty(t)?this[t]=e:i(this,t,e)}return e},set:function(e){this.hasOwnProperty(t)?this[t]=e:i(this,t,e)}}):Object.defineProperty(r,e,{configurable:!0,get:function(){var e=this[t];return e||(e={},this.hasOwnProperty(t)?this[t]=e:i(this,t,e)),e},set:function(e){this.hasOwnProperty(t)?this[t]=e:i(this,t,e)}}):(n.__proto__||Object.getPrototypeOf(n))===u?0!==n.length?Object.defineProperty(r,e,{configurable:!0,get:function(){var e=this[t];if(!e){var r,a;for(e=[],r=0;void 0!==(a=n[r]);r++)e[r]=a;this.hasOwnProperty(t)?this[t]=e:i(this,t,e)}return e},set:function(e){this.hasOwnProperty(t)?this[t]=e:i(this,t,e)}}):Object.defineProperty(r,e,{configurable:!0,get:function(){var e=this[t];return e||(e=[],this.hasOwnProperty(t)?this[t]=e:i(this,t,e)),e},set:function(e){this.hasOwnProperty(t)?this[t]=e:i(this,t,e)}}):n.constructor.prototype===Object.getPrototypeOf(n)?Object.defineProperty(r,e,{configurable:!0,get:function(){var e=this[t];if(!e){var r;e=new n.constructor;for(r in n)e[r]=n[r];this.hasOwnProperty(t)?this[t]=e:i(this,t,e)}return e},set:function(e){this.hasOwnProperty(t)?this[t]=e:i(this,t,e)}}):Object.defineProperty(r,e,{configurable:!0,get:function(){var e=this[t];return e||(e=Object.create(n.__proto__||Object.getPrototypeOf(n)),this.hasOwnProperty(t)?this[t]=e:i(this,t,e)),e},set:function(e){this.hasOwnProperty(t)?this[t]=e:i(this,t,e)}})})(t,i+t,r.value,e)}}),Object.defineProperty(p,"defineProperties",{value:function(e,t){if("object"!=typeof t||null===t)throw new TypeError("Properties must be an object, not '"+t+"'");for(var n in t)"_bindingDescriptors"!==n&&this.defineProperty(e,n,t[n]);return e}});var y={enumerable:!0,configurable:!0,serializable:!0},_={writable:!0,enumerable:!0,configurable:!0,serializable:"reference"},w={writable:!0,enumerable:!1,configurable:!0,serializable:!1};p.defineProperty(p,"didCreate",{value:Function.noop});var C=function(e,t){var n,r,i,a,o,s,l,c,u;if(!t._superPropertyName||!t._superPropertyType)for(p.defineProperty(t,"_superPropertyType",{value:null}),p.defineProperty(t,"_superPropertyName",{value:null}),l=e;!c&&null!==l;){for(n=Object.getOwnPropertyNames(l),r=Object.getPrototypeOf(l),i=0,a=n.length,i;a>i;i++){if(o=n[i],u=Object.getOwnPropertyDescriptor(l,o),null!=(s=u.value)&&(s===t||s.deprecatedFunction===t)){t._superPropertyType="value",t._superPropertyName=o,c=!0;break}if(null!=(s=u.get)&&(s===t||s.deprecatedFunction===t)){t._superPropertyType="get",t._superPropertyName=o,c=!0;break}if(null!=(s=u.set)&&(s===t||s.deprecatedFunction===t)){t._superPropertyType="set",t._superPropertyName=o,c=!0;break}}l=r}return L(e,t._superPropertyType,t._superPropertyName)},x=function(){if("function"!=typeof x.caller)throw new TypeError("Can't get super without caller. Use this.superForValue(methodName) if using strict mode.");var e=C(this,x.caller);return"function"==typeof e?e.bind(this):Function.noop},L=function(e,t,n){var r,i,a,o,s,l=e,c=n+"."+t;if(e._superContext||p.defineProperty(e,"_superContext",{value:{}}),e._superContext[c])l=e._superContext[c];else for(l=e;null!==l&&(!l.hasOwnProperty(n)||(a=Object.getOwnPropertyDescriptor(l,n),"function"!=typeof a[t]));)l=Object.getPrototypeOf(l);if(o=l.constructor,o._superCache&&o._superCache[c])return s=function(e,t,n,r){return function(){t._superContext[e]=n;var i=r.apply(t,arguments);return delete t._superContext[e],i}}(c,e,o._superCache[c].owner,o._superCache[c].func);for(i=l;void 0===r&&(i=Object.getPrototypeOf(i));)if(i._superDependencies||p.defineProperty(i,"_superDependencies",{value:{}}),i._superDependencies[c]||(i._superDependencies[c]=[]),i._superDependencies[c].push(o),a=Object.getOwnPropertyDescriptor(i,n)){if("function"==typeof a[t]){r=a[t];break}break}return"function"==typeof r?(s=function(e,t,n,r){return function(){t._superContext[e]=n;var i=r.apply(t,arguments);return delete t._superContext[e],i}}(c,e,i,r),o._superCache||p.defineProperty(o,"_superCache",{value:{}}),o._superCache[c]={func:r,owner:i},s):Function.noop},M=function(e){return L(this,"value",e)},E=function(e){return L(this,"get",e)},S=function(e){return L(this,"set",e)};p.defineProperty(p,"super",{get:x,enumerable:!1}),p.defineProperty(p.prototype,"super",{get:x,enumerable:!1}),p.defineProperty(p,"superForValue",{value:M,enumerable:!1}),p.defineProperty(p.prototype,"superForValue",{value:M,enumerable:!1}),p.defineProperty(p,"superForGet",{value:E,enumerable:!1}),p.defineProperty(p.prototype,"superForGet",{value:E,enumerable:!1}),p.defineProperty(p,"superForSet",{value:S,enumerable:!1}),p.defineProperty(p.prototype,"superForSet",{value:S,enumerable:!1}),p.defineProperty(p,"getSerializablePropertyNames",{value:function(e){var t=[],n=e._serializableAttributeProperties;if(n)for(var r in n)n[r]&&t.push(r);return t}}),p.defineProperty(p,"getPropertyAttribute",{value:function(e,t,n){var a=i+n+r,o=e[a];return o?o[t]:void 0}}),p.defineProperty(p,"getPropertyAttributes",{value:function(e,t){var n={},a=i+t+r,o=e[a];if(o){for(var s in o)n[s]=o[s];return n}}});var O={isInstance:{value:!0}},k={objectName:{value:"Function"},isInstance:{value:!0}};p.defineProperty(p,"getInfoForObject",{value:function(e){var t,n;if(z.call(e,"_montage_metadata"))return e._montage_metadata;if(t=e._montage_metadata||e.constructor&&e.constructor._montage_metadata||null,n=e.constructor===Function?k:O,e===Object.prototype)return Object.create(t,n);try{return Object.defineProperty(e,"_montage_metadata",{enumerable:!1,writable:!0,value:Object.create(t,n)})._montage_metadata}catch(r){return e._montage_metadata=Object.create(t,n)}}});var T=e("core/uuid");"undefined"!=typeof window&&(window.uuid=T.generate());var z=Object.prototype.hasOwnProperty,j=function(){var e=T.generate(),t=p.getInfoForObject(this);try{null!==t&&t.isInstance===!1?(this._uuid=e,Object.defineProperty(this,"uuid",{get:function(){return this.hasOwnProperty("uuid")?this._uuid:j.call(this)}})):(t.isInstance&&Object.defineProperty(this,"uuid",{configurable:!0,enumerable:!1,writable:!1,value:e}),!(this instanceof Element)&&t.isInstance&&o in(Object.getOwnPropertyDescriptor(this,"uuid")||{})&&a in this||(this._uuid=e))}catch(n){this._uuid=e}return e},P=function P(){return z.call(this,"_uuid")?this._uuid:j.call(this)};Object.defineProperty(Object.prototype,"_uuid",{enumerable:!1,value:null,writable:!0}),Object.defineProperty(Object.prototype,"uuid",{configurable:!0,get:P,set:function(){}}),p.defineProperty(p,"identifier",{value:null,serializable:!0}),p.defineProperty(p.prototype,"identifier",{value:null,serializable:!0}),p.defineProperty(p.prototype,"equals",{value:function(e){return e?this===e||this.uuid===e.uuid:!1}}),p.defineProperty(p,"equals",{value:p.prototype.equals}),p.defineProperty(p.prototype,"callDelegateMethod",{value:function(e){var t,n,r=this.delegate;return"string"==typeof this.identifier&&(t=this.identifier+e.toCapitalized(),r&&"function"==typeof(n=r[t]))?(u.shift.call(arguments),n.apply(r,arguments)):r&&"function"==typeof(n=r[e])?(u.shift.call(arguments),n.apply(r,arguments)):void 0}});var D=e("collections/listen/property-changes");Object.addEach(p,D.prototype),Object.addEach(p.prototype,D.prototype),e("core/bindings"),e("core/paths"),e("core/serialization/bindings"),t._blueprintModuleIdDescriptor={serializable:!1,enumerable:!1,get:function(){var e=p.getInfoForObject(this),t=e&&!e.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(t,"_blueprintModuleId")||!t._blueprintModuleId){e=p.getInfoForObject(t);var n=e.moduleId,r=n.lastIndexOf("/"),i=n.lastIndexOf(".");r=-1===r?0:r+1,i=-1===i?n.length:i,i=r>i?n.length:i,p.defineProperty(t,"_blueprintModuleId",{enumerable:!1,value:n.slice(0,i)+".meta"})}return t._blueprintModuleId}},t._blueprintDescriptor={serializable:!1,enumerable:!1,get:function(){var n=p.getInfoForObject(this),r=n&&!n.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(r,"_blueprint")||!r._blueprint){var i=r.blueprintModuleId;if(""===i)throw new TypeError("Blueprint moduleId undefined for the module '"+JSON.stringify(r)+"'");t._blueprintDescriptor.BlueprintModulePromise||(t._blueprintDescriptor.BlueprintModulePromise=e.async("core/meta/module-blueprint").get("ModuleBlueprint")),p.defineProperty(r,"_blueprint",{enumerable:!1,value:t._blueprintDescriptor.BlueprintModulePromise.then(function(e){var t=p.getInfoForObject(r);return e.getBlueprintWithModuleId(i,t.require).fail(function(t){if(-1!==t.message.indexOf("Can't XHR"))return e.createDefaultBlueprintForObject(r).then(function(e){return e});throw t})})})}return r._blueprint},set:function(t){var n,r=p.getInfoForObject(this),i=r&&!r.isInstance?this:this.constructor;if(null===t)n=null;else{if("function"==typeof t.then)throw new TypeError("Object blueprint should not be a promise");t.blueprintInstanceModule=i.blueprintModule,n=e("core/promise").Promise.resolve(t)}p.defineProperty(i,"_blueprint",{enumerable:!1,value:n})}}}}),montageDefine("e2fc70c","core/event/event-manager",{dependencies:["montage","core/uuid","core/event/mutable-event","core/serialization"],factory:function(e,t){var n,r=e("montage").Montage,i=e("core/uuid"),a=e("core/event/mutable-event").MutableEvent,o=e("core/serialization").Serializer,s=e("core/serialization").Deserializer;if("undefined"!=typeof window){void 0===window.Touch&&"ontouchstart"in window&&(window.Touch=function(){},function(){var e;document.addEventListener("touchstart",e=function(t){window.Touch=t.touches[0].constructor,document.nativeRemoveEventListener?document.nativeRemoveEventListener("touchstart",e,!0):document.removeEventListener("touchstart",e,!0),n&&n.isStoringPointerEvents&&(n.isStoringPointerEvents=!1,n.isStoringPointerEvents=!0)},!0)}()),r.specialize({type:{value:null},listener:{value:null},capture:{value:null}}),o.defineSerializationUnit("listeners",function(e,t){var r,i,a,o=n,s=t.uuid,l=[];for(var c in o.registeredEventListeners)if(r=o.registeredEventListeners[c],i=r&&r[s])for(var u in i.listeners)a=i.listeners[u],l.push({type:c,listener:e.addObjectReference(a.listener),capture:a.capture});return l.length>0?l:void 0}),s.defineDeserializationUnit("listeners",function(e,t,n){for(var r,i=0;r=n[i];i++)t.addEventListener(r.type,r.listener,r.capture)});var l=Event.NONE,c=Event.CAPTURING_PHASE,u=Event.AT_TARGET,h=Event.BUBBLING_PHASE,d="function";t.EventManager=r.specialize({eventDefinitions:{value:{abort:{bubbles:!1,cancelable:!1},beforeunload:{bubbles:!1},blur:{bubbles:!1,cancelable:!1},change:{bubbles:!0,cancelable:!1},click:{bubbles:!0,cancelable:!0},close:{bubbles:!1,cancelable:!1},compositionend:{bubbles:!0,cancelable:!1},compositionstart:{bubbles:!0,cancelable:!0},compositionupdate:{bubbles:!0,cancelable:!1},contextmenu:{bubbles:!0,cancelable:!0},copy:{bubbles:!0,cancelable:!0},cut:{bubbles:!0,cancelable:!0},dblclick:{bubbles:!0,cancelable:!1},DOMActivate:{bubbles:!0,cancelable:!0,deprecated:!0},DOMMouseScroll:{bubbles:!0},drag:{bubbles:!0,cancelable:!0},dragend:{bubbles:!0,cancelable:!1},dragenter:{bubbles:!0,cancelable:!0},dragleave:{bubbles:!0,cancelable:!1},dragover:{bubbles:!0,cancelable:!0},dragstart:{bubbles:!0,cancelable:!0},drop:{bubbles:!0,cancelable:!0},error:{bubbles:function(e){return!(XMLHttpRequest.prototype.isPrototypeOf(e)||e.tagName&&"VIDEO"===e.tagName.toUpperCase()||e.tagName&&"AUDIO"===e.tagName.toUpperCase())},cancelable:!1},focus:{bubbles:!1,cancelable:!1},focusin:{bubbles:!0,cancelable:!1},focusout:{bubbles:!0,cancelable:!1},input:{bubbles:!0,cancelable:!1},keydown:{bubbles:!0,cancelable:!1},keypress:{bubbles:!0,cancelable:!1},keyup:{bubbles:!0,cancelable:!1},load:{bubbles:!1,cancelable:!1},loadend:{bubbles:!1,cancelable:!1},loadstart:{bubbles:!1,cancelable:!1},message:{bubbles:!1,cancelable:!1},mousedown:{bubbles:!0,cancelable:!0},mouseenter:{bubbles:!1,cancelable:!1},mouseleave:{bubbles:!1,cancelable:!1},mousemove:{bubbles:!0,cancelable:!0},mouseout:{bubbles:!0,cancelable:!0},mouseover:{bubbles:!0,cancelable:!0},mouseup:{bubbles:!0,cancelable:!0},mousewheel:{bubbles:!0},orientationchange:{bubbles:!1},paste:{bubbles:!0,cancelable:!0},progress:{bubbles:!1,cancelable:!1},reset:{bubbles:!0,cancelable:!1},resize:{bubbles:!1,cancelable:!1},scroll:{bubbles:function(e){return!!e.defaultView},cancelable:!1},select:{bubbles:!0,cancelable:!1},submit:{bubbles:!0,cancelable:!0},touchcancel:{bubbles:!0,cancelable:!1},touchend:{bubbles:!0,cancelable:!0},touchmove:{bubbles:!0,cancelable:!0},touchstart:{bubbles:!0,cancelable:!0},unload:{bubbles:!1,cancelable:!1},wheel:{bubbles:!0,cancelable:!0}}},_DOMPasteboardElement:{value:null,enumerable:!1},_delegate:{value:null,enumerable:!1},delegate:{enumerable:!1,get:function(){return this._delegate},set:function(e){this._delegate=e}},_application:{value:null,enumerable:!1},application:{enumerable:!1,get:function(){return this._application},set:function(e){this._application=e}},_registeredWindows:{value:null,enumerable:!1},_windowsAwaitingFinalRegistration:{value:{},enumerable:!1},initWithWindow:{enumerable:!1,value:function(e){if(this._registeredWindows)throw"EventManager has already been initialized";return this.registerWindow(e),this}},registerWindow:{enumerable:!1,value:function(e){if(e.defaultEventManager&&e.defaultEventManager!==this)throw"EventManager cannot register a window already registered to another EventManager";if(this._registeredWindows&&this._registeredWindows.indexOf(e)>=0)throw"EventManager cannot register a window more than once";if(this._registeredWindows||(this._registeredWindows=[]),e.uuid&&0!==e.uuid.length||(e.uuid=i.generate()),this._windowsAwaitingFinalRegistration[e.uuid]!==e){if(e.Element.prototype.nativeAddEventListener=e.Element.prototype.addEventListener,Object.defineProperty(e,"nativeAddEventListener",{configurable:!0,value:e.addEventListener}),Object.getPrototypeOf(e.document).nativeAddEventListener=e.document.addEventListener,e.XMLHttpRequest.prototype.nativeAddEventListener=e.XMLHttpRequest.prototype.addEventListener,e.Worker&&(e.Worker.prototype.nativeAddEventListener=e.Worker.prototype.addEventListener),e.MediaController&&(e.MediaController.prototype.nativeAddEventListener=e.MediaController.prototype.addEventListener),e.Element.prototype.nativeRemoveEventListener=e.Element.prototype.removeEventListener,Object.defineProperty(e,"nativeRemoveEventListener",{configurable:!0,value:e.removeEventListener}),Object.getPrototypeOf(e.document).nativeRemoveEventListener=e.document.removeEventListener,e.XMLHttpRequest.prototype.nativeRemoveEventListener=e.XMLHttpRequest.prototype.removeEventListener,e.Worker&&(e.Worker.prototype.nativeRemoveEventListener=e.Worker.prototype.removeEventListener),e.MediaController&&(e.MediaController.prototype.nativeRemoveEventListener=e.MediaController.prototype.removeEventListener),Object.defineProperty(e,"addEventListener",{configurable:!0,value:e.XMLHttpRequest.prototype.addEventListener=e.Element.prototype.addEventListener=Object.getPrototypeOf(e.document).addEventListener=function(t,n,r){return e.defaultEventManager.registerEventListener(this,t,n,!!r)}}),e.Worker&&(e.Worker.prototype.addEventListener=e.addEventListener),e.MediaController&&(e.MediaController.prototype.addEventListener=e.addEventListener),Object.defineProperty(e,"removeEventListener",{configurable:!0,value:e.XMLHttpRequest.prototype.removeEventListener=e.Element.prototype.removeEventListener=Object.getPrototypeOf(e.document).removeEventListener=function(t,n,r){return e.defaultEventManager.unregisterEventListener(this,t,n,!!r)}}),e.Worker&&(e.Worker.prototype.removeEventListener=e.removeEventListener),e.MediaController&&(e.MediaController.prototype.removeEventListener=e.removeEventListener),e.HTMLDivElement.prototype.addEventListener!==e.Element.prototype.nativeAddEventListener&&e.HTMLElement&&"addEventListener"in e.HTMLElement.prototype&&e.Components&&e.Components.interfaces){var a,o;for(a in Components.interfaces)a.match(/^nsIDOMHTML\w*Element$/)&&(a=a.replace(/^nsIDOM/,""),(a=window[a])&&(o=a.prototype,o.nativeAddEventListener=o.addEventListener,o.addEventListener=e.Element.prototype.addEventListener,o.nativeRemoveEventListener=o.removeEventListener,o.removeEventListener=e.Element.prototype.removeEventListener))}r.defineProperty(e.Element.prototype,"eventHandlerUUID",{value:void 0,enumerable:!1}),r.defineProperty(e.Element.prototype,"component",{get:function(){return n._elementEventHandlerByUUID[this.eventHandlerUUID]},enumerable:!1}),n=e.defaultEventManager=t.defaultEventManager=this,this._registeredWindows.push(e),this._windowsAwaitingFinalRegistration[e.uuid]=e,/loaded|complete|interactive/.test(e.document.readyState)?this._finalizeWindowRegistration(e):e.document.addEventListener("DOMContentLoaded",this,!0)}}},_finalizeWindowRegistration:{enumerable:!1,value:function(e){if(this._windowsAwaitingFinalRegistration[e.uuid]!==e)throw"EventManager wasn't expecting to register this window";delete this._windowsAwaitingFinalRegistration[e.uuid],this._listenToWindow(e)}},unregisterWindow:{enumerable:!1,value:function(e){if(0>this._registeredWindows.indexOf(e))throw"EventManager cannot unregister an unregistered window";if(this._registeredWindows=this._registeredWindows.filter(function(t){return e!==t}),delete e.defaultEventManager,e.Element.prototype.addEventListener=e.Element.prototype.nativeAddEventListener,Object.defineProperty(e,"addEventListener",{configurable:!0,value:e.nativeAddEventListener}),Object.getPrototypeOf(e.document).addEventListener=e.document.nativeAddEventListener,e.XMLHttpRequest.prototype.addEventListener=e.XMLHttpRequest.prototype.nativeAddEventListener,e.Worker&&(e.Worker.prototype.addEventListener=e.Worker.prototype.nativeAddEventListener),e.Element.prototype.removeEventListener=e.Element.prototype.nativeRemoveEventListener,Object.defineProperty(e,"removeEventListener",{configurable:!0,value:e.nativeRemoveEventListener}),Object.getPrototypeOf(e.document).removeEventListener=e.document.nativeRemoveEventListener,e.XMLHttpRequest.prototype.removeEventListener=e.XMLHttpRequest.prototype.nativeRemoveEventListener,e.Worker&&(e.Worker.prototype.removeEventListener=e.Worker.prototype.nativeRemoveEventListener),e.HTMLDivElement.prototype.nativeAddEventListener!==e.Element.prototype.addEventListener&&e.HTMLElement&&"addEventListener"in e.HTMLElement.prototype&&e.Components&&e.Components.interfaces){var t,n;for(t in Components.interfaces)t.match(/^nsIDOMHTML\w*Element$/)&&(t=t.replace(/^nsIDOM/,""),(t=window[t])&&(n=t.prototype,n.addEventListener=n.nativeAddEventListener,delete n.nativeAddEventListener,n.removeEventListener=n.nativeRemoveEventListener,delete n.nativeRemoveEventListener))}delete e.Element.prototype.nativeAddEventListener,delete e.nativeAddEventListener,delete Object.getPrototypeOf(e.document).nativeAddEventListener,delete e.XMLHttpRequest.prototype.nativeAddEventListener,e.Worker&&delete e.Worker.prototype.nativeAddEventListener,delete e.Element.prototype.nativeRemoveEventListener,delete e.nativeRemoveEventListener,delete Object.getPrototypeOf(e.document).nativeRemoveEventListener,delete e.XMLHttpRequest.prototype.nativeRemoveEventListener,e.Worker&&delete e.Worker.prototype.nativeRemoveEventListener,delete e.Element.prototype.eventHandlerUUID,delete e.Element.prototype.component,this._stopListeningToWindow(e)}},unregisterWindows:{enumerable:!1,value:function(){this._registeredWindows.forEach(this.unregisterWindow)}},registeredEventListeners:{enumerable:!1,value:{}},registeredEventListenersForEventType_:{value:function(e){var t,n,r,i,a=this.registeredEventListeners[e];if(!a)return null;i={};for(t in a){n=a[t].listeners;for(r in n)i[r]=n[r]}return i}},registeredEventListenersForEventType_onTarget_:{enumerable:!1,value:function(e,t,n){var r,i;return r=t===n?n.eventManager.registeredEventListeners[e]:this.registeredEventListeners[e],r?(i=r[t.uuid],i?i.listeners:null):null}},registeredEventListenersOnTarget_:{value:function(e){var t,n,r=[];for(t in this.registeredEventListeners)n=this.registeredEventListeners[t],e.uuid in n&&r.push(n);return r}},registerEventListener:{enumerable:!1,value:function(e,t,n,r){var i,a,o,s=this.registeredEventListeners[t],l=!1,c=!1;if(void 0===e.uuid)throw Error("EventManager cannot observe a target without a uuid: "+(e.outerHTML||e));return s?((i=s[e.uuid])||(i=s[e.uuid]={target:e,listeners:{}},l=!0),a=i.listeners[n.uuid],o=r?"capture":"bubble",a?(a[o]=!0,c=!0):(a={listener:n,capture:r,bubble:!r},i.listeners[n.uuid]=a,c=!0)):(s=this.registeredEventListeners[t]={},s[e.uuid]={target:e,listeners:{}},s[e.uuid].listeners[n.uuid]={listener:n,capture:r,bubble:!r},l=!0,c=!0),l&&"function"==typeof e.nativeAddEventListener&&this._observeTarget_forEventType_(e,t),c}},unregisterEventListener:{enumerable:!1,value:function(e,t,n,r){var i,a,o,s,l,c=this.registeredEventListeners[t];if(c&&(i=c[e.uuid])){if(a=i.listeners[n.uuid],!a){for(s in i.listeners)if(l=i.listeners[s].listener,l.originalListener&&l.originalListener.uuid===n.uuid){a=i.listeners[s],n=l;break}if(!a)return}o=r?"capture":"bubble",a[o]=!1,a.bubble||a.capture||(delete i.listeners[n.uuid],0===Object.keys(i.listeners).length&&(delete c[e.uuid],0===Object.keys(c).length&&(delete this.registeredEventListeners[t],this._stopObservingTarget_forEventType_(e,t))))}}},actualDOMTargetForEventTypeOnTarget:{value:function(e,t){if(t.nativeAddEventListener){if(t.defaultView)return t;var n,r=this.eventDefinitions[e];return r?(n=typeof r.bubbles===d?r.bubbles(t):r.bubbles,n?t.screen?t.document:t.ownerDocument:t):t}return null}},_observedTarget_byEventType_:{value:{}},_observeTarget_forEventType_:{enumerable:!1,value:function(e,t){var n;!(n=this.actualDOMTargetForEventTypeOnTarget(t,e))||this._observedTarget_byEventType_[t]&&this._observedTarget_byEventType_[t][n.uuid]||(this._observedTarget_byEventType_[t]||(this._observedTarget_byEventType_[t]={}),this._observedTarget_byEventType_[t][n.uuid]=this,n.nativeAddEventListener(t,this,!0))}},_stopObservingTarget_forEventType_:{enumerable:!1,value:function(e,t){var n;n=this.actualDOMTargetForEventTypeOnTarget(t,e),n&&(delete this._observedTarget_byEventType_[t][n.uuid],n.nativeRemoveEventListener(t,this,!0))}},_activationHandler:{enumerable:!0,value:null},_listenToWindow:{enumerable:!1,value:function(e){if(!this._activationHandler){var t=this;this._activationHandler=function(e){var n,r=e.type;if("focus"===r||"mousedown"===r||"touchstart"===r)if(e.changedTouches){n=e.changedTouches.length;for(var i=0;n>i;i++)t._prepareComponentsForActivation(e.changedTouches[i].target)}else t._prepareComponentsForActivation(e.target)}}if(e.Touch?e.document.nativeAddEventListener("touchstart",this._activationHandler,!0):e.document.nativeAddEventListener("mousedown",this._activationHandler,!0),e.document.nativeAddEventListener("focus",this._activationHandler,!0),this.application){var n,r=this.registeredEventListenersOnTarget_(this.application);for(n in r)this._observeTarget_forEventType_(e,n)}}},_stopListeningToWindow:{enumerable:!1,value:function(e){var t,n=this.registeredEventListenersOnTarget_(this.application),r=this.registeredEventListenersOnTarget_(e);for(t in n)this._stopObservingTarget_forEventType_(e,t);for(t in r)this._stopObservingTarget_forEventType_(e,t)}},reset:{enumerable:!1,value:function(){var e,t,n,r;for(e in this.registeredEventListeners){t=this.registeredEventListeners[e];for(n in t.targets)r=t.targets[n],this._stopObservingTarget_forEventType_(r.target,e)}this.registeredEventListeners={},this._claimedPointers={}}},unload:{enumerable:!1,value:function(){this._stopListening()}},methodNameForBubblePhaseOfEventType:{enumerable:!1,value:function(e){return function(t,n){var r=n?t+"+"+n:t;return e[r]||(e[r]="handle"+(n?n.toCapitalized():"")+t.toCapitalized())}}({})},_methodNameForCapturePhaseByEventType_:{value:{}},methodNameForCapturePhaseOfEventType:{enumerable:!1,value:function(e){return function(t,n){var r=n?t+"+"+n:t;return e[r]||(e[r]="capture"+(n?n.toCapitalized():"")+t.toCapitalized())}}({})},_claimedPointers:{enumerable:!1,distinct:!0,value:{}},componentClaimingPointer:{value:function(e){return this._claimedPointers[e]}},isPointerClaimedByComponent:{value:function(e,t){if(!t)throw"Must specify a valid component to see if it claims the specified pointer, '"+t+"' is not valid.";return this._claimedPointers[e]===t}},claimPointer:{value:function(e,t){if(!e&&0!==e)throw"Must specify a valid pointer to claim, '"+e+"' is not valid.";if(!t)throw"Must specify a valid component to claim a pointer, '"+t+"' is not valid.";var n=this._claimedPointers[e];return n===t?!0:n?n.surrenderPointer(e,t)?(this._claimedPointers[e]=t,!0):!1:(this._claimedPointers[e]=t,!0)}},forfeitPointer:{value:function(e,t){if(t!==this._claimedPointers[e])throw"Not allowed to forfeit pointer '"+e+"' claimed by another component";delete this._claimedPointers[e]}},forfeitAllPointers:{value:function(e){var t,n;for(t in this._claimedPointers)n=this._claimedPointers[t],e===n&&delete this._claimedPointers[t]}},_isStoringPointerEvents:{enumerable:!1,value:!1},isStoringPointerEvents:{enumerable:!0,get:function(){return this._isStoringPointerEvents},set:function(e){e===!0?this._isStoringPointerEvents||(this._isStoringPointerEvents=!0,window.Touch&&Object.defineProperty(Touch.prototype,"velocity",{get:function(){return n.pointerMotion(this.identifier).velocity},set:function(){}})):(this._isStoringPointerEvents=!1,this._pointerStorage.memory={},this._isMouseDragging=!1)}},_isStoringMouseEventsWhileDraggingOnly:{enumerable:!1,value:!0},isStoringMouseEventsWhileDraggingOnly:{enumerable:!0,get:function(){return this._isStoringMouseEventsWhileDraggingOnly},set:function(e){this._isStoringMouseEventsWhileDraggingOnly=e===!0?!0:!1}},_isMouseDragging:{enumerable:!1,value:!1},_pointerStorage:{enumerable:!1,value:{memory:{},add:function(e,t){this.memory[e]||(this.memory[e]={data:Array(32),size:0,pos:0}),this.memory[e].data[this.memory[e].pos]=t,this.memory[e].size<this.memory[e].data.length&&this.memory[e].size++,this.memory[e].pos=(this.memory[e].pos+1)%this.memory[e].data.length},remove:function(e){delete this.memory[e]},clear:function(e){this.memory[e]&&(this.memory[e].size=0)},getMemory:function(e){return this.memory[e]},isStored:function(e){return this.memory[e]&&this.memory[e].size>0},storeEvent:function(e){var t;switch(e.type){case"mousedown":n._isMouseDragging=!0;case"mousemove":n._isStoringMouseEventsWhileDraggingOnly?n._isMouseDragging&&(this.add("mouse",{clientX:e.clientX,clientY:e.clientY,timeStamp:e.timeStamp}),Object.defineProperty(e,"velocity",{get:function(){return n.pointerMotion("mouse").velocity
},set:function(){}})):(this.add("mouse",{clientX:e.clientX,clientY:e.clientY,timeStamp:e.timeStamp}),Object.defineProperty(e,"velocity",{get:function(){return n.pointerMotion("mouse").velocity},set:function(){}}));break;case"mouseup":this.add("mouse",{clientX:e.clientX,clientY:e.clientY,timeStamp:e.timeStamp}),Object.defineProperty(e,"velocity",{get:function(){return n.pointerMotion("mouse").velocity},set:function(){}});break;case"touchstart":case"touchmove":for(t=0;e.touches.length>t;t++)this.add(e.touches[t].identifier,{clientX:e.touches[t].clientX,clientY:e.touches[t].clientY,timeStamp:e.timeStamp});break;case"touchend":for(t=0;e.changedTouches.length>t;t++)this.add(e.changedTouches[t].identifier,{clientX:e.changedTouches[t].clientX,clientY:e.changedTouches[t].clientY,timeStamp:e.timeStamp})}},removeEvent:function(e){var t;switch(e.type){case"mouseup":n._isMouseDragging=!1,n._isStoringMouseEventsWhileDraggingOnly&&this.clear("mouse");break;case"touchend":for(t=0;e.changedTouches.length>t;t++)this.remove(e.changedTouches[t].identifier)}}}},_getPointerVelocityData:{enumerable:!1,value:function(e){var t,r,i,a,o,s,l,c,u,h=0,d=!0,p={x:[],y:[],time:[]};for(t=n._pointerStorage.getMemory(e),r=t.data.length,i=t.data[(t.pos-1+r)%r],a=o=s=i.timeStamp,l=i.clientX,c=i.clientY;d&&o>a-350&&t.size>h;)i=t.data[(t.pos-h-1+r)%r],o=i.timeStamp,u=l*l+c*c,u>2&&50>=s-o?(p.x.push(i.clientX),p.y.push(i.clientY),p.time.push(o),s=o,l=i.clientX,c=i.clientY,h++):d=!1;return p}},_fitPointerCurve:{enumerable:!1,value:function(e,t){var n,r,i,a,o,s,l,c,u,h,d,p,f,m,g,v,b,y,_,w,C,x,L,M,E,S,O,k,T,z,j,P,D,A,B,R,I,F,N=1e-4,q=t.length;do{for(d=0,p=0,f=0,m=0,g=0,v=0,y=0,_=0,w=0,C=0,x=0,L=0,E=0,S=0,O=0,k=0,T=0,z=0,P=0,D=0,A=0,B=0,R=0,I=0,h=0;q>h;h++)o=t[h],s=o.t,c=s*s,u=c*s,l=o.v,b=N*(6*(c-s)-u+2),M=6*N*(u-2*c+s),j=6*N*(c-u),F=2*N*u,v+=b*b,L+=M*M,z+=j*j,I+=F*F,d+=l*b,y+=l*M,E+=l*j,P+=l*F,f-=b,w-=M,O-=j,A-=F,p-=b*s,_-=M*s,S-=j*s,D-=F*s,m-=b*c,C-=M*c,k-=j*c,B-=F*c,g-=b*u,x-=M*u,T-=j*u,R-=F*u;N*=2}while(0===v||0===L||0===z||0===I);for(s=N/v,d*=s,p*=3*s,f*=s,m*=3*s,g*=s,s=N/L,y*=s,_*=3*s,w*=s,C*=3*s,x*=s,s=N/z,E*=s,S*=3*s,O*=s,k*=3*s,T*=s,s=N/I,P*=s,D*=3*s,A*=s,B*=3*s,R*=s,v=e[0],L=e[1],z=e[2],I=e[3],n=3*(L-z)+I-v,r=v+z-2*L,i=L-v,a=v,h=0;20>h;h++)s=d+a*f+i*p+r*m+n*g,v+=s,a+=s,n-=s,r+=s,i-=s,s=y+a*w+i*_+r*C+n*x,L+=s,n+=3*s,r-=s+s,i+=s,s=E+a*O+i*S+r*k+n*T,z+=s,n-=3*s,r+=s,s=P+a*A+i*D+r*B+n*R,I+=s,n+=s;e[0]=v,e[1]=L,e[2]=z,e[3]=I}},_pointerBezierValue:{enumerable:!1,value:function(e,t){var n=1-e;return n*n*n*t[0]+3*n*n*e*t[1]+3*n*e*e*t[2]+e*e*e*t[3]}},_calculatePointerVelocity:{enumerable:!1,value:function(e,t){var n,r,i=e.length,a=e[0],o=e[0],s=0;for(r=1;i>r;r++)a>e[r]&&(a=e[r],s=r);if(n=o-a){if(i>5){var l,c,u,h=[];for(r=0;i>r;r++)h[r]={v:t[r],t:(e[r]-a)/n};return l=h[s].v,c=h[0].v,u=[l,(2*l+c)/3,(l+2*c)/3,c],this._fitPointerCurve(u,h),5e3*(this._pointerBezierValue(.8,u)-this._pointerBezierValue(.6,u))/n}return i>1?1e3*(t[0]-t[s])/n:0}return 0}},pointerMotion:{value:function(e){if(n._pointerStorage.isStored(e)){var t={};return Object.defineProperties(t,{_data:{enumerable:!1,writable:!0,value:null},_x:{enumerable:!1,writable:!0,value:null},_y:{enumerable:!1,writable:!0,value:null},_speed:{enumerable:!1,writable:!0,value:null},_angle:{enumerable:!1,writable:!0,value:null},x:{get:function(){return null===this._x&&(null===this._data&&(this._data=n._getPointerVelocityData(e)),this._x=n._calculatePointerVelocity(this._data.time,this._data.x)),this._x},set:function(){}},y:{get:function(){return null===this._y&&(null===this._data&&(this._data=n._getPointerVelocityData(e)),this._y=n._calculatePointerVelocity(this._data.time,this._data.y)),this._y},set:function(){}},speed:{get:function(){return null===this._speed&&(this._speed=Math.sqrt(this.x*this.x+this.y*this.y)),this._speed},set:function(){}},angle:{get:function(){return null===this._angle&&(this._angle=Math.atan2(this.y,this.x)),this._angle},set:function(){}}}),{velocity:t}}return void 0}},monitorDOMModificationInEventHandling:{value:!1},domModificationEventHandler:{value:r.specialize({handleEvent:{value:function(){throw"DOM Modified"}},captureDOMSubtreeModified:{value:function(){throw"DOMSubtreeModified"}},captureDOMAttrModified:{value:function(){throw"DOMAttrModified"}},captureDOMCharacterDataModified:{value:function(){throw"DOMCharacterDataModified"}}})},handleEvent:{enumerable:!1,value:function(e){this.monitorDOMModificationInEventHandling&&(document.body.addEventListener("DOMSubtreeModified",this.domModificationEventHandler,!0),document.body.addEventListener("DOMAttrModified",this.domModificationEventHandler,!0),document.body.addEventListener("DOMCharacterDataModified",this.domModificationEventHandler,!0));var t,n,r,i,o,s,p,f,m,g,v,b,y,_,w=e.type,C=e.bubbles;for("DOMContentLoaded"===w&&(t=e.target.defaultView,t&&this._windowsAwaitingFinalRegistration[t.uuid]&&(this._finalizeWindowRegistration(t),e.target.removeEventListener("DOMContentLoaded",this,!0))),_="boolean"!=typeof e.propagationStopped?a.fromEvent(e):e,m=Element.isElement(_.target)||_.target instanceof Document||_.target instanceof Window?this._eventPathForDomTarget(_.target):this._eventPathForTarget(_.target),b=_.target.identifier?this.methodNameForCapturePhaseOfEventType(w,_.target.identifier):null,y=_.target.identifier?this.methodNameForBubblePhaseOfEventType(w,_.target.identifier):null,g=this.methodNameForCapturePhaseOfEventType(w),v=this.methodNameForBubblePhaseOfEventType(w),this.delegate&&typeof this.delegate.willDistributeEvent===d&&this.delegate.willDistributeEvent(_),this._isStoringPointerEvents&&this._pointerStorage.storeEvent(_),_.eventPhase=c,n=m.length-1;!_.propagationStopped&&(r=m[n]);n--)if(_.currentTarget=r,i=this.registeredEventListenersForEventType_onTarget_(w,r))for(p=Object.keys(i),o=0;i&&!_.immediatePropagationStopped&&(s=i[p[o]]);o++)s.capture&&(f=s.listener,b&&typeof f[b]===d?f[b](_):typeof f[g]===d?f[g](_):typeof f.handleEvent===d?f.handleEvent(_):typeof f!==d||f.__isConstructor__||f.call(r,_));if(!_.propagationStopped&&(_.eventPhase=u,_.currentTarget=r=_.target,i=this.registeredEventListenersForEventType_onTarget_(w,r)))for(p=Object.keys(i),o=0;i&&!_.immediatePropagationStopped&&(s=i[p[o]]);o++)f=s.listener,s.capture&&(b&&typeof f[b]===d?f[b](_):typeof f[g]===d?f[g](_):typeof f.handleEvent===d?f.handleEvent(_):typeof f===d&&f.call(r,_)),s.bubble&&(y&&typeof f[y]===d?f[y](_):typeof f[v]===d?f[v](_):typeof f.handleEvent===d?f.handleEvent(_):typeof f===d&&f.call(r,_));for(_.eventPhase=h,n=0;C&&!_.propagationStopped&&(r=m[n]);n++)if(_.currentTarget=r,i=this.registeredEventListenersForEventType_onTarget_(w,r))for(p=Object.keys(i),o=0;i&&!_.immediatePropagationStopped&&(s=i[p[o]]);o++)s.bubble&&(f=s.listener,y&&typeof f[y]===d?f[y](_):typeof f[v]===d?f[v](_):typeof f.handleEvent===d?f.handleEvent(_):typeof f===d&&f.call(r,_));_.eventPhase=l,_.currentTarget=null,this._isStoringPointerEvents&&this._pointerStorage.removeEvent(e),this.monitorDOMModificationInEventHandling&&(document.body.removeEventListener("DOMSubtreeModified",this.domModificationEventHandler,!0),document.body.removeEventListener("DOMAttrModified",this.domModificationEventHandler,!0),document.body.removeEventListener("DOMCharacterDataModified",this.domModificationEventHandler,!0))}},_prepareComponentsForActivation:{value:function(e){var t,n,r=e,i=r&&r.defaultView?r.defaultView:window,a=i.document?i.document:document,o=!1,s=null;do switch(r&&(n=this.eventHandlerForElement(r),n&&(o||(o=!0,s=this._findActiveTarget(n)),n._preparedForActivationEvents||(n._prepareForActivationEvents(),n._preparedForActivationEvents=!0))),t=r,r){case i:r=null;break;case a:r=i;break;case a.documentElement:r=a;break;default:r=r.parentNode}while(r&&t!==r);this.activeTarget=s}},_findActiveTarget:{value:function(e){for(var t=null,n={};!t&&e&&!(e.uuid in n);)n[e.uuid]=e,e.acceptsActiveTarget?t=e:e=e.nextTarget;return t}},_eventPathForTarget:{enumerable:!1,value:function(e){if(!e)return[];var t=e,n=this.application,r=[],i={};i[e.uuid]=e;do t.uuid in i||(r.push(t),i[t.uuid]=t),t=t.nextTarget,(!t||t.uuid in i)&&(t=n),t&&t.uuid in i&&(t=null);while(t);return r}},_eventPathForDomTarget:{enumerable:!1,value:function(e){if(!e)return[];var t,n=e,r=n&&n.defaultView?n.defaultView:window,i=r.document?r.document:document,a=this.application,o=[];do switch(n!==e&&o.push(n),t=n,n){case a:n=n.parentApplication,n&&(a=n);break;case r:n=a;break;case i:n=r;break;case i.documentElement:n=i;break;default:n=n.parentNode,n||(n=a)}while(n&&t!==n);return o}},_elementEventHandlerByUUID:{enumerable:!1,value:{}},registerEventHandlerForElement:{enumerable:!1,value:function(e,t){var n=this.eventHandlerForElement(t);n&&this.unregisterEventHandlerForElement(t),this._elementEventHandlerByUUID[t.eventHandlerUUID=e.uuid]=e}},unregisterEventHandlerForElement:{enumerable:!1,value:function(e){delete this._elementEventHandlerByUUID[e.eventHandlerUUID],delete e.eventHandlerUUID}},eventHandlerForElement:{enumerable:!1,value:function(e){return this._elementEventHandlerByUUID[e.eventHandlerUUID]}},_activeTarget:{value:null},activeTarget:{get:function(){return this._activeTarget||this.application},set:function(e){e||(e=this.application),e===this._activeTarget||this.activeTarget&&!this.activeTarget.surrendersActiveTarget(e)||(e.willBecomeActiveTarget(this.activeTarget),this._activeTarget=e,e.didBecomeActiveTarget())}}})}}}),montageDefine("e2fc70c","core/serialization/deserializer/montage-reviver",{dependencies:["core/core","mousse/deserialization/reviver","./properties-deserializer","./self-deserializer","./unit-deserializer","core/module-reference","core/promise"],factory:function(e,t){var n=e("core/core").Montage,r=e("mousse/deserialization/reviver").Reviver,i=e("./properties-deserializer").PropertiesDeserializer,a=e("./self-deserializer").SelfDeserializer,o=e("./unit-deserializer").UnitDeserializer,s=e("core/module-reference").ModuleReference,l=e("core/promise").Promise,c=n.specialize({_require:{value:null},_objectRequires:{value:null},init:{value:function(e,t){if("function"!=typeof e)throw Error("Function 'require' missing.");if("string"!=typeof e.location)throw Error("Function 'require' location is missing");if("object"!=typeof t&&void 0!==t)throw Error("Parameter 'objectRequires' should be an object.");return this._require=e,this._objectRequires=t,this}},getExports:{value:function(e,t){var n;for(t=e.resolve(t),n=e.getModuleDescriptor(t);void 0!==n.redirect;)n=e.getModuleDescriptor(n.redirect);return void 0!==n.mappingRedirect?this.getExports(n.mappingRequire,n.mappingRedirect):n.exports}},getModule:{value:function(e,t){var n,r,i=this._objectRequires;return n=i&&t in i?i[t]:this._require,r=this.getExports(n,e),r||(r=n.async(e)),r}}}),u=t.MontageReviver=n.specialize.call(r,{moduleLoader:{value:null},init:{value:function(e,t){return this.moduleLoader=(new c).init(e,t),this}},getTypeOf:{value:function(e){if(null!==e&&"object"==typeof e&&1===Object.keys(e).length){if("#"in e)return"Element";if("%"in e)return"Module"}return r.prototype.getTypeOf.call(this,e)}},reviveElement:{value:function(e,t,n){var r=e["#"],i=t.getElementById(r);return i?(n&&t.setObjectLabel(i,n),i):l.reject(Error("Element with id '"+r+"' was not found."))}},reviveModule:{value:function(e,t){var n=e["%"],r=t.getRequire();n=r.resolve(n);var i=r.getModuleDescriptor(n);return(new s).initWithIdAndRequire(i.id,i.require)}},reviveCustomObject:{value:function(e,t,n){return this.reviveMontageObject(e,t,n)}},reviveMontageObject:{value:function(e,t,n){var r,i,a,o=this,s=e.prototype||e.object;return s&&(i=u.parseObjectLocationId(s),r=this.moduleLoader.getModule(i.moduleId,n),a=i.objectName),l.isPromise(r)?r.then(function(r){return o.instantiateMontageObject(e,r,a,t,n)},function(t){throw t.stack&&console.error(t.stack),Error('Error deserializing "'+n+'" when loading module "'+i.moduleId+"' from '"+e.prototype+"'")}):this.instantiateMontageObject(e,r,a,t,n)}},instantiateMontageObject:{value:function(e,t,n,r,i){var a,o,s=this;return a=this.getMontageObject(e,t,n,r,i),r.setObjectLabel(a,i),a.isDeserializing=!0,o=this.reviveObjectLiteral(e,r),l.isPromise(o)?o.then(function(e){return s.deserializeMontageObject(e,a,r,i)}):this.deserializeMontageObject(o,a,r,i)}},deserializeMontageObject:{value:function(e,t,n,r){var i;return"function"==typeof t.deserializeSelf?this.deserializeCustomMontageObject(t,e,n,r):(n.setUnitsToDeserialize(t,e,u._unitNames),i=this.deserializeMontageObjectProperties(t,e.properties,n),l.isPromise(i)?i.then(function(){return t}):t)}},deserializeMontageObjectProperties:{value:function(e,t,n){var r;if("function"==typeof e.deserializeProperties){var a=(new i).initWithReviverAndObjects(this,n);r=e.deserializeProperties(a)}else for(var o in t)e[o]=t[o];return r}},deserializeCustomMontageObject:{value:function(e,t,n,r){var i,o=(new a).initWithObjectAndObjectDescriptorAndContextAndUnitNames(e,t,n,u._unitNames);return i=e.deserializeSelf(o),l.isPromise(i)?i.then(function(e){return n.setObjectLabel(e,r),e}):void 0!==i?(n.setObjectLabel(i,r),i):e}},getMontageObject:{value:function(e,t,n,r,i){var a;if(r.hasUserObject(i))return r.getUserObject(i);if("prototype"in e){if(!(n in t))throw Error('Error deserializing "'+i+'": object named "'+n+'"'+' was not found in "'+e.prototype+'".'+" Available objects are: "+Object.keys(t)+".");return a=Object.create(t[n].prototype),a.isDeserializing=!0,"function"==typeof a.didCreate?a.didCreate():"function"==typeof a.constructor&&a.constructor(),a}if("object"in e){if(!(n in t))throw Error('Error deserializing "'+i+'": object named "'+a+"' was not found given '"+e.object+"'");return t[n]}throw Error("Error deserializing "+JSON.stringify(e)+', might need "prototype" or "object" on label '+JSON.stringify(i))}},didReviveObjects:{value:function(e,t){var n,r=this;return n=this._deserializeUnits(t),l.isPromise(n)?n.then(function(){r._invokeDeserializedFromSerialization(e,t)}):(this._invokeDeserializedFromSerialization(e,t),void 0)}},_invokeDeserializedFromSerialization:{value:function(e,t){var n;for(var r in e)n=e[r],null!=n&&delete n.isDeserializing,t.hasUserObject(r)||n&&"function"==typeof n.deserializedFromSerialization&&n.deserializedFromSerialization(r)}},_deserializeUnits:{value:function(e){for(var t,n,r,i=e.getUnitsToDeserialize(),a=u._unitRevivers,s=0;r=i[s];s++){t=r.unitNames;for(var l,c=0;l=t[c];c++)l in r.objectDesc&&(n=(new o).initWithContext(e),a[l](n,r.object,r.objectDesc[l]))}}}},{_unitRevivers:{value:Object.create(null)},_unitNames:{value:[]},_findObjectNameRegExp:{value:/([^\/]+?)(\.reel)?$/},_toCamelCaseRegExp:{value:/(?:^|-)([^-])/g},_replaceToCamelCase:{value:function(e,t){return t.toUpperCase()}},_locationDescCache:{value:Object.create(null)},parseObjectLocationId:{value:function(e){var t,n,r,i,a=this._locationDescCache;return e in a?t=a[e]:(n=e.indexOf("["),n>0?(r=e.substr(0,n),i=e.slice(n+1,-1)):(r=e,this._findObjectNameRegExp.test(e),i=RegExp.$1.replace(this._toCamelCaseRegExp,this._replaceToCamelCase)),t={moduleId:r,objectName:i},a[e]=t),t}},defineUnitReviver:{value:function(e,t){this._unitRevivers[e]=t,this._unitNames.push(e)}},getTypeOf:{value:function(e){return this.prototype.getTypeOf.call(this,e)}}});void 0!==t&&(t.MontageReviver=u)}}),montageDefine("e2fc70c","core/logger",{dependencies:["montage"],factory:function(e,t){var n,r,i,a,o,s,l,c,u,h=e("montage").Montage;r=t.loggers={},s=function(){var e,t=s.caller.caller;return e=t.name,""===e&&(e="anonymous"),e},l=function(e){if(e.getHours){var t=e.getHours(),n=e.getMinutes(),r=e.getSeconds();return(1===t.length?"0"+t:t)+":"+(1===n.length?"0"+n:n)+":"+(1===r.length?"0"+r:r)+"."+e.getMilliseconds()}},o=function(){},i=function(){console.log(arguments)},a=function(){var e=arguments[0],t=e._montage_metadata;new Date,t?([].shift.call(arguments),[].unshift.call(arguments,t.objectName+"."+s(e)+"()"),this.buffered?this.buffer.push(arguments):console.debug.apply(console,arguments)):this.buffered?this.buffer.push(arguments):console.debug.apply(console,arguments)},n=t.Logger=h.specialize({constructor:{value:function n(){this.super()}},init:{value:function(e,t,n){if(this.name=e,this._onStateChange=t,this._storeState=!n,this._storeState&&u){var r=u.getItem("_montage_logger_"+e);r&&(this.isDebug="true"===r)}return t&&this._onStateChange("true"===r),this.isError=!0,this}},name:{value:null},buffer:{value:[],distinct:!0},buffered:{value:!1},flush:{value:function(){var e,t,n=this.buffer;for(t=0;e=n[t];t++)console.debug.apply(console,e);this.buffer.length=0}},isDebug:{get:function(){return this.debug!==o},set:function(e){this.debug=e?a:o}},isError:{get:function(){return this.error!==o},set:function(e){this.error=e?a:o}},debug:{value:o},error:{value:o},toTimeString:{value:l},_storeState:{value:null},_onStateChange:{value:null}}),t.logger=function(e,t,i){var a;return null==(a=r[e])&&(a=(new n).init(e,t,i),h.defineProperty(r,e,{value:a})),a},c=h.specialize({constructor:{value:function c(){this.super()}},init:{value:function(){return document.nativeAddEventListener?(document.nativeAddEventListener("keyup",this,!1),document.nativeAddEventListener("keydown",this,!1)):(document.addEventListener("keyup",this,!1),document.addEventListener("keydown",this,!1)),this}},inspectorElement:{value:null},m_dontRemove:{value:null},titleHeader:{value:null},shown:{value:!1},isCtrl:{value:!1},isAlt:{value:!1},keyup:{value:function(e){17==e.which&&(this.isCtrl=!1),18==e.which&&(this.isAlt=!1)}},keydown:{value:function(e){return 17==e.which&&(this.isCtrl=!0),18==e.which&&(this.isAlt=!0),76==e.which&&this.isCtrl===!0&&this.isAlt===!0?(this.shown?this.hideInspector():this.showInspector(),!1):void 0}},change:{value:function(e){var t=e.target.checked,n=e.target.value,i=r[n];i.isDebug=t,i._onStateChange&&i._onStateChange(t),i._storeState&&u&&u.setItem("_montage_logger_"+n,t)}},mouseup:{value:function(){this.hideInspector()}},showInspector:{value:function(){if(!this.inspectorElement){var e,t,n,i,a,o,s,l,c,h,d,p=0;for(this.m_dontRemove=document.getElementsByTagName("body")[0],this.inspectorElement=document.createElement("div"),this.inspectorElement.id="_montage_logger_inspector",t=document.createElement("div"),this.inspectorElement.appendChild(t),i=document.createElement("div"),t.appendChild(i),n=document.createElement("h1"),n.className="_montage_logger_inspector-title",n.textContent="Logger Inspector",this.titleHeader=n,i.appendChild(n),c=Object.keys(r),p=0;e=r[c[p]];p++)a=document.createElement("label"),o=document.createElement("input"),d=document.createElement("span"),a.className="_montage_logger_inspector-content",d.textContent=e.name,a.appendChild(o),a.appendChild(d),o.value=e.name,o.type="checkbox",o.checked=!!e.isDebug,l="_montage_logger_"+e.name,e._storeState&&u&&(s=u.getItem(l),null==s&&u.setItem(l,e.isDebug)),i.appendChild(a);h=document.createElement("style");var f="#_montage_logger_inspector {";f+="    border: 1px solid rgba(15,15,15,0.4);",f+="    position: fixed;",f+="    right: 25px;",f+="    top: 25px;",f+="    -webkit-border-radius: 5px;",f+="    color: #dddddd;",f+='    font: 10px "Lucida Grande","Lucida Sans", sans;',f+="    background:-webkit-gradient(linear, left top, left bottom, from(rgba(15,15,15,0.75)), to(rgba(15,15,15,0.95)) );",f+="    -webkit-box-shadow: 0 0 15px rgba(0,0,0,.3);",f+="    width: 250px;",f+="}",f+="#_montage_logger_inspector div {",f+="    -webkit-border-radius: 5px;",f+="    background: -webkit-gradient(radial, 100 -60, 0, 125 -50, 125, from(rgba(255,255,255,0.00)), to(rgba(0,0,0,.2)), color-stop(1, rgba(0,0,0,.2)));",f+="}",f+="#_montage_logger_inspector div div {",f+="    background: -webkit-gradient(linear, left top, left bottom, from(rgba(255,255,255,0.2)), to(rgba(0,0,0,.1)), color-stop(0.33, rgba(255,255,255,.01)), color-stop(0.33, rgba(50,50,50,1)) );",f+="    padding: 7px 10px;",f+="    -webkit-border-radius: 3px;",f+="    overflow-x: hidden;",f+="}",f+="._montage_logger_inspector-title {",f+="    color: rgba(255,255,255,0.9);",f+="    font-size: 13px;",f+="    margin: 0 0 11px 0;",f+="    padding: 0 0 0 5px;",f+="}",f+="._montage_logger_inspector-content {",f+="    padding: 0 0 0 20px;",f+="    margin: 0;",f+="    display: block;",f+="}",h.textContent=f,document.head.appendChild(h)}this.shown=!0,this.m_dontRemove.appendChild(this.inspectorElement),this.titleHeader.nativeAddEventListener("mouseup",this,!1),this.inspectorElement.nativeAddEventListener("change",this,!1)}},hideInspector:{value:function(){document.getElementById("_montage_logger_inspector")&&(this.shown=!1,this.m_dontRemove.removeChild(this.inspectorElement),this.titleHeader.nativeRemoveEventListener("mouseup",this,!1),this.inspectorElement.nativeRemoveEventListener("change",this,!1))}},handleEvent:{enumerable:!1,value:function(e){this[e.type]&&this[e.type](e)}}});var d=function(){(new c).init()};"undefined"!=typeof window&&(u=window.localStorage,window.loggers=r,window.localStorage&&d())}}),montageDefine("e2fc70c","core/shim/object",{dependencies:[],factory:function(){Object.create||(Object._creator=function e(){this.__proto__=e.prototype},Object.create=function(e){return this._creator.prototype=e||Object.prototype,new this._creator},Object.getPrototypeOf=function(e){return e.__proto__}),Object.isSealed||Object.defineProperty(Object,"isSealed",{value:function(){return!1},writable:!0,configurable:!0}),Object.seal||Object.defineProperty(Object,"seal",{value:function(e){return e},writable:!0,configurable:!0})}}),montageDefine("e2fc70c","core/shim/array",{dependencies:[],factory:function(){Array.isArray||Object.defineProperty(Array,"isArray",{value:function(e){return"[object Array]"===Object.prototype.toString.call(e)},writable:!0,configurable:!0})}}),montageDefine("e2fc70c","core/shim/string",{dependencies:[],factory:function(){String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e){return this.length>=e.length&&this.slice(0,e.length)===e},writable:!0,configurable:!0}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e){return this.length>=e.length&&this.slice(this.length-e.length,this.length)===e},writable:!0,configurable:!0})}}),montageDefine("e2fc70c","core/extras/object",{dependencies:["core/core","collections/weak-map","frb"],factory:function(e){e("core/core"),e("collections/weak-map"),Object.defineProperty(Object,"getPropertyDescriptor",{value:function(e,t){var n,r=e;do n=Object.getOwnPropertyDescriptor(r,t);while(!n&&(r=r.__proto__||Object.getPrototypeOf(r)));return n},writable:!0,configurable:!0}),Object.defineProperty(Object,"getPrototypeAndDescriptorDefiningProperty",{value:function(e,t){var n,r=e;if(t){do n=Object.getOwnPropertyDescriptor(r,t);while(!n&&(r=r.__proto__||Object.getPrototypeOf(r)));return{prototype:r,propertyDescriptor:n}}},writable:!0,configurable:!0}),Object.defineProperty(Object.prototype,"clear",{value:function(){for(var e=Object.keys(this),t=e.length;t;)t--,delete this[e[t]];return this},writable:!0,configurable:!0}),Object.defineProperty(Object,"defineBinding",{value:function(t,n,r){var i=Error.stackTraceLimit;Error.stackTraceLimit=2,console.warn("Object.defineBinding deprecated.  See the comment below this warning for migration instructions.",Error("deprecated").stack),Error.stackTraceLimit=i;var a=e("frb");r.source=r.boundObject,r.oneway?r["<-"]=r.boundObjectPropertyPath:r["<->"]=r.boundObjectPropertyPath,r.boundValueMutator&&(r.convert=r.boundValueMutator),a.defineBinding(t,n,r)}}),Object.defineProperty(Object,"deleteBinding",{value:function(t,n){var r=e("frb");r.cancelBinding(t,n)}})}}),montageDefine("e2fc70c","core/extras/date",{dependencies:[],factory:function(){Object.defineProperty(Date.prototype,"clone",{value:function(){return new Date(this)},writable:!0,configurable:!0})}}),montageDefine("e2fc70c","core/extras/element",{dependencies:[],factory:function(){Element&&!Element.isElement&&Object.defineProperty(Element,"isElement",{value:function(e){return!(!e||1!==e.nodeType)},writable:!0,configurable:!0})}}),montageDefine("e2fc70c","core/extras/function",{dependencies:["./object"],factory:function(e){e("./object"),Object.defineProperty(Function,"identity",{value:function(e){return e},writable:!0,configurable:!0}),Object.defineProperty(Function,"noop",{value:function(){},writable:!0,configurable:!0}),Object.defineProperty(Function,"by",{value:function(e,t){t=t||Object.compare,e=e||Function.identity;var n=function(n,r){return t(e(n),e(r))};return n.compare=t,n.by=e,n},writable:!0,configurable:!0})}}),montageDefine("e2fc70c","core/extras/regexp",{dependencies:[],factory:function(){if(!RegExp.isRegExp){var e=Object.prototype.toString;Object.defineProperty(RegExp,"isRegExp",{value:function(t){return"[object RegExp]"===e.call(t)},writable:!0,configurable:!0})}}}),montageDefine("e2fc70c","core/extras/string",{dependencies:[],factory:function(){Object.defineProperty(String.prototype,"equals",{value:function(e){return this.valueOf()===Object.getValueOf(e)},writable:!0,configurable:!0}),Object.defineProperty(String.prototype,"contains",{value:function(e){return-1!==this.indexOf(e)},writable:!0,configurable:!0}),Object.defineProperty(String.prototype,"toCapitalized",{value:function(){return this.charAt(0).toUpperCase()+this.slice(1)},writable:!0,configurable:!0}),Object.defineProperty(String.prototype,"addEventListener",{value:Function.noop,writable:!0,configurable:!0})}}),montageDefine("e2fc70c","core/uuid",{dependencies:[],factory:function(e,t){function n(){var e,t=r,n=i;return n[0]=t[15&(e=4294967296*Math.random())],n[1]=t[15&(e>>>=4)],n[2]=t[15&(e>>>=4)],n[3]=t[15&(e>>>=4)],n[4]=t[15&(e>>>=4)],n[5]=t[15&(e>>>=4)],n[6]=t[15&(e>>>=4)],n[7]=t[15&(e>>>=4)],n[9]=t[15&(e=4294967296*Math.random())],n[10]=t[15&(e>>>=4)],n[11]=t[15&(e>>>=4)],n[12]=t[15&(e>>>=4)],n[15]=t[15&(e>>>=4)],n[16]=t[15&(e>>>=4)],n[17]=t[15&(e>>>=4)],n[19]=t[8|3&(e=4294967296*Math.random())],n[20]=t[15&(e>>>=4)],n[21]=t[15&(e>>>=4)],n[22]=t[15&(e>>>=4)],n[24]=t[15&(e>>>=4)],n[25]=t[15&(e>>>=4)],n[26]=t[15&(e>>>=4)],n[27]=t[15&(e>>>=4)],n[28]=t[15&(e=4294967296*Math.random())],n[29]=t[15&(e>>>=4)],n[30]=t[15&(e>>>=4)],n[31]=t[15&(e>>>=4)],n[32]=t[15&(e>>>=4)],n[33]=t[15&(e>>>=4)],n[34]=t[15&(e>>>=4)],n[35]=t[15&(e>>>=4)],n.join("")}var r="0123456789ABCDEF".split(""),i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".split("");t.Uuid=Object.create(Object.prototype,{generate:{enumerable:!1,value:n}}),t.generate=n}}),montageDefine("e2fc70c","core/bindings",{dependencies:["core/core","frb"],factory:function(e,t){var n=e("core/core").Montage,r=t.Bindings=e("frb"),i={defineBinding:{value:function(e,t,n){return r.defineBinding(this,e,t,n)}},defineBindings:{value:function(e,t){return r.defineBindings(this,e,t)}},cancelBinding:{value:function(e){return r.cancelBinding(this,e)}},cancelBindings:{value:function(){return r.cancelBindings(this)}},getBinding:{value:function(e){return r.getBinding(this,e)}},getBindings:{value:function(){return r.getBindings(this)}}};n.defineProperties(n,i),n.defineProperties(n.prototype,i)}}),montageDefine("e2fc70c","core/paths",{dependencies:["core/core","collections/weak-map","collections/map","frb/parse","frb/evaluate","frb/assign","frb/observe","frb/bind","frb/compile-observer","frb/scope","frb/observers"],factory:function(e){var t=e("core/core").Montage,n=e("collections/weak-map"),r=e("collections/map"),i=e("frb/parse"),a=e("frb/evaluate"),o=e("frb/assign");e("frb/observe"),e("frb/bind");var s=e("frb/compile-observer"),l=e("frb/scope"),c=e("frb/observers"),u=c.autoCancelPrevious,h=new n,d={getPath:{value:function(e,t,n,r){return a(e,this,t||this,n,r)}},setPath:{value:function(e,t,n,r,i){return o(this,e,t,n||this,r,i)}},observePath:{value:function(e,t){var n=i(e),r=s(n);return r(u(t),new l(this))}},addRangeAtPathChangeListener:{value:function(e,t,n){function r(e,r,i){if(t[n])t[n](e,r,i);else{if(!t.call)throw Error("Can't dispatch range change to "+t);t.call(null,e,r,i)}}n=n||"handleRangeChange";var i=[];return this.addPathChangeListener(e,function(e){return e&&e.toArray&&e.addRangeChangeListener?(r(e.toArray(),i.toArray(),0),i=e,e.addRangeChangeListener(r)):(e=[],r(e,i,0),i=e,void 0)})}},getPathChangeDescriptors:{value:function(){return h.has(this)||h.set(this,{}),h.get(this)}},getPathChangeDescriptor:{value:function(e,n,i){var a=t.getPathChangeDescriptors.call(this);return Object.owns(a,e)||(a[e]={willChangeListeners:new r,changeListeners:new r}),a=a[e],a=i?a.willChangeListeners:a.changeListeners,a.has(n)||a.set(n,{path:e,handler:n,beforeChange:i,cancel:Function.noop}),a.get(n)}},addPathChangeListener:{value:function(e,n,r,a){var o=this;n=n||Function.noop;var c=t.getPathChangeDescriptor.call(this,e,n,a);c.cancel();var h,d,p,f=i(e);if(n===Function.noop)p=function(t){if(d)throw Error("Path change handler needs a handler because it emits new values when the source changes: "+JSON.stringify(e));d=!0,h=t};else if(r)p=function(t){return n[r].call(n,t,e,o)};else if(n.handlePathChange)p=function(t){return n.handlePathChange.call(n,t,e,o)};else{if("function"!=typeof n)throw Error("Can't recognize handler type: "+n+". Must be function or delegate implementing handlePathChange.");p=function(t){return n.call(o,t,e,o)}}var m=s(f),g=m(u(p),new l(this));return c.cancel=g,d?h:g}},removePathChangeListener:{value:function(e,n,r){n=n||Function.noop;var i=t.getPathChangeDescriptors.call(this),a=r?"willChangeListeners":"changeListeners";if(!Object.owns(i,e))throw Error("Can't find "+a+" for "+JSON.stringify(e));var o=i[e],s=o[a];if(!s.has(n))throw Error("Can't find "+a+" for "+JSON.stringify(e));var l=s.get(n);l.cancel(),s["delete"](n),0===o.willChangeListeners.length&&0===o.changeListeners.length&&delete i[e];for(var c in i)return;h["delete"](this)}},addBeforePathChangeListener:{value:function(e,n,r){return t.addPathChangeListener.call(this,e,n,r,!0)}},removeBeforePathChangeListener:{value:function(e,n){return t.removePathChangeListener.call(this,e,n,!0)}}};t.defineProperties(t,d),t.defineProperties(t.prototype,d)}}),montageDefine("e2fc70c","core/serialization/bindings",{dependencies:["frb","frb/parse","frb/stringify","frb/expand","frb/scope","core/serialization"],factory:function(e){var t=e("frb"),n=(e("frb/parse"),e("frb/stringify")),r=e("frb/expand"),i=e("frb/scope"),a=e("core/serialization").Serializer,o=e("core/serialization").Deserializer;a.defineSerializationUnit("bindings",function(e,a){var o,s=t.getBindings(a),l={};for(var c in s){var u=s[c],h={};if(!("serializable"in u)||u.serializable){var d=u.sourcePath,p=u.sourceSyntax;if(u.source!==a){var f=e.getObjectLabel(u.source),m=new i({type:"component",label:f});m.components=e,p=r(p,m)}var m=new i;m.components=e,d=n(p,m),u.twoWay?h["<->"]=d:h["<-"]=d,u.converter?h.converter=u.converter:(h.convert=u.convert,h.revert=u.revert),u.trace&&(h.trace=!0),l[c]=h,o=!0}}return o?l:void 0}),o.defineDeserializationUnit("bindings",function(e,n,r){for(var i in r){var a=r[i];if("object"!=typeof a)throw Error("Binding descriptor must be an object, not "+typeof a);"boundObject"in a?(a.source=e.getObjectByLabel(a.boundObject),a.oneway?a["<-"]=a.boundPropertyPath:a["<->"]=a.boundPropertyPath,delete a.boundObject,delete a.boundObjectPropertyPath,delete a.oneway):a["<<->"]&&(console.warn("WARNING: <<-> in bindings is deprectated, use <-> only, please update now."),a["<->"]=a["<<->"],delete a["<<->"])}t.defineBindings(n,r,{components:e})})}}),montageDefine("e2fc70c","core/serialization/deserializer/properties-deserializer",{dependencies:["core/core","core/promise"],factory:function(e,t){var n=e("core/core").Montage;e("core/promise").Promise;var r=n.specialize({_object:{value:null},_objectDescriptor:{value:null},_context:{value:null},initWithObjectAndObjectDescriptorAndContext:{value:function(e,t,n){return this._object=e,this._objectDescriptor=t,this._context=n,this}},get:{value:function(e){return this._objectDescriptor.properties?this._objectDescriptor.properties[e]:void 0}},deserializeProperties:{value:function(e){var t,r=this._object,i=this._objectDescriptor.properties;if(i){e||(e=n.getSerializablePropertyNames(r));
for(var a=0,o=e.length;o>a;a++)t=e[a],r[t]=i[t]}}},getObjectByLabel:{value:function(e){this._context.getObject(e)}}});t.PropertiesDeserializer=r}}),montageDefine("e2fc70c","core/serialization/deserializer/self-deserializer",{dependencies:["core/core","core/promise"],factory:function(e,t){var n=e("core/core").Montage;e("core/promise").Promise;var r=n.specialize({_object:{value:null},_objectDescriptor:{value:null},_context:{value:null},_unitNames:{value:null},_objectUnitNames:{value:null},create:{value:function(){return new this}},initWithObjectAndObjectDescriptorAndContextAndUnitNames:{value:function(e,t,n,r){return this._object=e,this._objectDescriptor=t,this._context=n,this._unitNames=r,this}},getProperty:{value:function(e){return this._objectDescriptor.properties?this._objectDescriptor.properties[e]:void 0}},getType:{value:function(){return"prototype"in this._objectDescriptor?"prototype":"object"in this._objectDescriptor?"object":void 0}},getTypeValue:{value:function(){return this._objectDescriptor.prototype||this._objectDescriptor.object}},getObjectByLabel:{value:function(e){this._context.getObject(e)}},deserializeProperties:{value:function(e){var t,r=this._object,i=this._objectDescriptor.properties;if(i){e||(e=n.getSerializablePropertyNames(r));for(var a=0,o=e.length;o>a;a++)t=e[a],r[t]=i[t]}}},deserializeUnit:{value:function(e){var t=this._objectUnitNames;t?-1===t.indexOf(e)&&t.push(e):(t=this._objectUnitNames=[e],this._context.setUnitsToDeserialize(this._object,this._objectDescriptor,t))}},deserializeUnits:{value:function(){var e=this._objectUnitNames;if(e)for(var t,n=0;t=e[n];n++)-1===e.indexOf(t)&&e.push(t);else e=this._objectUnitNames=this._unitNames,this._context.setUnitsToDeserialize(this._object,this._objectDescriptor,e)}}});t.SelfDeserializer=r}}),montageDefine("e2fc70c","core/serialization/deserializer/unit-deserializer",{dependencies:["core/core","core/promise"],factory:function(e,t){var n=e("core/core").Montage,r=e("core/promise").Promise,i=n.specialize({_context:{value:null},create:{value:function(){return new this}},initWithContext:{value:function(e){return this._context=e,this}},getObjectByLabel:{value:function(e){var t=this._context.getObject(e);return r.isPromise(t)?void 0:t}}});t.UnitDeserializer=i}}),montageDefine("e2fc70c","core/module-reference",{dependencies:["montage"],factory:function(e,t){var n=e("montage").Montage;t.ModuleReference=n.specialize({constructor:{value:function(){return this.super()}},initWithIdAndRequire:{value:function(e,t){if(!e||!t)throw Error("Module ID and require required");return this.id=e,this.require=t,this}},id:{value:null},require:{value:null},_exports:{value:null},exports:{get:function(){return this._exports?this._exports:this._exports=this.require.async(this.id)}},resolve:{value:function(e){return e.identify(this.id,this.require)}},isModuleReference:{writable:!1,configurable:!1,value:!0}})}}),montageDefine("e2fc70c","core/event/mutable-event",{dependencies:["montage"],factory:function(e,t){var n=e("montage").Montage;if("undefined"!=typeof window){var r={},i=function(e,t){var r="_"+t;n.defineProperty(e,r,{value:void 0}),n.defineProperty(e,t,{get:function(e,t){return function(){return this.hasOwnProperty(t)?this[t]:this._event?this._event[e]:void 0}}(t,r),set:function(e){return function(t){this[e]=t}}(r)})};t.MutableEvent=n.specialize({_initPrototypeWithEvent:{value:function(e){var t;for(t in e)this[t]||i(this,t);return i(this,"replayed"),this}},_initWithEvent:{value:function(e){return this._event=e,this}},preventDefault:{value:function(){this._event.preventDefault()}},stopImmediatePropagation:{value:function(){this._event.stopImmediatePropagation(),this.propagationStopped=!0,this.immediatePropagationStopped=!0}},propagationStopped:{value:!1},immediatePropagationStopped:{value:!1},mutable:{value:!0},target:{value:null},stopPropagation:{value:function(){this._event.stopPropagation(),this.propagationStopped=!0}},stop:{value:function(){this.preventDefault(),this.stopPropagation()}}},{fromEvent:{value:function(e){var n,i=e.type,a=r[i];return a||(a=function(){},a.prototype=(new t.MutableEvent)._initPrototypeWithEvent(e),r[i]=a),n=new a,n._initWithEvent(e),n}},fromType:{value:function(e,t,n,r){var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t,n,r),this.fromEvent(i)}}})}}}),montageDefine("e2fc70c","core/serialization",{dependencies:["./serialization/serializer/montage-serializer","./serialization/deserializer/montage-deserializer"],factory:function(e,t){var n=e("./serialization/serializer/montage-serializer").MontageSerializer,r=e("./serialization/serializer/montage-serializer").serialize,i=e("./serialization/deserializer/montage-deserializer").MontageDeserializer,a=e("./serialization/deserializer/montage-deserializer").deserialize;t.Serializer=n,t.serialize=r,t.Deserializer=i,t.deserialize=a}}),montageDefine("e2fc70c","core/serialization/serializer/montage-serializer",{dependencies:["core/core","mousse/serialization/malker","mousse/serialization/serializer","./montage-builder","./montage-labeler","./montage-visitor","core/logger"],factory:function(e,t){var n=e("core/core").Montage,r=e("mousse/serialization/malker").Malker,i=e("mousse/serialization/serializer").Serializer,a=e("./montage-builder").MontageBuilder,o=e("./montage-labeler").MontageLabeler,s=e("./montage-visitor").MontageVisitor;e("core/logger").logger("montage-serializer");var l=n.specialize.call(i,{_require:{value:null},_visitor:{value:null},_units:{value:Object.create(null)},_findObjectNameRegExp:{value:/([^\/]+?)(\.reel)?$/},_toCamelCaseRegExp:{value:/(?:^|-)([^-])/g},_replaceToCamelCase:{value:function(e,t){return t.toUpperCase()}},constructor:{value:function l(){}},initWithRequire:{value:function(e){return this._require=e,this._builder=new a,this._labeler=new o,this._visitor=(new s).initWithBuilderAndLabelerAndRequireAndUnits(this._builder,this._labeler,this._require,this._units),this._malker=new r(this._visitor),this}},getExternalObjects:{value:function(){return this._visitor.getExternalObjects()}},getExternalElements:{value:function(){return this._visitor.getExternalElements()}},defineSerializationUnit:{value:function(e,t){this.constructor.defineSerializationUnit.call(this,e,t)}}},{defineSerializationUnit:{value:function(e,t){this._units[e]=t}},getDefaultObjectNameForModuleId:{value:function(e){return this._findObjectNameRegExp.test(e),RegExp.$1.replace(this._toCamelCaseRegExp,this._replaceToCamelCase)}}});t.MontageSerializer=l,t.serialize=function(e,t){return(new l).initWithRequire(t).serializeObject(e)}}}),montageDefine("e2fc70c","core/serialization/deserializer/montage-deserializer",{dependencies:["core/core","mousse/deserialization/interpreter","mousse/deserialization/deserializer","./montage-interpreter","./montage-reviver","core/promise","core/jshint","core/logger"],factory:function(e,t){var n=e("core/core").Montage;e("mousse/deserialization/interpreter").Interpreter;var r=e("mousse/deserialization/deserializer").Deserializer,i=e("./montage-interpreter").MontageInterpreter,a=e("./montage-reviver").MontageReviver,o=e("core/promise").Promise,s=e("core/jshint").JSHINT;e("core/logger").logger("montage-deserializer");var l=n.specialize.call(r,{_interpreter:{value:null},_serializationString:{value:null},_serialization:{value:null},init:{value:function(e,t,n){if(!this.isSerializationStringValid(e))throw Error(this._formatSerializationSyntaxError(e));return r.call(this,e),this._origin,this._serialization=null,this._interpreter=(new i).init(t,n),this}},serialization:{get:function(){var e=this._serialization;return e||(e=JSON.parse(this._serializationString),this._serialization=e),e}},deserialize:{value:function(e,t){var n;try{n=JSON.parse(this._serializationString)}catch(r){return o.reject(r)}return this._interpreter.instantiate(n,e,t)}},preloadModules:{value:function(){var e=JSON.parse(this._serializationString);return this._interpreter.preloadModules(e)}},getExternalObjectLabels:{value:function(){var e=this.serialization,t=[];for(var n in e)0===Object.keys(e[n]).length&&t.push(n);return t}},isSerializationStringValid:{value:function(e){try{return JSON.parse(e),!0}catch(t){return!1}}},_formatSerializationSyntaxError:{value:function(e){var t,n,r,i,a,o="   ",l=this._origin;if(s(e))t="Syntax error in the serialization but not able to find it!\n"+e;else{n=s.errors[0],r=e.split("\n"),i=(o+r.length).length,a=n.line-1;for(var c=0,u=r.length;u>c;c++)r[c]=Array(i-(c+1+"").length+1).join(c===a?">":" ")+(c+1)+" "+r[c];t="Syntax error at line "+n.line+(l?" from "+l:"")+":\n"+n.evidence+"\n"+n.reason+"\n"+r.join("\n")}return t}}},{defineDeserializationUnit:{value:function(e,t){a.defineUnitReviver(e,t)}}});t.MontageDeserializer=l,t.deserialize=function(e,t){return(new l).init(e,t).deserializeObject()}}}),montageDefine("e2fc70c","core/serialization/serializer/montage-builder",{dependencies:["montage","mousse/serialization/builder","./montage-ast"],factory:function(e,t){var n=e("montage").Montage,r=e("mousse/serialization/builder").Builder,i=e("./montage-ast"),a=n.specialize.call(r,{constructor:{value:function a(){r.call(this)}},createElementReference:{value:function(e){return(new i.ElementReference).initWithRootAndId(this._root,e)}},createModuleReference:{value:function(e){return(new i.ModuleReference).initWithRootAndModuleId(this._root,e)}}});t.MontageBuilder=a}}),montageDefine("e2fc70c","core/serialization/serializer/montage-labeler",{dependencies:["montage","mousse/serialization/labeler"],factory:function(e,t){var n=e("montage").Montage,r=e("mousse/serialization/labeler").Labeler;t.MontageLabeler=n.specialize.call(r,{_labelRegexp:{value:/^[a-zA-Z_$][0-9a-zA-Z_$]*$/},constructor:{value:function(){r.call(this)}},getObjectName:{value:function(e){var t,i=e.identifier;return i&&this._labelRegexp.test(i)?t=e.identifier:"getInfoForObject"in e||"getInfoForObject"in e.constructor?(t=n.getInfoForObject(e).objectName,t=t.toLowerCase()):t=r.prototype.getObjectName.call(this,e),t}}})}}),montageDefine("e2fc70c","core/serialization/serializer/montage-visitor",{dependencies:["montage","./montage-serializer","./properties-serializer","./self-serializer","./unit-serializer","mousse/serialization/visitor"],factory:function(e,t){var n=e("montage").Montage,r=e("./montage-serializer"),i=e("./properties-serializer").PropertiesSerializer,a=e("./self-serializer").SelfSerializer,o=e("./unit-serializer").UnitSerializer,s=e("mousse/serialization/visitor").Visitor,l=n.specialize.call(s,{_MONTAGE_ID_ATTRIBUTE:{value:"data-montage-id"},_require:{value:null},_units:{value:null},_elements:{value:null},constructor:{value:function l(){}},initWithBuilderAndLabelerAndRequireAndUnits:{value:function(e,t,n,r){return s.call(this,e,t),this._require=n,this._units=r,this._elements=[],this}},getTypeOf:{value:function(e){return e.isModuleReference?"Module":"getInfoForObject"in e||"getInfoForObject"in e.constructor?"MontageObject":e.thisIsAReferenceCreatedByMontageSerializer?"MontageReference":"undefined"!=typeof Element&&Element.isElement(e)?"Element":void 0}},visitMontageReference:{value:function(e,t,n){this.builder.top.setProperty(n,t.reference)}},visitElement:{value:function(e,t,n){var r,i;if(i=t.getAttribute(this._MONTAGE_ID_ATTRIBUTE),!i)throw Error("Not possible to serialize a DOM element with no "+this._MONTAGE_ID_ATTRIBUTE+" assigned: "+t.outerHTML);r=this.builder.createElementReference(i),this.storeValue(r,t,n),this._elements.push(t)}},visitModule:{value:function(e,t,n){var r,i;try{i=t.resolve(this._require)}catch(a){throw Error("Not possible to serialize module reference "+t.id+" from package "+t.require.location+" inside package "+this._require.location)}r=this.builder.createModuleReference(i),this.storeValue(r,t,n)}},visitMontageObject:{value:function(e,t,n){this.isObjectSerialized(t)?this.serializeReferenceToMontageObject(e,t,n):this.handleMontageObject(e,t,n)}},handleMontageObject:{value:function(e,t,n){var r,i=this.builder.createCustomObject();this.setObjectSerialization(t,i),r=this.serializeMontageObject(e,t,i),r?this.serializeSubstituteObject(e,t,n,i,r):(i.setLabel(this.labeler.getObjectLabel(t)),this.builder.top.setProperty(n,i))}},serializeReferenceToMontageObject:{value:function(e,t,n){var r=this.labeler.getObjectLabel(t),i=this.builder.createObjectReference(r);this.builder.top.setProperty(n,i)}},serializeSubstituteObject:{value:function(e,t,n,r,i){var a,o,s,l;a=this.labeler.getObjectLabel(t),this.labeler.isUserDefinedLabel(a)?(o=this.labeler.getObjectLabel(i),this.labeler.setObjectLabel(i,a),this.builder.relabelReferences(o,a),l=this.getObjectSerialization(i),l&&(l.setLabel(a),this.labeler.isUserDefinedLabel(o)&&this.builder.createObjectReference(a).setLabel(o)),e.visit(i,n)):(e.visit(i,n),s=this.labeler.getObjectLabel(i),this.labeler.setObjectLabel(t,s),this.builder.relabelReferences(a,s))}},serializeMontageObject:{value:function(e,t,n){var r,i,o=this.builder.createObjectLiteral();return this.setObjectType(t,n),n.setProperty("properties",o),this.builder.push(n),"function"==typeof t.serializeSelf?(r=(new a).initWithMalkerAndVisitorAndObject(e,this,t,n),i=t.serializeSelf(r)):(this.setObjectProperties(e,t),this.setObjectCustomUnits(e,t)),this.builder.pop(),0===o.getPropertyNames().length&&n.clearProperty("properties"),i}},setObjectType:{value:function(e,t){var r=n.getInfoForObject(e).isInstance,i=this.getObjectLocationId(e),a=this.builder.createString(i);r?t.setProperty("prototype",a):t.setProperty("object",a)}},getObjectModuleId:{value:function(e){var t=n.getInfoForObject(e);return this._require.identify(t.moduleId,t.require)}},getObjectLocationId:{value:function(e){var t,i=this.getObjectModuleId(e),a=n.getInfoForObject(e),o=a.objectName;return t=r.MontageSerializer.getDefaultObjectNameForModuleId(i),t===o?i:i+"["+o+"]"}},setObjectProperties:{value:function(e,t){var n,r;r=this.builder.top.getProperty("properties"),this.builder.push(r),"function"==typeof t.serializeProperties?(n=(new i).initWithMalkerAndVisitorAndObject(e,this,t),t.serializeProperties(n)):this.setSerializableObjectProperties(e,t),this.builder.pop()}},setSerializableObjectProperties:{value:function(e,t){for(var r,i,a=n.getSerializablePropertyNames(t),o=a.length,s=0;o>s;s++)i=a[s],r=n.getPropertyAttribute(t,i,"serializable"),this.setProperty(e,i,t[i],r)}},hackIsReferenceAllowedForValue:{value:function(e){return"object"==typeof e&&null!=e&&!("undefined"!=typeof Element&&Element.isElement(e))}},setProperty:{value:function(e,t,n,r){var i;if("reference"===r&&this.hackIsReferenceAllowedForValue(n)){i=this.labeler.getObjectLabel(n);var a=this.builder.createObjectReference(i);this.builder.top.setProperty(t,a)}else e.visit(n,t)}},setObjectCustomUnits:{value:function(e,t){for(var n in this._units)this.setObjectCustomUnit(e,t,n)}},setObjectCustomUnit:{value:function(e,t,n){var r,i,a=this._units[n];a&&(i=(new o).initWithMalkerAndVisitorAndObject(e,this,t),r=a(i,t),null!=r&&e.visit(r,n))}},getExternalObjects:{value:function(){for(var e,t={},n=this.builder.getExternalReferences(),r=0;e=n[r];r++)t[e]=this.labeler.getObjectByLabel(e);return t}},getExternalElements:{value:function(){return this._elements}}});t.MontageVisitor=l}}),montageDefine("e2fc70c","core/serialization/deserializer/montage-interpreter",{dependencies:["core/core","mousse/deserialization/interpreter","mousse/deserialization/context","./montage-reviver","core/promise"],factory:function(e,t){var n=e("core/core").Montage,r=e("mousse/deserialization/interpreter").Interpreter,i=e("mousse/deserialization/context").Context,a=e("./montage-reviver").MontageReviver,o=e("core/promise").Promise,s=n.specialize.call(r,{_require:{value:null},_reviver:{value:null},init:{value:function(e,t){if("function"!=typeof e)throw Error("Function 'require' missing.");return this._reviver=(new a).init(e,t),this._require=e,this}},instantiate:{value:function(e,t,n){var r;return r=(new l).init(e,this._reviver,t,n,this._require),r.getObjects()}},preloadModules:{value:function(e){var t,n,r,i,s=this._reviver,l=s.moduleLoader,c=[];for(var u in e)t=e[u],n=t.prototype||t.object,n&&(r=a.parseObjectLocationId(n),i=l.getModule(r.moduleId,u),o.isPromise(i)&&c.push(i));return c.length>0?o.all(c):void 0}}}),l=n.specialize.call(i,{_ELEMENT_ID_ATTRIBUTE:{value:"data-montage-id"},_unitsToDeserialize:{value:null},_element:{value:null},_require:{value:null},constructor:{value:function(){this._unitsToDeserialize=[]}},init:{value:function(e,t,n,r,a){return i.call(this,e,t,n),this._element=r,this._require=a,this}},getRequire:{value:function(){return this._require}},getElement:{value:function(){return this._element}},getElementById:{value:function(e){var t="*["+this._ELEMENT_ID_ATTRIBUTE+'="'+e+'"]';return this._element.querySelector(t)}},setUnitsToDeserialize:{value:function(e,t,n){this._unitsToDeserialize.push({object:e,objectDesc:t,unitNames:n})}},getUnitsToDeserialize:{value:function(){return this._unitsToDeserialize}}});t.MontageInterpreter=s,t.MontageContext=l}}),montageDefine("e2fc70c","core/jshint",{dependencies:[],factory:function(e,t){var n=function(e){var t,n=function(){return t||(t=e(n)),t.apply(this,arguments)};return n}(function(e){"use strict";function t(){}function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function r(e,t){var r;for(r in t)n(t,r)&&(e[r]=t[r])}function i(){dt.couch&&r(pt,St),dt.rhino&&r(pt,Bt),dt.prototypejs&&r(pt,At),dt.node&&r(pt,Dt),dt.devel&&r(pt,Ot),dt.dojo&&r(pt,kt),dt.browser&&r(pt,Et),dt.jquery&&r(pt,jt),dt.mootools&&r(pt,Pt),dt.wsh&&r(pt,Ft),dt.globalstrict&&dt.strict!==!1&&(dt.strict=!0)}function a(e,t,n){var r=Math.floor(100*(t/ot.length));throw{name:"JSHintError",line:t,character:n,message:e+" ("+r+"% scanned)."}}function o(t,n,r,i,o,s){var l,c,u;return n=n||ut,"(end)"===n.id&&(n=wt),c=n.line||0,l=n.from||0,u={id:"(error)",raw:t,evidence:ot[c-1]||"",line:c,character:l,a:r,b:i,c:o,d:s},u.reason=t.supplant(u),e.errors.push(u),dt.passfail&&a("Stopping. ",c,l),xt+=1,xt>=dt.maxerr&&a("Too many errors.",c,l),u}function s(e,t,n,r,i,a,s){return o(e,{line:t,from:n},r,i,a,s)}function l(e,t,n,r,i,s){var l=o(e,t,n,r,i,s);a("Stopping, unable to continue.",l.line,l.character)}function c(e,t,n,r,i,a,o){return l(e,{line:t,from:n},r,i,a,o)}function u(e,t){"hasOwnProperty"===e&&o("'hasOwnProperty' is a really bad name."),n(Q,e)&&!Q["(global)"]&&(Q[e]===!0?dt.latedef&&o("'{a}' was used before it was defined.",ut,e):dt.shadow||o("'{a}' is already defined.",ut,e)),Q[e]=t,Q["(global)"]?(tt[e]=Q,n(nt,e)&&(dt.latedef&&o("'{a}' was used before it was defined.",ut,e),delete nt[e])):gt[e]=Q}function h(){var e,t,n,r,a,o=ut.value;switch(o){case"*/":l("Unbegun comment.");break;case"/*members":case"/*member":o="/*members",ct||(ct={}),t=ct;break;case"/*jshint":case"/*jslint":t=dt,n=Mt;break;case"/*global":t=pt;break;default:l("What?")}r=Xt.token();e:for(;;){for(;;){if("special"===r.type&&"*/"===r.value)break e;if("(endline)"!==r.id&&","!==r.id)break;r=Xt.token()}"(string)"!==r.type&&"(identifier)"!==r.type&&"/*members"!==o&&l("Bad option.",r),a=Xt.token(),":"===a.id?(a=Xt.token(),t===ct&&l("Expected '{a}' and instead saw '{b}'.",r,"*/",":"),"indent"!==r.value||"/*jshint"!==o&&"/*jslint"!==o?"maxerr"!==r.value||"/*jshint"!==o&&"/*jslint"!==o?"maxlen"!==r.value||"/*jshint"!==o&&"/*jslint"!==o?"true"===a.value?t[r.value]=!0:"false"===a.value?t[r.value]=!1:l("Bad option value.",a):(e=+a.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&l("Expected a small integer and instead saw '{a}'.",a,a.value),t.maxlen=e):(e=+a.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&l("Expected a small integer and instead saw '{a}'.",a,a.value),t.maxerr=e):(e=+a.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&l("Expected a small integer and instead saw '{a}'.",a,a.value),t.white=!0,t.indent=e),r=Xt.token()):(("/*jshint"===o||"/*jslint"===o)&&l("Missing option value.",r),t[r.value]=!1,r=a)}n&&i()}function d(e){for(var t,n=e||0,r=0;n>=r;)t=st[r],t||(t=st[r]=Xt.token()),r+=1;return t}function p(e,t){switch(wt.id){case"(number)":"."===ut.id&&o("A dot following a number can be confused with a decimal point.",wt);break;case"-":("-"===ut.id||"--"===ut.id)&&o("Confusing minusses.");break;case"+":("+"===ut.id||"++"===ut.id)&&o("Confusing plusses.")}for(("(string)"===wt.type||wt.identifier)&&($=wt.value),e&&ut.id!==e&&(t?"(end)"===ut.id?o("Unmatched '{a}'.",t,t.id):o("Expected '{a}' to match '{b}' from line {c} and instead saw '{d}'.",ut,e,t.id,t.line,ut.value):("(identifier)"!==ut.type||ut.value!==e)&&o("Expected '{a}' and instead saw '{b}'.",ut,e,ut.value)),mt=wt,wt=ut;;){if(ut=st.shift()||Xt.token(),"(end)"===ut.id||"(error)"===ut.id)return;if("special"===ut.type)h();else if("(endline)"!==ut.id)break}}function f(e,t){var n,r=!1;if("(end)"===ut.id&&l("Unexpected early end of program.",wt),p(),t&&($="anonymous",Q["(verb)"]=wt.value),t===!0&&wt.fud)n=wt.fud();else{if(wt.nud)n=wt.nud();else{if("(number)"===ut.type&&"."===wt.id)return o("A leading decimal point can be confused with a dot: '.{a}'.",wt,ut.value),p(),wt;l("Expected an identifier and instead saw '{a}'.",wt,wt.id)}for(;ut.lbp>e;)r="Array"==wt.value,p(),r&&"("==wt.id&&")"==ut.id&&o("Use the array literal notation [].",wt),wt.led?n=wt.led(n):l("Expected an operator and instead saw '{a}'.",wt,wt.id)}return n}function m(e,t){e=e||wt,t=t||ut,dt.white&&e.character!==t.from&&e.line===t.line&&o("Unexpected space after '{a}'.",t,e.value)}function g(e,t){e=e||wt,t=t||ut,!dt.white||e.character===t.from&&e.line===t.line||o("Unexpected space before '{a}'.",t,t.value)}function v(e,t){e=e||wt,t=t||ut,dt.white&&!e.comment&&e.line===t.line&&m(e,t)}function b(e,t){dt.white&&(e=e||wt,t=t||ut,e.line===t.line&&e.character===t.from&&o("Missing space after '{a}'.",ut,e.value))}function y(e,t){e=e||wt,t=t||ut,dt.laxbreak||e.line===t.line?dt.white&&(e=e||wt,t=t||ut,e.character===t.from&&o("Missing space after '{a}'.",ut,e.value)):o("Bad line breaking before '{a}'.",t,t.id)}function _(e){var t;dt.white&&"(end)"!==ut.id&&(t=it+(e||0),ut.from!==t&&o("Expected '{a}' to have an indentation at {b} instead at {c}.",ut,ut.value,t,ut.from))}function w(e){e=e||wt,e.line!==ut.line&&o("Line breaking error '{a}'.",e,e.value)}function C(){wt.line!==ut.line?dt.laxbreak||o("Bad line breaking before '{a}'.",wt,ut.id):wt.character!==ut.from&&dt.white&&o("Unexpected space after '{a}'.",ut,wt.value),p(","),b(wt,ut)}function x(e,t){var n=It[e];return n&&"object"==typeof n||(It[e]=n={id:e,lbp:t,value:e}),n}function L(e){return x(e,0)}function M(e,t){var n=L(e);return n.identifier=n.reserved=!0,n.fud=t,n}function E(e,t){var n=M(e,t);return n.block=!0,n}function S(e){var t=e.id.charAt(0);return(t>="a"&&"z">=t||t>="A"&&"Z">=t)&&(e.identifier=e.reserved=!0),e}function O(e,t){var n=x(e,150);return S(n),n.nud="function"==typeof t?t:function(){return this.right=f(150),this.arity="unary",("++"===this.id||"--"===this.id)&&(dt.plusplus?o("Unexpected use of '{a}'.",this,this.id):this.right.identifier&&!this.right.reserved||"."===this.right.id||"["===this.right.id||o("Bad operand.",this)),this},n}function k(e,t){var n=L(e);return n.type=e,n.nud=t,n}function T(e,t){var n=k(e,t);return n.identifier=n.reserved=!0,n}function z(e,t){return T(e,function(){return"function"==typeof t&&t(this),this})}function j(e,t,n,r){var i=x(e,n);return S(i),i.led=function(e){return r||(y(mt,wt),b(wt,ut)),"function"==typeof t?t(e,this):(this.left=e,this.right=f(n),this)},i}function P(e,t){var n=x(e,100);return n.led=function(e){y(mt,wt),b(wt,ut);var n=f(100);return e&&"NaN"===e.id||n&&"NaN"===n.id?o("Use the isNaN function to compare with NaN.",this):t&&t.apply(this,[e,n]),"!"===e.id&&o("Confusing use of '{a}'.",e,"!"),"!"===n.id&&o("Confusing use of '{a}'.",e,"!"),this.left=e,this.right=n,this},n}function D(e){return e&&("(number)"===e.type&&0===+e.value||"(string)"===e.type&&""===e.value||"null"===e.type&&!dt.eqnull||"true"===e.type||"false"===e.type||"undefined"===e.type)}function A(e){return x(e,20).exps=!0,j(e,function(e,t){if(t.left=e,pt[e.value]===!1&&gt[e.value]["(global)"]===!0?o("Read only.",e):e["function"]&&o("'{a}' is a function.",e,e.value),e){if("."===e.id||"["===e.id)return e.left&&"arguments"!==e.left.value||o("Bad assignment.",t),t.right=f(19),t;if(e.identifier&&!e.reserved)return"exception"===Q[e.value]&&o("Do not assign to the exception parameter.",e),t.right=f(19),t;e===It["function"]&&o("Expected an identifier in an assignment and instead saw a function invocation.",wt)}l("Bad assignment.",t)},20)}function B(e,t,n){var r=x(e,n);return S(r),r.led="function"==typeof t?t:function(e){return dt.bitwise&&o("Unexpected use of '{a}'.",this,this.id),this.left=e,this.right=f(n),this},r}function R(e){return x(e,20).exps=!0,j(e,function(e,t){return dt.bitwise&&o("Unexpected use of '{a}'.",t,t.id),b(mt,wt),b(wt,ut),e?"."===e.id||"["===e.id||e.identifier&&!e.reserved?(f(19),t):(e===It["function"]&&o("Expected an identifier in an assignment, and instead saw a function invocation.",wt),t):(l("Bad assignment.",t),void 0)},20)}function I(e){var t=x(e,150);return t.led=function(e){return dt.plusplus?o("Unexpected use of '{a}'.",this,this.id):e.identifier&&!e.reserved||"."===e.id||"["===e.id||o("Bad operand.",this),this.left=e,this},t}function F(e){return ut.identifier?(p(),wt.reserved&&!dt.es5&&(e&&"undefined"==wt.value||o("Expected an identifier and instead saw '{a}' (a reserved word).",wt,wt.id)),wt.value):void 0}function N(e){var t=F(e);return t?t:("function"===wt.id&&"("===ut.id?o("Missing name in function declaration."):l("Expected an identifier and instead saw '{a}'.",ut,ut.value),void 0)}function q(e){var t,n=0;if(";"===ut.id&&!ht)for(;;){if(t=d(n),t.reach)return;if("(endline)"!==t.id){if("function"===t.id){o("Inner functions should be listed at the top of the outer function.",t);break}o("Unreachable '{a}' after '{b}'.",t,t.value,e);break}n+=1}}function W(e){var t,n=it,r=gt,i=ut;return";"===i.id?(o("Unnecessary semicolon.",i),p(";"),void 0):(i.identifier&&!i.reserved&&":"===d().id&&(p(),p(":"),gt=Object.create(r),u(i.value,"label"),ut.labelled||o("Label '{a}' on {b} statement.",ut,i.value,ut.value),Yt.test(i.value+":")&&o("Label '{a}' looks like a javascript url.",i,i.value),ut.label=i.value,i=ut),e||_(),t=f(0,!0),i.block||(dt.expr||t&&t.exps?dt.nonew&&"("===t.id&&"new"===t.left.id&&o("Do not use 'new' for side effects."):o("Expected an assignment or function call and instead saw an expression.",wt),";"!==ut.id?dt.asi||dt.lastsemic&&"}"==ut.id&&ut.line==wt.line||s("Missing semicolon.",wt.line,wt.from+wt.value.length):(m(wt,ut),p(";"),b(wt,ut))),it=n,gt=r,t)}function V(){return"use strict"===ut.value?(yt&&o('Unnecessary "use strict".'),p(),p(";"),yt=!0,dt.newcap=!0,dt.undef=!0,!0):!1}function U(){for(var e=[];!ut.reach&&"(end)"!==ut.id;)";"===ut.id?(o("Unnecessary semicolon."),p(";")):e.push(W());return e}function H(e,t){var n,r,i=rt,a=it,s=yt,c=gt;if(rt=e,gt=Object.create(gt),b(wt,ut),r=ut,"{"===ut.id){if(p("{"),"}"!==ut.id||wt.line!==ut.line){for(it+=dt.indent;!e&&ut.from>it;)it+=dt.indent;e||V()||s||!dt.strict||!Q["(context)"]["(global)"]||o('Missing "use strict" statement.'),n=U(),yt=s,it-=dt.indent,_()}p("}",r),it=a}else e?((!t||dt.curly)&&o("Expected '{a}' and instead saw '{b}'.",ut,"{",ut.value),ht=!0,n=[W()],ht=!1):l("Expected '{a}' and instead saw '{b}'.",ut,"{",ut.value);return Q["(verb)"]=null,gt=c,rt=i,!e||!dt.noempty||n&&0!==n.length||o("Empty block."),n}function Y(e){ct&&"boolean"!=typeof ct[e]&&o("Unexpected /*member '{a}'.",wt,e),"number"==typeof lt[e]?lt[e]+=1:lt[e]=1}function G(e){var t=e.value,n=e.line,r=nt[t];"function"==typeof r&&(r=!1),r?r[r.length-1]!==n&&r.push(n):(r=[n],nt[t]=r)}function X(){var e=F(!0);return e||("(string)"===ut.id?(e=ut.value,p()):"(number)"===ut.id&&(e=""+ut.value,p())),e}function K(){var e,t=ut,n=[];if(p("("),v(),")"===ut.id)return p(")"),v(mt,wt),void 0;for(;;){if(e=N(!0),n.push(e),u(e,"parameter"),","!==ut.id)return p(")",t),v(mt,wt),n;C()}}function Z(e,t){var n,r=dt,i=gt;return dt=Object.create(dt),gt=Object.create(gt),Q={"(name)":e||'"'+$+'"',"(line)":ut.line,"(context)":Q,"(breakage)":0,"(loopage)":0,"(scope)":gt,"(statement)":t},n=Q,wt.funct=Q,et.push(Q),e&&u(e,"function"),Q["(params)"]=K(),H(!1),gt=i,dt=r,Q["(last)"]=wt.line,Q=Q["(context)"],n}function J(){function e(){var e={},t=ut;if(p("{"),"}"!==ut.id)for(;;){if("(end)"===ut.id)l("Missing '}' to match '{' from line {a}.",ut,t.line);else{if("}"===ut.id){o("Unexpected comma.",wt);break}","===ut.id?l("Unexpected comma.",ut):"(string)"!==ut.id&&o("Expected a string and instead saw {a}.",ut,ut.value)}if(e[ut.value]===!0?o("Duplicate key '{a}'.",ut,ut.value):"__proto__"===ut.value?o("Stupid key '{a}'.",ut,ut.value):e[ut.value]=!0,p(),p(":"),J(),","!==ut.id)break;p(",")}p("}")}function t(){var e=ut;if(p("["),"]"!==ut.id)for(;;){if("(end)"===ut.id)l("Missing ']' to match '[' from line {a}.",ut,e.line);else{if("]"===ut.id){o("Unexpected comma.",wt);break}","===ut.id&&l("Unexpected comma.",ut)}if(J(),","!==ut.id)break;p(",")}p("]")}switch(ut.id){case"{":e();break;case"[":t();break;case"true":case"false":case"null":case"(number)":case"(string)":p();break;case"-":p("-"),wt.character!==ut.from&&o("Unexpected space after '-'.",wt),m(wt,ut),p("(number)");break;default:l("Expected a JSON value.",ut)}}var $,Q,et,tt,nt,rt,it,at,ot,st,lt,ct,ut,ht,dt,pt,ft,mt,gt,vt,bt,yt,_t,wt,Ct,xt,Lt={"<":!0,"<=":!0,"==":!0,"===":!0,"!==":!0,"!=":!0,">":!0,">=":!0,"+":!0,"-":!0,"*":!0,"/":!0,"%":!0},Mt={asi:!0,bitwise:!0,boss:!0,browser:!0,couch:!0,curly:!0,debug:!0,devel:!0,dojo:!0,eqeqeq:!0,eqnull:!0,es5:!0,evil:!0,expr:!0,forin:!0,globalstrict:!0,immed:!0,jquery:!0,latedef:!0,laxbreak:!0,loopfunc:!0,mootools:!0,newcap:!0,noarg:!0,node:!0,noempty:!0,nonew:!0,nomen:!0,onevar:!0,passfail:!0,plusplus:!0,prototypejs:!0,regexdash:!0,regexp:!0,rhino:!0,undef:!0,scripturl:!0,shadow:!0,strict:!0,sub:!0,supernew:!0,trailing:!0,white:!0,wsh:!0},Et={ArrayBuffer:!1,ArrayBufferView:!1,addEventListener:!1,applicationCache:!1,blur:!1,clearInterval:!1,clearTimeout:!1,close:!1,closed:!1,DataView:!1,defaultStatus:!1,document:!1,event:!1,FileReader:!1,Float32Array:!1,Float64Array:!1,focus:!1,frames:!1,getComputedStyle:!1,HTMLElement:!1,history:!1,Int16Array:!1,Int32Array:!1,Int8Array:!1,Image:!1,length:!1,localStorage:!1,location:!1,moveBy:!1,moveTo:!1,name:!1,navigator:!1,onbeforeunload:!0,onblur:!0,onerror:!0,onfocus:!0,onload:!0,onresize:!0,onunload:!0,open:!1,openDatabase:!1,opener:!1,Option:!1,parent:!1,print:!1,removeEventListener:!1,resizeBy:!1,resizeTo:!1,screen:!1,scroll:!1,scrollBy:!1,scrollTo:!1,setInterval:!1,setTimeout:!1,status:!1,top:!1,Uint16Array:!1,Uint32Array:!1,Uint8Array:!1,WebSocket:!1,window:!1,Worker:!1,XMLHttpRequest:!1,XPathEvaluator:!1,XPathException:!1,XPathExpression:!1,XPathNamespace:!1,XPathNSResolver:!1,XPathResult:!1},St={require:!1,respond:!1,getRow:!1,emit:!1,send:!1,start:!1,sum:!1,log:!1,exports:!1,module:!1},Ot={alert:!1,confirm:!1,console:!1,Debug:!1,opera:!1,prompt:!1},kt={dojo:!1,dijit:!1,dojox:!1,define:!1,require:!1},Tt={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"/":"\\/","\\":"\\\\"},zt=["closure","exception","global","label","outer","unused","var"],jt={$:!1,jQuery:!1},Pt={$:!1,$$:!1,Assets:!1,Browser:!1,Chain:!1,Class:!1,Color:!1,Cookie:!1,Core:!1,Document:!1,DomReady:!1,DOMReady:!1,Drag:!1,Element:!1,Elements:!1,Event:!1,Events:!1,Fx:!1,Group:!1,Hash:!1,HtmlTable:!1,Iframe:!1,IframeShim:!1,InputValidator:!1,instanceOf:!1,Keyboard:!1,Locale:!1,Mask:!1,MooTools:!1,Native:!1,Options:!1,OverText:!1,Request:!1,Scroller:!1,Slick:!1,Slider:!1,Sortables:!1,Spinner:!1,Swiff:!1,Tips:!1,Type:!1,typeOf:!1,URI:!1,Window:!1},Dt={__filename:!1,__dirname:!1,exports:!1,Buffer:!1,GLOBAL:!1,global:!1,module:!1,process:!1,require:!1},At={$:!1,$$:!1,$A:!1,$F:!1,$H:!1,$R:!1,$break:!1,$continue:!1,$w:!1,Abstract:!1,Ajax:!1,Class:!1,Enumerable:!1,Element:!1,Event:!1,Field:!1,Form:!1,Hash:!1,Insertion:!1,ObjectRange:!1,PeriodicalExecuter:!1,Position:!1,Prototype:!1,Selector:!1,Template:!1,Toggle:!1,Try:!1,Autocompleter:!1,Builder:!1,Control:!1,Draggable:!1,Draggables:!1,Droppables:!1,Effect:!1,Sortable:!1,SortableObserver:!1,Sound:!1,Scriptaculous:!1},Bt={defineClass:!1,deserialize:!1,gc:!1,help:!1,load:!1,loadClass:!1,print:!1,quit:!1,readFile:!1,readUrl:!1,runCommand:!1,seal:!1,serialize:!1,spawn:!1,sync:!1,toint32:!1,version:!1},Rt={Array:!1,Boolean:!1,Date:!1,decodeURI:!1,decodeURIComponent:!1,encodeURI:!1,encodeURIComponent:!1,Error:!1,eval:!1,EvalError:!1,Function:!1,hasOwnProperty:!1,isFinite:!1,isNaN:!1,JSON:!1,Math:!1,Number:!1,Object:!1,parseInt:!1,parseFloat:!1,RangeError:!1,ReferenceError:!1,RegExp:!1,String:!1,SyntaxError:!1,TypeError:!1,URIError:!1},It={},Ft={ActiveXObject:!0,Enumerator:!0,GetObject:!0,ScriptEngine:!0,ScriptEngineBuildVersion:!0,ScriptEngineMajorVersion:!0,ScriptEngineMinorVersion:!0,VBArray:!0,WSH:!0,WScript:!0},Nt=/[\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,qt=/^\s*([(){}\[.,:;'"~\?\]#@]|==?=?|\/(\*(jshint|jslint|members?|global)?|=|\/)?|\*[\/=]?|\+(?:=|\++)?|-(?:=|-+)?|%=?|&[&=]?|\|[|=]?|>>?>?=?|<([\/=!]|\!(\[|--)?|<=?)?|\^=?|\!=?=?|[a-zA-Z_$][a-zA-Z0-9_$]*|[0-9]+([xX][0-9a-fA-F]+|\.[0-9]*)?([eE][+\-]?[0-9]+)?)/,Wt=/[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,Vt=/[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,Ut=/\*\/|\/\*/,Ht=/^([a-zA-Z_$][a-zA-Z0-9_$]*)$/,Yt=/^(?:javascript|jscript|ecmascript|vbscript|mocha|livescript)\s*:/i,Gt=/^\s*\/\*\s*falls\sthrough\s*\*\/\s*$/;
"function"!=typeof Array.isArray&&(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.apply(e)}),"function"!=typeof Object.create&&(Object.create=function(e){return t.prototype=e,new t}),"function"!=typeof Object.keys&&(Object.keys=function(e){var t,r=[];for(t in e)n(e,t)&&r.push(t);return r}),"function"!=typeof String.prototype.entityify&&(String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}),"function"!=typeof String.prototype.isAlpha&&(String.prototype.isAlpha=function(){return this>="a"&&"z￿">=this||this>="A"&&"Z￿">=this}),"function"!=typeof String.prototype.isDigit&&(String.prototype.isDigit=function(){return this>="0"&&"9">=this}),"function"!=typeof String.prototype.supplant&&(String.prototype.supplant=function(e){return this.replace(/\{([^{}]*)\}/g,function(t,n){var r=e[n];return"string"==typeof r||"number"==typeof r?r:t})}),"function"!=typeof String.prototype.name&&(String.prototype.name=function(){return Ht.test(this)?this:Wt.test(this)?'"'+this.replace(Vt,function(e){var t=Tt[e];return t?t:"\\u"+("0000"+e.charCodeAt().toString(16)).slice(-4)})+'"':'"'+this+'"'});var Xt=function Xt(){function e(){var e,t;return a>=ot.length?!1:(r=1,o=ot[a],a+=1,e=o.search(/ \t/),e>=0&&s("Mixed spaces and tabs.",a,e+1),o=o.replace(/\t/g,_t),e=o.search(Nt),e>=0&&s("Unsafe character.",a,e),dt.maxlen&&dt.maxlen<o.length&&s("Line too long.",a,o.length),t=o.search(/\s+$/),dt.trailing&&~t&&!~o.search(/^\s+$/)&&s("Trailing whitespace.",a,t),!0)}function t(e,t){var o,l;return l="(color)"===e||"(range)"===e?{type:e}:"(punctuator)"===e||"(identifier)"===e&&n(It,t)?It[t]||It["(error)"]:It[e],l=Object.create(l),("(string)"===e||"(range)"===e)&&!dt.scripturl&&Yt.test(t)&&s("Script URL.",a,i),"(identifier)"===e&&(l.identifier=!0,"__iterator__"===t||"__proto__"===t?c("Reserved name '{a}'.",a,i,t):!dt.nomen||"_"!==t.charAt(0)&&"_"!==t.charAt(t.length-1)||s("Unexpected {a} in '{b}'.",a,i,"dangling '_'",t)),l.value=t,l.line=a,l.character=r,l.from=i,o=l.id,"(endline)"!==o&&(ft=o&&("(,=:[!&|?{};".indexOf(o.charAt(o.length-1))>=0||"return"===o)),l}var r,i,a,o;return{init:function(t){ot="string"==typeof t?t.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n"):t,ot[0]&&"#!"==ot[0].substr(0,2)&&(ot[0]=""),a=0,e(),i=1},range:function(e,n){var l,u="";for(i=r,o.charAt(0)!==e&&c("Expected '{a}' and instead saw '{b}'.",a,r,e,o.charAt(0));;){switch(o=o.slice(1),r+=1,l=o.charAt(0)){case"":c("Missing '{a}'.",a,r,l);break;case n:return o=o.slice(1),r+=1,t("(range)",u);case"\\":s("Unexpected '{a}'.",a,r,l)}u+=l}},token:function(){function n(e){var t,n=e.exec(o);return n?(v=n[0].length,t=n[1],h=t.charAt(0),o=o.substr(v),i=r+v-t.length,r+=v,t):void 0}function l(n){function l(e){var t=parseInt(o.substr(h+1,e),16);h+=e,t>=32&&126>=t&&34!==t&&92!==t&&39!==t&&s("Unnecessary escapement.",a,r),r+=e,u=String.fromCharCode(t)}var u,h,d="";for(at&&'"'!==n&&s("Strings must use doublequote.",a,r),h=0;;){for(;h>=o.length;)h=0,e()||c("Unclosed string.",a,i);if(u=o.charAt(h),u===n)return r+=1,o=o.substr(h+1),t("(string)",d,n);if(" ">u){if("\n"===u||"\r"===u)break;s("Control character in string: {a}.",a,r+h,o.slice(0,h))}else if("\\"===u)switch(h+=1,r+=1,u=o.charAt(h)){case"\\":case'"':case"/":break;case"'":at&&s("Avoid \\'.",a,r);break;case"b":u="\b";break;case"f":u="\f";break;case"n":u="\n";break;case"r":u="\r";break;case"t":u="	";break;case"u":l(4);break;case"v":at&&s("Avoid \\v.",a,r),u="";break;case"x":at&&s("Avoid \\x-.",a,r),l(2);break;default:s("Bad escapement.",a,r)}d+=u,r+=1,h+=1}}for(var u,h,d,p,f,m,g,v,b,y,_;;){if(!o)return t(e()?"(endline)":"(end)","");if(_=n(qt)){if(h.isAlpha()||"_"===h||"$"===h)return t("(identifier)",_);if(h.isDigit())return isFinite(Number(_))||s("Bad number '{a}'.",a,r,_),o.substr(0,1).isAlpha()&&s("Missing space after '{a}'.",a,r,_),"0"===h&&(p=_.substr(1,1),p.isDigit()?"."!==wt.id&&s("Don't use extra leading zeros '{a}'.",a,r,_):!at||"x"!==p&&"X"!==p||s("Avoid 0x-. '{a}'.",a,r,_)),"."===_.substr(_.length-1)&&s("A trailing decimal point can be confused with a dot '{a}'.",a,r,_),t("(number)",_);switch(_){case'"':case"'":return l(_);case"//":vt&&s("Unexpected comment.",a,r),o="",wt.comment=!0;break;case"/*":for(vt&&s("Unexpected comment.",a,r);g=o.search(Ut),!(g>=0);)e()||c("Unclosed comment.",a,r);r+=g+2,"/"===o.substr(g,1)&&c("Nested comment.",a,r),o=o.substr(g+2),wt.comment=!0;break;case"/*members":case"/*member":case"/*jshint":case"/*jslint":case"/*global":case"*/":return{value:_,type:"special",line:a,character:r,from:i};case"":break;case"/":if("/="===wt.id&&c("A regular expression literal can be confused with '/='.",a,i),ft){for(f=0,d=0,v=0;;){switch(u=!0,h=o.charAt(v),v+=1,h){case"":return c("Unclosed regular expression.",a,i),void 0;case"/":for(f>0&&s("Unescaped '{a}'.",a,i+v,"/"),h=o.substr(0,v-1),y={g:!0,i:!0,m:!0};y[o.charAt(v)]===!0;)y[o.charAt(v)]=!1,v+=1;return r+=v,o=o.substr(v),y=o.charAt(0),("/"===y||"*"===y)&&c("Confusing regular expression.",a,i),t("(regexp)",h);case"\\":h=o.charAt(v)," ">h?s("Unexpected control character in regular expression.",a,i+v):"<"===h&&s("Unexpected escaped character '{a}' in regular expression.",a,i+v,h),v+=1;break;case"(":if(f+=1,u=!1,"?"===o.charAt(v))switch(v+=1,o.charAt(v)){case":":case"=":case"!":v+=1;break;default:s("Expected '{a}' and instead saw '{b}'.",a,i+v,":",o.charAt(v))}else d+=1;break;case"|":u=!1;break;case")":0===f?s("Unescaped '{a}'.",a,i+v,")"):f-=1;break;case" ":for(y=1;" "===o.charAt(v);)v+=1,y+=1;y>1&&s("Spaces are hard to count. Use {{a}}.",a,i+v,y);break;case"[":h=o.charAt(v),"^"===h&&(v+=1,dt.regexp?s("Insecure '{a}'.",a,i+v,h):"]"===o.charAt(v)&&c("Unescaped '{a}'.",a,i+v,"^")),y=!1,"]"===h&&(s("Empty class.",a,i+v-1),y=!0);e:do switch(h=o.charAt(v),v+=1,h){case"[":case"^":s("Unescaped '{a}'.",a,i+v,h),y=!0;break;case"-":y?y=!1:(s("Unescaped '{a}'.",a,i+v,"-"),y=!0);break;case"]":y||dt.regexdash||s("Unescaped '{a}'.",a,i+v-1,"-");break e;case"\\":h=o.charAt(v)," ">h?s("Unexpected control character in regular expression.",a,i+v):"<"===h&&s("Unexpected escaped character '{a}' in regular expression.",a,i+v,h),v+=1,y=!0;break;case"/":s("Unescaped '{a}'.",a,i+v-1,"/"),y=!0;break;case"<":y=!0;break;default:y=!0}while(h);break;case".":dt.regexp&&s("Insecure '{a}'.",a,i+v,h);break;case"]":case"?":case"{":case"}":case"+":case"*":s("Unescaped '{a}'.",a,i+v,h)}if(u)switch(o.charAt(v)){case"?":case"+":case"*":v+=1,"?"===o.charAt(v)&&(v+=1);break;case"{":for(v+=1,h=o.charAt(v),("0">h||h>"9")&&s("Expected a number and instead saw '{a}'.",a,i+v,h),v+=1,b=+h;h=o.charAt(v),!("0">h||h>"9");)v+=1,b=+h+10*b;if(m=b,","===h&&(v+=1,m=1/0,h=o.charAt(v),h>="0"&&"9">=h))for(v+=1,m=+h;h=o.charAt(v),!("0">h||h>"9");)v+=1,m=+h+10*m;"}"!==o.charAt(v)?s("Expected '{a}' and instead saw '{b}'.",a,i+v,"}",h):v+=1,"?"===o.charAt(v)&&(v+=1),b>m&&s("'{a}' should not be greater than '{b}'.",a,i+v,b,m)}}return h=o.substr(0,v-1),r+=v,o=o.substr(v),t("(regexp)",h)}return t("(punctuator)",_);case"#":return t("(punctuator)",_);default:return t("(punctuator)",_)}}else{for(_="",h="";o&&"!">o;)o=o.substr(1);o&&c("Unexpected '{a}'.",a,r,o.substr(0,1))}}}}}();k("(number)",function(){return this}),k("(string)",function(){return this}),It["(identifier)"]={type:"(identifier)",lbp:0,identifier:!0,nud:function(){var e,t=this.value,n=gt[t];if("function"==typeof n?n=void 0:"boolean"==typeof n&&(e=Q,Q=et[0],u(t,"var"),n=Q,Q=e),Q===n)switch(Q[t]){case"unused":Q[t]="var";break;case"unction":Q[t]="function",this["function"]=!0;break;case"function":this["function"]=!0;break;case"label":o("'{a}' is a statement label.",wt,t)}else if(Q["(global)"])"typeof"!=$&&"delete"!=$&&dt.undef&&"boolean"!=typeof pt[t]&&o("'{a}' is not defined.",wt,t),G(wt);else switch(Q[t]){case"closure":case"function":case"var":case"unused":o("'{a}' used out of scope.",wt,t);break;case"label":o("'{a}' is a statement label.",wt,t);break;case"outer":case"global":break;default:if(n===!0)Q[t]=!0;else if(null===n)o("'{a}' is not allowed.",wt,t),G(wt);else if("object"!=typeof n)"typeof"!=$&&"delete"!=$&&dt.undef?o("'{a}' is not defined.",wt,t):Q[t]=!0,G(wt);else switch(n[t]){case"function":case"unction":this["function"]=!0,n[t]="closure",Q[t]=n["(global)"]?"global":"outer";break;case"var":case"unused":n[t]="closure",Q[t]=n["(global)"]?"global":"outer";break;case"closure":case"parameter":Q[t]=n["(global)"]?"global":"outer";break;case"label":o("'{a}' is a statement label.",wt,t)}}return this},led:function(){l("Expected an operator and instead saw '{a}'.",ut,ut.value)}},k("(regexp)",function(){return this}),L("(endline)"),L("(begin)"),L("(end)").reach=!0,L("</").reach=!0,L("<!"),L("<!--"),L("-->"),L("(error)").reach=!0,L("}").reach=!0,L(")"),L("]"),L('"').reach=!0,L("'").reach=!0,L(";"),L(":").reach=!0,L(","),L("#"),L("@"),T("else"),T("case").reach=!0,T("catch"),T("default").reach=!0,T("finally"),z("arguments",function(e){yt&&Q["(global)"]&&o("Strict violation.",e)}),z("eval"),z("false"),z("Infinity"),z("NaN"),z("null"),z("this",function(e){yt&&(Q["(statement)"]&&Q["(name)"].charAt(0)>"Z"||Q["(global)"])&&o("Strict violation.",e)}),z("true"),z("undefined"),A("=","assign",20),A("+=","assignadd",20),A("-=","assignsub",20),A("*=","assignmult",20),A("/=","assigndiv",20).nud=function(){l("A regular expression literal can be confused with '/='.")},A("%=","assignmod",20),R("&=","assignbitand",20),R("|=","assignbitor",20),R("^=","assignbitxor",20),R("<<=","assignshiftleft",20),R(">>=","assignshiftright",20),R(">>>=","assignshiftrightunsigned",20),j("?",function(e,t){return t.left=e,t.right=f(10),p(":"),t["else"]=f(10),t},30),j("||","or",40),j("&&","and",50),B("|","bitor",70),B("^","bitxor",80),B("&","bitand",90),P("==",function(e,t){var n=dt.eqnull&&("null"==e.value||"null"==t.value);return!n&&dt.eqeqeq?o("Expected '{a}' and instead saw '{b}'.",this,"===","=="):D(e)?o("Use '{a}' to compare with '{b}'.",this,"===",e.value):D(t)&&o("Use '{a}' to compare with '{b}'.",this,"===",t.value),this}),P("==="),P("!=",function(e,t){return dt.eqeqeq?o("Expected '{a}' and instead saw '{b}'.",this,"!==","!="):D(e)?o("Use '{a}' to compare with '{b}'.",this,"!==",e.value):D(t)&&o("Use '{a}' to compare with '{b}'.",this,"!==",t.value),this}),P("!=="),P("<"),P(">"),P("<="),P(">="),B("<<","shiftleft",120),B(">>","shiftright",120),B(">>>","shiftrightunsigned",120),j("in","in",120),j("instanceof","instanceof",120),j("+",function(e,t){var n=f(130);return e&&n&&"(string)"===e.id&&"(string)"===n.id?(e.value+=n.value,e.character=n.character,!dt.scripturl&&Yt.test(e.value)&&o("JavaScript URL.",e),e):(t.left=e,t.right=n,t)},130),O("+","num"),O("+++",function(){return o("Confusing pluses."),this.right=f(150),this.arity="unary",this}),j("+++",function(e){return o("Confusing pluses."),this.left=e,this.right=f(130),this},130),j("-","sub",130),O("-","neg"),O("---",function(){return o("Confusing minuses."),this.right=f(150),this.arity="unary",this}),j("---",function(e){return o("Confusing minuses."),this.left=e,this.right=f(130),this},130),j("*","mult",140),j("/","div",140),j("%","mod",140),I("++","postinc"),O("++","preinc"),It["++"].exps=!0,I("--","postdec"),O("--","predec"),It["--"].exps=!0,O("delete",function(){var e=f(0);return(!e||"."!==e.id&&"["!==e.id)&&o("Variables should not be deleted."),this.first=e,this}).exps=!0,O("~",function(){return dt.bitwise&&o("Unexpected '{a}'.",this,"~"),f(150),this}),O("!",function(){return this.right=f(150),this.arity="unary",Lt[this.right.id]===!0&&o("Confusing use of '{a}'.",this,"!"),this}),O("typeof","typeof"),O("new",function(){var e,t=f(155);if(t&&"function"!==t.id)if(t.identifier)switch(t["new"]=!0,t.value){case"Object":o("Use the object literal notation {}.",wt);break;case"Number":case"String":case"Boolean":case"Math":case"JSON":o("Do not use {a} as a constructor.",wt,t.value);break;case"Function":dt.evil||o("The Function constructor is eval.");break;case"Date":case"RegExp":break;default:"function"!==t.id&&(e=t.value.substr(0,1),dt.newcap&&("A">e||e>"Z")&&o("A constructor name should start with an uppercase letter.",wt))}else"."!==t.id&&"["!==t.id&&"("!==t.id&&o("Bad constructor.",wt);else dt.supernew||o("Weird construction. Delete 'new'.",this);return m(wt,ut),"("===ut.id||dt.supernew||o("Missing '()' invoking a constructor."),this.first=t,this}),It["new"].exps=!0,O("void").exps=!0,j(".",function(e,t){m(mt,wt),g();var n=N();return"string"==typeof n&&Y(n),t.left=e,t.right=n,dt.noarg&&e&&"arguments"===e.value&&("callee"===n||"caller"===n)?o("Avoid arguments.{a}.",e,n):dt.evil||!e||"document"!==e.value||"write"!==n&&"writeln"!==n||o("document.write can be a form of eval.",e),dt.evil||"eval"!==n&&"execScript"!==n||o("eval is evil."),t},160,!0),j("(",function(e,t){"}"!==mt.id&&")"!==mt.id&&g(mt,wt),v(),dt.immed&&!e.immed&&"function"===e.id&&o("Wrap an immediate function invocation in parentheses to assist the reader in understanding that the expression is the result of a function, and not the function itself.");var n=0,r=[];if(e&&"(identifier)"===e.type&&e.value.match(/^[A-Z]([A-Z0-9_$]*[a-z][A-Za-z0-9_$]*)?$/)&&"Number"!==e.value&&"String"!==e.value&&"Boolean"!==e.value&&"Date"!==e.value&&("Math"===e.value?o("Math is not a function.",e):dt.newcap&&o("Missing 'new' prefix when invoking a constructor.",e)),")"!==ut.id)for(;r[r.length]=f(10),n+=1,","===ut.id;)C();return p(")"),v(mt,wt),"object"==typeof e&&("parseInt"===e.value&&1===n&&o("Missing radix parameter.",e),dt.evil||("eval"===e.value||"Function"===e.value||"execScript"===e.value?o("eval is evil.",e):!r[0]||"(string)"!==r[0].id||"setTimeout"!==e.value&&"setInterval"!==e.value||o("Implied eval is evil. Pass a function instead of a string.",e)),e.identifier||"."===e.id||"["===e.id||"("===e.id||"&&"===e.id||"||"===e.id||"?"===e.id||o("Bad invocation.",e)),t.left=e,t},155,!0).exps=!0,O("(",function(){v(),"function"===ut.id&&(ut.immed=!0);var e=f(0);return p(")",this),v(mt,wt),dt.immed&&"function"===e.id&&("("===ut.id?o("Move the invocation into the parens that contain the function.",ut):o("Do not wrap function literals in parens unless they are to be immediately invoked.",this)),e}),j("[",function(e,t){g(mt,wt),v();var n,r=f(0);return r&&"(string)"===r.type&&(dt.evil||"eval"!==r.value&&"execScript"!==r.value||o("eval is evil.",t),Y(r.value),!dt.sub&&Ht.test(r.value)&&(n=It[r.value],n&&n.reserved||o("['{a}'] is better written in dot notation.",r,r.value))),p("]",t),v(mt,wt),t.left=e,t.right=r,t},160,!0),O("[",function(){var e=wt.line!==ut.line;for(this.first=[],e&&(it+=dt.indent,ut.from===it+dt.indent&&(it+=dt.indent));"(end)"!==ut.id;){for(;","===ut.id;)o("Extra comma."),p(",");if("]"===ut.id)break;if(e&&wt.line!==ut.line&&_(),this.first.push(f(10)),","!==ut.id)break;if(C(),"]"===ut.id&&!dt.es5){o("Extra comma.",wt);break}}return e&&(it-=dt.indent,_()),p("]",this),this},160),function(e){e.nud=function(){var e,t,n,r,i,a,s={};for(e=wt.line!==ut.line,e&&(it+=dt.indent,ut.from===it+dt.indent&&(it+=dt.indent));"}"!==ut.id;){if(e&&_(),"get"===ut.value&&":"!==d().id)p("get"),dt.es5||l("get/set are ES5 features."),n=X(),n||l("Missing property name."),a=ut,m(wt,ut),t=Z(),!dt.loopfunc&&Q["(loopage)"]&&o("Don't make functions within a loop.",a),i=t["(params)"],i&&o("Unexpected parameter '{a}' in get {b} function.",a,i[0],n),m(wt,ut),p(","),_(),p("set"),r=X(),n!==r&&l("Expected {a} and instead saw {b}.",wt,n,r),a=ut,m(wt,ut),t=Z(),i=t["(params)"],i&&1===i.length&&"value"===i[0]||o("Expected (value) in set {a} function.",a,n);else{if(n=X(),"string"!=typeof n)break;p(":"),b(wt,ut),f(10)}if(s[n]===!0&&o("Duplicate member '{a}'.",ut,n),s[n]=!0,Y(n),","!==ut.id)break;C(),","===ut.id?o("Extra comma.",wt):"}"!==ut.id||dt.es5||o("Extra comma.",wt)}return e&&(it-=dt.indent,_()),p("}",this),this},e.fud=function(){l("Expected to see a statement and instead saw a block.",wt)}}(L("{"));var Kt=M("var",function(e){var t,n,r;for(Q["(onevar)"]&&dt.onevar?o("Too many var statements."):Q["(global)"]||(Q["(onevar)"]=!0),this.first=[];b(wt,ut),t=N(),Q["(global)"]&&pt[t]===!1&&o("Redefinition of '{a}'.",wt,t),u(t,"unused"),!e&&(n=wt,this.first.push(wt),"="===ut.id&&(b(wt,ut),p("="),b(wt,ut),"undefined"===ut.id&&o("It is not necessary to initialize '{a}' to 'undefined'.",wt,t),"="===d(0).id&&ut.identifier&&l("Variable {a} was not declared correctly.",ut,ut.value),r=f(0),n.first=r),","===ut.id);)C();return this});Kt.exps=!0,E("function",function(){rt&&o("Function declarations should not be placed in blocks. Use a function expression or move the statement to the top of the outer function.",wt);var e=N();return m(wt,ut),u(e,"unction"),Z(e,!0),"("===ut.id&&ut.line===wt.line&&l("Function declarations are not invocable. Wrap the whole function invocation in parens."),this}),O("function",function(){var e=F();return e?m(wt,ut):b(wt,ut),Z(e),!dt.loopfunc&&Q["(loopage)"]&&o("Don't make functions within a loop."),this}),E("if",function(){var e=ut;return p("("),b(this,e),v(),f(20),"="===ut.id&&(dt.boss||o("Expected a conditional expression and instead saw an assignment."),p("="),f(20)),p(")",e),v(mt,wt),H(!0,!0),"else"===ut.id&&(b(wt,ut),p("else"),"if"===ut.id||"switch"===ut.id?W(!0):H(!0,!0)),this}),E("try",function(){var e,t,n;return H(!1),"catch"===ut.id&&(p("catch"),b(wt,ut),p("("),n=gt,gt=Object.create(n),t=ut.value,"(identifier)"!==ut.type?o("Expected an identifier and instead saw '{a}'.",ut,t):u(t,"exception"),p(),p(")"),H(!1),e=!0,gt=n),"finally"===ut.id?(p("finally"),H(!1),void 0):(e||l("Expected '{a}' and instead saw '{b}'.",ut,"catch",ut.value),this)}),E("while",function(){var e=ut;return Q["(breakage)"]+=1,Q["(loopage)"]+=1,p("("),b(this,e),v(),f(20),"="===ut.id&&(dt.boss||o("Expected a conditional expression and instead saw an assignment."),p("="),f(20)),p(")",e),v(mt,wt),H(!0,!0),Q["(breakage)"]-=1,Q["(loopage)"]-=1,this}).labelled=!0,T("with"),E("switch",function(){var e=ut,t=!1;for(Q["(breakage)"]+=1,p("("),b(this,e),v(),this.condition=f(20),p(")",e),v(mt,wt),b(wt,ut),e=ut,p("{"),b(wt,ut),it+=dt.indent,this.cases=[];;)switch(ut.id){case"case":switch(Q["(verb)"]){case"break":case"case":case"continue":case"return":case"switch":case"throw":break;default:Gt.test(ot[ut.line-2])||o("Expected a 'break' statement before 'case'.",wt)}_(-dt.indent),p("case"),this.cases.push(f(20)),t=!0,p(":"),Q["(verb)"]="case";break;case"default":switch(Q["(verb)"]){case"break":case"continue":case"return":case"throw":break;default:Gt.test(ot[ut.line-2])||o("Expected a 'break' statement before 'default'.",wt)}_(-dt.indent),p("default"),t=!0,p(":");break;case"}":return it-=dt.indent,_(),p("}",e),(1===this.cases.length||"true"===this.condition.id||"false"===this.condition.id)&&o("This 'switch' should be an 'if'.",this),Q["(breakage)"]-=1,Q["(verb)"]=void 0,void 0;case"(end)":return l("Missing '{a}'.",ut,"}"),void 0;default:if(t)switch(wt.id){case",":return l("Each value should have its own case label."),void 0;case":":U();break;default:l("Missing ':' on a case clause.",wt)}else l("Expected '{a}' and instead saw '{b}'.",ut,"case",ut.value)}}).labelled=!0,M("debugger",function(){return dt.debug||o("All 'debugger' statements should be removed."),this}).exps=!0,function(){var e=M("do",function(){Q["(breakage)"]+=1,Q["(loopage)"]+=1,this.first=H(!0),p("while");var e=ut;return b(wt,e),p("("),v(),f(20),"="===ut.id&&(dt.boss||o("Expected a conditional expression and instead saw an assignment."),p("="),f(20)),p(")",e),v(mt,wt),Q["(breakage)"]-=1,Q["(loopage)"]-=1,this});e.labelled=!0,e.exps=!0}(),E("for",function(){var e,t=ut;if(Q["(breakage)"]+=1,Q["(loopage)"]+=1,p("("),b(this,t),v(),"in"===d("var"===ut.id?1:0).id){if("var"===ut.id)p("var"),Kt.fud.call(Kt,!0);else{switch(Q[ut.value]){case"unused":Q[ut.value]="var";break;case"var":break;default:o("Bad for in variable '{a}'.",ut,ut.value)}p()}return p("in"),f(20),p(")",t),e=H(!0,!0),dt.forin&&(e.length>1||"object"!=typeof e[0]||"if"!==e[0].value)&&o("The body of a for in should be wrapped in an if statement to filter unwanted properties from the prototype.",this),Q["(breakage)"]-=1,Q["(loopage)"]-=1,this}if(";"!==ut.id)if("var"===ut.id)p("var"),Kt.fud.call(Kt);else for(;f(0,"for"),","===ut.id;)C();if(w(wt),p(";"),";"!==ut.id&&(f(20),"="===ut.id&&(dt.boss||o("Expected a conditional expression and instead saw an assignment."),p("="),f(20))),w(wt),p(";"),";"===ut.id&&l("Expected '{a}' and instead saw '{b}'.",ut,")",";"),")"!==ut.id)for(;f(0,"for"),","===ut.id;)C();return p(")",t),v(mt,wt),H(!0,!0),Q["(breakage)"]-=1,Q["(loopage)"]-=1,this}).labelled=!0,M("break",function(){var e=ut.value;return 0===Q["(breakage)"]&&o("Unexpected '{a}'.",ut,this.value),w(this),";"!==ut.id&&wt.line===ut.line&&("label"!==Q[e]?o("'{a}' is not a statement label.",ut,e):gt[e]!==Q&&o("'{a}' is out of scope.",ut,e),this.first=ut,p()),q("break"),this}).exps=!0,M("continue",function(){var e=ut.value;return 0===Q["(breakage)"]&&o("Unexpected '{a}'.",ut,this.value),w(this),";"!==ut.id?wt.line===ut.line&&("label"!==Q[e]?o("'{a}' is not a statement label.",ut,e):gt[e]!==Q&&o("'{a}' is out of scope.",ut,e),this.first=ut,p()):Q["(loopage)"]||o("Unexpected '{a}'.",ut,this.value),q("continue"),this}).exps=!0,M("return",function(){return w(this),"(regexp)"===ut.id&&o("Wrap the /regexp/ literal in parens to disambiguate the slash operator."),";"===ut.id||ut.reach||(b(wt,ut),this.first=f(20)),q("return"),this}).exps=!0,M("throw",function(){return w(this),b(wt,ut),this.first=f(20),q("throw"),this}).exps=!0,T("class"),T("const"),T("enum"),T("export"),T("extends"),T("import"),T("super"),T("let"),T("yield"),T("implements"),T("interface"),T("package"),T("private"),T("protected"),T("public"),T("static");var Zt=function(t,n,a){var s,l,c;if(e.errors=[],pt=Object.create(Rt),r(pt,a||{}),n){if(s=n.predef)if(Array.isArray(s))for(l=0;s.length>l;l+=1)pt[s[l]]=!0;else if("object"==typeof s)for(c=Object.keys(s),l=0;c.length>l;l+=1)pt[c[l]]=!!s[c];dt=n}else dt={};for(dt.indent=dt.indent||4,dt.maxerr=dt.maxerr||50,_t="",l=0;dt.indent>l;l+=1)_t+=" ";it=1,tt=Object.create(pt),gt=tt,Q={"(global)":!0,"(name)":"(global)","(scope)":gt,"(breakage)":0,"(loopage)":0},et=[Q],Ct=[],vt=!1,bt=null,lt={},ct=null,nt={},rt=!1,st=[],at=!1,xt=0,Xt.init(t),ft=!0,yt=!1,mt=wt=ut=It["(begin)"],i();try{switch(p(),ut.id){case"{":case"[":dt.laxbreak=!0,at=!0,J();break;default:"use strict"===ut.value&&(dt.globalstrict||o('Use the function form of "use strict".'),V()),U("lib")}p("(end)")}catch(u){u&&e.errors.push({reason:u.message,line:u.line||ut.line,character:u.character||ut.from},null)}return 0===e.errors.length};return e.data=function(){var t,r,i,a,o,s,l,c={functions:[]},u=[],h=[],d=[];e.errors.length&&(c.errors=e.errors),at&&(c.json=!0);for(s in nt)n(nt,s)&&u.push({name:s,line:nt[s]});for(u.length>0&&(c.implieds=u),Ct.length>0&&(c.urls=Ct),r=Object.keys(gt),r.length>0&&(c.globals=r),a=1;et.length>a;a+=1){for(i=et[a],t={},o=0;zt.length>o;o+=1)t[zt[o]]=[];for(s in i)n(i,s)&&"("!==s.charAt(0)&&(l=i[s],"unction"===l&&(l="unused"),Array.isArray(t[l])&&(t[l].push(s),"unused"===l&&d.push({name:s,line:i["(line)"],"function":i["(name)"]})));for(o=0;zt.length>o;o+=1)0===t[zt[o]].length&&delete t[zt[o]];t.name=i["(name)"],t.param=i["(params)"],t.line=i["(line)"],t.last=i["(last)"],c.functions.push(t)}d.length>0&&(c.unused=d),h=[];for(s in lt)if("number"==typeof lt[s]){c.member=lt;break}return c},e.report=function(t){function n(e,t){var n,r,i;if(t){for(m.push("<div><i>"+e+"</i> "),t=t.sort(),r=0;t.length>r;r+=1)t[r]!==i&&(i=t[r],m.push((n?", ":"")+i),n=!0);m.push("</div>")}}var r,i,a,o,s,l,c,u,h,d=e.data(),p=[],f="",m=[];if(d.errors||d.implieds||d.unused){if(a=!0,m.push("<div id=errors><i>Error:</i>"),d.errors)for(s=0;d.errors.length>s;s+=1)r=d.errors[s],r&&(i=r.evidence||"",m.push("<p>Problem"+(isFinite(r.line)?" at line "+r.line+" character "+r.character:"")+": "+r.reason.entityify()+"</p><p class=evidence>"+(i&&(i.length>80?i.slice(0,77)+"...":i).entityify())+"</p>"));if(d.implieds){for(h=[],s=0;d.implieds.length>s;s+=1)h[s]="<code>"+d.implieds[s].name+"</code>&nbsp;<i>"+d.implieds[s].line+"</i>";m.push("<p><i>Implied global:</i> "+h.join(", ")+"</p>")}if(d.unused){for(h=[],s=0;d.unused.length>s;s+=1)h[s]="<code><u>"+d.unused[s].name+"</u></code>&nbsp;<i>"+d.unused[s].line+"</i> <code>"+d.unused[s]["function"]+"</code>";m.push("<p><i>Unused variable:</i> "+h.join(", ")+"</p>")}d.json&&m.push("<p>JSON: bad.</p>"),m.push("</div>")}if(!t){for(m.push("<br><div id=functions>"),d.urls&&n("URLs<br>",d.urls,"<br>"),d.json&&!a?m.push("<p>JSON: good.</p>"):d.globals?m.push("<div><i>Global</i> "+d.globals.sort().join(", ")+"</div>"):m.push("<div><i>No new global variables introduced.</i></div>"),s=0;d.functions.length>s;s+=1)o=d.functions[s],m.push("<br><div class=function><i>"+o.line+"-"+o.last+"</i> "+(o.name||"")+"("+(o.param?o.param.join(", "):"")+")</div>"),n("<big><b>Unused</b></big>",o.unused),n("Closure",o.closure),n("Variable",o["var"]),n("Exception",o.exception),n("Outer",o.outer),n("Global",o.global),n("Label",o.label);if(d.member){if(p=Object.keys(d.member),p.length){for(p=p.sort(),f="<br><pre id=members>/*members ",c=10,s=0;p.length>s;s+=1)l=p[s],u=l.name(),c+u.length>72&&(m.push(f+"<br>"),f="    ",c=1),c+=u.length+2,1===d.member[l]&&(u="<i>"+u+"</i>"),p.length-1>s&&(u+=", "),f+=u;m.push(f+"<br>*/</pre>")}m.push("</div>")}}return m.join("")},e.jshint=Zt,e.edition="2011-04-16",Zt});"object"==typeof t&&(t.JSHINT=n),"undefined"!=typeof bootstrap&&bootstrap("core/jshint",function(e,t){"use strict";t.JSHINT=n})}}),montageDefine("e2fc70c","core/serialization/serializer/montage-ast",{dependencies:["montage","mousse/serialization/ast"],factory:function(e,t){var n=e("montage").Montage,r=e("mousse/serialization/ast").Value,i=n.specialize.call(r,{constructor:{value:function i(){}},initWithRootAndId:{value:function(e,t){return r.call(this,e,t),this}},_getSerializationValue:{value:function(){return{"#":this.value}}}}),a=n.specialize.call(r,{constructor:{value:function a(){}},initWithRootAndModuleId:{value:function(e,t){return r.call(this,e,t),this}},_getSerializationValue:{value:function(){return{"%":this.value}}}});t.ElementReference=i,t.ModuleReference=a}}),montageDefine("e2fc70c","core/serialization/serializer/properties-serializer",{dependencies:["montage"],factory:function(e,t){var n=e("montage").Montage,r=n.specialize.call(Object,{_malker:{value:null},_visitor:{value:null},_object:{value:null},constructor:{value:function r(){}},initWithMalkerAndVisitorAndObject:{value:function(e,t,n){return this._malker=e,this._visitor=t,this._object=n,this}},addObject:{value:function(e){return"object"==typeof e?(this._malker.visit(e),e):void 0}},addObjectReference:{value:function(e){var t=this._visitor.builder,n=this._visitor.labeler,r=n.getObjectLabel(e),a=Object.create(i);return a.reference=t.createReference(r),a}},set:{value:function(e,t,n){this._visitor.setProperty(this._malker,e,t,n)}},setAll:{value:function(){this._visitor.setSerializableObjectProperties(this._malker,this._object)}}}),i={thisIsAReferenceCreatedByMontageSerializer:!0,reference:null};t.PropertiesSerializer=r}}),montageDefine("e2fc70c","core/serialization/serializer/self-serializer",{dependencies:["montage"],factory:function(e,t){var n=e("montage").Montage,r=n.specialize.call(Object,{_malker:{value:null},_visitor:{value:null},_object:{value:null},constructor:{value:function r(){}},initWithMalkerAndVisitorAndObject:{value:function(e,t,n){return this._malker=e,this._visitor=t,this._object=n,this}},getObjectLabel:{value:function(e){return this._visitor.labeler.getObjectLabel(e)}},addObject:{value:function(e){return"object"==typeof e?(this._malker.visit(e),e):void 0}},addObjectReference:{value:function(e){var t=this._visitor.builder,n=this._visitor.labeler,r=n.getObjectLabel(e);return{thisIsAReferenceCreatedByMontageSerializer:!0,reference:t.createObjectReference(r)}}},setProperty:{value:function(e,t,n){var r,i=this._visitor.builder;r=i.top.getProperty("properties"),i.push(r),this._visitor.setProperty(this._malker,e,t,n),i.pop()}},setAllProperties:{value:function(){var e,t=this._visitor.builder;e=t.top.getProperty("properties"),t.push(e),this._visitor.setSerializableObjectProperties(this._malker,this._object),t.pop()}},setUnit:{value:function(e){this._visitor.setObjectCustomUnit(this._malker,this._object,e)}},setAllUnits:{value:function(){this._visitor.setObjectCustomUnits(this._malker,this._object)}}});t.SelfSerializer=r}}),montageDefine("e2fc70c","core/serialization/serializer/unit-serializer",{dependencies:["montage"],factory:function(e,t){function n(e,t,n){this._visitor=e,this._malker=t,this._object=n}var r=e("montage").Montage,n=r.specialize.call(Object,{_malker:{value:null},_visitor:{value:null},_object:{value:null},constructor:{value:function n(){}},initWithMalkerAndVisitorAndObject:{value:function(e,t,n){return this._malker=e,this._visitor=t,this._object=n,this}},getObjectLabel:{value:function(e){return this.addObjectReference(e),this._visitor.labeler.getObjectLabel(e)}},addObject:{value:function(e){return"object"==typeof e?(this._malker.visit(e),e):void 0}},addObjectReference:{value:function(e){var t=this._visitor.builder,n=this._visitor.labeler,r=n.getObjectLabel(e);return{thisIsAReferenceCreatedByMontageSerializer:!0,reference:t.createObjectReference(r)}}}});t.UnitSerializer=n}}),montageDefine("e2fc70c","ui/loader.reel/loader",{dependencies:["core/core","ui/component","core/logger","core/event/event-manager"],factory:function(e,t){var n=(e("core/core").Montage,e("ui/component").Component),r=e("core/logger").logger("loader"),i=e("core/event/event-manager").defaultEventManager,a="_montageStartBootstrappingTimeout",o="montage-app-loader",s="montage-app-bootstrapping",l="montage-app-loading",c="montage-app-loaded",u=0,h=1,d=2,p=3;t.Loader=n.specialize({constructor:{value:function(){this.super()}},mainModule:{value:"ui/main.reel"},mainName:{value:"Main"},includeFrameworkModules:{value:!1},minimumBootstrappingDuration:{value:1500},minimumLoadingDuration:{value:2e3},_initializedModules:{value:null},initializedModules:{dependencies:["includeFrameworkModules"],enumerable:!1,get:function(){return!this._initializedModules||this.includeFrameworkModules?this._initializedModules:this._initializedModules.slice(this._frameworkModuleCount-1)},set:function(e){this._initializedModules=e}},_requiredModules:{value:null},requiredModules:{dependencies:["includeFrameworkModules"],enumerable:!1,get:function(){return!this._requiredModules||this.includeFrameworkModules?this._requiredModules:this._requiredModules.slice(this._frameworkModuleCount-1)},set:function(e){this._requiredModules=e}},_currentStage:{value:u},currentStage:{get:function(){return this._currentStage},set:function(e){e!==this._currentStage&&(r.isDebug&&r.debug(this,"CURRENT STAGE: "+e),this._currentStage=e,this.needsDraw=!0)}},_readyToShowLoader:{value:!1},isLoadingMainComponent:{value:null},readyToShowLoader:{get:function(){return this._readyToShowLoader},set:function(e){e===this._readyToShowLoader&&(this._readyToShowLoader=e,this.needsDraw=!0)}},readyToShowMainComponent:{get:function(){return!!this._mainComponent}},_frameworkModuleCount:{enumerable:!1,value:null},hasTemplate:{enumerable:!1,value:!1},_mainComponent:{value:null},_mainComponentEnterDocument:{value:null},_showLoadingTimeout:{enumerable:!1,value:null},_showMainComponentTimeout:{enumerable:!1,value:null},templateDidLoad:{value:function(){r.isDebug&&r.debug(this,"templateDidLoad"),this.element||(this.element=document.documentElement,this.attachToParentComponent()),this.readyToShowLoader=!0;var e,t=document._montageTiming,n=this;t.bootstrappingStartTime?(r.isDebug&&r.debug(this,"had already started bootstrapping"),this.currentStage=h,t.bootstrappingEndTime=Date.now(),e=this.minimumBootstrappingDuration-(t.bootstrappingEndTime-t.bootstrappingStartTime),e>0?(r.isDebug&&r.debug(this,"still need to show bootstrapper for another "+e+"ms"),this._showLoadingTimeout=setTimeout(function(){n._revealLoader()},e)):this._revealLoader()):(r.isDebug&&r.debug(this,"bootstrapping has not started yet…"),this._loadMainComponent())
}},_revealLoader:{value:function(){r.isDebug&&r.debug(this,"_revealLoader"),this.currentStage=d,document._montageTiming.loadingStartTime=Date.now();var e,t,n,i,a=document.getElementById(o);if(a)for(t=a.children,e=0;n=t[e];e++)(i=n.component)&&(i.attachToParentComponent(),i.needsDraw=!0)}},_revealMainComponent:{value:function(){r.isDebug&&r.debug(this,"_revealMainComponent"),this.currentStage=p}},_loadMainComponent:{value:function(){r.isDebug&&r.debug(this,"_loadMainComponent"),this.isLoadingMainComponent=!0;var e=this;window.require.async(this.mainModule).then(function(t){if(!(e.mainName in t))throw Error(e.mainName+" was not found in "+e.mainModule);return e._mainLoadedCallback(t)}).done()}},_mainLoadedCallback:{value:function(e){r.isDebug&&r.debug(this,"_mainLoadedCallback"),this._mainComponent=e[this.mainName].create(),this._mainComponentEnterDocument=this._mainComponent.enterDocument,this._mainComponent.enterDocument=this.mainComponentEnterDocument.bind(this),this._mainComponent.setElementWithParentComponent(document.createElement("div"),this),this._mainComponent.attachToParentComponent(),this._mainComponent.needsDraw=!0}},mainComponentEnterDocument:{value:function(){var e,t=this;r.isDebug&&r.debug(this,"main preparing to draw"),this.isLoadingMainComponent=!1,this._contentToRemove=document.createRange(),e=this.element===document.documentElement?document.body:this.element,this._contentToRemove.selectNodeContents(e),this.childComponents=[this._mainComponent],e.appendChild(this._mainComponent.element);var n,o,s=document[a],l=document._montageTiming;l.bootstrappingStartTime?l.bootstrappingStartTime&&!l.loadingStartTime?(clearTimeout(this._showLoadingTimeout),this._showLoadingTimeout=null,l.bootstrappingEndTime=Date.now(),(n=this.minimumBootstrappingDuration-(l.bootstrappingEndTime-l.bootstrappingStartTime))>0?(r.isDebug&&r.debug(this,"show bootstrapper for another "+n+"ms"),this._showMainComponentTimeout=setTimeout(function(){r.isDebug&&r.debug(this,"ok, shown bootstrapper long enough"),t._revealMainComponent()},n)):setTimeout(function(){r.isDebug&&r.debug(this,"ok, showing bootstrapper now"),t._revealMainComponent()},0)):l.loadingStartTime&&(l.loadingEndTime=Date.now(),(o=this.minimumLoadingDuration-(l.loadingEndTime-l.loadingStartTime))>0?(r.isDebug&&r.debug(this,"show loader for another "+o+"ms"),this._showMainComponentTimeout=setTimeout(function(){r.isDebug&&r.debug(this,"ok, shown loader long enough"),t._revealMainComponent()},o)):this._revealMainComponent()):(r.isDebug&&r.debug(this,"bootstrapper never shown"),clearTimeout(s),s=null,this._revealMainComponent());var c=this._mainComponent;return i.unregisterEventHandlerForElement(this.element),c.attachToParentComponent(),p>this.currentStage&&(this.currentStage=p),c.enterDocument=this._mainComponentEnterDocument,c.enterDocument?c.enterDocument.apply(c,arguments):void 0}},removeContentOnLoad:{value:!0},_forceContentRemoval:{enumerable:!1,value:!1},_contentToRemove:{enumerable:!1,value:null},removeContent:{value:function(){this._forceContentRemoval=!0,this.needsDraw=!0}},draw:{value:function(){if(this.readyToShowMainComponent||this.isLoadingMainComponent||(r.isDebug&&r.debug(this,"draw; start loading main component"),this._loadMainComponent()),d===this.currentStage)this.element.classList.remove(s),this.element.classList.add(l);else if(p===this.currentStage&&this._contentToRemove){this.element.classList.remove(s),this.element.classList.remove(l),(this.removeContentOnLoad||this._forceContentRemoval)&&(this._contentToRemove.extractContents(),this._contentToRemove.detach(),this._contentToRemove=null),this.element.classList.add(c);var e=document.createEvent("CustomEvent");e.initCustomEvent("componentLoaded",!0,!0,this._mainComponent),this.dispatchEvent(e,!0,!0),this.detachFromParentComponent()}}}})}}),montageDefine("e2fc70c","ui/component",{dependencies:["montage","core/target","core/bindings","core/template","core/document-resources","core/gate","core/promise","core/logger","core/event/event-manager","collections/set","core/application"],factory:function(e,t){var n=e("montage").Montage,r=e("core/target").Target,i=e("core/bindings").Bindings,a=e("core/template").Template,o=e("core/document-resources").DocumentResources,s=e("core/gate").Gate,l=e("core/promise").Promise,c=e("core/logger").logger("component"),u=e("core/logger").logger("Drawing performance"),h=e("core/logger").logger("drawing"),d=e("core/event/event-manager").defaultEventManager,p=e("collections/set"),f=t.Component=r.specialize({DOM_ARG_ATTRIBUTE:{value:"data-arg"},constructor:{value:function f(){this.super(),this._isComponentExpanded=!1,this._isTemplateLoaded=!1,this._isTemplateInstantiated=!1,this._isComponentTreeLoaded=!1}},delegate:{value:null},templateObjects:{serializable:!1,value:null},_nextTarget:{value:null},nextTarget:{get:function(){return this._nextTarget||this.parentComponent},set:function(e){this._nextTarget=e}},_ownerDocumentPart:{value:null},_templateDocumentPart:{value:null},_domArguments:{value:null},_dispatchActionEvent:{value:function(){this.dispatchEvent(this.createActionEvent())},enumerable:!1},createActionEvent:{value:function(){var e=document.createEvent("CustomEvent");return e.initCustomEvent("action",!0,!0,null),e}},canDrawGate:{get:function(){return this._canDrawGate||(this._canDrawGate=(new s).initWithDelegate(this),this._canDrawGate.setField("componentTreeLoaded",!1)),this._canDrawGate},enumerable:!1},_blockDrawGate:{value:null},blockDrawGate:{enumerable:!1,get:function(){return this._blockDrawGate||(this._blockDrawGate=(new s).initWithDelegate(this),this._blockDrawGate.setField("element",!1),this._blockDrawGate.setField("drawRequested",!1)),this._blockDrawGate}},_firstDraw:{enumerable:!1,value:!0},_completedFirstDraw:{enumerable:!1,value:!1},originalElement:{value:null},_element:{enumerable:!1,value:null},element:{get:function(){return this._element},set:function(e){if(null==e)return console.warn("Tried to set element of ",this," to ",e),void 0;if(this.isDeserializing)this.eventManager.registerEventHandlerForElement(this,e),this._isTemplateInstantiated?this._templateElement||(this._templateElement=e):(this._element=e,!this.blockDrawGate.value&&this._element&&this.blockDrawGate.setField("element",!0));else{if(!this._firstDraw)return console.error("Cannot change element of ",this," after it has been set"),void 0;this.eventManager.registerEventHandlerForElement(this,e),this._element=e,!this.blockDrawGate.value&&this._element&&this.blockDrawGate.setField("element",!0)}this._initializeClassListFromElement(e)}},getElementId:{value:function(){var e=this._element;return e?e.getAttribute("data-montage-id"):void 0}},_initDomArguments:{value:function(){var e,t,n,r={},i=this.element;e=i.querySelectorAll("*["+this.DOM_ARG_ATTRIBUTE+"]");e:for(var a,o=0;a=e[o];o++){for(n=a;(n=n.parentNode)!==i;)if(n.component)continue e;this._findAndDetachComponents(a),a.parentNode.removeChild(a),t=a.getAttribute(this.DOM_ARG_ATTRIBUTE),a.removeAttribute(this.DOM_ARG_ATTRIBUTE),r[t]=a}this._domArguments=r}},getDomArgumentNames:{value:function(){return Object.keys(this._domArguments)}},extractDomArgument:{value:function(e){var t;return t=this._domArguments[e],delete this._domArguments[e],t}},_getDomArgument:{value:function(e,t){var n,r,i,a,o;n=e.querySelectorAll("*["+this.DOM_ARG_ATTRIBUTE+"='"+t+"']");e:for(var s,l=0;s=n[l];l++){for(r=s;(r=r.parentNode)!==e;)if(i=this._template.getElementId(r),i&&(a=this._template.getSerialization(),o=a.getSerializationLabelsWithElements(i),o.length>0))continue e;return s}}},getTemplateParameterArgument:{value:function(e,t){var n,r,i;return n=e.getElementById(this.getElementId()),"*"===t?(r=e.document.createRange(),r.selectNodeContents(n),i=r.cloneContents()):(i=this._getDomArgument(n,t).cloneNode(!0),i.removeAttribute(this.DOM_ARG_ATTRIBUTE)),i}},setElementWithParentComponent:{value:function(e,t){this._alternateParentComponent=t,this.element!==e&&(this.element=e)}},application:{enumerable:!1,get:function(){return e("core/application").application}},eventManager:{enumerable:!1,get:function(){return d}},rootComponent:{enumerable:!1,get:function(){return g}},elementControllerFromEvent:{enumerable:!1,value:function(e,t){return t}},_alternateParentComponent:{value:null},__parentComponent:{value:null},_parentComponent:{set:function(e){this.__parentComponent=e,this.dispatchOwnPropertyChange("parentComponent",e)},get:function(){return this.__parentComponent}},parentComponent:{enumerable:!1,get:function(){return this._parentComponent}},findParentComponent:{value:function(){var e,t=this.element,n=this.eventManager;if(t){for(;null!=(e=t.parentNode)&&null==n.eventHandlerForElement(e);)t=e;return e?n.eventHandlerForElement(e):this._alternateParentComponent}}},querySelectorComponent:{value:function(e){if("string"!=typeof e)throw"querySelectorComponent: Selector needs to be a string.";var t=e.match(/^\s*(?:@([^>\s]+))?(?:\s*(>)?\s*@([^>\s]+)(.*))?$/);if(!t)throw'querySelectorComponent: Syntax error "'+e+'"';var r,i,a,o=this.childComponents,s=t[1],l=(t[2]||" ",t[3]),c=t[4];if(s)for(c=l?"@"+l+c:"",i=0,a;a=o[i];i++){if(s===n.getInfoForObject(a).label)return c?a.querySelectorComponent(c):a;if(r=a.querySelectorComponent(e))return r}else for(i=0,a;a=o[i];i++)if(l===n.getInfoForObject(a).label)return c?a.querySelectorComponent(c):a;return null}},querySelectorAllComponent:{value:function(e,t){if("string"!=typeof e)throw"querySelectorComponent: Selector needs to be a string.";var r=e.match(/^\s*(?:@([^>\s]+))?(?:\s*(>)?\s*@([^>\s]+)(.*))?$/);if(!r)throw'querySelectorComponent: Syntax error "'+e+'"';var i,a,o=this.childComponents,s=r[1],l=(r[2]||" ",r[3]),c=r[4],u=[];if(s)for(c=l?"@"+l+c:"",i=0,a;a=o[i];i++)s!==n.getInfoForObject(a).label||t&&t!==a.ownerComponent?u=u.concat(a.querySelectorAllComponent(e,t)):c?u=u.concat(a.querySelectorAllComponent(c)):u.push(a);else for(i=0,a;a=o[i];i++)l!==n.getInfoForObject(a).label||t&&t!==a.ownerComponent||(c?u=u.concat(a.querySelectorAllComponent(c,t)):u.push(a));return u}},template:{enumerable:!1,value:null},hasTemplate:{enumerable:!1,value:!0},_templateModuleId:{serializable:!1,value:null},_template:{value:null},_treeLevel:{value:0},_addChildComponent:{value:function(e){return this.addChildComponent(e)}},addChildComponent:{value:function(e){-1===this.childComponents.indexOf(e)&&(this.childComponents.push(e),e._prepareForEnterDocument(),e._parentComponent=this,e.needsDraw&&!this.rootComponent.isComponentWaitingNeedsDraw(e)&&e._addToParentsDrawList())}},attachToParentComponent:{value:function(){this.detachFromParentComponent(),this._parentComponent=null;var e,t,n=this.findParentComponent();if(n){e=n.childComponents;for(var r=0;t=e[r];r++){var i=t.findParentComponent();i===this&&(n.removeChildComponent(t),i.addChildComponent(t))}n.addChildComponent(this)}}},detachFromParentComponent:{value:function(){var e=this.parentComponent;e&&e.removeChildComponent(this)}},removeChildComponent:{value:function(e){var t=this.childComponents,n=t.indexOf(e);n>-1&&(e._exitDocument(),t.splice(n,1),e._parentComponent=null,e._alternateParentComponent=null,e._addedToDrawList&&(e._addedToDrawList=!1,n=this._drawList.indexOf(e),this._drawList.splice(n,1)),this.rootComponent.removeFromCannotDrawList(e))}},childComponents:{enumerable:!1,distinct:!0,value:[]},_needsEnterDocument:{value:!1},_inDocument:{value:!1},__exitDocument:{value:function(){this._inDocument&&"function"==typeof this.exitDocument&&(this.exitDocument(),this._inDocument=!1)}},_exitDocument:{value:function(){var e;this._needsEnterDocument?this._needsEnterDocument=!1:(e=function(t){for(var n,r=t.childComponents,i=0;n=r[i];i++)n._isComponentExpanded&&e(n);t._inDocument&&t.__exitDocument()},e(this))}},exitDocument:{value:function(){this.isActiveTarget&&(d.activeTarget=this.nextTarget)}},_prepareForEnterDocument:{value:function(){this._firstDraw?this._needsEnterDocument=!0:(this.needsDraw=!0,this.traverseComponentTree(function(e){return e._needsEnterDocument?!1:(e._needsEnterDocument=!0,e.needsDraw=!0,void 0)}))}},ownerComponent:{enumerable:!1,value:null},components:{enumerable:!1,value:{}},_isComponentExpanded:{enumerable:!1,value:null},_isTemplateLoaded:{enumerable:!1,value:null},_isTemplateInstantiated:{enumerable:!1,value:null},cleanupDeletedComponentTree:{value:function(e){e&&i.cancelBindings(this),this.needsDraw=!1,this.traverseComponentTree(function(t){e&&i.cancelBindings(t),t.needsDraw=!1})}},_newDomContent:{enumerable:!1,value:null},domContent:{serializable:!1,get:function(){return this._element?Array.prototype.slice.call(this._element.childNodes,0):null},set:function(e){var t,n,r,i=[];for(this._newDomContent=e,this.needsDraw=!0,null===this._newDomContent&&(this._shouldClearDomContentOnNextDraw=!0),"function"==typeof this.contentWillChange&&this.contentWillChange(e),t=this.childComponents,n=0,r;r=t[n];n++)r.detachFromParentComponent();if(e instanceof Element)this._findAndDetachComponents(e,i);else if(e&&e[0])for(n=0;e.length>n;n++)this._findAndDetachComponents(e[n],i);for(n=0,r;r=i[n];n++)this.addChildComponent(r)}},_shouldClearDomContentOnNextDraw:{value:!1},_findAndDetachComponents:{value:function(e,t){var n,r=e.component;if(t||(t=[]),r)r.detachFromParentComponent(),t.push(r);else{n=e.children||e.childNodes;for(var i,a=0;i=n[a];a++)this._findAndDetachComponents(i,t)}return t}},clonesChildComponents:{writable:!1,value:!1},_innerTemplate:{value:null},innerTemplate:{serializable:!1,get:function(){var e,t,n,r,i,a,o,s=this._innerTemplate;if(!s&&(e=this._ownerDocumentPart)){t=e.template,n=this.getElementId(),s=t.createTemplateFromElementContents(n),r=s.getSerialization(),i=r.getExternalObjectLabels(),a=e.objects,o=Object.create(null);for(var l,c=0;l=i[c];c++)o[l]=a[l];s.setInstances(o),this._innerTemplate=s}return s},set:function(e){this._innerTemplate=e}},canDraw:{value:function(){return this._canDraw}},_canDraw:{get:function(){return!this._canDrawGate||this._canDrawGate.value},set:function(e){g.componentCanDraw(this,e)},enumerable:!1},_prepareCanDraw:{enumerable:!1,value:function(){this._isComponentTreeLoaded||this.loadComponentTree().done()}},_isComponentTreeLoaded:{value:null},shouldLoadComponentTree:{value:!0},_loadComponentTreeDeferred:{value:null},loadComponentTree:{value:function(){var e=this,t=this.canDrawGate,n=this._loadComponentTreeDeferred;return n||(n=l.defer(),this._loadComponentTreeDeferred=n,t.setField("componentTreeLoaded",!1),(this.needsDraw||this.hasTemplate)&&(this._canDraw=!1),this.expandComponent().then(function(){if(e.hasTemplate||e.shouldLoadComponentTree){for(var t,n=[],r=e.childComponents,i=0;t=r[i];i++)n.push(t.loadComponentTree());return l.all(n)}}).then(function(){e._isComponentTreeLoaded=!0,e._needsEnterDocument&&(e.needsDraw=!0),t.setField("componentTreeLoaded",!0),n.resolve()},n.reject).done()),n.promise}},traverseComponentTree:{value:function(e,t){function n(){var n,i,a=r.childComponents;if(e&&e(r)===!1)return t&&t(),void 0;if(0===(i=a.length))return t&&t(),void 0;for(var o=function(){0===--i&&t&&t()},s=0;n=a[s];s++)n.traverseComponentTree(e,o)}var r=this;this._isComponentExpanded?n():t&&t()}},_expandComponentDeferred:{value:null},expandComponent:{value:function(){var e=this,t=this._expandComponentDeferred;return t||(t=l.defer(),this._expandComponentDeferred=t,this.hasTemplate?this._instantiateTemplate().then(function(){e._isComponentExpanded=!0,e._addTemplateStyles(),e.needsDraw=!0,t.resolve()},t.reject):(this._isComponentExpanded=!0,t.resolve())),t.promise}},_templateObjectDescriptor:{value:{enumerable:!0,configurable:!0}},_setupTemplateObjects:{value:function(e){var t=this._templateObjectDescriptor,n=Object.create(null);for(var r in e){var i=e[r];"object"==typeof i&&null!=i&&(f.prototype.isPrototypeOf(i)&&i!==this&&i.parentComponent!==this?(t.get=this._makeTemplateObjectGetter(this,r,i),Object.defineProperty(n,r,t)):n[r]=i)}this.templateObjects=n}},_makeTemplateObjectGetter:{value:function(e,t,n){var r,i,a,o="@"+t;return function(){if(r)return e.querySelectorAllComponent(o,e);if(i=e.querySelectorAllComponent(o,e),1===i.length)for(a=i[0];a=a.parentComponent;){if(a===e)return Object.defineProperty(this,t,{value:i[0]}),i[0];if(a.clonesChildComponents)break}else if(0===i.length)return n;return r=!0,i}}},_instantiateTemplate:{value:function(){var e=this;return this._loadTemplate().then(function(t){if(!e._element)return console.error("Cannot instantiate template without an element.",e),l.reject(Error("Cannot instantiate template without an element.",e));var n=e.templateObjects,r=e._element.ownerDocument;return n||(n=Object.create(null)),n.owner=e,e._isTemplateInstantiated=!0,t.instantiateWithInstances(n,r).then(function(t){e._templateDocumentPart=t,t.fragment=null}).fail(function(e){var n=e.stack||e;throw console.error("Error in",t.getBaseUrl()+":",n),e})})}},_templateDidLoad:{value:function(e){this._setupTemplateObjects(e.objects)}},_loadTemplatePromise:{value:null},_loadTemplate:{value:function(){var e,t=this,r=this._loadTemplatePromise;return r||(e=n.getInfoForObject(this),r=this._loadTemplatePromise=a.getTemplateWithModuleId(this.templateModuleId,e.require).then(function(e){return t._template=e,t._isTemplateLoaded=!0,e})),r}},templateModuleId:{get:function(){return this._templateModuleId||this._getDefaultTemplateModuleId()}},_getDefaultTemplateModuleId:{value:function(){var e,t,r,i;return i=n.getInfoForObject(this),r=i.moduleId,t=r.lastIndexOf("/"),e=r+"/"+r.slice(-1===t?0:t+1,-5)+".html"}},deserializedFromSerialization:{value:function(){this.attachToParentComponent()}},_deserializedFromTemplate:{value:function(e,t,r){n.getInfoForObject(this).label=t,this._ownerDocumentPart=r,this.hasOwnProperty("identifier")||(this.identifier=t),this.ownerComponent||(this.ownerComponent=f.prototype.isPrototypeOf(e)?e:this.rootComponent),this._needsDrawInDeserialization&&(this.needsDraw=!0)}},blueprintModuleId:{serializable:!1,enumerable:!1,get:function(){var e=n.getInfoForObject(this),t=e&&!e.isInstance?this:Object.getPrototypeOf(this);if(!Object.getOwnPropertyDescriptor(t,"_blueprintModuleId")||!t._blueprintModuleId){e=n.getInfoForObject(t);var r=e.moduleId,i=r.lastIndexOf("/"),a=r.lastIndexOf(".");i=-1===i?0:i+1,a=-1===a?r.length:a,a=i>a?r.length:a;var o;o=r.length>a&&".reel"===r.slice(a,r.length)?r+"/"+r.slice(i,a)+".meta":r.slice(0,a)+".meta",n.defineProperty(t,"_blueprintModuleId",{value:o})}return t._blueprintModuleId}},blueprint:e("montage")._blueprintDescriptor,gateDidBecomeTrue:{value:function(e){e===this._canDrawGate?this._canDraw=!0:e===this._blockDrawGate&&(g.componentBlockDraw(this),this._prepareCanDraw())},enumerable:!1},_canDrawGate:{enumerable:!1,value:null},_preparedForActivationEvents:{enumerable:!1,value:!1},_drawIfNeeded:{enumerable:!1,value:function(e){var t,r,i,a,o=this._firstDraw;if(this._treeLevel=e,o&&(this.originalElement=this.element),this.needsDraw&&g.addToDrawCycle(this),o&&this.prepareForDraw&&n.callDeprecatedFunction(this,this.prepareForDraw,"prepareForDraw","enterDocument(firstTime)"),this._needsEnterDocument&&(this._needsEnterDocument=!1,this._inDocument=!0,"function"==typeof this.enterDocument&&this.enterDocument(o),this._enterDocument(o)),o&&(this.originalElement=null),h.isDebug&&h.debug(this,"drawList: "+(this._drawList||[]).length+" of "+this.childComponents.length),null!==this._drawList&&this._drawList.length>0)for(r=this._drawList,this._drawList=[],a=r.length,i=0;a>i;i++)t=r[i],h.isDebug&&h.debug("Parent Component "+(null!=this.element?this.element.id:"")+" drawList length: "+r.length),t._addedToDrawList=!1,h.isDebug&&h.debug(this,"childComponent: "+t.element+"; canDraw: "+t.canDraw()),t.canDraw()&&t._drawIfNeeded(e+1)}},_updateComponentDom:{value:function(){var e,t,n;if(this._firstDraw){for(this._prepareForDraw(),t=this.composerList.length,n=0;t>n;n++)e=this.composerList[n],e.lazyLoad||e._load();this._firstDraw=!1}(null!==this._newDomContent||this._shouldClearDomContentOnNextDraw)&&(h.isDebug&&c.debug("Component content changed: component ",this._montage_metadata.objectName,this.identifier," newDomContent",this._newDomContent),this._performDomContentChanges())}},_replaceElementWithTemplate:{enumerable:!1,value:function(){var e,t,n,r,i=this.element,a=this._templateElement,o=this.element.attributes;for(n=0;r=o[n];n++)e=r.nodeName,t="id"===e||"data-montage-id"===e?r.nodeValue:(a.getAttribute(e)||"")+("style"===e?"; ":" ")+r.nodeValue,a.setAttribute(e,t);this._initializeClassListFromElement(a),i.parentNode?i.parentNode.replaceChild(a,i):console.warn("Warning: Trying to replace element ",i," which has no parentNode"),this.eventManager.unregisterEventHandlerForElement(i),this.eventManager.registerEventHandlerForElement(this,a),this._element=a,this._templateElement=null,this._newDomContent&&(this._newDomContent=null,this._shouldClearDomContentOnNextDraw=!1)}},_addTemplateStyles:{value:function(){var e,t,n,r=this._templateDocumentPart;if(r){e=r.template.getResources(),n=this.element.ownerDocument,t=e.createStylesForDocument(n);for(var i,a=0;i=t[a];a++)this.rootComponent.addStylesheet(i)}}},_prepareForDraw:{value:function(){c.isDebug&&c.debug(this,"_templateElement: "+this._templateElement),this._initDomArguments(),this._templateElement&&(this._bindTemplateParametersToArguments(),this._replaceElementWithTemplate())},enumerable:!1},_bindTemplateParametersToArguments:{value:function(){var e,t,n,r,i,a,o,s,l=this._templateDocumentPart.parameters;if(t=this._domArguments,this._template.hasParameters()||1!==t.length){if(r=this._validateTemplateArguments(t,l))throw r;for(var c in l){e=l[c],n=t[c],"*"===c?(o=this._element.ownerDocument.createRange(),o.selectNodeContents(this._element),i=o.extractContents()):i=n,a=this._findAndDetachComponents(i),e.parentNode.replaceChild(i,e);for(var u=0;s=a[u];u++)s.attachToParentComponent()}}}},_validateTemplateArguments:{value:function(e,t){var n,r,i=Object.keys(t);if(0!==i.length)if(null==e){if(i.length>0)return Error("No arguments provided for "+this.templateModuleId+". Arguments needed: "+i+".")}else if("*"in t){if(n=Object.keys(e),n.length>0)return Error('Arguments "'+n+'" were given to component but no named parameters '+"are defined in "+this.templateModuleId)}else{for(r in t)if(!(r in e))return Error('"'+r+'" argument not '+"given in "+this.templateModuleId);for(r in e)if("*"!==r&&!(r in t))return Error('"'+r+'" parameter does '+"not exist in "+this.templateModuleId)}}},prepareForActivationEvents:{enumerable:!1,value:null},_prepareForActivationEvents:{value:function(){var e,t=this.composerList.length;for(t=0;this.composerList.length>t;t++)e=this.composerList[t],e.lazyLoad&&e._load();"function"==typeof this.prepareForActivationEvents&&this.prepareForActivationEvents()}},_performDomContentChanges:{value:function(){var e,t=this._newDomContent,n=this._element.childNodes[0];if(t||this._shouldClearDomContentOnNextDraw){if(e=this._element,e.innerHTML="",Element.isElement(t))e.appendChild(t);else if(null!=t)for(var r,i=0;r=t[i];i++)e.appendChild(r);this._newDomContent=null,"function"==typeof this.contentDidChange&&this.contentDidChange(this._element.childNodes[0],n),this._shouldClearDomContentOnNextDraw=!1}}},prepareForDraw:{enumerable:!1,value:null},draw:{enumerable:!1,value:function(){}},willDraw:{enumerable:!1,value:null},didDraw:{enumerable:!1,value:function(){}},_addedToDrawList:{value:!1},_addToParentsDrawList:{enumerable:!1,value:function(){if(!this._addedToDrawList){var e=this.parentComponent;e?(e._addToDrawList(this),h.isDebug&&h.debug("drawList -- childComponent",this._montage_metadata.objectName," added to ",e._montage_metadata.objectName)):h.isDebug&&h.debug(this,"parentComponent is null")}}},_needsDraw:{value:!1},_needsDrawInDeserialization:{value:!1},needsDraw:{enumerable:!1,get:function(){return!!this._needsDraw},set:function(e){return this.isDeserializing?(this._needsDrawInDeserialization=!0,void 0):(this._needsDraw!==e&&(h.isDebug&&h.debug("NEEDS DRAW TOGGLED "+e+" FOR "+this._montage_metadata.objectName),this._needsDraw=!!e,e&&(this.canDrawGate.value?this._addToParentsDrawList():this.blockDrawGate.setField("drawRequested",!0))),void 0)}},_drawList:{value:null},__addToDrawList:{enumerable:!1,value:function(e){null===this._drawList?(this._drawList=[e],e._addedToDrawList=!0):-1===this._drawList.indexOf(e)&&(this._drawList.push(e),e._addedToDrawList=!0)}},_addToDrawList:{enumerable:!1,value:function(e){this.__addToDrawList(e),this._addToParentsDrawList()}},_templateElement:{enumerable:!1,value:null},surrenderPointer:{value:function(){return!0}},composerList:{value:[],distinct:!0,serializable:!1},addComposer:{value:function(e){this.addComposerForElement(e,e.element)}},addComposerForElement:{value:function(e,t){e.component=this,e.element=t,this.composerList.push(e),this._firstDraw||(e.lazyLoad?this._preparedForActivationEvents&&e._load():e._load())}},scheduleComposer:{value:function(e){this.rootComponent.addToComposerList(e)}},removeComposer:{value:function(e){var t,n;for(n=this.composerList.length,t=0;n>t;t++)if(this.composerList[t].uuid===e.uuid){this.composerList[t].unload(),this.composerList.splice(t,1);break}}},clearAllComposers:{value:function(){var e,t,n=this.composerList;for(t=n.length,e=0;t>e;e++)n[e].unload();n.splice(0,t)}},localizer:{value:null},_waitForLocalizerMessages:{value:!1},waitForLocalizerMessages:{enumerable:!1,get:function(){return this._waitForLocalizerMessages},set:function(e){if(this._waitForLocalizerMessages!==e)if(e!==!0||this.localizer.messages)this._waitForLocalizerMessages=!1,this.canDrawGate.setField("messages",!0);else{if(!this.localizer)throw"Cannot wait for messages on localizer if it is not set";this._waitForLocalizerMessages=!0;var t=this;c.debug(this,"waiting for messages from localizer"),this.canDrawGate.setField("messages",!1),this.localizer.messagesPromise.then(function(){c.isDebug&&c.debug(t,"got messages from localizer"),t.canDrawGate.setField("messages",!0)})}}},_elementAttributeValues:{value:null},_elementAttributeDescriptors:{value:null},_getElementAttributeDescriptor:{value:function(e){for(var t,n=this;n&&n._elementAttributeDescriptors&&!(t=n._elementAttributeDescriptors[e]);)n=Object.getPrototypeOf(n);return t}},defineAttribute:{value:function(e,t){t=t||{};var r="_"+e,i={configurable:void 0===t.configurable?!0:t.configurable,enumerable:void 0===t.enumerable?!0:t.enumerable,set:function(e,t){return function(n){var r=this._getElementAttributeDescriptor(e,this);r&&"boolean"===r.dataType&&(n=n||""===n?!0:!1),void 0!==n&&this[t]!==n&&(this[t]=n,null===this._elementAttributeValues&&(this._elementAttributeValues={}),this._elementAttributeValues[e]=n,this.needsDraw=!0)}}(e,r),get:function(e,t){return function(){return this[t]}}(e,r)};n.defineProperty(this.prototype,r,{value:null}),n.defineProperty(this.prototype,e,i)}},addAttributes:{value:function(e){var t,n,r;this.prototype._elementAttributeDescriptors=e;for(n in e)e.hasOwnProperty(n)&&(r=e[n],null===r||"string"==typeof r?(t={value:r,dataType:"string"},e[n]=t):t=r,void 0===this[n]&&this.defineAttribute(n,t))}},_enterDocument:{value:function(e){var t;if(e){t=this.originalElement;var n,r,i,a,o,s,l;if(n=t.attributes)for(i=n.length,r=0;i>r;r++)a=n[r].name,o=n[r].value,l=this._getElementAttributeDescriptor(a,this),(l||void 0!==this[a])&&(null===this._elementAttributeValues&&(this._elementAttributeValues={}),void 0===this._elementAttributeValues[a]&&(this._elementAttributeValues[a]=o,(void 0===this[a]||null==this[a])&&(this[a]=o)));if(l=this._getElementAttributeDescriptor("textContent",this)){var c=t.textContent;void 0===this._elementAttributeValues.textContent&&(this._elementAttributeValues.textContent=c,null==this.textContent&&(this.textContent=c))}if(this._elementAttributeDescriptors)for(s in this._elementAttributeDescriptors){l=this._elementAttributeDescriptors[s];var u="_"+s;null===this[u]&&null!==l&&"value"in l&&(this[u]=this._elementAttributeDescriptors[s].value)}}}},_draw:{value:function(){var e,t=this.element;for(var n in this._elementAttributeValues)if(this._elementAttributeValues.hasOwnProperty(n)){var r=this[n];e=this._getElementAttributeDescriptor(n,this),e&&("boolean"===e.dataType?r===!0?(t[n]=!0,t.setAttribute(n,n.toLowerCase())):(t[n]=!1,t.removeAttribute(n)):void 0!==r&&("textContent"===n?t.textContent=r:t.setAttribute(n,r))),delete this._elementAttributeValues[n]}this._drawClassListIntoComponent()}},_classList:{value:null},_classListDirty:{value:!1},classList:{get:function(){return null===this._classList&&(this._classList=new p,this._subscribeToToClassListChanges(),this._initializeClassListFromElement(this.element)),this._classList}},_initializeClassListFromElement:{value:function(e){var t;if(e&&e.className&&(t=e.className.trim())&&0!==t.length){var n=this.classList;this._unsubscribeToClassListChanges&&this._unsubscribeToClassListChanges(),n.addEach(t.split(/\s+/)),this._subscribeToToClassListChanges()}}},_unsubscribeToClassListChanges:{value:null},_subscribeToToClassListChanges:{value:function(){this._unsubscribeToClassListChanges=this._classList.addRangeChangeListener(this,"classList")}},handleClassListRangeChange:{value:function(){this._classListDirty=!0,this.needsDraw=!0}},_drawClassListIntoComponent:{value:function(){if(this._classListDirty){for(var e,t=this.element.classList,n=this._classList,r=0,i=t.length;i>r;r++)e=t.item(r),n.has(e)||(t.remove(e),r--,i--);this._classList.forEach(function(e){t.add(e)}),this._classListDirty=!1}}},dispose:{value:function(){this.cancelBindings(),this.detachFromParentComponent(),d.unregisterEventHandlerForElement(this,this._element),this._element=null,this.childComponents.forEach(function(e){e.dispose()})}}}),m=f.specialize({constructor:{value:function m(){this.super()}},init:{value:function(){return this}},needsDraw:{enumerable:!0,get:function(){return!1},set:function(e){if(this._needsDraw!==e&&(this._needsDraw=!!e,e))for(var t,n=this.childComponents,r=0;t=n[r];r++)h.isDebug&&h.debug(this,"needsDraw = true for: "+t._montage_metadata.exportedSymbol),t.needsDraw=!0}},canDrawGate:{get:function(){return this._canDrawGate||(this._canDrawGate=(new s).initWithDelegate(this))}},_clearNeedsDrawTimeOut:{value:null},_needsDrawList:{value:[]},_cannotDrawList:{value:null},componentBlockDraw:{value:function(e){this._cannotDrawList=this._cannotDrawList?this._cannotDrawList:{},this._cannotDrawList[e.uuid]=e,this._clearNeedsDrawTimeOut&&(window.clearTimeout(this._clearNeedsDrawTimeOut),this._clearNeedsDrawTimeOut=null)}},isComponentWaitingNeedsDraw:{value:function(e){return e.uuid in this._cannotDrawList||this._needsDrawList.indexOf(e)>=0}},componentCanDraw:{value:function(e,t){if(t){if(!this._cannotDrawList)return;if(delete this._cannotDrawList[e.uuid],this._needsDrawList.push(e),0===Object.keys(this._cannotDrawList).length&&this._needsDrawList.length>0&&!this._clearNeedsDrawTimeOut){var n=this;this._clearNeedsDrawTimeOut=window.setTimeout(function(){n._clearNeedsDrawList()},0)}}else this._clearNeedsDrawTimeOut&&(window.clearTimeout(this._clearNeedsDrawTimeOut),this._clearNeedsDrawTimeOut=null)}},_clearNeedsDrawList:{value:function(){var e,t,n,r=this._needsDrawList;for(n=r.length,t=0;n>t;t++)e=r[t],e.needsDraw&&e._addToParentsDrawList();this._clearNeedsDrawTimeOut=null,r.splice(0,n)}},removeFromCannotDrawList:{value:function(e){if(this._cannotDrawList&&(delete this._cannotDrawList[e.uuid],0===Object.keys(this._cannotDrawList).length&&this._needsDrawList.length>0&&!this._clearNeedsDrawTimeOut)){var t=this;this._clearNeedsDrawTimeOut=window.setTimeout(function(){t._clearNeedsDrawList()},0)}}},_cancelDrawIfScheduled:{value:function(){var e=this.requestedAnimationFrame,t=this.cancelAnimationFrame;null!==e&&(this._frameTime||(c.isDebug&&c.debug(this,"clearing draw"),t?t.call(window,e):window.clearTimeout(e),this.requestedAnimationFrame=null))}},_addToDrawList:{value:function(e){this.__addToDrawList(e),h.isDebug&&h.debug(this,this.canDrawGate.value,this.requestedAnimationFrame),this.drawTree()},enumerable:!1},addToComposerList:{value:function(e){this.composerList.push(e),h.isDebug&&h.debug(this,e,"Added to composer list"),this._scheduleComposerRequest=!0,this.drawTree()
}},composerListSwap:{value:[],distinct:!0},_scheduleComposerRequest:{value:!1},requestedAnimationFrame:{value:null,enumerable:!1},requestAnimationFrame:{value:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,enumerable:!1},cancelAnimationFrame:{value:window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame,enumerable:!1},_frameTime:{value:null},_oldSource:{value:null},_diff:{value:function(e,t){for(var n={},r={},i=0;t.length>i;i++)null==n[t[i]]&&(n[t[i]]={rows:[],o:null}),n[t[i]].rows.push(i);for(i=0;e.length>i;i++)null==r[e[i]]&&(r[e[i]]={rows:[],n:null}),r[e[i]].rows.push(i);for(i in n)1===n[i].rows.length&&void 0!==r[i]&&1===r[i].rows.length&&(t[n[i].rows[0]]={text:t[n[i].rows[0]],row:r[i].rows[0]},e[r[i].rows[0]]={text:e[r[i].rows[0]],row:n[i].rows[0]});for(i=0;t.length-1>i;i++)null!=t[i].text&&null==t[i+1].text&&t[i].row+1<e.length&&null==e[t[i].row+1].text&&t[i+1]==e[t[i].row+1]&&(t[i+1]={text:t[i+1],row:t[i].row+1},e[t[i].row+1]={text:e[t[i].row+1],row:i+1});for(i=t.length-1;i>0;i--)null!=t[i].text&&null==t[i-1].text&&t[i].row>0&&null==e[t[i].row-1].text&&t[i-1]==e[t[i].row-1]&&(t[i-1]={text:t[i-1],row:t[i].row-1},e[t[i].row-1]={text:e[t[i].row-1],row:i-1});return{o:e,n:t}}},_previousDrawDate:{enumerable:!1,value:0},_documentResources:{value:null},_needsStylesheetsDraw:{value:!1},_stylesheets:{value:[]},addStylesheet:{value:function(e){this._stylesheets.push(e),this._needsStylesheetsDraw=!0}},drawStylesheets:{value:function(){for(var e,t=this._documentResources,n=this._stylesheets;e=n.shift();)t.addStyle(e);this._needsStylesheetsDraw=!1}},drawTree:{value:function(){if(null===this.requestedAnimationFrame){h.isDebug&&h.debug(this,"requesting a draw");var e=this,t=this.requestAnimationFrame,n=function(t){var n;if(e._needsStylesheetsDraw&&e.drawStylesheets(),!e._documentResources.areStylesLoaded)return u.isDebug&&console.log("Draw Cycle Waiting Stylesheets: ",e._documentResources._expectedStyles.length),e.requestedAnimationFrame=null,e.drawTree(),void 0;if(u.isDebug&&(n=window.performance?window.performance.now():Date.now()),e._frameTime=t?t:Date.now(),e._clearNeedsDrawTimeOut&&e._clearNeedsDrawList(),h.isDebug){var r=document.documentElement.innerHTML;if(e._oldSource&&r!==e._oldSource){for(var i=["DOM modified outside of the draw loop"],a=e._diff(e._oldSource.split("\n"),r.split("\n")),o=0;a.n.length>o;o++)if(null==a.n[o].text)i.push("+ "+a.n[o]);else for(var s=a.n[o].row+1;a.o.length>s&&null==a.o[s].text;s++)i.push("- "+a.o[s]);console.warn(i.join("\n"))}console.group((t?h.toTimeString(new Date(t))+" ":"")+"Draw Fired")}if(e.drawIfNeeded(),u.isDebug){if(window.performance)var l=window.performance.now();else var l=Date.now();console.log("Draw Cycle Time: ",l-n,", Components: ",e._lastDrawComponentsCount)}h.isDebug&&(console.groupEnd(),e._oldSource=document.documentElement.innerHTML),e._frameTime=null,e._scheduleComposerRequest&&e.drawTree()};if(t)this.requestedAnimationFrame=t.call(window,n);else{var r=Date.now(),i=17-r+this._previousDrawDate;0>i&&(i=0),this.requestedAnimationFrame=setTimeout(n,i),this._previousDrawDate=r+i}this._scheduleComposerRequest=!1}},enumerable:!1},_readyToDrawList:{enumerable:!1,value:[]},_readyToDrawListIndex:{enumerable:!1,value:null},addToDrawCycle:{value:function(e){var t=this._readyToDrawListIndex;return t.hasOwnProperty(e.uuid)?(h.isDebug&&h.debug("components should not be added to the draw cycle twice"),void 0):(this._readyToDrawList.push(e),this._readyToDrawListIndex[e.uuid]=!0,e._updateComponentDom(),void 0)}},_lastDrawComponentsCount:{value:null},drawIfNeeded:{value:function(){var e,t,n,r,i,a,o=this._readyToDrawList,s=0,l=this.composerList;if(o.length=0,a=l.length,this._readyToDrawListIndex={},a>0){for(this.composerList=this.composerListSwap,t=0;a>t;t++)i=l[t],i.needsFrame=!1,i.frame(this._frameTime);l.splice(0,a),this.composerListSwap=l}for(this._drawIfNeeded(0),n=o.length;n>s;){for(t=s;n>t;t++)e=o[t],"function"==typeof e.willDraw&&e.willDraw(this._frameTime),h.isDebug&&h.debug(e._montage_metadata.objectName," willDraw treeLevel ",e._treeLevel);this._drawIfNeeded(0),s=n,n=o.length}var c=function(e,t){return e._treeLevel-t._treeLevel};for(o.sort(c),t=0;n>t;t++)e=o[t],e.needsDraw=!1;for(this.requestedAnimationFrame=null,t=n-1;t>=0;t--)e=o[t],e._draw(this._frameTime),e.draw(this._frameTime),h.isDebug&&h.debug(e._montage_metadata.objectName," draw treeLevel ",e._treeLevel);for(t=0;n>t;t++)e=o[t],e.didDraw(this._frameTime),e._completedFirstDraw||(r=document.createEvent("CustomEvent"),r.initCustomEvent("firstDraw",!0,!1,null),e.dispatchEvent(r),e._completedFirstDraw=!0),h.isDebug&&h.debug(e._montage_metadata.objectName," didDraw treeLevel ",e._treeLevel);return u.isDebug&&(this._lastDrawComponentsCount=o.length),!!o.length}},element:{get:function(){return this._element},set:function(e){d.registerEventHandlerForElement(this,e),this._element=e,this._documentResources=o.getInstanceForDocument(e)}}}),g=(new m).init();t.__root__=g}}),montageDefine("e2fc70c","core/target",{dependencies:["montage","core/event/event-manager","core/event/mutable-event"],factory:function(e,t){var n=e("montage").Montage,r=e("core/event/event-manager").defaultEventManager,i=e("core/event/mutable-event").MutableEvent;t.Target=n.specialize({constructor:{value:function(){this.super()}},acceptsActiveTarget:{serializable:!1,value:!1},isActiveTarget:{get:function(){return this===r.activeTarget}},willBecomeActiveTarget:{value:Function.noop},didBecomeActiveTarget:{value:Function.noop},surrendersActiveTarget:{value:function(){return!0}},nextTarget:{serializable:!1,value:null},dispatchEvent:{value:function(e){var t=e;return e instanceof i||(t=i.fromEvent(t)),t.target=this,r.handleEvent(t),!e.defaultPrevented}},dispatchEventNamed:{value:function(e,t,n,a){var o=i.fromType(e,t,n,a);return o.target=this,r.handleEvent(o),!o.defaultPrevented}},addEventListener:{value:function(e,t,n){t&&r.registerEventListener(this,e,t,n)}},removeEventListener:{value:function(e,t,n){t&&r.unregisterEventListener(this,e,t,n)}}})}}),montageDefine("e2fc70c","core/template",{dependencies:["montage","core/serialization","core/document-part","core/document-resources","core/serialization/serialization","core/serialization/serializer/montage-labeler","core/promise","core/mini-url","core/logger","core/event/event-manager","core/application"],factory:function(e,t){function n(e,t,n){var r,i,a=new d,s=e.documentElement.outerHTML,l=new o,c=e.documentElement;return r=a.createHtmlDocumentWithHtml(s,e.location.href),a.initWithDocument(r,t).then(function(){return a.setBaseUrl(e.location.href),i=a._createTemplateObjects(n),l.initWithTemplateAndFragment(a),a._instantiateObjects(i,c).then(function(e){return l.objects=e,a._invokeDelegates(l),l})})}var r,i=e("montage").Montage,a=e("core/serialization").Deserializer,o=e("core/document-part").DocumentPart,s=e("core/document-resources").DocumentResources,l=e("core/serialization/serialization").Serialization,c=e("core/serialization/serializer/montage-labeler").MontageLabeler,u=e("core/promise").Promise,h=e("core/mini-url");e("core/logger").logger("template"),e("core/event/event-manager").defaultEventManager;var d=i.specialize({_SERIALIZATON_SCRIPT_TYPE:{value:"text/montage-serialization"},_ELEMENT_ID_ATTRIBUTE:{value:"data-montage-id"},PARAM_ATTRIBUTE:{value:"data-param"},_require:{value:null},_resources:{value:null},document:{value:null},_baseUrl:{value:null},_instances:{value:null},_metadata:{value:null},_objectsString:{value:null},objectsString:{get:function(){return this._objectsString},set:function(e){this._objectsString=e,this._serialization&&this._serialization.initWithString(e),this.__deserializer=null}},__deserializer:{value:null},_deserializer:{get:function(){var e,t,n=this.__deserializer;if(!n){if(e=this._metadata){t=Object.create(null);for(var r in e)t[r]=e[r].require}n=(new a).init(this.objectsString,this._require,t),this.__deserializer=n}return n}},getDeserializer:{value:function(){return this._deserializer}},_serialization:{value:null},getSerialization:{value:function(){var e=this._serialization;return e||(e=this._serialization=new l,e.initWithString(this.objectsString)),e}},constructor:{value:function d(){this.super()}},initWithRequire:{value:function(e){return this._require=e,this.document=this.createHtmlDocumentWithHtml(""),this.objectsString="",this}},initWithDocument:{value:function(e,t){var n=this;return this._require=t,this.setDocument(e),this.getObjectsString(e).then(function(e){return n.objectsString=e,n})}},initWithHtml:{value:function(e,t){var n=this;return this._require=t,this.document=this.createHtmlDocumentWithHtml(e),this.getObjectsString(this.document).then(function(e){return n.objectsString=e,n})}},initWithObjectsAndDocumentFragment:{value:function(e,t,n){return this._require=n,this.document=this.createHtmlDocumentWithHtml(""),this.document.body.appendChild(this.document.importNode(t,!0)),this.setObjects(e),this}},initWithModuleId:{value:function(e,t){var n=this;return this._require=t,this.createHtmlDocumentWithModuleId(e,t).then(function(r){var i=t(e).directory;return n.document=r,n.setBaseUrl(i),n.getObjectsString(r).then(function(e){return n.objectsString=e,n})})}},clone:{value:function(){var e=new d;return e._require=this._require,e._baseUrl=this._baseUrl,e.setDocument(this.document),e.objectsString=this.objectsString,e._instances=Object.clone(this._instances,1),e}},instantiate:{value:function(e){return this.instantiateWithInstances(null,e)}},instantiateWithInstances:{value:function(e,t){var n,r,i,a=this,s=new o;return e=e||this._instances,n=this._createMarkupDocumentFragment(t),i=this._getParameters(n),s.initWithTemplateAndFragment(this,n),s.startActingAsTopComponent(),s.parameters=i,r=this._createTemplateObjects(e),this._instantiateObjects(r,n).then(function(n){var r;return s.objects=n,a._invokeDelegates(s,e),s.stopActingAsTopComponent(),r=a.getResources(),!r.resourcesLoaded()&&r.hasResources()&&r.loadResources(t).done(),s})}},_objectsInstantiationOptimized:{value:!1},_optimizeObjectsInstantiationPromise:{value:null},_optimizeObjectsInstantiation:{value:function(){var e,t=this;return this._objectsInstantiationOptimized?void 0:(this._optimizeObjectsInstantiationPromise||(e=this._deserializer.preloadModules(),e?this._optimizeObjectsInstantiationPromise=e.then(function(){t._objectsInstantiationOptimized=!0}):this._objectsInstantiationOptimized=!0),this._optimizeObjectsInstantiationPromise)}},setBaseUrl:{value:function(e){this._baseUrl=e}},getBaseUrl:{value:function(){return this._baseUrl}},getResources:{value:function(){var e=this._resources;return e||(e=this._resources=new p,e.initWithTemplate(this)),e}},_createTemplateObjects:{value:function(t){var n=Object.create(t||null);return void 0===r&&(r=e("core/application").application),n.application=r,n.template=this,n}},_instantiateObjects:{value:function(e,t){var n,r=this._deserializer;return n=this._optimizeObjectsInstantiation(),n?n.then(function(){return r.deserialize(e,t)}):r.deserialize(e,t)}},_createMarkupDocumentFragment:{value:function(e){for(var t=e.createDocumentFragment(),n=this.document.body.childNodes,r=0,i=n.length;i>r;r++)t.appendChild(e.importNode(n[r],!0));return t}},getParameterName:{value:function(e){return e.getAttribute(this.PARAM_ATTRIBUTE)}},getParameters:{value:function(){return this._getParameters(this.document.body)}},_getParameters:{value:function(e){for(var t,n=e.querySelectorAll("*["+this.PARAM_ATTRIBUTE+"]"),r=n.length,i={},a=0;r>a;a++){t=n[a];var o=this.getParameterName(t);if(o in i)throw Error('The parameter "'+o+'" is'+" declared more than once in "+this.getBaseUrl()+".");i[o]=t}if("*"in i&&r>1)throw Error('The star "*" template parameter was declared when other parameters were also present in '+this.getBaseUrl()+": "+Object.keys(i)+".");return i}},hasParameters:{value:function(){return!!this.document.querySelector("*["+this.PARAM_ATTRIBUTE+"]")}},_invokeDelegates:{value:function(e,t){var n,r,i=e.objects,a=i.owner||t&&t.owner;for(var o in i)t&&o in t||(n=i[o],r=this._getObjectOwner(o,a),n&&("function"==typeof n._deserializedFromTemplate&&n._deserializedFromTemplate(r,o,e),"function"==typeof n.deserializedFromTemplate&&n.deserializedFromTemplate(r,o,e)));if(a){var s=this.getSerialization();s.isExternalObject("owner")||("function"==typeof a._templateDidLoad&&a._templateDidLoad(e),"function"==typeof a.templateDidLoad&&a.templateDidLoad(e))}}},setInstances:{value:function(e){this._instances=e}},getInstances:{value:function(){return this._instances}},setObjects:{value:function(e){this.objectsString=JSON.stringify(e,null,4)}},setObjectMetadata:{value:function(e,t,n,r){var i=this._metadata;i||(this._metadata=i=Object.create(null)),i[e]={require:t,label:n,owner:r},this.__deserializer=null}},getObjectMetadata:{value:function(e){var t=this._metadata;return t&&e in t?t[e]:{require:this._require,label:e}}},_getObjectOwner:{value:function(e,t){var n,r=this._metadata;return n=r&&e in r?r[e].owner:t}},setDocument:{value:function(e){var t=e.documentElement.innerHTML;this.document=this.createHtmlDocumentWithHtml(t,e.baseURI)}},getObjectsString:{value:function(e){var t;return t=this.getInlineObjectsString(e),null===t?this.getExternalObjectsString(e):u.resolve(t)}},getInlineObjectsString:{value:function(e){var t="script[type='"+this._SERIALIZATON_SCRIPT_TYPE+"']",n=e.querySelector(t);return n?n.textContent:null}},getExternalObjectsString:{value:function(e){var t,n,r,i,a=e.querySelector('link[rel="serialization"]');return a?(t=new XMLHttpRequest,n=a.getAttribute("href"),r=this.getBaseUrl()||"",/^https?:\/\/|^\//.test(n)?u.reject(Error("Relative link found for the objects file but the document URL is unknown: '"+n+"'.")):(n=r+n,i=u.defer(),t.open("GET",n),t.addEventListener("load",function(){200==t.status?i.resolve(t.responseText):i.reject(Error("Unable to retrive '"+n+"', code status: "+t.status))},!1),t.addEventListener("error",function(e){i.reject(Error("Unable to retrive '"+n+"' with error: "+e.error+"."))},!1),t.send(),i.promise)):u.resolve(null)}},createHtmlDocumentWithHtml:{value:function(e,t){var n=document.implementation.createHTMLDocument("");return n.documentElement.innerHTML=e,this.normalizeRelativeUrls(n,t),n}},createHtmlDocumentWithModuleId:{value:function(e,t){var n=this;return"function"!=typeof t?u.reject(Error("Missing 'require' function to load module '"+e+"'.")):t.async(e).then(function(e){return n.createHtmlDocumentWithHtml(e.content,e.directory)})}},_removeObjects:{value:function(e){var t="script[type='"+this._SERIALIZATON_SCRIPT_TYPE+"'], link[rel='serialization']";Array.prototype.forEach.call(e.querySelectorAll(t),function(e){e.parentNode.removeChild(e)})}},_addObjects:{value:function(e,t){if(t){var n=e.createElement("script");n.setAttribute("type",this._SERIALIZATON_SCRIPT_TYPE),n.textContent=JSON.stringify(JSON.parse(t),null,4),e.head.appendChild(n)}}},_templateFromElementContentsCache:{value:null},clearTemplateFromElementContentsCache:{value:function(){this._templateFromElementContentsCache=null}},createTemplateFromElementContents:{value:function(e){var t,n,r,i=this._templateFromElementContentsCache;return i||(i=Object.create(null),this._templateFromElementContentsCache=i),e in i?Object.create(i[e]):(t=this.getElementById(e),r=this.document.createRange(),r.selectNodeContents(t),n=this.createTemplateFromRange(r),i[e]=n,Object.create(n))}},createTemplateFromElement:{value:function(e){var t,n;return t=this.getElementById(e),n=this.document.createRange(),n.selectNode(t),this.createTemplateFromRange(n)}},createTemplateFromRange:{value:function(e){var t,n,r,i,a,o=new l;return t=e.cloneContents(),n=this._getChildrenElementIds(t),o.initWithString(this.objectsString),r=o.getSerializationLabelsWithElements(n),a=o.extractSerialization(r,["owner"]),i=new d,i.initWithObjectsAndDocumentFragment(null,t,this._require),i.objectsString=a.getSerializationString(),i._resources=this.getResources(),i}},_createSerializationWithElementIds:{value:function(e){var t,n,r=new l;return r.initWithString(this.objectsString),t=r.getSerializationLabelsWithElements(e),n=r.extractSerialization(t,["owner"])}},expandParameters:{value:function(e,t){var n,r,i,a,o,s,l=[],c={},u=this.getSerialization(),h={};n=this.getParameters();for(var d in n)if(a=n[d],o=t.getTemplateParameterArgument(e,d),l.push.apply(l,this._getElementIds(o)),r=this.replaceNode(o,a))for(var p in r)c[p]=r[p];return h.elementIds=l,h.elementIdsCollisions=c,s=e._createSerializationWithElementIds(l),s.renameElementReferences(c),i=u.mergeSerialization(s),this.objectsString=u.getSerializationString(),h.labels=s.getSerializationLabels(),h.labelsCollisions=i,h}},_resolveElementIdCollisions:{value:function(e){var t,n,r,i,a,o=new c;r=this.getElementIds();for(var s,l=0;s=r[l];l++)o.setObjectLabel(null,s);n=this._getElements(e);for(var s in n)this.getElementById(s)&&(i=n[s],a=o.getObjectLabel(i),this.setElementId(i,a),t||(t=Object.create(null)),t[s]=a);return t}},replaceNode:{value:function(e,t){var n;return n=this._resolveElementIdCollisions(e),this.normalizeRelativeUrls(e,this.getBaseUrl()),t.parentNode.replaceChild(e,t),n}},insertNodeBefore:{value:function(e,t){var n;return n=this._resolveElementIdCollisions(e),this.normalizeRelativeUrls(e,this.getBaseUrl()),t.parentNode.insertBefore(e,t),n}},appendNode:{value:function(e,t){var n;return n=this._resolveElementIdCollisions(e),this.normalizeRelativeUrls(e,this.getBaseUrl()),t.appendChild(e),n}},getElementId:{value:function(e){return e.getAttribute?e.getAttribute(this._ELEMENT_ID_ATTRIBUTE):void 0}},setElementId:{value:function(e,t){e.setAttribute(this._ELEMENT_ID_ATTRIBUTE,t)}},getElementIds:{value:function(){return this._getElementIds(this.document.body)}},_getElements:{value:function(e){var t,n,r="*["+this._ELEMENT_ID_ATTRIBUTE+"]",i={};t=e.querySelectorAll(r);for(var a,o=0;a=t[o];o++)n=this.getElementId(a),i[n]=a;return n=this.getElementId(e),n&&(i[n]=e),i}},_getChildrenElementIds:{value:function(e){var t,n="*["+this._ELEMENT_ID_ATTRIBUTE+"]",r=[];t=e.querySelectorAll(n);for(var i,a=0;i=t[a];a++)r.push(this.getElementId(i));return r}},_getElementIds:{value:function(e){var t,n=this._getChildrenElementIds(e);return t=this.getElementId(e),t&&n.push(t),n}},getElementById:{value:function(e){var t="*["+this._ELEMENT_ID_ATTRIBUTE+"='"+e+"']";return this.document.querySelector(t)}},html:{get:function(){var e=this.document;return this._removeObjects(e),this._addObjects(e,this.objectsString),this._getDoctypeString(e.doctype)+"\n"+e.documentElement.outerHTML}},_getDoctypeString:{value:function(e){return"<!DOCTYPE "+e.name+(e.publicId?' PUBLIC "'+e.publicId+'"':"")+(!e.publicId&&e.systemId?" SYSTEM":"")+(e.systemId?' "'+e.systemId+'"':"")+">"}},normalizeRelativeUrls:{value:function(e,t){if("string"==typeof t&&""!==t&&"about:blank"!==t)for(var n="http://www.w3.org/1999/xlink",r=/^[\w\-]+:|^\//,i=-1!==d._NORMALIZED_TAG_NAMES.indexOf(e.tagName)?[e]:e.querySelectorAll(d._NORMALIZED_TAG_NAMES_SELECTOR),a=0,o=i.length;o>a;a++){var s,l=i[a];"image"===l.tagName?(s=l.getAttributeNS(n,"href"),r.test(s)||l.setAttributeNS(n,"href",h.resolve(t,s))):(s=l.getAttribute("src"),r.test(s)||l.setAttribute("src",h.resolve(t,s)))}}}},{_templateCache:{value:{moduleId:Object.create(null)}},_getTemplateCacheKey:{value:function(e,t){return e=t.resolve(e),t.location+"#"+e}},getTemplateWithModuleId:{value:function(e,t){var n,r;return n=this._getTemplateCacheKey(e,t),r=this._templateCache.moduleId[n],r||(r=(new d).initWithModuleId(e,t),this._templateCache.moduleId[n]=r),r}},_NORMALIZED_TAG_NAMES:{value:["IMG","image","IFRAME"]},__NORMALIZED_TAG_NAMES_SELECTOR:{value:null},_NORMALIZED_TAG_NAMES_SELECTOR:{get:function(){return this.__NORMALIZED_TAG_NAMES_SELECTOR||(this.__NORMALIZED_TAG_NAMES_SELECTOR=this._NORMALIZED_TAG_NAMES.join(",")),this.__NORMALIZED_TAG_NAMES_SELECTOR}}}),p=i.specialize({_resources:{value:null},_resourcesLoaded:{value:!1},template:{value:null},rootUrl:{value:""},constructor:{value:function p(){this._resources=Object.create(null)}},initWithTemplate:{value:function(e){this.template=e}},hasResources:{value:function(){return this.getStyles().length>0||this.getScripts().length>0}},resourcesLoaded:{value:function(){return this._resourcesLoaded}},loadResources:{value:function(e){return this._resourcesLoaded=!0,u.all([this.loadScripts(e),this.loadStyles(e)])}},getScripts:{value:function(){var e,t,n,r=this._resources.scripts;if(!r){t=this.template,r=this._resources.scripts=[],n=t.document.querySelectorAll("script");for(var i=0,a=n.length;a>i;i++)e=n[i],e.type!==this.template._SERIALIZATON_SCRIPT_TYPE&&r.push(e)}return r}},loadScripts:{value:function(e){var t,n=[];t=this.getScripts();for(var r=0,i=t.length;i>r;r++)n.push(this.loadScript(t[r],e));return u.all(n)}},loadScript:{value:function(e,t){var n,r;return n=s.getInstanceForDocument(t),r=this._cloneScriptElement(e,t),n.addScript(r)}},_cloneScriptElement:{value:function(e,t){for(var n,r=t.createElement("script"),i=e.attributes,a=0,o=i.length;o>a;a++)n=i[a],r.setAttribute(n.name,n.value);return r}},getStyles:{value:function(){var e,t,n,r=this._resources.styles;return r||(n='link[rel="stylesheet"], style',e=this.template,t=e.document.querySelectorAll(n),r=Array.prototype.slice.call(t,0),this._resources.styles=r),r}},loadStyles:{value:function(e){var t,n=[];t=this.getStyles();for(var r=0,i=t.length;i>r;r++)n.push(this.loadStyle(t[r],e));return u.all(n)}},loadStyle:{value:function(e,t){var n,r,i=this.template.getBaseUrl();return n=e.getAttribute("href"),n?(r=s.getInstanceForDocument(t),n=r.normalizeUrl(n,i),r.preloadResource(n)):u.resolve()}},createStylesForDocument:{value:function(e){var t,n,r,i,a=this.getStyles(),o=[],l=this.template.getBaseUrl();n=s.getInstanceForDocument(e);for(var c,u=0;c=a[u];u++)r=c.getAttribute("href"),t=e.importNode(c,!0),o.push(t),r&&(i=n.normalizeUrl(r,l),t.setAttribute("href",i));return o}}});t.Template=d,t.TemplateResources=p,t.instantiateDocument=n}}),montageDefine("e2fc70c","core/document-resources",{dependencies:["montage","core/promise","core/mini-url"],factory:function(e,t){var n=e("montage").Montage,r=e("core/promise").Promise,i=e("core/mini-url"),a=n.specialize({_SCRIPT_TIMEOUT:{value:5e3},_document:{value:null},_resources:{value:null},_preloaded:{value:null},_expectedStyles:{value:null},constructor:{value:function a(){this.super(),this._expectedStyles=[]}},initWithDocument:{value:function(e){return this.clear(),this._document=e,this}},clear:{value:function(){this._resources=Object.create(null),this._preloaded=Object.create(null)}},_addResource:{value:function(e){this._resources[e]=!0}},hasResource:{value:function(e){return e in this._resources}},isResourcePreloaded:{value:function(e){return this._preloaded[e]===!0}},isResourcePreloading:{value:function(e){return r.isPromise(this._preloaded[e])}},setResourcePreloadedPromise:{value:function(e,t){this._preloaded[e]=t}},setResourcePreloaded:{value:function(e){this._preloaded[e]=!0}},getResourcePreloadedPromise:{value:function(e){return this._preloaded[e]}},addScript:{value:function(e){var t=this.normalizeUrl(e.src);return t?this.isResourcePreloaded(t)?r.resolve():this.isResourcePreloading(t)?this.getResourcePreloadedPromise(t):this._importScript(e):this._importScript(e)}},_importScript:{value:function(e){var t,n,i=this,a=this._document,o=a.head,s=r.defer(),l=e.src;return l?(i._addResource(l),t=function(){i.setResourcePreloaded(l),e.removeEventListener("load",t),e.removeEventListener("error",t),clearTimeout(n),s.resolve()},e.addEventListener("load",t,!1),e.addEventListener("error",t,!1),n=setTimeout(function(){i.setResourcePreloaded(l),s.resolve()},this._SCRIPT_TIMEOUT),this.setResourcePreloadedPromise(l,s.promise)):s.resolve(),o.appendChild(a.createComment("Inserted from FIXME")),o.appendChild(e),s.promise}},addStyle:{value:function(e){var t,n=e.getAttribute("href");if(n=this.normalizeUrl(n)){if(this.hasResource(n))return;this._addResource(n)}t=this._document.head,this._expectedStyles.push(n),t.insertBefore(e,t.firstChild)}},normalizeUrl:{value:function(e,t){return t||(t=this._document.location.href),i.resolve(t,e)}},_schemeRegexp:{value:/^[a-zA-Z][a-zA-Z0-9+\.\-]*:\/\//i},preloadResource:{value:function(e,t){var n;return this._schemeRegexp.test(e)&&(n=!0),e=this.normalizeUrl(e),"file://"===e.slice(0,7)&&(n=!0),n&&t&&(n=!1),n||this.isResourcePreloaded(e)?r.resolve():this.isResourcePreloading(e)?this.getResourcePreloadedPromise(e):this._preloadResource(e)}},_preloadResource:{value:function(e){var t,n,i=this,a=new XMLHttpRequest,o=r.defer();return a.open("GET",e),t=function(){i.setResourcePreloaded(e),a.removeEventListener("load",t),a.removeEventListener("error",t),clearTimeout(n),o.resolve()},a.addEventListener("load",t,!1),a.addEventListener("error",t,!1),a.send(),n=setTimeout(function(){i.setResourcePreloaded(e),o.resolve()},this._SCRIPT_TIMEOUT),this.setResourcePreloadedPromise(e,o.promise),o.promise}},areStylesLoaded:{get:function(){var e,t;if(this._expectedStyles.length>0){e=this._document.styleSheets;for(var n,r=0;n=e[r];r++)t=this._expectedStyles.indexOf(n.href),t>=0&&this._expectedStyles.splice(t,1)}return 0===this._expectedStyles.length}}},{getInstanceForDocument:{value:function(e){var t=e.__montage_resources__;return t||(t=e.__montage_resources__=(new a).initWithDocument(e)),t}}});t.DocumentResources=a}}),montageDefine("e2fc70c","core/gate",{dependencies:["montage","core/logger"],factory:function(e,t){var n=e("montage").Montage,r=e("core/logger").logger("gate");t.Gate=n.specialize({constructor:{value:function(){this.super()}},init:{enumerable:!1,value:function(){return this.reset(),this}},initWithDelegate:{enumerable:!1,value:function(e){return this.reset(),this.delegate=e,this}},initWithDescriptor:{enumerable:!1,value:function(e){var t;this.reset();for(t in e)this.setField(t,e[t].value);return this}},count:{value:0},table:{value:null},getField:{enumerable:!1,value:function(e){var t=this.table;return!t||t[e]}},setField:{enumerable:!1,value:function(e,t){var n,i=this.table,a=this.count;i=i?i:this.table={},n=i[e],void 0!==n||t?void 0!==n&&n!==t?t?this.count--:this.count++:t&&r.error(this,e+" was not set before."):this.count++,i[e]=!!t,0===this.count&&a>0?this.callDelegateMethod(!0):0===a&&this.count>0&&this.callDelegateMethod(!1)}},removeField:{enumerable:!1,value:function(e){var t=this.table,n=t[e];void 0===n||n||this.count--,delete t[e]}},delegate:{enumerable:!1,value:null},callDelegateMethod:{value:function(e){var t;this.delegate&&"function"==typeof(t=this.delegate["gateDidBecome"+(e?"True":"False")])&&t.call(this.delegate,this)},enumerable:!1},value:{enumerable:!1,get:function(){return 0===this.count}},reset:{enumerable:!1,value:function(){this.table={},this.count=0}},toString:{value:function(){var e,t,n=this._fields,r="";for(e=0;t=n[e];e++)r+=t+"["+(this._value&n[t])+"], ";return r}}})}}),montageDefine("e2fc70c","core/application",{dependencies:["core/core","core/target","window-loader/montage-window","core/dom","core/template"],factory:function(e,t){var n,r=(e("core/core").Montage,e("core/target").Target),i=e("window-loader/montage-window").MontageWindow;e("core/dom"),t.Application=r.specialize({eventManager:{value:null},parentApplication:{value:null},mainApplication:{get:function(){for(var e=this;e.parentApplication;)e=e.parentApplication;return e}},_windowsSortOrder:{value:"reverse-z-order"},windowsSortOrder:{get:function(){return null==this.parentApplication?this._windowsSortOrder:this.mainApplication.windowsSortOrder},set:function(e){null==this.parentApplication?-1!==["z-order","reverse-z-order","z-order","reverse-open-order"].indexOf(e)&&(this._windowsSortOrder=e):this.mainApplication.windowsSortOrder=e}},windows:{get:function(){var e;if(null==this.parentApplication){if(!this._windows){var e=new i;e.application=this,e.window=window,this.window=e,this._windows=[this.window],this._multipleWindow=!0}return this._windows}return this.mainApplication.windows}},_window:{value:null},window:{get:function(){if(!this._window&&this==this.mainApplication){var e=new i;e.application=this,e.window=window,this._window=e}return this._window},set:function(e){this._window||(this._window=e)}},attachedWindows:{value:[]},eventManagerForWindow:{value:function(e){return e.defaultEventMananger}},focusWindow:{get:function(){var e=this.windows,t=this.windowsSortOrder;if("z-order"==t)return e[0];if("reverse-z-order"==t)return e[e.length-1];for(var n in e)if(e[n].focused)return e[n]}},delegate:{value:null},nextTarget:{get:function(){return this.delegate}},openWindow:{value:function(e,t,n){var r,a,o=this,s=new i,l={location:!1,menubar:!1,resizable:!0,scrollbars:!0,status:!1,titlebar:!0,toolbar:!1},c={module:e,name:t,parent:window,callback:function(e,t){var n;r=e.document.application,s.window=e,s.application=r,s.component=t,r.window=s,o.attachedWindows.push(s),n=o.mainApplication.windowsSortOrder,"z-order"==n||"reverse-open-order"==n?o.windows.unshift(s):o.windows.push(s),a=document.createEvent("CustomEvent"),a.initCustomEvent("load",!0,!0,null),s.dispatchEvent(a)}};if(this!==this.mainApplication||this._multipleWindow||this.window,"object"==typeof n){var u,h,d="",p="";for(u in n)n.hasOwnProperty(u)&&(l[u]=n[u])}var f=["name"];for(u in l)-1==f.indexOf(u)&&(h=l[u],"boolean"==typeof h?h=h?"yes":"no":(h+="",h.match(/[ ,"]/)&&(h='"'+h.replace(/"/g,'\\"')+'"')),p+=d+u+"="+h,d=",");return window.require.loadPackage({name:"montage"}).then(function(e){var t=window.open(e.location+"window-loader/index.html","_blank",p);t.loadInfo=c}).done(),s}},attachWindow:{value:function(e){var t,n=e.application.parentApplication;return n!==this&&(n&&n.detachWindow(e),e.parentApplication=this,this.attachedWindows.push(e),t=this.mainApplication.windowsSortOrder,"z-order"==t||"reverse-open-order"==t?this.windows.unshift(e):this.windows.push(e),e.focus()),e}},detachWindow:{value:function(e){var t,n,r=this.windows;return void 0===e&&(e=this.window),n=e.application.parentApplication,n==this?(t=this.attachedWindows.indexOf(e),-1!==t&&this.attachedWindows.splice(t,1),t=r.indexOf(e),-1!==t&&r.splice(t,1),e.application.parentApplication=null):n&&n.detachWindow(e),e}},constructor:{value:function(){window.loadInfo&&!this.parentApplication&&(this.parentApplication=window.loadInfo.parent.document.application)}},_load:{value:function(n,r){var i,a=this;t.application=a,e.async("ui/component").then(function(t){return i=t.__root__,i.element=document,e("core/template").instantiateDocument(window.document,n).then(function(){a.callDelegateMethod("willFinishLoading",a),i.needsDraw=!0,r&&r(a)})}).done()}},_alertPopup:{value:null,enumerable:!1},_confirmPopup:{value:null,enumerable:!1},_notifyPopup:{value:null,enumerable:!1},_zIndex:{value:null},_isSystemPopup:{value:function(e){return"alert"===e||"confirm"===e||"notify"===e}},_createPopupSlot:{value:function(e){var t=document.createElement("div");document.body.appendChild(t),t.style.zIndex=e,t.style.position="absolute";var r=new n;return r.element=t,r.attachToParentComponent(),r}},getPopupSlot:{value:function(t,r,i){var a=this;e.async("ui/slot.reel/slot").then(function(e){n=n||e.Slot,t=t||"custom";var o,s,l=a._isSystemPopup(t);if(a.popupSlots=a.popupSlots||{},l)switch(t){case"alert":o=9004;break;case"confirm":o=9003;break;case"notify":o=9002}else a._zIndex=a._zIndex?a._zIndex+1:7e3,o=a._zIndex;s=a.popupSlots[t],s||(s=a.popupSlots[t]=a._createPopupSlot(o)),l||(s.element.style.zIndex=o),s.content=r,i.call(this,s)}).done()}},returnPopupSlot:{value:function(e){var t=this;if(t.popupSlots&&t.popupSlots[e]){var n=t.popupSlots[e];n.content=null}}},_getActivePopupSlots:{value:function(){var e=[];if(this.popupSlots){var t=Object.keys(this.popupSlots);if(t&&t.length>0){var n,r=0,i=t.length;for(r=0;i>r;r++)n=this.popupSlots[t[r]],n&&null!==n.content&&e.push(n)}}return e}}})}}),montageDefine("e2fc70c","core/document-part",{dependencies:["montage","core/logger","core/promise","core/event/event-manager"],factory:function(e,t){var n=e("montage").Montage,r=(e("core/logger").logger("document-part"),e("core/promise").Promise),i=e("core/event/event-manager").defaultEventManager,a=n.specialize({template:{value:null},fragment:{value:null},objects:{value:null},childComponents:{value:null},parameters:{value:null},constructor:{value:function a(){this.super()
}},initWithTemplateAndFragment:{value:function(e,t){this.template=e,this.fragment=t,this.objects=null,this.childComponents=[],this.parameters=null}},startActingAsTopComponent:{value:function(){this.fragment&&i.registerEventHandlerForElement(this,this.fragment)}},stopActingAsTopComponent:{value:function(){this.fragment&&i.unregisterEventHandlerForElement(this.fragment)}},addChildComponent:{value:function(e){-1==this.childComponents.indexOf(e)&&this.childComponents.push(e)}},removeChildComponent:{value:function(e){var t=this.childComponents,n=t.indexOf(e);n>-1&&(t.splice(n,1),e._parentComponent=null,e._alternateParentComponent=null)}},_addToDrawList:{value:function(){}},_componentTreeLoadedDeferred:{value:null},loadComponentTree:{value:function(){var e,t=this._componentTreeLoadedDeferred;return t||(t=r.defer(),this._componentTreeLoadedDeferred=t,e=[],this.childComponents.forEach(function(t){e.push(t.loadComponentTree())}),r.all(e).then(function(){t.resolve()},t.reject).done()),t.promise}}});t.DocumentPart=a}}),montageDefine("e2fc70c","core/serialization/serialization",{dependencies:["core/core","./serializer/montage-labeler","./deserializer/montage-reviver","frb/parse","frb/stringify"],factory:function(e,t){var n=e("core/core").Montage,r=e("./serializer/montage-labeler").MontageLabeler,i=e("./deserializer/montage-reviver").MontageReviver,a=e("frb/parse"),o=e("frb/stringify"),s=n.specialize({_serializationString:{value:null},_serializationObject:{value:null},initWithString:{value:function(e){return this._serializationString=e,this._serializationObject=null,this}},initWithObject:{value:function(e){return this._serializationString=null,this._serializationObject=e,this}},getSerializationObject:{value:function(){return this._serializationObject||(this._serializationObject=JSON.parse(this._serializationString)),this._serializationObject}},getSerializationString:{value:function(){return this._serializationString||(this._serializationString=JSON.stringify(this._serializationObject)),this._serializationString}},getSerializationLabels:{value:function(){var e=this.getSerializationObject();return Object.keys(e)}},getExternalObjectLabels:{value:function(){var e=this.getSerializationObject(),t=[];for(var n in e)0===Object.keys(e[n]).length&&t.push(n);return t}},isExternalObject:{value:function(e){var t=this.getSerializationObject();return t&&e in t?0===Object.keys(t[e]).length:!1}},getSerializationLabelsWithElements:{value:function(e){var t=new c,n=[];return t.initWithSerialization(this),t.visitSerialization(function(t){"Element"===t.type&&e.indexOf(t.data)>=0&&(t=t.parent,t&&"properties"===t.name&&(t=t.parent,t&&"montageObject"===t.type&&n.push(t.label)))}),n}},renameElementReferences:{value:function(e){var t=new c;t.initWithSerialization(this),t.visitSerialization(function(t){"Element"===t.type&&t.data in e&&(t.data=e[t.data])})}},renameSerializationLabels:{value:function(e){var t=new c;t.initWithSerialization(this),t.visitSerialization(function(t){if(t.label){var n=t.label;n in e&&(t.label=e[n])}if("reference"===t.type){var r=t.data;r in e&&(t.data=e[r])}})}},mergeSerialization:{value:function(e){return l.mergeSerializations(this,e)}},extractSerialization:{value:function(e,t){var n=new u;return n.initWithSerialization(this),n.extractSerialization(e,t)}}}),l=n.specialize(null,{mergeSerializations:{value:function(e,t){var n,r,i,a,o,l;a=e.getSerializationLabels(),o=t.getSerializationLabels(),l=this._createCollisionTable(a,o),l&&(i=t.getSerializationString(),t=(new s).initWithString(i),t.renameSerializationLabels(l),o=t.getSerializationLabels()),n=e.getSerializationObject(),r=t.getSerializationObject();for(var c,u=0;c=o[u];u++)n[c]=r[c];return e.initWithObject(n),l}},_createCollisionTable:{value:function(e,t){for(var n=new r,i={},a=!1,o=0;e.length>o;o++)n.setObjectLabel(null,e[o]);for(var s,o=0;s=t[o];o++)e.indexOf(s)>=0&&(i[s]=n.generateObjectLabel({}),a=!0);return a?i:void 0}}}),c=n.specialize({initWithSerialization:{value:function(e){this._serialization=e}},visitSerialization:{value:function(e){var t=this._serialization.getSerializationObject();this._walkRootObjects(e,t),this._serialization.initWithObject(t)}},visitSerializationObject:{value:function(e,t){var n=this._serialization.getSerializationObject();if(!(e in n))throw Error('Object "'+e+'" does not exist in '+this._serialization.getSerializationString());this._walkRootObject(t,n,e),this._serialization.initWithObject(n)}},changeLabel:{value:function(e,t){var n,r=this._serialization.getSerializationObject();n=r[e],delete r[e],r[t]=n}},_walkRootObjects:{value:function(e,t){for(var n in t)this._walkRootObject(e,t,n)}},_walkRootObject:{value:function(e,t,n){var r=t[n];"value"in r?this._walkObject(e,r,"value",n):this._walkCustomObject(e,t,n)}},_walkObject:{value:function(e,t,n,r,a){var o,s=t[n],l=i.getTypeOf(s);if(o={type:l},r?o.label=r:o.name=n,a&&(o.parent=a),"number"===l||"string"===l||"null"===l)o.data=s,e(o),t[n]=o.data;else if("regexp"===l)o.data=s["/"],e(o),s["/"]=o.data;else if("reference"===l)o.data=s["@"],e(o),s["@"]=o.data;else if("Element"===l)o.data=s["#"],e(o),s["#"]=o.data;else if("array"===l){o.data=s,e(o),t[n]=s=o.data;for(var c=0,u=s.length;u>c;c++)this._walkObject(e,s,""+c,null,o)}else if("object"===l){o.data=s,e(o),t[n]=s=o.data;for(var n in s)this._walkObject(e,s,n,null,o)}o.label!=r&&this.changeLabel(r,o.label)}},_walkCustomObject:{value:function(e,t,n){var r,i=t[n];r={type:"montageObject",label:n,data:i},e(r),t[n]=i=r.data,r.label!=n&&this.changeLabel(n,r.label),i.properties&&this._walkObject(e,i,"properties",null,r),i.listeners&&this._walkObject(e,i,"listeners",null,r),i.bindings&&this._walkBindings(e,i,null,r),i.localizations&&this._walkLocalizations(e,i,null,r)}},_walkBindings:{value:function(e,t,n){var r,i=t.bindings;r={type:"bindings",data:i,parent:n},e(r),t.bindings=i=r.data;for(var a in i)this._walkBinding(e,i,a,r)}},_walkBinding:{value:function(e,t,n,r){var i,a=t[n];i={type:"binding",name:n,data:a,parent:r},e(i),t[n]=a=i.data,this._walkBindingData(e,a,i)}},_walkBindingData:{value:function(e,t,n){var r,i,s=!1;r=t["<-"]||t["<->"],i=a(r),this._walksBindingReferences(i,function(t){var n={type:"reference",data:t.label};e(n),t.label!==n.data&&(t.label=n.data,s=!0)}),s&&("<-"in t?t["<-"]=o(i):t["<->"]=o(i)),t.converter&&this._walkObject(e,t,"converter",null,n)}},_walkLocalizations:{value:function(e,t,n){var r,i=t.localizations;r={type:"localizations",data:i,parent:n},e(r),t.localizations=i=r.data;for(var a in i)this._walkLocalization(e,i,a,r)}},_walkLocalization:{value:function(e,t,n,r){var i,a,o=t[n];if(i={type:"localization",name:n,data:o,parent:r},e(i),t[n]=o=i.data,"object"==typeof o.key&&this._walkBindingData(e,o.key,i),"object"==typeof o.default&&this._walkBindingData(e,o.default,i),"object"==typeof o.data){a=o.data;for(var n in a)this._walkBindingData(e,a[n],i)}}},_walksBindingReferences:{value:function(e,t){var n=e.args;if("component"===e.type&&t(e),n)for(var r=0,i=n.length;i>r;r++)this._walksBindingReferences(n[r],t)}}}),u=n.specialize({_serialization:{value:null},initWithSerialization:{value:function(e){this._serialization=e}},extractSerialization:{value:function(e,t){var n,r=new c,i={},a=[];n=this._serialization.getSerializationObject(),r.initWithSerialization(this._serialization);for(var o,l=0;o=e[l];l++)i[o]=n[o],r.visitSerializationObject(o,function(t){var n;"reference"===t.type&&(n=t.data,-1===a.indexOf(n)&&-1===e.indexOf(n)&&a.push(n))});if(t)for(var o,l=0;o=t[l];l++)o in n&&!(o in i)&&(i[o]={});for(var o,l=0;o=a[l];l++)i[o]={};return(new s).initWithObject(i)}}});t.Serialization=s,t.SerializationMerger=l,t.SerializationInspector=c,t.SerializationExtractor=u}}),montageDefine("e2fc70c","window-loader/montage-window",{dependencies:["montage"],factory:function(e,t){var n=e("montage").Montage;t.MontageWindow=n.specialize({_application:{value:null},application:{get:function(){return this._application},set:function(e){null===this._application&&(this._application=e,this.focused&&this._setFocusedWindow(this))}},_window:{value:null},window:{get:function(){return this._window},set:function(e){if(null===this._window){var t=e.document.body;this._window=e,e.addEventListener("beforeunload",this,!0),e.addEventListener("focus",this,!0),e.addEventListener("mousedown",this,!0),null===t.getAttribute("tabIndex")&&(t.setAttribute("tabIndex",-1),t.focus())}}},document:{get:function(){return this._window.document}},_component:{value:null},component:{get:function(){return this._component},set:function(e){null===this._component&&(this._component=e)}},title:{get:function(){return this.document.title},set:function(e){this.document.title=e}},focused:{value:!1},focus:{value:function(){this._window&&this._window.focus()}},_setFocusedWindow:{value:function(e){var t,n,r,i=this.application;if(i._multipleWindow){t=i.windows;for(r in t)n=t[r],n.window===e?n.focused!==!0&&(n.focused=!0,"z-order"==i.windowsSortOrder?(t.splice(r,1),t.unshift(n)):"reverse-z-order"==i.windowsSortOrder&&(t.splice(r,1),t.push(n))):n.focused=!1}else this.focused=!0}},closed:{get:function(){return this._window?this._window.closed:!1}},close:{value:function(){this._window&&this._window.close()}},resizeTo:{value:function(e,t){this._window&&this._window.resizeTo(e,t)}},moveTo:{value:function(e,t){this._window&&this._window.moveTo(e,t)}},captureFocus:{value:function(e){var t=this.application;if(!this.application)return this.focused=!0,void 0;if(t.parentApplication)t.mainApplication.window.captureFocus(e);else{var n=(e.target.ownerDocument?e.target.ownerDocument.defaultView:null)||e.target.defaultView||e.target;this._setFocusedWindow(n)}}},captureMousedown:{value:function(e){this.captureFocus(e)}},captureBeforeunload:{value:function(){var e,t=this.application,n=t.windows,r=t.attachedWindows;t.attachedWindows=[];for(var e in r)r[e].close();t.parentApplication&&(r=t.parentApplication.attachedWindows,e=r.indexOf(this),-1!==e&&r.splice(e,1),e=n.indexOf(this),-1!==e&&n.splice(e,1),this.window.removeEventListener("beforeunload",this,!0),this.close())}}})}}),montageDefine("e2fc70c","core/dom",{dependencies:["core/geometry/point"],factory:function(e,t){var n=e("core/geometry/point").Point,r=Node.prototype,i=Element.prototype;Object.defineProperty(i,"set",{value:function(e,t,n){var r,i,a,o,s,l=e.indexOf(".",n);n=n||0,i=e.substring(n,-1===l?e.length:l),-1===l?this.setAttribute(i,t):(a=e.lastIndexOf("."),"style"===i?(o=e.substring(l+1,e.length),this.style[o]=t):"classList"===i?(s=e.substring(l+1,e.length),t?this.classList.add(s):this.classList.remove(s)):(r=this.get(e.substring(0,a)))&&(r[e.substring(a+1,e.length)]=t))},enumerable:!1}),r.get=function(e){return this.getAttribute(e)||this[e]},Object.getPrototypeOf(document).addRule=function(e,t){var n,r;if(null==(n=document.styleSheets[0])){var i=document.createElement("style");i.type="text/css",document.head.appendChild(i),n=document.styleSheets[0]}else r=document.getRule(e,n);r||n.insertRule(e+" "+t,n.cssRules.length)},Object.getPrototypeOf(document).getRule=function(e,t){var n;if(t.cssRules)for(var r=0;n=t.cssRules[r];r++){if(n.name&&n.name===e)return n;if(n.selectorText===e)return n}},"undefined"!=typeof Element&&function(){var e="classList";if(!Element.prototype.hasOwnProperty(e)){var t=/^\s+|\s+$/g,n=function(e,t){e.setAttribute("class",t.join(" "))},r=function(e,t){if(""===t)throw"SYNTAX_ERR";if(/\s/.test(t))throw"INVALID_CHARACTER_ERR";return e.indexOf(t)},i=function(){var e=this,i=e.getAttribute("class")||"";return i=i.replace(t,"").split(/\s+/),{length:i.length,item:function(e){return i[e]||null},contains:function(e){return-1!==r(i,e)},add:function(t){-1===r(i,t)&&(i.push(t),this.length=i.length,n(e,i))},remove:function(t){var a=r(i,t);-1!==a&&(i.splice(a,1),this.length=i.length,n(e,i))},toggle:function(e){-1===r(i,e)?this.add(e):this.remove(e)},toString:function(){return e.getAttribute("class")||""}}};Object.defineProperty?Object.defineProperty(Element.prototype,e,{get:i,enumerable:!0}):Object.prototype.__defineGetter__&&Element.prototype.__defineGetter__(e,i)}}(),r.parentOf=function(e){for(;(e=e.parentNode)&&e!==this;);return e?!0:!1};var a=function(e){var t,n,r,i,a=e.ownerDocument;if(e&&a){if(n=a.documentElement,r=a.body,i=a.defaultView,e!==r){if(t=e.getBoundingClientRect(),n.parentOf(e)){var o=n.clientTop||r.clientTop||0,s=n.clientLeft||r.clientLeft||0,l=i.pageYOffset||n.scrollTop||r.scrollTop,c=i.pageXOffset||n.scrollLeft||r.scrollLeft,u=t.top+l-o,h=t.left+c-s;return{top:u,left:h}}return{top:t.top,left:t.left}}return{top:r.offsetTop,left:r.offsetLeft}}return null},o=null;try{o=new WebKitPoint(0,0)}catch(s){}var l=function(){t.convertPointFromNodeToPage=function(e,t){return t?(o.x=t.x,o.y=t.y):(o.x=0,o.y=0),t=webkitConvertPointFromNodeToPage(e,o),t?(new n).init(t.x,t.y):null},t.convertPointFromPageToNode=function(e,t){return t?(o.x=t.x,o.y=t.y):(o.x=0,o.y=0),t=webkitConvertPointFromPageToNode(e,o),t?(new n).init(t.x,t.y):null}},c=function(){t.convertPointFromNodeToPage=function(e,t){if(!e||void 0!==e.x)return null;var r;return(r=a(e))?(new n).init((t?t.x:0)+r.left,(t?t.y:0)+r.top):(new n).init(t?t.x:0,t?t.y:0)},t.convertPointFromPageToNode=function(e,t){if(!e||void 0!==e.x)return null;var r;return(r=a(e))?(new n).init((t?t.x:0)-r.left,(t?t.y:0)-r.top):(new n).init(t?t.x:0,t?t.y:0)}};o?l():c()}}),montageDefine("e2fc70c","core/geometry/point",{dependencies:["montage"],factory:function(e,t){var n=e("montage").Montage;t.Point=n.specialize({init:{enumerable:!1,value:function(e,t){return this.x=null===e?0:e,this.y=null===t?0:t,this}},x:{enumerable:!0,value:0},y:{enumerable:!0,value:0}},{interpolate:{enumerable:!1,value:function(e,n,r,i){var a,o;return a=n.x+(r.x-n.x)*e,o=n.y+(r.y-n.y)*e,i>0&&(a=Math.round(a*i)/i,o=Math.round(o*i)/i),(new t.Point).init(a,o)}}})}}),montageDefine("f814a7b","shim",{dependencies:["./shim-array","./shim-object","./shim-function","./shim-regexp"],factory:function(e){e("./shim-array"),e("./shim-object"),e("./shim-function"),e("./shim-regexp")}}),montageDefine("f814a7b","listen/property-changes",{dependencies:["../shim","weak-map"],factory:function(e,t,n){function r(){throw Error("This is an abstract interface. Mix it. Don't construct it")}e("../shim");var i=e("weak-map"),a=Object.prototype.hasOwnProperty,o=new i,s=new i;n.exports=r,r.debug=!0,r.prototype.getOwnPropertyChangeDescriptor=function(e){o.has(this)||o.set(this,{});var t=o.get(this);return a.call(t,e)||(t[e]={willChangeListeners:[],changeListeners:[]}),t[e]},r.prototype.hasOwnPropertyChangeDescriptor=function(e){if(!o.has(this))return!1;if(!e)return!0;var t=o.get(this);return a.call(t,e)?!0:!1},r.prototype.addOwnPropertyChangeListener=function(e,t,n){this.makeObservable&&!this.isObservable&&this.makeObservable();var i,a=r.getOwnPropertyChangeDescriptor(this,e);i=n?a.willChangeListeners:a.changeListeners,r.makePropertyObservable(this,e),i.push(t);var o=this;return function(){r.removeOwnPropertyChangeListener(o,e,i,n),o=null}},r.prototype.addBeforeOwnPropertyChangeListener=function(e,t){return r.addOwnPropertyChangeListener(this,e,t,!0)},r.prototype.removeOwnPropertyChangeListener=function(e,t,n){var i,a=r.getOwnPropertyChangeDescriptor(this,e);i=n?a.willChangeListeners:a.changeListeners;var o=i.lastIndexOf(t);if(-1===o)throw Error("Can't remove listener: does not exist.");i.splice(o,1),0===a.changeListeners.length+a.willChangeListeners.length&&r.makePropertyUnobservable(this,e)},r.prototype.removeBeforeOwnPropertyChangeListener=function(e,t){return r.removeOwnPropertyChangeListener(this,e,t,!0)},r.prototype.dispatchOwnPropertyChange=function(e,t,n){var i=r.getOwnPropertyChangeDescriptor(this,e);if(!i.isActive){i.isActive=!0;var a;a=n?i.willChangeListeners:i.changeListeners;var o=(n?"Will":"")+"Change",s="handleProperty"+o,l=e+"";l=l&&l[0].toUpperCase()+l.slice(1);var c="handle"+l+o;try{a.forEach(function(n){var r=n;if(n=n[c]||n[s]||n,!n.call)throw Error("No event listener for "+c+" or "+s+" or call on "+n);n.call(r,t,e,this)},this)}finally{i.isActive=!1}}},r.prototype.dispatchBeforeOwnPropertyChange=function(e,t){return r.dispatchOwnPropertyChange(this,e,t,!0)},r.prototype.makePropertyObservable=function(e){if(!Array.isArray(this)){if(!Object.isExtensible(this,e))throw Error("Can't make property "+JSON.stringify(e)+" observable on "+this+" because object is not extensible");var t;"object"==typeof this.__state__?t=this.__state__:(t={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:t,writable:!0,enumerable:!1})),t[e]=this[e],s.has(this)||(n={},s.set(this,n));var n=s.get(this);if(!a.call(n,e)){var i,o=this;Object.getOwnPropertyDescriptor(o,e);do{if(i=Object.getOwnPropertyDescriptor(o,e))break;o=Object.getPrototypeOf(o)}while(o);if(i=i||{value:void 0,enumerable:!0,writable:!0,configurable:!0},!i.configurable)throw Error("Can't observe non-configurable properties");if(n[e]=i,i.writable||i.set){var l;l="value"in i?{get:function(){return i.value},set:function(n){return n===i.value?n:(r.dispatchBeforeOwnPropertyChange(this,e,i.value),i.value=n,t[e]=n,r.dispatchOwnPropertyChange(this,e,n),n)},enumerable:i.enumerable,configurable:!0}:{get:function(){return i.get?i.get.apply(this,arguments):void 0},set:function(n){var a;return i.get&&(a=i.get.apply(this,arguments)),i.set&&i.set.apply(this,arguments),i.get&&(n=i.get.apply(this,arguments),t[e]=n),n===a?n:(r.dispatchBeforeOwnPropertyChange(this,e,a),r.dispatchOwnPropertyChange(this,e,n),n)},enumerable:i.enumerable,configurable:!0},Object.defineProperty(this,e,l)}}}},r.prototype.makePropertyUnobservable=function(e){if(!Array.isArray(this)){if(!s.has(this))throw Error("Can't uninstall observer on property");var t=s.get(this);if(!t[e])throw Error("Can't uninstall observer on property");var n=t[e];delete t[e];var r;"object"==typeof this.__state__?r=this.__state__:(r={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:r,writable:!0,enumerable:!1})),delete r[e],Object.defineProperty(this,e,n)}},r.getOwnPropertyChangeDescriptor=function(e,t){return e.getOwnPropertyChangeDescriptor?e.getOwnPropertyChangeDescriptor(t):r.prototype.getOwnPropertyChangeDescriptor.call(e,t)},r.hasOwnPropertyChangeDescriptor=function(e,t){return e.hasOwnPropertyChangeDescriptor?e.hasOwnPropertyChangeDescriptor(t):r.prototype.hasOwnPropertyChangeDescriptor.call(e,t)},r.addOwnPropertyChangeListener=function(e,t,n,i){return Object.isObject(e)?e.addOwnPropertyChangeListener?e.addOwnPropertyChangeListener(t,n,i):r.prototype.addOwnPropertyChangeListener.call(e,t,n,i):void 0},r.removeOwnPropertyChangeListener=function(e,t,n,i){return Object.isObject(e)?e.removeOwnPropertyChangeListener?e.removeOwnPropertyChangeListener(t,n,i):r.prototype.removeOwnPropertyChangeListener.call(e,t,n,i):void 0},r.dispatchOwnPropertyChange=function(e,t,n,i){return Object.isObject(e)?e.dispatchOwnPropertyChange?e.dispatchOwnPropertyChange(t,n,i):r.prototype.dispatchOwnPropertyChange.call(e,t,n,i):void 0},r.addBeforeOwnPropertyChangeListener=function(e,t,n){return r.addOwnPropertyChangeListener(e,t,n,!0)},r.removeBeforeOwnPropertyChangeListener=function(e,t,n){return r.removeOwnPropertyChangeListener(e,t,n,!0)},r.dispatchBeforeOwnPropertyChange=function(e,t,n){return r.dispatchOwnPropertyChange(e,t,n,!0)},r.makePropertyObservable=function(e,t){return e.makePropertyObservable?e.makePropertyObservable(t):r.prototype.makePropertyObservable.call(e,t)},r.makePropertyUnobservable=function(e,t){return e.makePropertyUnobservable?e.makePropertyUnobservable(t):r.prototype.makePropertyUnobservable.call(e,t)}}}),montageDefine("f814a7b","map",{dependencies:["./shim","./set","./generic-collection","./generic-map","./listen/property-changes"],factory:function(e,t,n){"use strict";function r(e,t,n,a){return this instanceof r?(t=t||Object.equals,n=n||Object.hash,a=a||Function.noop,this.contentEquals=t,this.contentHash=n,this.getDefault=a,this.store=new i(void 0,function(e,n){return t(e.key,n.key)},function(e){return n(e.key)}),this.length=0,this.addEach(e),void 0):new r(e,t,n,a)}e("./shim");var i=e("./set"),a=e("./generic-collection"),o=e("./generic-map"),s=e("./listen/property-changes");n.exports=r,Object.addEach(r.prototype,a.prototype),Object.addEach(r.prototype,o.prototype),Object.addEach(r.prototype,s.prototype),r.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentHash,this.getDefault)},r.prototype.log=function(e,t,n,r){t=t||this.logNode,this.store.log(e,function(e,n,r){t(e.value.value,n,r)},n,r)},r.prototype.logNode=function(e,t){t(" key: "+e.key),t(" value: "+e.value)}}}),montageDefine("f814a7b","shim-array",{dependencies:["./shim-function","./generic-collection","./generic-order","weak-map"],factory:function(e,t,n){"use strict";function r(e,t){Object.defineProperty(Array.prototype,e,{value:t,writable:!0,configurable:!0,enumerable:!1})}function i(e,t,n){this.array=e,this.start=null==t?0:t,this.end=n}e("./shim-function");var a=e("./generic-collection"),o=e("./generic-order"),s=e("weak-map");n.exports=Array,Array.empty=[],Object.freeze&&Object.freeze(Array.empty),Array.from=function(e){var t=[];return t.addEach(e),t},Array.unzip=function(e){for(var t=[],n=1/0,r=0;e.length>r;r++){var i=e[r];e[r]=i.toArray(),n>i.length&&(n=i.length)}for(var r=0;e.length>r;r++)for(var i=e[r],a=0;i.length>a;a++)n>a&&a in i&&(t[a]=t[a]||[],t[a][r]=i[a]);return t},r("addEach",a.prototype.addEach),r("deleteEach",a.prototype.deleteEach),r("toArray",a.prototype.toArray),r("toObject",a.prototype.toObject),r("all",a.prototype.all),r("any",a.prototype.any),r("min",a.prototype.min),r("max",a.prototype.max),r("sum",a.prototype.sum),r("average",a.prototype.average),r("only",a.prototype.only),r("flatten",a.prototype.flatten),r("zip",a.prototype.zip),r("enumerate",a.prototype.enumerate),r("group",a.prototype.group),r("sorted",a.prototype.sorted),r("reversed",a.prototype.reversed),r("constructClone",function(e){var t=new this.constructor;return t.addEach(e),t}),r("has",function(e,t){return-1!==this.find(e,t)}),r("get",function(e,t){if(+e!==e)throw Error("Indicies must be numbers");return!e in this?t:this[e]}),r("set",function(e,t){return this.splice(e,1,t),!0}),r("add",function(e){return this.push(e),!0}),r("delete",function(e,t){var n=this.find(e,t);return-1!==n?(this.splice(n,1),!0):!1}),r("find",function(e,t){t=t||this.contentEquals||Object.equals;for(var n=0;this.length>n;n++)if(n in this&&t(this[n],e))return n;return-1}),r("findLast",function(e,t){t=t||this.contentEquals||Object.equals;var n=this.length;do if(n--,n in this&&t(this[n],e))return n;while(n>0);return-1}),r("swap",function(e,t,n){var r=Array.prototype.slice.call(arguments,0,2);return n&&(Array.isArray(n)||(n=Array.prototype.slice.call(n)),r.push.apply(r,n)),this.splice.apply(this,r)}),r("one",function(){for(var e in this)if(Object.owns(this,e))return this[e]}),r("clear",function(){return this.length=0,this}),r("compare",function(e,t){t=t||Object.compare;var n,r,i,a,s;if(this===e)return 0;if(!e||!Array.isArray(e))return o.prototype.compare.call(this,e,t);for(r=Math.min(this.length,e.length),n=0;r>n;n++)if(n in this){if(!(n in e))return-1;if(i=this[n],a=e[n],s=t(i,a))return s}else if(n in e)return 1;return this.length-e.length}),r("equals",function(e,t){t=t||Object.equals;var n,r,i=0,a=this.length;if(this===e)return!0;if(!e||!Array.isArray(e))return o.prototype.equals.call(this,e);if(a!==e.length)return!1;for(;a>i;++i)if(i in this){if(!(i in e))return!1;if(n=this[i],r=e[i],!t(n,r))return!1}else if(i in e)return!1;return!0}),r("clone",function(e,t){if(void 0===e)e=1/0;else if(0===e)return this;t=t||new s;var n=[];for(var r in this)Object.owns(this,r)&&(n[r]=Object.clone(this[r],e-1,t));return n}),r("iterate",function(e,t){return new i(this,e,t)}),r("Iterator",i),i.prototype.next=function(){if(this.start===(null==this.end?this.array.length:this.end))throw StopIteration;return this.array[this.start++]}}}),montageDefine("f814a7b","shim-object",{dependencies:["weak-map"],factory:function(e,t,n){"use strict";var r=e("weak-map");n.exports=Object,Object.empty=Object.freeze(Object.create(null)),Object.isObject=function(e){return Object(e)===e},Object.getValueOf=function(e){return Object.can(e,"valueOf")&&(e=e.valueOf()),e};var i=new r;Object.hash=function(e){return Object.can(e,"hash")?""+e.hash():Object(e)===e?(i.has(e)||i.set(e,Math.random().toString(36).slice(2)),i.get(e)):""+e};var a=Object.prototype.hasOwnProperty;Object.owns=function(e,t){return a.call(e,t)},Object.can=function(e,t){return null!=e&&"function"==typeof e[t]&&!a.call(e,t)},Object.has=function(e,t){if("object"!=typeof e)throw Error("Object.has can't accept non-object: "+typeof e);if(Object.can(e,"has"))return e.has(t);if("string"==typeof t)return t in e&&e[t]!==Object.prototype[t];throw Error("Key must be a string for Object.has on plain objects")},Object.get=function(e,t,n){if("object"!=typeof e)throw Error("Object.get can't accept non-object: "+typeof e);return Object.can(e,"get")?e.get(t,n):Object.has(e,t)?e[t]:n},Object.set=function(e,t,n){Object.can(e,"set")?e.set(t,n):e[t]=n},Object.addEach=function(e,t){return t&&(Object.can(t,"forEach")?"function"==typeof t.keys?t.forEach(function(t,n){e[n]=t}):t.forEach(function(t){e[t[0]]=t[1]}):Object.keys(t).forEach(function(n){e[n]=t[n]})),e},Object.forEach=function(e,t,n){Object.keys(e).forEach(function(r){t.call(n,e[r],r,e)})},Object.map=function(e,t,n){return Object.keys(e).map(function(r){return t.call(n,e[r],r,e)})},Object.values=function(e){return Object.map(e,Function.identity)},Object.concat=function(){for(var e={},t=0;arguments.length>t;t++)Object.addEach(e,arguments[t]);return e},Object.from=Object.concat,Object.is=function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t},Object.equals=function(e,t,n){if(n=n||Object.equals,e=Object.getValueOf(e),t=Object.getValueOf(t),e===t)return 0!==e||1/e===1/t;if(null===e||null===t)return e===t;if(Object.can(e,"equals"))return e.equals(t,n);if(Object.can(t,"equals"))return t.equals(e,n);if("object"==typeof e&&"object"==typeof t){var r=Object.getPrototypeOf(e),i=Object.getPrototypeOf(t);if(r===i&&(r===Object.prototype||null===r)){for(var a in e)if(!n(e[a],t[a]))return!1;for(var a in t)if(!n(e[a],t[a]))return!1;return!0}}return e!==e&&t!==t},Object.compare=function(e,t){e=Object.getValueOf(e),t=Object.getValueOf(t);var n=typeof e,r=typeof t;return e===t?0:n!==r?0:"number"===n?e-t:"string"===n?t>e?-1:1:Object.can(e,"compare")?e.compare(t):Object.can(t,"compare")?-t.compare(e):0},Object.clone=function(e,t,n){if(e=Object.getValueOf(e),n=n||new r,void 0===t)t=1/0;else if(0===t)return e;if(Object.isObject(e)){if(!n.has(e))if(Object.can(e,"clone"))n.set(e,e.clone(t,n));else{var i=Object.getPrototypeOf(e);if(null!==i&&i!==Object.prototype)throw Error("Can't clone "+e);var a=Object.create(i);n.set(e,a);for(var o in e)a[o]=Object.clone(e[o],t-1,n)}return n.get(e)}return e},Object.clear=function(e){if(Object.can(e,"clear"))e.clear();else for(var t=Object.keys(e),n=t.length;n;)n--,delete e[t[n]];return e}}}),montageDefine("f814a7b","shim-function",{dependencies:[],factory:function(e,t,n){n.exports=Function,Function.noop=function(){},Function.identity=function(e){return e},Function.by=function(e,t){t=t||Object.compare,e=e||Function.identity;var n=function(n,r){return t(e(n),e(r))};return n.compare=t,n.by=e,n},Function.get=function(e){return function(t){return Object.get(t,e)}}}}),montageDefine("f814a7b","shim-regexp",{dependencies:[],factory:function(){if(!RegExp.escape){var e=/[-[\]{}()*+?.\\^$|,#\s]/g;RegExp.escape=function(t){return t.replace(e,"\\$&")}}}}),montageDefine("f814a7b","set",{dependencies:["./shim","./list","./fast-set","./generic-collection","./generic-set","./listen/property-changes","./listen/range-changes"],factory:function(e,t,n){"use strict";function r(e,t,n,i){return this instanceof r?(t=t||Object.equals,n=n||Object.hash,i=i||Function.noop,this.contentEquals=t,this.contentHash=n,this.getDefault=i,this.order=new this.Order(void 0,t),this.store=new this.Store(void 0,function(e,n){return t(e.value,n.value)},function(e){return n(e.value)}),this.length=0,this.addEach(e),void 0):new r(e,t,n,i)}e("./shim");var i=e("./list"),a=e("./fast-set"),o=e("./generic-collection"),s=e("./generic-set"),l=e("./listen/property-changes"),c=e("./listen/range-changes");n.exports=r,Object.addEach(r.prototype,o.prototype),Object.addEach(r.prototype,s.prototype),Object.addEach(r.prototype,l.prototype),Object.addEach(r.prototype,c.prototype),r.prototype.Order=i,r.prototype.Store=a,r.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentHash,this.getDefault)},r.prototype.has=function(e){var t=new this.order.Node(e);return this.store.has(t)},r.prototype.get=function(e){var t=new this.order.Node(e);return t=this.store.get(t),t?t.value:this.getDefault(e)},r.prototype.add=function(e){var t=new this.order.Node(e);if(!this.store.has(t)){var n=this.length;return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],n),this.order.add(e),t=this.order.head.prev,this.store.add(t),this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],n),!0}return!1},r.prototype["delete"]=function(e){var t=new this.order.Node(e);if(this.store.has(t)){var t=this.store.get(t);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[e],t.index),this.store["delete"](t),this.order.splice(t,1),this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange([],[e],t.index),!0}return!1},r.prototype.pop=function(){if(this.length){var e=this.order.head.prev.value;return this["delete"](e),e}},r.prototype.shift=function(){if(this.length){var e=this.order.head.next.value;return this["delete"](e),e}},r.prototype.one=function(){return this.length>0?this.store.one().value:void 0},r.prototype.clear=function(){var e;this.dispatchesRangeChanges&&(e=this.toArray(),this.dispatchBeforeRangeChange([],e,0)),this.store.clear(),this.order.clear(),this.length=0,this.dispatchesRangeChanges&&this.dispatchRangeChange([],e,0)},r.prototype.reduce=function(e,t){var n=arguments[2],r=this.order,i=0;return r.reduce(function(t,r){return e.call(n,t,r,i++,this)},t,this)},r.prototype.reduceRight=function(e,t){var n=arguments[2],r=this.order,i=this.length-1;return r.reduceRight(function(t,r){return e.call(n,t,r,i--,this)},t,this)},r.prototype.iterate=function(){return this.order.iterate()},r.prototype.log=function(){var e=this.store;return e.log.apply(e,arguments)},r.prototype.makeObservable=function(){this.order.makeObservable()}}}),montageDefine("f814a7b","generic-collection",{dependencies:["./shim-array"],factory:function(e,t,n){"use strict";function r(){throw Error("Can't construct. GenericCollection is a mixin.")}n.exports=r,r.prototype.addEach=function(e){if(e&&Object(e)===e)if("function"==typeof e.forEach)e.forEach(this.add,this);else if("number"==typeof e.length)for(var t=0;e.length>t;t++)this.add(e[t],t);else Object.keys(e).forEach(function(t){this.add(e[t],t)},this);return this},r.prototype.deleteEach=function(e,t){return e.forEach(function(e){this["delete"](e,t)},this),this},r.prototype.forEach=function(e){var t=arguments[1];return this.reduce(function(n,r,i,a,o){e.call(t,r,i,a,o)},void 0)},r.prototype.map=function(e){var t=arguments[1],n=[];return this.reduce(function(r,i,a,o,s){n.push(e.call(t,i,a,o,s))},void 0),n},r.prototype.enumerate=function(e){null==e&&(e=0);var t=[];return this.reduce(function(n,r){t.push([e++,r])},void 0),t},r.prototype.group=function(e,t,n){n=n||Object.equals;var r=[],i=[];return this.forEach(function(a,o,s){var l,o=e.call(t,a,o,s),c=i.indexOf(o,n);-1===c?(l=[],r.push([o,l]),i.push(o)):l=r[c][1],l.push(a)}),r},r.prototype.toArray=function(){return this.map(Function.identity)},r.prototype.toObject=function(){var e={};return this.reduce(function(t,n,r){e[r]=n},void 0),e},r.prototype.filter=function(e){var t=arguments[1],n=this.constructClone();return this.reduce(function(r,i,a,o,s){e.call(t,i,a,o,s)&&n.add(i)},void 0),n},r.prototype.every=function(e){var t=arguments[1];
return this.reduce(function(n,r,i,a,o){return n&&e.call(t,r,i,a,o)},!0)},r.prototype.some=function(e){var t=arguments[1];return this.reduce(function(n,r,i,a,o){return n||e.call(t,r,i,a,o)},!1)},r.prototype.all=function(){return this.every(Boolean)},r.prototype.any=function(){return this.some(Boolean)},r.prototype.min=function(e){e=e||this.contentCompare||Object.compare;var t=!0;return this.reduce(function(n,r){return t?(t=!1,r):0>e(r,n)?r:n},void 0)},r.prototype.max=function(e){e=e||this.contentCompare||Object.compare;var t=!0;return this.reduce(function(n,r){return t?(t=!1,r):e(r,n)>0?r:n},void 0)},r.prototype.sum=function(e){return e=void 0===e?0:e,this.reduce(function(e,t){return e+t},e)},r.prototype.average=function(e){var t=void 0===e?0:e,n=void 0===e?0:e;return this.reduce(function(e,r){t+=r,n+=1},void 0),t/n},r.prototype.concat=function(){for(var e=this.constructClone(this),t=0;arguments.length>t;t++)e.addEach(arguments[t]);return e},r.prototype.flatten=function(){var e=this;return this.reduce(function(t,n){return n.forEach(function(e){this.push(e)},t,e),t},[])},r.prototype.zip=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),Array.unzip(e)},r.prototype.join=function(e){return this.reduce(function(t,n){return t+e+n})},r.prototype.sorted=function(e,t,n){return e=e||this.contentCompare||Object.compare,e.by?(t=e.by,e=e.compare||this.contentCompare||Object.compare):t=t||Function.identity,void 0===n&&(n=1),this.map(function(e){return{by:t(e),value:e}}).sort(function(t,r){return e(t.by,r.by)*n}).map(function(e){return e.value})},r.prototype.reversed=function(){return this.constructClone(this).reverse()},r.prototype.clone=function(e,t){if(void 0===e)e=1/0;else if(0===e)return this;var n=this.constructClone();return this.forEach(function(r,i){n.add(Object.clone(r,e-1,t),i)},this),n},r.prototype.only=function(){return 1===this.length?this.one():void 0},r.prototype.iterator=function(){return this.iterate.apply(this,arguments)},e("./shim-array")}}),montageDefine("f814a7b","generic-map",{dependencies:["./shim-object","./listen/map-changes","./listen/property-changes"],factory:function(e,t,n){"use strict";function r(){throw Error("Can't construct. GenericMap is a mixin.")}function i(e,t){this.key=e,this.value=t}var a=e("./shim-object"),o=e("./listen/map-changes"),s=e("./listen/property-changes");n.exports=r,a.addEach(r.prototype,o.prototype),a.addEach(r.prototype,s.prototype),r.prototype.addEach=function(e){return e&&a(e)===e&&("function"==typeof e.forEach?"function"==typeof e.keys?e.forEach(function(e,t){this.set(t,e)},this):e.forEach(function(e){this.set(e[0],e[1])},this):a.keys(e).forEach(function(t){this.set(t,e[t])},this)),this},r.prototype.get=function(e,t){var n=this.store.get(new this.Item(e));return n?n.value:arguments.length>1?t:this.getDefault(e)},r.prototype.set=function(e,t){var n=new this.Item(e,t),r=this.store.get(n),i=!1;return r?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,r.value),r.value=t,this.dispatchesMapChanges&&this.dispatchMapChange(e,t)):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,void 0),this.store.add(n)&&(this.length++,i=!0),this.dispatchesMapChanges&&this.dispatchMapChange(e,t)),i},r.prototype.add=function(e,t){return this.set(t,e)},r.prototype.has=function(e){return this.store.has(new this.Item(e))},r.prototype["delete"]=function(e){var t=new this.Item(e);if(this.store.has(t)){var n=this.store.get(t).value;return this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,n),this.store["delete"](t),this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0),!0}return!1},r.prototype.clear=function(){var e;this.dispatchesMapChanges&&(this.forEach(function(e,t){this.dispatchBeforeMapChange(t,e)},this),e=this.keys()),this.store.clear(),this.length=0,this.dispatchesMapChanges&&e.forEach(function(e){this.dispatchMapChange(e)},this)},r.prototype.reduce=function(e,t,n){return this.store.reduce(function(t,r){return e.call(n,t,r.value,r.key,this)},t,this)},r.prototype.reduceRight=function(e,t,n){return this.store.reduceRight(function(t,r){return e.call(n,t,r.value,r.key,this)},t,this)},r.prototype.keys=function(){return this.map(function(e,t){return t})},r.prototype.values=function(){return this.map(Function.identity)},r.prototype.entries=function(){return this.map(function(e,t){return[t,e]})},r.prototype.items=function(){return this.entries()},r.prototype.equals=function(e,t){if(t=t||a.equals,this===e)return!0;if(a.can(e,"every"))return e.length===this.length&&e.every(function(e,n){return t(this.get(n),e)},this);var n=a.keys(e);return n.length===this.length&&a.keys(e).every(function(n){return t(this.get(n),e[n])},this)},r.prototype.Item=i,i.prototype.equals=function(e){return a.equals(this.key,e.key)&&a.equals(this.value,e.value)},i.prototype.compare=function(e){return a.compare(this.key,e.key)}}}),montageDefine("f814a7b","generic-order",{dependencies:["./shim-object"],factory:function(e,t,n){function r(){throw Error("Can't construct. GenericOrder is a mixin.")}var i=e("./shim-object");n.exports=r,r.prototype.equals=function(e,t){return t=t||this.contentEquals||i.equals,this===e?!0:e?this.length===e.length&&this.zip(e).every(function(e){return t(e[0],e[1])}):!1},r.prototype.compare=function(e,t){if(t=t||this.contentCompare||i.compare,this===e)return 0;if(!e)return 1;var n=Math.min(this.length,e.length),r=this.zip(e).reduce(function(e,r,i){return 0===e?i>=n?e:t(r[0],r[1]):e},0);return 0===r?this.length-e.length:r}}}),montageDefine("f814a7b","list",{dependencies:["./shim","./generic-collection","./generic-order","./listen/property-changes","./listen/range-changes"],factory:function(e,t,n){"use strict";function r(e,t,n){if(!(this instanceof r))return new r(e,t,n);var i=this.head=new this.Node;i.next=i,i.prev=i,this.contentEquals=t||Object.equals,this.getDefault=n||Function.noop,this.length=0,this.addEach(e)}function i(e){this.head=e,this.at=e.next}function a(e){this.value=e,this.prev=null,this.next=null}n.exports=r,e("./shim");var o=e("./generic-collection"),s=e("./generic-order"),l=e("./listen/property-changes"),c=e("./listen/range-changes");Object.addEach(r.prototype,o.prototype),Object.addEach(r.prototype,s.prototype),Object.addEach(r.prototype,l.prototype),Object.addEach(r.prototype,c.prototype),r.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.getDefault)},r.prototype.find=function(e,t){t=t||this.contentEquals;for(var n=this.head,r=n.next;r!==n;){if(t(r.value,e))return r;r=r.next}},r.prototype.findLast=function(e,t){t=t||this.contentEquals;for(var n=this.head,r=n.prev;r!==n;){if(t(r.value,e))return r;r=r.prev}},r.prototype.has=function(e,t){return!!this.find(e,t)},r.prototype.get=function(e,t){var n=this.find(e,t);return n?n.value:this.getDefault(e)},r.prototype["delete"]=function(e,t){var n=this.findLast(e,t);if(n){if(this.dispatchesRangeChanges){var r=[],i=[e];this.dispatchBeforeRangeChange(r,i,n.index)}return n["delete"](),this.length--,this.dispatchesRangeChanges&&(this.updateIndexes(n.next,n.index),this.dispatchRangeChange(r,i,n.index)),!0}return!1},r.prototype.clear=function(){var e,t;this.dispatchesRangeChanges&&(t=this.toArray(),e=[],this.dispatchBeforeRangeChange(e,t,0)),this.head.next=this.head.prev=this.head,this.length=0,this.dispatchesRangeChanges&&this.dispatchRangeChange(e,t,0)},r.prototype.add=function(e){var t=new this.Node(e);return this.dispatchesRangeChanges&&(t.index=this.length,this.dispatchBeforeRangeChange([e],[],t.index)),this.head.addBefore(t),this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],t.index),!0},r.prototype.push=function(){var e=this.head;if(this.dispatchesRangeChanges){var t=Array.prototype.slice.call(arguments),n=[],r=this.length;this.dispatchBeforeRangeChange(t,n,r);var i=this.head.prev}for(var a=0;arguments.length>a;a++){var o=arguments[a],s=new this.Node(o);e.addBefore(s)}this.length+=arguments.length,this.dispatchesRangeChanges&&(this.updateIndexes(i.next,void 0===i.index?0:i.index+1),this.dispatchRangeChange(t,n,r))},r.prototype.unshift=function(){if(this.dispatchesRangeChanges){var e=Array.prototype.slice.call(arguments),t=[];this.dispatchBeforeRangeChange(e,t,0)}for(var n=this.head,r=0;arguments.length>r;r++){var i=arguments[r],a=new this.Node(i);n.addAfter(a),n=a}this.length+=arguments.length,this.dispatchesRangeChanges&&(this.updateIndexes(this.head.next,0),this.dispatchRangeChange(e,t,0))},r.prototype.pop=function(){var e,t=this.head;if(t.prev!==t){if(e=t.prev.value,this.dispatchesRangeChanges){var n=[],r=[e],i=this.length-1;this.dispatchBeforeRangeChange(n,r,i)}t.prev["delete"](),this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange(n,r,i)}return e},r.prototype.shift=function(){var e,t=this.head;if(t.prev!==t){if(e=t.next.value,this.dispatchesRangeChanges){var n=[],r=[e];this.dispatchBeforeRangeChange(n,r,0)}t.next["delete"](),this.length--,this.dispatchesRangeChanges&&(this.updateIndexes(this.head.next,0),this.dispatchRangeChange(n,r,0))}return e},r.prototype.peek=function(){return this.head!==this.head.next?this.head.next.value:void 0},r.prototype.poke=function(e){this.head!==this.head.next?this.head.next.value=e:this.push(e)},r.prototype.one=function(){return this.peek()},r.prototype.scan=function(e,t){var n=this.head;if("number"==typeof e){var r=e;if(r>=0)for(e=n.next;r&&(r--,e=e.next,e!=n););else for(e=n;0>r&&(r++,e=e.prev,e!=n););return e}return e||t},r.prototype.slice=function(e,t){var n=[],r=this.head;for(e=this.scan(e,r.next),t=this.scan(t,r);e!==t&&e!==r;)n.push(e.value),e=e.next;return n},r.prototype.splice=function(e,t){return this.swap(e,t,Array.prototype.slice.call(arguments,2))},r.prototype.swap=function(e,t,n){var r=e;e=this.scan(e,this.head),null==t&&(t=1/0),n=Array.from(n);for(var i=[],a=e;t--&&t>=0&&a!==this.head;)i.push(a.value),a=a.next;var o,s;this.dispatchesRangeChanges&&(o=e===this.head?this.length:e.prev===this.head?0:e.index,s=e.prev,this.dispatchBeforeRangeChange(n,i,o));for(var a=e,l=0,a=e;i.length>l;l++,a=a.next)a["delete"]();null==r&&a===this.head&&(a=this.head.next);for(var l=0;n.length>l;l++){var c=new this.Node(n[l]);a.addBefore(c)}return this.length+=n.length-i.length,this.dispatchesRangeChanges&&(e===this.head?this.updateIndexes(this.head.next,0):this.updateIndexes(s.next,s.index+1),this.dispatchRangeChange(n,i,o)),i},r.prototype.reverse=function(){if(this.dispatchesRangeChanges){var e=this.toArray(),t=e.reversed();this.dispatchBeforeRangeChange(t,e,0)}var n=this.head;do{var r=n.next;n.next=n.prev,n.prev=r,n=n.next}while(n!==this.head);return this.dispatchesRangeChanges&&this.dispatchRangeChange(t,e,0),this},r.prototype.sort=function(){this.swap(0,this.length,this.sorted())},r.prototype.reduce=function(e,t){for(var n=arguments[2],r=this.head,i=r.next;i!==r;)t=e.call(n,t,i.value,i,this),i=i.next;return t},r.prototype.reduceRight=function(e,t){for(var n=arguments[2],r=this.head,i=r.prev;i!==r;)t=e.call(n,t,i.value,i,this),i=i.prev;return t},r.prototype.updateIndexes=function(e,t){for(;e!==this.head;)e.index=t++,e=e.next},r.prototype.makeObservable=function(){this.head.index=-1,this.updateIndexes(this.head.next,0),this.dispatchesRangeChanges=!0},r.prototype.iterate=function(){return new i(this.head)},i.prototype.next=function(){if(this.at===this.head)throw StopIteration;var e=this.at.value;return this.at=this.at.next,e},r.prototype.Node=a,a.prototype["delete"]=function(){this.prev.next=this.next,this.next.prev=this.prev},a.prototype.addBefore=function(e){var t=this.prev;this.prev=e,e.prev=t,t.next=e,e.next=this},a.prototype.addAfter=function(e){var t=this.next;this.next=e,e.next=t,t.prev=e,e.prev=this}}}),montageDefine("f814a7b","fast-set",{dependencies:["./shim","./dict","./list","./generic-collection","./generic-set","./tree-log","./listen/property-changes"],factory:function(e,t,n){"use strict";function r(e,t,n,i){return this instanceof r?(t=t||Object.equals,n=n||Object.hash,i=i||Function.noop,this.contentEquals=t,this.contentHash=n,this.getDefault=i,this.buckets=new this.Buckets(null,this.Bucket),this.length=0,this.addEach(e),void 0):new r(e,t,n,i)}e("./shim");var i=e("./dict"),a=e("./list"),o=e("./generic-collection"),s=e("./generic-set"),l=e("./tree-log"),c=e("./listen/property-changes");Object.prototype.hasOwnProperty,n.exports=r,Object.addEach(r.prototype,o.prototype),Object.addEach(r.prototype,s.prototype),Object.addEach(r.prototype,c.prototype),r.prototype.Buckets=i,r.prototype.Bucket=a,r.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentHash,this.getDefault)},r.prototype.has=function(e){var t=this.contentHash(e);return this.buckets.get(t).has(e)},r.prototype.get=function(e){var t=this.contentHash(e),n=this.buckets;return n.has(t)?n.get(t).get(e):this.getDefault(e)},r.prototype["delete"]=function(e){var t=this.contentHash(e),n=this.buckets;if(n.has(t)){var r=n.get(t);if(r["delete"](e))return this.length--,0===r.length&&n["delete"](t),!0}return!1},r.prototype.clear=function(){this.buckets.clear(),this.length=0},r.prototype.add=function(e){var t=this.contentHash(e),n=this.buckets;return n.has(t)||n.set(t,new this.Bucket(null,this.contentEquals)),n.get(t).has(e)?!1:(n.get(t).add(e),this.length++,!0)},r.prototype.reduce=function(e,t){var n=arguments[2],r=this.buckets,i=0;return r.reduce(function(t,r){return r.reduce(function(t,r){return e.call(n,t,r,i++,this)},t,this)},t,this)},r.prototype.one=function(){return this.length>0?this.buckets.one().one():void 0},r.prototype.iterate=function(){return this.buckets.values().flatten().iterate()},r.prototype.log=function(e,t,n,r){e=e||l.unicodeSharp,t=t||this.logNode,n||(n=console.log,r=console),n=n.bind(r);var i=this.buckets,a=i.keys();a.forEach(function(o,s){var l,c;s===a.length-1?(l=e.fromAbove,c=" "):0===s?(l=e.branchDown,c=e.strafe):(l=e.fromBoth,c=e.strafe);var u=i.get(o);n.call(r,l+e.through+e.branchDown+" "+o),u.forEach(function(i,a){var o,s;a===u.head.prev?(o=e.fromAbove,s=" "):(o=e.fromBoth,s=e.strafe);var l;t(a,function(t){l?n.call(r,c+" "+s+"  "+t):(n.call(r,c+" "+o+e.through+e.through+t),l=!0)},function(t){n.call(r,c+" "+e.strafe+"  "+t)})})})},r.prototype.logNode=function(e,t){var n=e.value;Object(n)===n?JSON.stringify(n,null,4).split("\n").forEach(function(e){t(" "+e)}):t(" "+n)}}}),montageDefine("f814a7b","generic-set",{dependencies:[],factory:function(e,t,n){function r(){throw Error("Can't construct. GenericSet is a mixin.")}n.exports=r,r.prototype.union=function(e){var t=this.constructClone(this);return t.addEach(e),t},r.prototype.intersection=function(e){return this.constructClone(this.filter(function(t){return e.has(t)}))},r.prototype.difference=function(e){var t=this.constructClone(this);return t.deleteEach(e),t},r.prototype.symmetricDifference=function(e){var t=this.union(e),n=this.intersection(e);return t.difference(n)},r.prototype.equals=function(e,t){var n=this;return Object.can(e,"reduce")&&this.length===e.length&&e.reduce(function(e,r){return e&&n.has(r,t)},!0)},r.prototype.contains=function(e){return this.has(e)},r.prototype.remove=function(e){return this["delete"](e)},r.prototype.toggle=function(e){this.has(e)?this["delete"](e):this.add(e)}}}),montageDefine("f814a7b","listen/range-changes",{dependencies:["weak-map","../dict"],factory:function(e,t,n){"use strict";function r(){throw Error("Can't construct. RangeChanges is a mixin.")}var i=e("weak-map"),a=e("../dict"),o=new i;n.exports=r,r.prototype.getAllRangeChangeDescriptors=function(){return o.has(this)||o.set(this,a()),o.get(this)},r.prototype.getRangeChangeDescriptor=function(e){var t=this.getAllRangeChangeDescriptors();return e=e||"",t.has(e)||t.set(e,{isActive:!1,changeListeners:[],willChangeListeners:[]}),t.get(e)},r.prototype.addRangeChangeListener=function(e,t,n){!this.isObservable&&this.makeObservable&&this.makeObservable();var r,i=this.getRangeChangeDescriptor(t);r=n?i.willChangeListeners:i.changeListeners,r.push(e),Object.defineProperty(this,"dispatchesRangeChanges",{value:!0,writable:!0,configurable:!0,enumerable:!1});var a=this;return function(){a&&(a.removeRangeChangeListener(e,t,n),a=null)}},r.prototype.removeRangeChangeListener=function(e,t,n){var r,i=this.getRangeChangeDescriptor(t);r=n?i.willChangeListeners:i.changeListeners;var a=r.lastIndexOf(e);if(-1===a)throw Error("Can't remove listener: does not exist.");r.splice(a,1)},r.prototype.dispatchRangeChange=function(e,t,n,r){var i=this.getAllRangeChangeDescriptors(),a="Range"+(r?"WillChange":"Change");i.forEach(function(i,o){if(!i.isActive){i.isActive=!0;var s;s=r?i.willChangeListeners:i.changeListeners;var l="handle"+(o.slice(0,1).toUpperCase()+o.slice(1))+a;try{s.forEach(function(i){if(i[l])i[l](e,t,n,this,r);else{if(!i.call)throw Error("Handler "+i+" has no method "+l+" and is not callable");i.call(this,e,t,n,this,r)}},this)}finally{i.isActive=!1}}},this)},r.prototype.addBeforeRangeChangeListener=function(e,t){return this.addRangeChangeListener(e,t,!0)},r.prototype.removeBeforeRangeChangeListener=function(e,t){return this.removeRangeChangeListener(e,t,!0)},r.prototype.dispatchBeforeRangeChange=function(e,t,n){return this.dispatchRangeChange(e,t,n,!0)}}}),montageDefine("f814a7b","listen/map-changes",{dependencies:["weak-map","../list","../dict"],factory:function(e,t,n){"use strict";function r(){throw Error("Can't construct. MapChanges is a mixin.")}var i=e("weak-map"),a=e("../list");n.exports=r,Object.prototype.hasOwnProperty;var o=new i;r.prototype.getAllMapChangeDescriptors=function(){var t=e("../dict");return o.has(this)||o.set(this,t()),o.get(this)},r.prototype.getMapChangeDescriptor=function(e){var t=this.getAllMapChangeDescriptors();return e=e||"",t.has(e)||t.set(e,{willChangeListeners:new a,changeListeners:new a}),t.get(e)},r.prototype.addMapChangeListener=function(e,t,n){!this.isObservable&&this.makeObservable&&this.makeObservable();var r,i=this.getMapChangeDescriptor(t);r=n?i.willChangeListeners:i.changeListeners,r.push(e),Object.defineProperty(this,"dispatchesMapChanges",{value:!0,writable:!0,configurable:!0,enumerable:!1});var a=this;return function(){a&&(a.removeMapChangeListener(e,t,n),a=null)}},r.prototype.removeMapChangeListener=function(e,t,n){var r,i=this.getMapChangeDescriptor(t);r=n?i.willChangeListeners:i.changeListeners;var a=r.findLast(e);if(!a)throw Error("Can't remove listener: does not exist.");a["delete"]()},r.prototype.dispatchMapChange=function(e,t,n){var r=this.getAllMapChangeDescriptors(),i="Map"+(n?"WillChange":"Change");r.forEach(function(r,a){if(!r.isActive){r.isActive=!0;var o;o=n?r.willChangeListeners:r.changeListeners;var s="handle"+(a.slice(0,1).toUpperCase()+a.slice(1))+i;try{o.forEach(function(n){if(n[s])n[s](t,e,this);else{if(!n.call)throw Error("Handler "+n+" has no method "+s+" and is not callable");n.call(n,t,e,this)}},this)}finally{r.isActive=!1}}},this)},r.prototype.addBeforeMapChangeListener=function(e,t){return this.addMapChangeListener(e,t,!0)},r.prototype.removeBeforeMapChangeListener=function(e,t){return this.removeMapChangeListener(e,t,!0)},r.prototype.dispatchBeforeMapChange=function(e,t){return this.dispatchMapChange(e,t,!0)}}}),montageDefine("f814a7b","listen/array-changes",{dependencies:["../shim","../list","weak-map","./property-changes","./range-changes","./map-changes"],factory:function(e){function t(e){for(var t in e)Object.defineProperty(Array.prototype,t,{value:e[t],writable:!0,configurable:!0,enumerable:!1})}e("../shim"),e("../list"),e("weak-map");var n=e("./property-changes"),r=e("./range-changes"),i=e("./map-changes"),a=Array.prototype.splice,o=Array.prototype.slice;Array.prototype.reverse;var s,l=Array.prototype.sort,c={}.__proto__===Object.prototype;s=c?function(){this.__proto__=h}:function(){Object.defineProperties(this,u)},Object.defineProperty(Array.prototype,"makeObservable",{value:s,writable:!0,configurable:!0,enumerable:!1}),t(n.prototype),t(r.prototype),t(i.prototype);var u={isObservable:{value:!0,writable:!0,configurable:!0},makeObservable:{value:Function.noop,writable:!0,configurable:!0},reverse:{value:function(){var e=this.constructClone(this);return e.reverse(),this.swap(0,this.length,e),this},writable:!0,configurable:!0},sort:{value:function(){this.dispatchBeforeRangeChange(this,this,0);for(var e=0;this.length>e;e++)n.dispatchBeforeOwnPropertyChange(this,e,this[e]),this.dispatchBeforeMapChange(e,this[e]);l.apply(this,arguments);for(var e=0;this.length>e;e++)n.dispatchOwnPropertyChange(this,e,this[e]),this.dispatchMapChange(e,this[e]);return this.dispatchRangeChange(this,this,0),this},writable:!0,configurable:!0},splice:{value:function(e,t){var r=o.call(this,e,e+t),i=o.call(arguments,2);if(!r.length&&!i.length)return i;var s=i.length-r.length,l=this.length,c=Math.max(this.length+s,e+i.length),u=Math.max(l,c);if(s&&n.dispatchBeforeOwnPropertyChange(this,"length",this.length),this.dispatchBeforeRangeChange(i,r,e),0===s)for(var h=e;e+i.length>h;h++)n.dispatchBeforeOwnPropertyChange(this,h,this[h]),this.dispatchBeforeMapChange(h,this[h]);else if(n.hasOwnPropertyChangeDescriptor(this))for(var h=e;u>h;h++)n.dispatchBeforeOwnPropertyChange(this,h,this[h]),this.dispatchBeforeMapChange(h,this[h]);e>l&&(this.length=e);var d=a.apply(this,arguments);if(0===s)for(var h=e;e+i.length>h;h++)n.dispatchOwnPropertyChange(this,h,this[h]),this.dispatchMapChange(h,this[h]);else if(n.hasOwnPropertyChangeDescriptor(this))for(var h=e;u>h;h++)n.dispatchOwnPropertyChange(this,h,this[h]),this.dispatchMapChange(h,this[h]);return this.dispatchRangeChange(i,r,e),s&&n.dispatchOwnPropertyChange(this,"length",this.length),d},writable:!0,configurable:!0},set:{value:function(e,t){return this.splice(e,1,t),this},writable:!0,configurable:!0},shift:{value:function(){return this.splice(0,1)[0]},writable:!0,configurable:!0},pop:{value:function(){return this.length?this.splice(this.length-1,1)[0]:void 0},writable:!0,configurable:!0},push:{value:function(e){if(1===arguments.length)return this.splice(this.length,0,e);var t=o.call(arguments);return this.swap(this.length,0,t)},writable:!0,configurable:!0},unshift:{value:function(e){if(1===arguments.length)return this.splice(0,0,e);var t=o.call(arguments);return this.swap(0,0,t)},writable:!0,configurable:!0},clear:{value:function(){return this.splice(0,this.length)},writable:!0,configurable:!0}},h=Object.create(Array.prototype,u)}}),montageDefine("f814a7b","sorted-array",{dependencies:["./shim","./generic-collection","./listen/property-changes","./listen/range-changes"],factory:function(e,t,n){"use strict";function r(e,t,n,i){return this instanceof r?(Array.isArray(e)?(this.array=e,e=e.splice(0,e.length)):this.array=[],this.contentEquals=t||Object.equals,this.contentCompare=n||Object.compare,this.getDefault=i||Function.noop,this.length=0,this.addEach(e),void 0):new r(e,t,n,i)}function i(e,t,n){for(var r=0,i=e.length-1;i>=r;){var a=r+i>>1,o=n(t,e[a]);if(o>0)r=a+1;else{if(!(0>o))return a;i=a-1}}return-(r+1)}function a(e,t,n,r){var a=i(e,t,n);if(0>a)return-1;for(;a>0&&r(t,e[a-1]);)a--;return r(t,e[a])?a:-1}function o(e,t,n,r){var a=i(e,t,n);if(0>a)return-1;for(;e.length-1>a&&r(t,e[a+1]);)a++;return r(t,e[a])?a:-1}function s(e,t,n){var r=i(e,t,n);if(0>r)return-r-1;for(var a=e.length-1;a>r&&0===n(t,e[r+1]);)r++;return r}n.exports=r,e("./shim");var l=e("./generic-collection"),c=e("./listen/property-changes"),u=e("./listen/range-changes");Object.addEach(r.prototype,l.prototype),Object.addEach(r.prototype,c.prototype),Object.addEach(r.prototype,u.prototype),r.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentCompare,this.getDefault)},r.prototype.has=function(e){var t=i(this.array,e,this.contentCompare);return t>=0&&this.contentEquals(this.array[t],e)},r.prototype.get=function(e){var t=a(this.array,e,this.contentCompare,this.contentEquals);return-1!==t?this.array[t]:this.getDefault(e)},r.prototype.add=function(e){var t=s(this.array,e,this.contentCompare);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],t),this.array.splice(t,0,e),this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],t),!0},r.prototype["delete"]=function(e){var t=a(this.array,e,this.contentCompare,this.contentEquals);return-1!==t?(this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[e],t),this.array.splice(t,1),this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange([],[e],t),!0):!1},r.prototype.indexOf=function(e){return a(this.array,e,this.contentCompare,this.contentEquals)},r.prototype.lastIndexOf=function(e){return o(this.array,e,this.contentCompare,this.contentEquals)},r.prototype.find=function(e){return a(this.array,e,this.contentCompare,this.contentEquals)},r.prototype.findLast=function(e){return o(this.array,e,this.contentCompare,this.contentEquals)},r.prototype.push=function(){this.addEach(arguments)},r.prototype.unshift=function(){this.addEach(arguments)},r.prototype.pop=function(){return this.array.pop()},r.prototype.shift=function(){return this.array.shift()},r.prototype.slice=function(){return this.array.slice.apply(this.array,arguments)},r.prototype.splice=function(e,t){return this.swap(e,t,Array.prototype.slice.call(arguments,2))},r.prototype.swap=function(e,t,n){if(void 0===e&&void 0===t)return[];e=e||0,0>e&&(e+=this.length),void 0===t&&(t=1/0);var r=this.slice(e,e+t);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange(n,r,e),this.array.splice(e,t),this.addEach(n),this.dispatchesRangeChanges&&this.dispatchRangeChange(n,r,e),r},r.prototype.reduce=function(e,t){var n=arguments[2];return this.array.reduce(function(t,r,i){return e.call(n,t,r,i,this)},t,this)},r.prototype.reduceRight=function(){var e=arguments[2];return this.array.reduceRight(function(t,n,r){return callback.call(e,t,n,r,this)},basis,this)},r.prototype.min=function(){return this.length?this.array[0]:void 0},r.prototype.max=function(){return this.length?this.array[this.length-1]:void 0},r.prototype.one=function(){return this.array.one()},r.prototype.clear=function(){var e;this.dispatchesRangeChanges&&(e=this.array.slice(),this.dispatchBeforeRangeChange([],e,0)),this.length=0,this.array.clear(),this.dispatchesRangeChanges&&this.dispatchRangeChange([],e,0)},r.prototype.equals=function(e,t){return this.array.equals(e,t)},r.prototype.compare=function(e,t){return this.array.compare(e,t)},r.prototype.iterate=function(e,t){return new this.Iterator(this.array,e,t)},r.prototype.Iterator=Array.prototype.Iterator}}),montageDefine("f814a7b","sorted-set",{dependencies:["./shim","./generic-collection","./generic-set","./listen/property-changes","./listen/range-changes","./tree-log"],factory:function(e,t,n){"use strict";function r(e,t,n,i){return this instanceof r?(this.contentEquals=t||Object.equals,this.contentCompare=n||Object.compare,this.getDefault=i||Function.noop,this.root=null,this.length=0,this.addEach(e),void 0):new r(e,t,n,i)}function i(e){this.value=e,this.left=null,this.right=null,this.length=1}function a(e,t,n){if(this.set=e,this.prev=null,this.end=n,t){var r=this.set.findLeastGreaterThanOrEqual(t);r&&(this.set.splay(r.value),this.prev=r.getPrevious())}}n.exports=r,e("./shim");var o=e("./generic-collection"),s=e("./generic-set"),l=e("./listen/property-changes"),c=e("./listen/range-changes"),u=e("./tree-log");Object.addEach(r.prototype,o.prototype),Object.addEach(r.prototype,s.prototype),Object.addEach(r.prototype,l.prototype),Object.addEach(r.prototype,c.prototype),r.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentCompare,this.getDefault)},r.prototype.has=function(e){return this.root?(this.splay(e),this.contentEquals(e,this.root.value)):!1},r.prototype.get=function(e){return this.root&&(this.splay(e),this.contentEquals(e,this.root.value))?this.root.value:this.getDefault(e)},r.prototype.add=function(e){var t=new this.Node(e);if(!this.root)return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],0),this.root=t,this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],0),!0;if(this.splay(e),!this.contentEquals(e,this.root.value)){var n=this.contentCompare(e,this.root.value);if(0===n)throw Error("SortedSet cannot contain incomparable but inequal values: "+e+" and "+this.root.value);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],this.root.index),0>n?(t.right=this.root,t.left=this.root.left,this.root.left=null,this.root.touch()):(t.left=this.root,t.right=this.root.right,this.root.right=null,this.root.touch()),t.touch(),this.root=t,this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],this.root.index),!0}return!1},r.prototype["delete"]=function(e){if(this.root&&(this.splay(e),this.contentEquals(e,this.root.value))){var t=this.root.index;if(this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[e],t),this.root.left){var n=this.root.right;this.root=this.root.left,this.splay(e),this.root.right=n}else this.root=this.root.right;return this.length--,this.root&&this.root.touch(),this.dispatchesRangeChanges&&this.dispatchRangeChange([],[e],t),!0}return!1},r.prototype.indexOf=function(e){return this.root&&(this.splay(e),this.contentEquals(e,this.root.value))?this.root.index:-1},r.prototype.find=function(e){return this.root&&(this.splay(e),this.contentEquals(e,this.root.value))?this.root:void 0},r.prototype.findGreatest=function(e){if(this.root){for(e=e||this.root;e.right;)e=e.right;return e}},r.prototype.findLeast=function(e){if(this.root){for(e=e||this.root;e.left;)e=e.left;return e}},r.prototype.findGreatestLessThanOrEqual=function(e){return this.root?(this.splay(e),this.root):void 0},r.prototype.findGreatestLessThan=function(e){return this.root?(this.splay(e),this.root.getPrevious()):void 0},r.prototype.findLeastGreaterThanOrEqual=function(e){if(this.root){this.splay(e);var t=this.contentCompare(e,this.root.value);return 0===t?this.root:this.root.getNext()}},r.prototype.findLeastGreaterThan=function(e){return this.root?(this.splay(e),this.contentCompare(e,this.root.value),this.root.getNext()):void 0},r.prototype.pop=function(){if(this.root){var e=this.findGreatest();return this["delete"](e.value),e.value}},r.prototype.shift=function(){if(this.root){var e=this.findLeast();return this["delete"](e.value),e.value}},r.prototype.push=function(){this.addEach(arguments)},r.prototype.unshift=function(){this.addEach(arguments)},r.prototype.slice=function(e,t){e=e||0,t=t||this.length,0>e&&(e+=this.length),0>t&&(t+=this.length);var n=[];if(this.root)for(this.splayIndex(e);t>this.root.index&&(n.push(this.root.value),this.root.right);)this.splay(this.root.getNext().value);return n},r.prototype.splice=function(e,t){return this.swap(e,t,Array.prototype.slice.call(arguments,2))},r.prototype.swap=function(e,t,n){if(void 0===e&&void 0===t)return[];e=e||0,0>e&&(e+=this.length),void 0===t&&(t=1/0);var r=[];if(this.root){this.splayIndex(e);for(var i=0;t>i;i++){r.push(this.root.value);var a=this.root.getNext();if(this["delete"](this.root.value),!a)break;this.splay(a.value)}}return this.addEach(n),r},r.prototype.splay=function(e){var t,n,r,a,o,s;if(this.root){for(t=n=r=new this.Node,s=new this.Node,o=this.root;;){var l=this.contentCompare(e,o.value);if(0>l){if(!o.left)break;if(0>this.contentCompare(e,o.left.value)&&(a=o.left,o.left=a.right,o.touch(),a.right=o,a.touch(),o=a,!o.left))break;a=new i,a.right=o,a.left=s.left,s.left=a,r.left=o,r.touch(),r=o,o=o.left}else{if(!(l>0))break;if(!o.right)break;if(this.contentCompare(e,o.right.value)>0&&(a=o.right,o.right=a.left,o.touch(),a.left=o,a.touch(),o=a,!o.right))break;a=new i,a.left=o,a.right=s.right,s.right=a,n.right=o,n.touch(),n=o,o=o.right}}for(n.right=o.left,n.touch(),r.left=o.right,r.touch(),o.left=t.right,o.right=t.left;s.left;)s.left.right.touch(),s.left=s.left.left;for(;s.right;)s.right.left.touch(),s.right=s.right.right;o.touch(),this.root=o}},r.prototype.splayIndex=function(e){if(this.root){for(var t=this.root,n=this.root.index;n!==e;)if(n>e&&t.left)t=t.left,n-=1+(t.right?t.right.length:0);else{if(!(e>n&&t.right))break;
t=t.right,n+=1+(t.left?t.left.length:0)}return this.splay(t.value),this.root.index===e}return!1},r.prototype.reduce=function(e,t,n){return this.root&&(t=this.root.reduce(e,t,0,n,this)),t},r.prototype.reduceRight=function(e,t,n){return this.root&&(t=this.root.reduceRight(e,t,this.length-1,n,this)),t},r.prototype.min=function(e){var t=this.findLeast(e);return t?t.value:void 0},r.prototype.max=function(e){var t=this.findGreatest(e);return t?t.value:void 0},r.prototype.one=function(){return this.root?this.root.value:void 0},r.prototype.clear=function(){var e;this.dispatchesRangeChanges&&(e=this.toArray(),this.dispatchBeforeRangeChange([],e,0)),this.root=null,this.length=0,this.dispatchesRangeChanges&&this.dispatchRangeChange([],e,0)},r.prototype.iterate=function(e,t){return new this.Iterator(this,e,t)},r.prototype.Iterator=a,r.prototype.summary=function(){return this.root?this.root.summary():"()"},r.prototype.log=function(e,t,n,r){e=e||u.unicodeRound,t=t||this.logNode,n||(n=console.log,r=console),n=n.bind(r),this.root&&this.root.log(e,t,n,n)},r.prototype.logNode=function(e,t){t(" "+e.value)},r.logCharsets=u,r.prototype.Node=i,i.prototype.reduce=function(e,t,n,r,i,a){if(a=a||0,this.left){var o=this.left.length;t=this.left.reduce(e,t,n,r,i,a+1),n+=o}return t=e.call(r,t,this.value,n,i,this,a),n+=1,this.right&&(t=this.right.reduce(e,t,n,r,i,a+1)),t},i.prototype.reduceRight=function(e,t,n,r,i,a){return a=a||0,this.right&&(t=this.right.reduce(e,t,n,r,i,a+1),n-=this.right.length),t=e.call(r,t,this.value,this.value,i,this,a),n-=1,this.left&&(t=this.left.reduce(e,t,n,r,i,a+1)),t},i.prototype.touch=function(){this.length=1+(this.left?this.left.length:0)+(this.right?this.right.length:0),this.index=this.left?this.left.length:0},i.prototype.checkIntegrity=function(){var e=1;if(e+=this.left?this.left.checkIntegrity():0,e+=this.right?this.right.checkIntegrity():0,this.length!==e)throw Error("Integrity check failed: "+this.summary());return e},i.prototype.getNext=function(){var e=this;if(e.right){for(e=e.right;e.left;)e=e.left;return e}},i.prototype.getPrevious=function(){var e=this;if(e.left){for(e=e.left;e.right;)e=e.right;return e}},i.prototype.summary=function(){var e=this.value||"-";return e+=" <"+this.length,this.left||this.right?"("+e+" "+(this.left?this.left.summary():"()")+", "+(this.right?this.right.summary():"()")+")":"("+e+")"},i.prototype.log=function(e,t,n,r){var i,a=this;i=this.left&&this.right?e.intersection:this.left?e.branchUp:this.right?e.branchDown:e.through;var o;this.left&&this.left.log(e,t,function(t){o?r(e.strafe+" "+t):(o=!0,r(e.fromBelow+e.through+t))},function(e){r("  "+e)});var s;t(this,function(t){s?n((a.right?e.strafe:" ")+t):(s=!0,n(i+t))},function(t){r((a.left?e.strafe:" ")+t)});var l;this.right&&this.right.log(e,t,function(t){l?n("  "+t):(l=!0,n(e.fromAbove+e.through+t))},function(t){n(e.strafe+" "+t)})},a.prototype.next=function(){var e;if(e=this.prev?this.set.findLeastGreaterThan(this.prev.value):this.set.findLeast(),!e)throw StopIteration;if(void 0!==this.end&&this.set.contentCompare(e.value,this.end)>=0)throw StopIteration;return this.prev=e,e.value}}}),montageDefine("f814a7b","heap",{dependencies:["./listen/array-changes","./shim","./generic-collection","./listen/map-changes","./listen/range-changes","./listen/property-changes"],factory:function(e,t,n){function r(e,t,n){return this instanceof r?(this.contentEquals=t||Object.equals,this.contentCompare=n||Object.compare,this.content=[],this.length=0,this.addEach(e),void 0):new r(e,t,n)}e("./listen/array-changes"),e("./shim");var i=e("./generic-collection"),a=e("./listen/map-changes"),o=e("./listen/range-changes"),s=e("./listen/property-changes");n.exports=r,Object.addEach(r.prototype,i.prototype),Object.addEach(r.prototype,s.prototype),Object.addEach(r.prototype,o.prototype),Object.addEach(r.prototype,a.prototype),r.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentCompare)},r.prototype.push=function(e){this.content.push(e),this.float(this.content.length-1),this.length++},r.prototype.pop=function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content.set(0,t),this.sink(0)),this.length--,e},r.prototype.add=function(e){this.push(e)},r.prototype.indexOf=function(e){for(var t=0;this.length>t;t++)if(this.contentEquals(this.content[t],e))return t;return-1},r.prototype.delete=function(e){var t=this.indexOf(e);if(-1===t)return!1;var n=this.content.pop();if(t===this.content.length)return!0;this.content.set(t,n);var r=this.contentCompare(n,e);return r>0?this.float(t):0>r&&this.sink(t),this.length--,!0},r.prototype.peek=function(){return this.length?this.content[0]:void 0},r.prototype.max=function(){return this.peek()},r.prototype.one=function(){return this.peek()},r.prototype.float=function(e){for(var t=this.content[e];e>0;){var n=Math.floor((e+1)/2)-1,r=this.content[n];if(!(0>this.contentCompare(r,t)))break;this.content.set(n,t),this.content.set(e,r),e=n}},r.prototype.sink=function(e){for(var t,n,r,i,a,o,s=this.content.length,l=this.content[e];;){if(i=2*(e+1),r=i-1,o=!1,s>r){var t=this.content[r],c=this.contentCompare(t,l);c>0&&(a=r,o=!0)}if(s>i){var n=this.content[i],c=this.contentCompare(n,o?t:l);c>0&&(a=i,o=!0)}if(!o)break;this.content.set(e,this.content[a]),this.content.set(a,l),e=a}},r.prototype.clear=function(){this.content.clear(),this.length=0},r.prototype.reduce=function(e,t){var n=arguments[2];return this.content.reduce(function(t,r,i){return e.call(n,t,r,i,this)},t,this)},r.prototype.reduceRight=function(e,t){var n=arguments[2];return this.content.reduceRight(function(t,r,i){return e.call(n,t,r,i,this)},t,this)},r.prototype.makeObservable=function(){this.content.addRangeChangeListener(this,"content"),this.content.addBeforeRangeChangeListener(this,"content"),this.content.addMapChangeListener(this,"content"),this.content.addBeforeMapChangeListener(this,"content")},r.prototype.handleContentRangeChange=function(e,t,n){this.dispatchRangeChange(e,t,n)},r.prototype.handleContentRangeWillChange=function(e,t,n){this.dispatchBeforeRangeChange(e,t,n)},r.prototype.handleContentMapChange=function(e,t){this.dispatchMapChange(t,e)},r.prototype.handleContentMapWillChange=function(e,t){this.dispatchBeforeMapChange(t,e)}}}),montageDefine("f814a7b","dict",{dependencies:["./shim","./generic-collection","./generic-map","./listen/property-changes"],factory:function(e,t,n){"use strict";function r(e,t){return this instanceof r?(t=t||Function.noop,this.getDefault=t,this.store={},this.length=0,this.addEach(e),void 0):new r(e,t)}function i(e){return"~"+e}function a(e){return e.slice(1)}e("./shim");var o=e("./generic-collection"),s=e("./generic-map"),l=e("./listen/property-changes");n.exports=r,Object.addEach(r.prototype,o.prototype),Object.addEach(r.prototype,s.prototype),Object.addEach(r.prototype,l.prototype),r.prototype.constructClone=function(e){return new this.constructor(e,this.mangle,this.getDefault)},r.prototype.assertString=function(e){if("string"!=typeof e)throw new TypeError("key must be a string but Got "+e)},r.prototype.get=function(e,t){this.assertString(e);var n=i(e);return n in this.store?this.store[n]:arguments.length>1?t:this.getDefault(e)},r.prototype.set=function(e,t){this.assertString(e);var n=i(e);return n in this.store?(this.dispatchesBeforeMapChanges&&this.dispatchBeforeMapChange(e,this.store[n]),this.store[n]=t,this.dispatchesMapChanges&&this.dispatchMapChange(e,t),!1):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,void 0),this.length++,this.store[n]=t,this.dispatchesMapChanges&&this.dispatchMapChange(e,t),!0)},r.prototype.has=function(e){this.assertString(e);var t=i(e);return t in this.store},r.prototype["delete"]=function(e){this.assertString(e);var t=i(e);return t in this.store?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,this.store[t]),delete this.store[i(e)],this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0),!0):!1},r.prototype.clear=function(){var e,t;for(t in this.store)e=a(t),this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,this.store[t]),delete this.store[t],this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0);this.length=0},r.prototype.reduce=function(e,t,n){for(var r in this.store)t=e.call(n,t,this.store[r],a(r),this);return t},r.prototype.reduceRight=function(e,t,n){var r=this,i=this.store;return Object.keys(this.store).reduceRight(function(t,o){return e.call(n,t,i[o],a(o),r)},t)},r.prototype.one=function(){var e;for(e in this.store)return this.store[e]}}}),montageDefine("f814a7b","tree-log",{dependencies:[],factory:function(e,t,n){"use strict";function r(){}n.exports=r,r.ascii={intersection:"+",through:"-",branchUp:"+",branchDown:"+",fromBelow:".",fromAbove:"'",fromBoth:"+",strafe:"|"},r.unicodeRound={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"╭",fromAbove:"╰",fromBoth:"┣",strafe:"┃"},r.unicodeSharp={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"┏",fromAbove:"┗",fromBoth:"┣",strafe:"┃"}}}),montageDefine("7ee841b","deserialization/reviver",{dependencies:["q"],factory:function(e,t){(function(t){function n(){}function r(e){var t=n.prototype.getCustomObjectTypeOf;return function(n){return e(n)||t(n)}}var i=function(){return this}(),a=e("q");Object.defineProperties(n.prototype,{_createAssignValueFunction:{value:function(e,t){return function(n){e[t]=n}}},getTypeOf:{value:function(e){var t=typeof e;return null===e?"null":Array.isArray(e)?"array":"object"===t&&1===Object.keys(e).length?"@"in e?"reference":"/"in e?"regexp":"object":t}},getCustomObjectTypeOf:{writable:!0,value:function(){}},reviveRootObject:{value:function(e,t,n){var r;return e.debugger,"value"in e?t.hasUserObject(n)?(r=t.getUserObject(n),t.setObjectLabel(r,n),r):this.reviveValue(e.value,t,n):0===Object.keys(e).length?t.hasUserObject(n)?(r=t.getUserObject(n),t.setObjectLabel(r,n),r):this.reviveExternalObject(e,t,n):this.reviveCustomObject(e,t,n)}},reviveValue:{value:function(e,t,n){var r=this.getTypeOf(e);return"string"===r||"number"===r||"boolean"===r||"null"===r||"undefined"===r?this.reviveNativeValue(e,t,n):"regexp"===r?this.reviveRegExp(e,t,n):"reference"===r?this.reviveObjectReference(e,t,n):"array"===r?this.reviveArray(e,t,n):"object"===r?this.reviveObjectLiteral(e,t,n):this._callReviveMethod("revive"+r,e,t,n)}},reviveNativeValue:{value:function(e,t,n){return n&&t.setObjectLabel(e,n),e}},reviveObjectLiteral:{value:function(e,t,n){var r,i=[];n&&t.setObjectLabel(e,n);for(var o in e)r=this.reviveValue(e[o],t),a.isPromise(r)?i.push(r.then(this._createAssignValueFunction(e,o))):e[o]=r;return 0===i.length?e:a.all(i).then(function(){return e})}},reviveRegExp:{value:function(e,t,n){var e=e["/"],r=RegExp(e.source,e.flags);return n&&t.setObjectLabel(r,n),r}},reviveObjectReference:{value:function(e,t){var e=e["@"],n=t.getObject(e);return n}},reviveArray:{value:function(e,t,n){var r,i=[];n&&t.setObjectLabel(e,n);for(var o=0,s=e.length;s>o;o++)r=this.reviveValue(e[o],t),a.isPromise(r)?i.push(r.then(this._createAssignValueFunction(e,o))):e[o]=r;return 0===i.length?e:a.all(i).then(function(){return e})}},reviveCustomObject:{value:function(e,t,n){var r=this.getCustomObjectTypeOf(e),s=o["revive"+r];return r?s.call(i,e,t,n):a.reject(Error("Object's type is unknown: "+JSON.stringify(e)))}},reviveExternalObject:{value:function(e,t,n){return a.reject(Error("External object '"+n+"' not found in user objects."))}},_callReviveMethod:{value:function(e,t,n,r){return this[e](t,n,r)}}});var o=Object.create(null);n.addCustomObjectReviver=function(e){for(var t in e)if("getTypeOf"!==t&&"function"==typeof e[t]&&/^revive/.test(t)){if(void 0!==o[t])return Error("Reviver '"+t+"' is already registered.");o[t]=e[t].bind(e)}this.prototype.getCustomObjectTypeOf=r(e.getTypeOf)},n.resetCustomObjectRevivers=function(){o=Object.create(null),this.prototype.getCustomObjectTypeOf=function(){}},t.Reviver=n})(t),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)})}}),montageDefine("7ee841b","serialization/malker",{dependencies:[],factory:function(e,t){(function(e){function t(e){this._handlers=e,this._enteredObjects={}}Object.defineProperties(t.prototype,{_handlers:{value:null,writable:!0},_enteredObjects:{value:null,writable:!0},_isObjectEntered:{value:function(e){return Object.hash(e)in this._enteredObjects}},_markObjectAsEntered:{value:function(e){this._enteredObjects[Object.hash(e)]=!0}},visit:{value:function(e,t){this._visitValue(e,t)},enumerable:!0},_getTypeOf:{value:function(e){return Array.isArray(e)?"array":RegExp.isRegExp(e)?"regexp":null===e?"null":"object"==typeof e?this._getObjectType(e):typeof e}},_getObjectType:{value:function(e){var t,n=this._handlers;return"function"==typeof n.getTypeOf&&(t=n.getTypeOf(e)),void 0===t?typeof e:t}},_visitValue:{value:function(e,t){var n=this._getTypeOf(e);"object"===n?this._visitObject(e,t):"array"===n?this._visitArray(e,t):"regexp"===n?this._visitRegExp(e,t):"number"===n?this._visitNumber(e,t):"string"===n?this._visitString(e,t):"boolean"===n?this._visitBoolean(e,t):"null"===n?this._visitNull(t):"undefined"===n?this._visitUndefined(t):this._visitCustomType(n,e,t)}},_visitCustomType:{value:function(e,t,n){this._callVisitorMethod("visit"+e,t,n)}},_enterCustomObject:{value:function(e,t,n){this._callVisitorMethod("enter"+e,t,n),this._callVisitorMethod("exit"+e,t,n)}},_visitObject:{value:function(e,t){var n;this._isObjectEntered(e)?this._callVisitorMethod("visitObject",e,t):(n=this._callVisitorMethod("willEnterObject",e,t),n!==!1&&(this._markObjectAsEntered(e),this._enterObject(e,t)))}},_enterObject:{value:function(e,t){var n,r=Object.keys(e);this._callVisitorMethod("enterObject",e,t);for(var i=0,a=r.length;a>i;i++)n=r[i],this._visitValue(e[n],n);this._callVisitorMethod("exitObject",e,t)}},_visitArray:{value:function(e,t){var n;this._isObjectEntered(e)?this._callVisitorMethod("visitArray",e,t):(n=this._callVisitorMethod("willEnterArray",e,t),n!==!1&&(this._markObjectAsEntered(e),this._enterArray(e,t)))}},_enterArray:{value:function(e,t){this._callVisitorMethod("enterArray",e,t);for(var n=0,r=e.length;r>n;n++)this._visitValue(e[n],""+n);this._callVisitorMethod("exitArray",e,t)}},_visitRegExp:{value:function(e,t){this._callVisitorMethod("visitRegExp",e,t)}},_visitString:{value:function(e,t){this._callVisitorMethod("visitString",e,t)}},_visitNumber:{value:function(e,t){this._callVisitorMethod("visitNumber",e,t)}},_visitBoolean:{value:function(e,t){this._callVisitorMethod("visitBoolean",e,t)}},_visitNull:{value:function(e){this._callVisitorMethod("visitNull",e)}},_visitUndefined:{value:function(e){this._callVisitorMethod("visitUndefined",e)}},_callVisitorMethod:{value:function(e){var t,n=this._handlers;return"function"==typeof n[e]?(t=Array.prototype.slice.call(arguments,1),t.unshift(this),n[e].apply(n,t)):void 0}}}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),RegExp.isRegExp||(RegExp.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}),e.Malker=t,e.visit=function(e,n){var r=new t(n);r.visit(e)}})(t)}}),montageDefine("7ee841b","serialization/serializer",{dependencies:["./malker","./builder","./labeler","./visitor"],factory:function(e,t){(function(t){function n(){var e;this._builder=new i,this._labeler=new a,e=new o(this._builder,this._labeler),this._malker=new r(e)}var r=e("./malker").Malker,i=e("./builder").Builder,a=e("./labeler").Labeler,o=e("./visitor").Visitor;Object.defineProperties(n.prototype,{_labeler:{value:null,writable:!0},_builder:{value:null,writable:!0},_serializationIndentation:{value:2,writable:!0},_malker:{value:null,writable:!0},setSerializationIndentation:{value:function(e){this._serializationIndentation=e}},serialize:{value:function(e){var t;this._labeler.initWithObjects(e);for(var n in e)this._malker.visit(e[n]);return t=this._formatSerialization(this._builder.getSerialization(this._serializationIndentation))}},serializeObject:{value:function(e){return this.serialize({root:e})}},_formatSerializationBindingsRegExp:{value:/\{\s*("(?:<->?)")\s*:\s*("[^"]+"\s*(?:,\s*"converter"\s*:\s*\{\s*"@"\s*:\s*"[^"]+"\s*\}\s*|,\s*"deferred"\s*:\s*(true|false)\s*)*)\}/gi},_formatSerializationBindingsReplacer:{value:function(e,t,n){return"{"+t+": "+n.replace(/\n\s*/g,"").replace(/,\s*/g,", ")+"}"}},_formatSerializationBindings:{value:function(e){return e.replace(this._formatSerializationBindingsRegExp,this._formatSerializationBindingsReplacer)}},_formatSerializationReferencesRegExp:{value:/\{\s*("[#@]")\s*:\s*("[^"]+")\s*\}/gi},_formatSerializationReferences:{value:function(e){return e.replace(this._formatSerializationReferencesRegExp,"{$1: $2}")}},_formatSerialization:{value:function(e){return this._formatSerializationBindings(this._formatSerializationReferences(e))}}}),t.Serializer=n,t.serialize=function(e){return(new n).serializeObject(e)}})(t)}}),montageDefine("7ee841b","deserialization/interpreter",{dependencies:["./reviver","./context"],factory:function(e,t){(function(t){function n(){}var r=e("./reviver").Reviver,i=e("./context").Context;Object.defineProperties(n.prototype,{instantiate:{value:function(e,t){var n=new r,a=new i(e,n,t);return a.getObjects()}}}),t.Interpreter=n})(t)}}),montageDefine("7ee841b","deserialization/deserializer",{dependencies:["q","./interpreter"],factory:function(e,t){(function(t){function n(e){this._serializationString=e}function r(e){return new n(e).deserializeObject()}var i=e("q"),a=e("./interpreter").Interpreter;Object.defineProperties(n.prototype,{_interpreter:{value:new a},_serializationString:{value:null,writable:!0},deserialize:{value:function(e){var t;try{t=JSON.parse(this._serializationString)}catch(n){return i.reject(n)}return this._interpreter.instantiate(t,e)}},deserializeObject:{value:function(e){return this.deserialize(e).then(function(e){return e.root})}}}),t.Deserializer=n,t.deserialize=r})(t)}}),montageDefine("7ee841b","serialization/builder",{dependencies:["./ast"],factory:function(e,t){(function(t){function n(){this.init()}var r=e("./ast");Object.defineProperties(n.prototype,{_root:{value:null,writable:!0},_stack:{value:null,writable:!0},_references:{value:null,writable:!0},_placeholderProperty:{value:Object.create(null)},init:{value:function(){return this._references=Object.create(null),this._root=new r.Root,this._stack=[this._root],this}},cleanup:{value:function(){this._references=null,this._root=null,this._stack=null}},getExternalReferences:{value:function(){var e=this._references,t=this._root,n=[];for(var r in e)t.hasProperty(r)&&t.getProperty(r)!==this._placeholderProperty||n.push(r);return n}},relabelReferences:{value:function(e,t){var n=this._references[e];if(n){n=n.slice(0);for(var r=0,i=n.length;i>r;r++)n[r].value=t}}},_registerReference:{value:function(e){var t=this._references,n=e.value;t[n]?t[n].push(e):t[n]=[e]}},_unregisterReference:{value:function(e){var t,n=e.label,r=this._references[n];1===r.length?delete this._references[n]:(t=r.indexOf(e),-1===t?console.log("BUG: reference '"+n+"' not found in registry."):r.splice(t,1))}},_createPlaceholdersForReferences:{value:function(){var e=this._references,t=this._root;for(var n in e)t.hasProperty(n)||t.setProperty(n,this._placeholderProperty)}},getSerialization:{value:function(e){return this._createPlaceholdersForReferences(),this._root.serialize(e)}},root:{get:function(){return this._root}},top:{get:function(){return this._stack[0]}},push:{value:function(e){return this._stack.unshift(e)}},pop:{value:function(){return this._stack.shift()}},createObjectLiteral:{value:function(){return new r.ObjectLiteral(this._root,Object.create(null))}},createArray:{value:function(){return new r.ObjectLiteral(this._root,[])}},createObjectReference:{value:function(e){var t=new r.ObjectReference(this._root,e);return this._registerReference(t),t}},createRegExp:{value:function(e){return new r.RegExpObject(this._root,e)}},createString:{value:function(e){return new r.Value(this._root,e)}},createNumber:{value:function(e){return new r.Value(this._root,e)}},createBoolean:{value:function(e){return new r.Value(this._root,e)}},createNull:{value:function(){return new r.Value(this._root,null)}},createCustomObject:{value:function(){return new r.CustomObject(this._root)}}}),t.Builder=n})(t)}}),montageDefine("7ee841b","serialization/labeler",{dependencies:[],factory:function(e,t){(function(e){function t(){this._objectsLabels=Object.create(null),this._objects=Object.create(null),this._objectNamesIndex=Object.create(null),this._userDefinedLabels=Object.create(null)}Object.defineProperties(t.prototype,{_objectsLabels:{value:null,writable:!0},_objects:{value:null,writable:!0},_INITIAL_LABEL_NUMBER:{value:2},_objectNamesIndex:{value:null,writable:!0},_userDefinedLabels:{value:null,writable:!0},initWithObjects:{value:function(e){for(var t in e)this.setObjectLabel(e[t],t),this._userDefinedLabels[t]=!0}},cleanup:{value:function(){this._objectsLabels=null,this._objects=null,this._objectNamesIndex=null,this._userDefinedLabels=null}},getObjectName:{value:function(e){return Array.isArray(e)?"array":RegExp.isRegExp(e)?"regexp":"object"}},generateObjectLabel:{value:function(e){var t,n=this.getObjectName(e),r=this._objectNamesIndex[n];do r?(t=n+r,this._objectNamesIndex[n]=r+=1):(t=n,this._objectNamesIndex[n]=r=this._INITIAL_LABEL_NUMBER);while(t in this._objects);return t}},getObjectLabel:{value:function(e){var t,n=Object.hash(e);return n in this._objectsLabels?t=this._objectsLabels[n]:(t=this.generateObjectLabel(e),this._objectsLabels[n]=t,this._objects[t]=e),t}},setObjectLabel:{value:function(e,t){if(void 0!==e){var n=Object.hash(e);this._objectsLabels[n]=t,this._objects[t]=e}}},getObjectByLabel:{value:function(e){return this._objects[e]}},isUserDefinedLabel:{value:function(e){return e in this._userDefinedLabels}}}),e.Labeler=t})(t)}}),montageDefine("7ee841b","serialization/visitor",{dependencies:["collections/shim-object"],factory:function(e,t){(function(t){function n(e,t){this.builder=e,this.labeler=t,this._objectsSerialization=Object.create(null)}function r(e){var t=n.prototype.getCustomObjectTypeOf;return function(n){return e(n)||t(n)}}e("collections/shim-object"),Object.defineProperties(n.prototype,{builder:{value:null,writable:!0},labeler:{value:null,writable:!0},getTypeOf:{value:function(e){return this.isCustomObject(e)?"CustomObject":void 0}},getCustomObjectTypeOf:{value:function(){},writable:!0},isCustomObject:{value:function(e){var t=this.getCustomObjectTypeOf(e);return"string"==typeof t}},_objectsSerialization:{value:null,writable:!0},setObjectSerialization:{value:function(e,t){this._objectsSerialization[Object.hash(e)]=t}},getObjectSerialization:{value:function(e){return this._objectsSerialization[Object.hash(e)]}},isObjectSerialized:{value:function(e){return Object.hash(e)in this._objectsSerialization}},enterObject:{value:function(e,t){var n=this.builder.createObjectLiteral();this.setObjectSerialization(t,n),this.builder.push(n)}},exitObject:{value:function(e,t,n){this.storeValue(this.builder.pop(),t,n)}},visitObject:{value:function(e,t,n){var r=this.labeler.getObjectLabel(t),i=this.builder.createObjectReference(r);this.getObjectSerialization(t).setLabel(r),this.builder.top.setProperty(n,i)}},enterArray:{value:function(e,t){var n=this.builder.createArray();this.setObjectSerialization(t,n),this.builder.push(n)}},exitArray:{value:function(e,t,n){this.storeValue(this.builder.pop(),t,n)}},visitArray:{value:function(e,t,n){var r=this.labeler.getObjectLabel(t),i=this.builder.createObjectReference(r);this.getObjectSerialization(t).setLabel(r),this.builder.top.setProperty(n,i)}},visitRegExp:{value:function(e,t,n){this.storeValue(this.builder.createRegExp(t),t,n)}},visitString:{value:function(e,t,n){this.storeValue(this.builder.createString(t),t,n)}},visitNumber:{value:function(e,t,n){this.storeValue(this.builder.createNumber(t),t,n)}},visitBoolean:{value:function(e,t,n){this.storeValue(this.builder.createBoolean(t),t,n)}},visitNull:{value:function(e,t){this.storeValue(this.builder.createNull(),null,t)}},visitCustomObject:{value:function(e,t,n){var r=this.getCustomObjectTypeOf(t),a=i["visit"+r];if(r)return a.call(global,e,this,t,n);throw Error("Object's type is unknown: "+t)}},storeValue:{value:function(e,t,n){void 0===n?e.setLabel(this.labeler.getObjectLabel(t)):this.builder.top.setProperty(n,e)}}});var i=Object.create(null);n.addCustomObjectVisitor=function(e){for(var t in e)if("getTypeOf"!==t&&"function"==typeof e[t]&&/^visit/.test(t)){if(void 0!==i[t])return Error("Visitor '"+t+"' is already registered.");i[t]=e[t].bind(e)}this.prototype.getCustomObjectTypeOf=r(e.getTypeOf)},n.resetCustomObjectVisitors=function(){i=Object.create(null),this.prototype.getCustomObjectTypeOf=function(){}},t.Visitor=n})(t)}}),montageDefine("7ee841b","deserialization/context",{dependencies:["q"],factory:function(e,t){var n=e("q");(function(e){function t(e,t,n){if(this._reviver=t,this._serialization=e,this._objects=Object.create(null),n){this._userObjects=Object.create(null);for(var r in n)this._userObjects[r]=n[r]}}Object.defineProperties(t.prototype,{_objects:{value:null,writable:!0},_userObjects:{value:null,writable:!0},_serialization:{value:null,writable:!0},_reviver:{value:null,writable:!0},setObjectLabel:{value:function(e,t){this._objects[t]=e}},getObject:{value:function(e){var t,r=this._serialization,i=this._reviver,a=this._objects;return e in a?a[e]:e in r?(t=i.reviveRootObject(r[e],this,e),e in a||(a[e]=t),t):n.reject(Error("Object with label '"+e+"' was not found."))}},getObjects:{value:function(){var e,t=this,r=(this._reviver,this._serialization),i=[];for(var a in r)e=this.getObject(a),n.isPromise(e)&&i.push(e);return 0===i.length?n.resolve(this._invokeDidReviveObjects()):n.all(i).then(function(){return t._invokeDidReviveObjects()})}},hasUserObject:{value:function(e){var t=this._userObjects;return t?e in t:!1}},getUserObject:{value:function(e){var t=this._userObjects;return t?t[e]:void 0}},_invokeDidReviveObjects:{value:function(){var e,t=this,r=this._reviver;return"function"==typeof r.didReviveObjects&&(e=r.didReviveObjects(this._objects,this),n.isPromise(e))?e.then(function(){return t._objects}):this._objects}}}),e.Context=t})(t)}}),montageDefine("7ee841b","serialization/ast",{dependencies:[],factory:function(e,t){(function(e){function t(){this.object=Object.create(null)}function n(e,t){this.root=e,this.value=t}function r(e,t){n.call(this,e,t)}function i(e,t){n.call(this,e,t)}function a(e,t){n.call(this,e,t)}function o(e){n.call(this,e,Object.create(null))}function s(e,t){n.call(this,e,t)}Object.defineProperties(t.prototype,{object:{value:null,writable:!0},setProperty:{value:function(e,t){null!=e&&(this.object[e]=t)}},getProperty:{value:function(e){return this.object[e]}},clearProperty:{value:function(e){delete this.object[e]}},hasProperty:{value:function(e){return e in this.object}},serialize:{value:function(e){return JSON.stringify(this,null,e)}},toJSON:{value:function(){var e,t=Object.create(null);for(var n in this.object)e=this.object[n],t[n]=e.toJSON?e.toJSON(1):e;return t}}}),Object.defineProperties(n.prototype,{root:{value:null,writable:!0},label:{value:null,writable:!0},value:{value:null,writable:!0},setLabel:{value:function(e){this.label&&this.root.clearProperty(this.label),this.label=e,this.root.setProperty(e,this)}},getLabel:{value:function(){return this.label}},clearLabel:{value:function(){this.root.clearProperty(this.label),this.label=null}},_getSerializationValue:{value:function(){return this.value}},toJSON:{value:function(e){var t=this._getSerializationValue();return 1===e?{value:t}:t}}}),r.prototype=Object.create(n.prototype,{constructor:{value:r},toJSON:{value:function(e){var t,n=this._getSerializationValue();return 1===e?{value:n}:this.label?(t=new s(this.root,this.label),t.toJSON()):n}}}),i.prototype=Object.create(r.prototype,{constructor:{value:i},setProperty:{value:function(e,t){null!=e&&(this.value[e]=t)}},getProperty:{value:function(e){return this.value[e]}},clearProperty:{value:function(e){delete this.value[e]}},getPropertyNames:{value:function(){return Object.keys(this.value)}}}),a.prototype=Object.create(r.prototype,{constructor:{value:a},_getSerializationValue:{value:function(){var e=this.value;return{"/":{source:e.source,flags:(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")}}}}}),o.prototype=Object.create(n.prototype,{constructor:{value:o},setProperty:{value:function(e,t){null!=e&&(this.value[e]=t)}},getProperty:{value:function(e){return this.value[e]}},clearProperty:{value:function(e){delete this.value[e]}},toJSON:{value:function(e){var t,n=this._getSerializationValue();return 1===e?n:(t=new s(this.root,this.label),t.toJSON())}}}),s.prototype=Object.create(n.prototype,{constructor:{value:s},_getSerializationValue:{value:function(){return{"@":this.value}}}}),e.Root=t,e.Value=n,e.ReferenceableValue=r,e.ObjectLiteral=i,e.RegExpObject=a,e.CustomObject=o,e.ObjectReference=s})(t)}}),montageDefine("3b7d56f","weak-map",{dependencies:[],factory:function(e,t,n){(function(){"use strict";function e(t){t.permitHostObjects___&&t.permitHostObjects___(e)}function t(e){return!(e.substr(0,c.length)==c&&"___"===e.substr(e.length-3))}function r(e){if(e!==Object(e))throw new TypeError("Not an object: "+e);var t=e[u];if(t&&t.key===e)return t;if(!l(e))return void 0;var n=[],r=[];return t={key:e,gets:n,vals:r},s(e,u,{value:t,writable:!1,enumerable:!1,configurable:!1}),t}function i(e){return e.prototype=null,Object.freeze(e)}if("undefined"==typeof ses||!ses.ok||ses.ok()){if("undefined"!=typeof ses&&(ses.weakMapPermitHostObjects=e),"function"==typeof WeakMap){var a=WeakMap;if("undefined"==typeof navigator||!/Firefox/.test(navigator.userAgent))return n.exports=WeakMap,void 0}Object.prototype.hasOwnProperty;var o=Object.getOwnPropertyNames,s=Object.defineProperty,l=Object.isExtensible,c="weakmap:",u=c+"ident:"+Math.random()+"___";if("undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues&&"function"==typeof ArrayBuffer&&"function"==typeof Uint8Array){var h=new ArrayBuffer(25),d=new Uint8Array(h);crypto.getRandomValues(d),u=c+"rand:"+Array.prototype.map.call(d,function(e){return(e%36).toString(36)}).join("")+"___"}if(s(Object,"getOwnPropertyNames",{value:function(e){return o(e).filter(t)}}),"getPropertyNames"in Object){var p=Object.getPropertyNames;s(Object,"getPropertyNames",{value:function(e){return p(e).filter(t)}})}(function(){var e=Object.freeze;s(Object,"freeze",{value:function(t){return r(t),e(t)}});var t=Object.seal;s(Object,"seal",{value:function(e){return r(e),t(e)}});var n=Object.preventExtensions;s(Object,"preventExtensions",{value:function(e){return r(e),n(e)}})})();var f=function(){function e(t,n){var i,a,l=r(t);return l?(i=l.gets.indexOf(e),a=l.vals):(i=o.indexOf(t),a=s),i>=0?a[i]:n}function t(t){var n,i=r(t);return n=i?i.gets.indexOf(e):o.indexOf(t),n>=0}function n(t,n){var i,a=r(t);a?(i=a.gets.indexOf(e),i>=0?a.vals[i]=n:(a.gets.push(e),a.vals.push(n))):(i=o.indexOf(t),i>=0?s[i]=n:(o.push(t),s.push(n)))}function a(t){var n,i=r(t);return i?(n=i.gets.indexOf(e),n>=0&&(i.gets.splice(n,1),i.vals.splice(n,1))):(n=o.indexOf(t),n>=0&&(o.splice(n,1),s.splice(n,1))),!0}var o=[],s=[];return Object.create(f.prototype,{get___:{value:i(e)},has___:{value:i(t)},set___:{value:i(n)},delete___:{value:i(a)}})};f.prototype=Object.create(Object.prototype,{get:{value:function(e,t){return this.get___(e,t)},writable:!0,configurable:!0},has:{value:function(e){return this.has___(e)},writable:!0,configurable:!0},set:{value:function(e,t){this.set___(e,t)},writable:!0,configurable:!0},"delete":{value:function(e){return this.delete___(e)},writable:!0,configurable:!0}}),"function"==typeof a?function(){function t(){function t(e,t){return l?s.has(e)?s.get(e):l.get___(e,t):s.get(e,t)}function n(e){return s.has(e)||(l?l.has___(e):!1)}function r(e,t){if(c)try{s.set(e,t)}catch(n){l||(l=new f),l.set___(e,t)}else s.set(e,t)}function o(e){s["delete"](e),l&&l.delete___(e)
}var s=new a,l=void 0,c=!1;return Object.create(f.prototype,{get___:{value:i(t)},has___:{value:i(n)},set___:{value:i(r)},delete___:{value:i(o)},permitHostObjects___:{value:i(function(t){if(t!==e)throw Error("bogus call to permitHostObjects___");c=!0})}})}t.prototype=f.prototype,n.exports=t,Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:!1,configurable:!0,writable:!0})}():("undefined"!=typeof Proxy&&(Proxy=void 0),n.exports=f)}})()}}),montageDefine("51f539f","parse",{dependencies:["collections/shim","./grammar"],factory:function(e,t,n){function r(e,t){if(Array.isArray(e))return{type:"tuple",args:e.map(function(e){return r(e,t)})};try{return i.parse(e,t||Object.empty)}catch(n){throw n.message=n.message.replace(/[\s\.]+$/,"")+" "+" on line "+n.line+" column "+n.column,n}}e("collections/shim");var i=e("./grammar");n.exports=r}}),montageDefine("51f539f","evaluate",{dependencies:["./parse","./compile-evaluator","./scope"],factory:function(e,t,n){function r(e,t,n,r,s){var l;l="string"==typeof e?i(e):e;var c=a(l),u=new o(t);return u.parameters=n,u.document=r,u.components=s,c(u)}var i=e("./parse"),a=e("./compile-evaluator"),o=e("./scope");n.exports=r}}),montageDefine("51f539f","assign",{dependencies:["./parse","./compile-assigner","./scope"],factory:function(e,t,n){function r(e,t,n,r,s,l){var c;c="string"==typeof t?i(t):t;var u=a(c),h=new o(e);return h.parameters=r,h.document=s,h.components=l,u(n,h)}var i=e("./parse"),a=e("./compile-assigner"),o=e("./scope");n.exports=r}}),montageDefine("51f539f","observe",{dependencies:["./parse","./compile-observer","./observers","./scope"],factory:function(e,t,n){function r(e,t,n){var r;r="function"==typeof n?{change:n}:n,r=r||c,r.source=e,r.sourcePath=t;var u=r.parameters=r.parameters||e,h=r.document,d=r.components,p=r.beforeChange,f=r.contentChange,m=new l(e);m.parameters=u,m.document=h,m.components=d,m.beforeChange=p;var g=i(t),v=a(g);return f===!0&&(v=o.makeRangeContentObserver(v)),v(s(function(t){if(t){if("function"!=typeof f)return r.change.apply(e,arguments);if("function"==typeof f)return t.addRangeChangeListener(f),o.once(function(){t.removeRangeChangeListener(f)})}}),m)}var i=e("./parse"),a=e("./compile-observer"),o=e("./observers"),s=o.autoCancelPrevious,l=e("./scope");n.exports=r;var c={}}}),montageDefine("51f539f","bind",{dependencies:["./parse","./algebra","./stringify","./compile-observer","./compile-binder","./observers","./scope"],factory:function(e,t,n){function r(e,t,n){n.target=e,n.targetPath=t;var r=n.source=n.source||e,s=n["<-"]||n["<->"]||"",l=n.twoWay="<->"in n;n.sourcePath=s,n.value;var c=n.parameters=n.parameters||r,u=n.document,h=n.components,p=n.trace,f=n.sourceScope=new d(r);f.parameters=c,f.document=u,f.components=h;var m=n.targetScope=new d(e);if(m.parameters=c,m.document=u,m.components=h,n.converter){var g=n.converter;g.convert&&(n.convert=g.convert.bind(g)),g.revert&&(n.revert=g.revert.bind(g))}else if(n.reverter){var v=n.reverter;v.convert&&(n.revert=v.convert.bind(v)),v.revert&&(n.convert=v.revert.bind(v))}var b=n.convert,y=n.revert,_=n.sourceSyntax=o(s),w=n.targetSyntax=o(t);p&&console.log("DEFINE BINDING",t,"<-",s,e);var C=i(m,w,f,_,b,n,p),x=a;return l&&(p&&console.log("DEFINE BINDING",t,"->",s,r),x=i(f,_,m,w,y,n,p)),function(){C(),x()}}function i(e,t,n,r,i,a,o){var d=s(t,r);t=d[0],r=d[1];var p=c(r);i&&(p=h.makeConverterObserver(p,i,n));var f=u(t);return f(p,n,e,a,o?{sourcePath:l(r),targetPath:l(t)}:null)}function a(){}var o=e("./parse"),s=e("./algebra"),l=e("./stringify"),c=e("./compile-observer"),u=e("./compile-binder"),h=e("./observers"),d=e("./scope");n.exports=r}}),montageDefine("51f539f","compile-observer",{dependencies:["./observers","./operators"],factory:function(e,t,n){function r(e){return o.compile(e)}var i=e("./observers"),a=e("./operators");n.exports=r;var o=r.semantics={compilers:{property:i.makePropertyObserver,get:i.makeGetObserver,path:i.makePathObserver,"with":i.makeWithObserver,"if":i.makeConditionalObserver,parent:i.makeParentObserver,not:i.makeNotObserver,and:i.makeAndObserver,or:i.makeOrObserver,"default":i.makeDefaultObserver,defined:i.makeDefinedObserver,rangeContent:i.makeAsArrayObserver,mapContent:Function.identity,keys:i.makeKeysObserver,values:i.makeValuesObserver,items:i.makeEntriesObserver,entries:i.makeEntriesObserver,toMap:i.makeToMapObserver,mapBlock:i.makeMapBlockObserver,filterBlock:i.makeFilterBlockObserver,everyBlock:i.makeEveryBlockObserver,someBlock:i.makeSomeBlockObserver,sortedBlock:i.makeSortedBlockObserver,sortedSetBlock:i.makeSortedSetBlockObserver,groupBlock:i.makeGroupBlockObserver,groupMapBlock:i.makeGroupMapBlockObserver,minBlock:i.makeMinBlockObserver,maxBlock:i.makeMaxBlockObserver,enumerate:i.makeEnumerationObserver,reversed:i.makeReversedObserver,flatten:i.makeFlattenObserver,concat:i.makeConcatObserver,view:i.makeViewObserver,sum:i.makeSumObserver,average:i.makeAverageObserver,last:i.makeLastObserver,only:i.makeOnlyObserver,has:i.makeHasObserver,tuple:i.makeArrayObserver,range:i.makeRangeObserver,startsWith:i.makeStartsWithObserver,endsWith:i.makeEndsWithObserver,contains:i.makeContainsObserver,join:i.makeJoinObserver,toArray:i.makeToArrayObserver,asArray:i.makeToArrayObserver},compile:function(e){var t=this.compilers;if("literal"===e.type)return i.makeLiteralObserver(e.value);if("value"===e.type)return i.observeValue;if("parameters"===e.type)return i.observeParameters;if("element"===e.type)return i.makeElementObserver(e.id);if("component"===e.type)return i.makeComponentObserver(e.label,e);if("record"===e.type){var n={},r=e.args;for(var a in r)n[a]=this.compile(r[a]);return i.makeObjectObserver(n)}t.hasOwnProperty(e.type)||(t[e.type]=i.makeMethodObserverMaker(e.type));var o=e.args.map(this.compile,this);return t[e.type].apply(null,o)}},s=o.compilers;Object.keys(a).forEach(function(e){s[e]||(s[e]=i.makeOperatorObserverMaker(a[e]))}),s.toString=i.makeOperatorObserverMaker(a.toString)}}),montageDefine("51f539f","scope",{dependencies:[],factory:function(e,t,n){function r(e){this.parent=null,this.value=e}n.exports=r,r.prototype.nest=function(e){var t=Object.create(this);return t.value=e,t.parent=this,t}}}),montageDefine("51f539f","observers",{dependencies:["collections/shim","collections/listen/property-changes","collections/listen/array-changes","collections/sorted-array","collections/sorted-set","collections/map","collections/set","collections/heap","./scope","./operators","./parse","./compile-observer","./merge"],factory:function(e,t){function n(e){return function(t){return t(e)||Function.noop}}function r(e,t){return e(t.value)||Function.noop}function i(e,t){return e(t.parameters)||Function.noop}function a(e){return function(t,n){return t(n.document.getElementById(e))||Function.noop}}function o(e,t){return function(n,r){var i=r.components,a=i.getObjectByLabel||i.getComponentByLabel,o=a.call(i,e);return t.component=o,n(o)||Function.noop}}function s(e,t,n,r){function i(e,t,r){a(),a=n(e,t,r)||Function.noop}if(null==e)return n();var a=Function.noop;return _t.addOwnPropertyChangeListener(e,t,i,r.beforeChange),i(e[t],t,e),yt(function(){a(),_t.removeOwnPropertyChangeListener(e,t,i,r.beforeChange)})}function l(e,t){return function(n,r){return t(bt(function(t){return"string"!=typeof t&&"number"!=typeof t?n():e(bt(function(e){return null==e?n():e.observeProperty?e.observeProperty(t,n,r):Et(e,t,n,r)}),r)}),r)}}function c(e,t,n,r){function i(e,r,i){o(t,r)&&(a(),a=n(e,t,i)||Function.noop)}var a=Function.noop,o=e.contentEquals||Object.equals;return i(e.get(t),t,e),e.addMapChangeListener(i,r.beforeChange),yt(function(){a(),e.removeMapChangeListener(i)})}function u(e,t){return function(n,r){return e(bt(function(e){return e?t(bt(function(t){return null==t?n():e.observeGet?e.observeGet(t,n,r):St(e,t,n,r)}),r):n()}),r)}}function h(e,t){return function(n,r){return n=gt(n),t(bt(function(t){return e(bt(function(e){return e?K(e,function(){return n((e.has||e.contains).call(e,t))},r):n()}),r)}),r)}}function d(e){return function(t,n){for(var r=Array(e.length),i=0;e.length>i;i++)r[i]=void 0;var a=e.map(function(e,t){return e(function(e){r.set(t,e)},n)}),o=t(r)||Function.noop;return yt(function(){o(),vt(a)})}}function p(e){return function(t,n){var r={},i={};for(var a in e)(function(e,t){r[e]=t(function(t){i[e]=t},n)})(a,e[a]);var o=t(i)||Function.noop;return function(){o();for(var e in r)r[e]()}}}function f(){return d(Array.prototype.slice.call(arguments))}function m(e){return function(){var t=d(Array.prototype.slice.call(arguments)),n=et(t);return function(t,r){return n(bt(function(n){return n.every(Mt.defined)?t(e.apply(void 0,n)):t()}),r)}}}function g(e){var t=e.slice(0,1).toUpperCase()+e.slice(1),n="make"+t+"Observer",r="observe"+t;return function(){var t=arguments[0],i=Array.prototype.slice.call(arguments,1),a=i.map(function(e){return function(t,n){return e(bt(t),n)}}),o=d(i),s=et(o);return function(i,o){return t(bt(function(t){return t?t[n]?t[n].apply(t,a)(i,o):t[r]?t[r](i,o):s(bt(function(n){return n.every(Mt.defined)?"function"==typeof t[e]?i(t[e].apply(t,n)):i():i()}),o):i()}),o)}}}function v(e){return function(t,n){return e(bt(function(e){return t(!e)}),n)}}function b(e,t){return function(n,r){return e(bt(function(e){return e?t(n,r):n(e)}),r)}}function y(e,t){return function(n,r){return e(bt(function(e){return e?n(e):t(n,r)}),r)}}function _(e,t,n){return function(r,i){return e(bt(function(e){return null==e?r():e?t(r,i):n(r,i)}),i)}}function w(e){return function(t,n){return e(bt(function(e){return t(null!=e)}),n)}}function C(e,t){return function(n,r){return e(bt(function(e){return null==e?t(n,r):n(e)}),r)}}function x(e,t){return function(n,r){return e(bt(function(e){function i(t){for(;e.length>t;t++)s[t].index=t}function a(e,n,a){s.swap(a,n.length,e.map(function(e,t){return{index:a+t}})),i(a+e.length);var c,u=[];vt(l.swap(a,n.length,e.map(function(e,n){var i=s[a+n];return t(bt(function(e){c?o.set(i.index,e):u[n]=e}),r.nest(e))}))),c=!0,o.swap(a,n.length,u)}if(!e)return n();var o=[],s=[],l=[],c=K(e,a,r),u=n(o,e)||Function.noop;return yt(function(){u(),vt(l),c()})}),r)}}function L(e,t){var n=x(e,t);return function(e,t){return n(bt(function(n,r){function i(e){for(;n.length>e;e++)l[e+1]=l[e]+!!n[e]}function a(e,t,n){var a=r.slice(n,n+e.length),s=t.map(Boolean).sum(),c=a.filter(function(t,n){return e[n]}),u=l[n],h=o.slice(u,u+s);(h.length!==c.length||h.some(function(e,t){return e!==c[t]}))&&o.swap(u,s,c),i(u)}if(!r)return e();var o=[],s=[],l=[0],c=K(n,a,t),u=e(o)||Function.noop;return yt(function(){u(),vt(s),c()})}),t)}}function M(e,t){var n=O(t),r=x(e,n),i=function(e,t){return r(bt(function(n){function r(e,t){a.addEach(e),a.deleteEach(t)}if(!n)return e();var i=[],a=wt(i,E,S),o=K(n,r,t),s=e(i)||Function.noop;return function(){s(),o()}}),t)};return Ot(i,ot)}function E(e,t){return Object.equals(e[1],t[1])}function S(e,t){return Object.compare(e[1],t[1])}function O(e){return function(t,n){return e(bt(function(e){return t([n.value,e])||Function.noop}),n)}}function k(e,t){var n=O(t),r=x(e,n),i=A(r,lt),a=x(i,Z(lt));return function(e,t){function n(e,t){return e=s.get(e),t=s.get(t),Object.compare(e,t)}function r(e,t){return e=s.get(e),t=s.get(t),Object.equals(e,t)}function i(e,t){t.forEach(function(e){l["delete"](e[0]),s["delete"](e[0])}),e.forEach(function(e){s.set(e[0],e[1]),l.add(e[0])})}function o(e){return l.clear(),K(e,i,t)}var s=new xt,l=new Ct(null,r,n),c=e(l)||Function.noop,u=a(o,t);return function(){c(),u()}}}function T(e){return function(t,n){return e(bt(function(e){function r(e,t,n){var r=i.length-n-t.length;i.swap(r,t.length,e.reversed())}if(!e)return t();var i=[],a=K(e,r,n),o=t(i);return yt(function(){o(),a()})}),n)}}function z(e){return function(t,n){return e(bt(function(e){function r(t){for(var n=t;e.length>n;n++)l[n].index=n,s[n+1]=e[n]?s[n]+e[n].length:s[n]}function i(e,t,i){var c=s[i],u=s[i+t.length],h=u-c;a.swap(c,h,[]),l.swap(i,t.length,e.map(function(){return{index:null}})),r(i),vt(o.swap(i,t.length,e.map(function(e,t){function o(e,t,n){r(c.index);var i=s[c.index]+n,o=s[c.index]+n+t.length,l=o-i;a.swap(i,l,e)}var c=l[i+t];return K(e,o,n)})))}if(!e)return t();var a=[],o=[],s=[0],l=[],c=K(e,i,n),u=t(a)||Function.noop;return yt(function(){u(),vt(o),c()})}),n)}}function j(){return Tt(d(Array.prototype.slice.call(arguments)))}function P(e,t){var n=kt(e,t),r=l(n,zt);return ht(r,Boolean)}function D(e,t){var n=ht(t,Mt.not),r=kt(e,n),i=l(r,zt);return ht(i,Mt.not)}function A(e,t){var n=B(e,t);return Dt(n)}function B(e,t){var n=O(t),r=x(e,n);return function(e,t){return r(bt(function(n,r){function i(e,t){t.forEach(function(e){var t=a.get(e[1]);1===t.length?a["delete"](e[1]):t["delete"](e[0])}),e.forEach(function(e){var t,n=!a.has(e[1]);t=n?r.constructClone():a.get(e[1]),t.add(e[0]),n&&a.set(e[1],t)})}if(!n)return e();var a=xt(),o=K(n,i,t),s=e(a)||Function.noop;return function(){o(),s()}}),t)}}function R(e,t,n){function r(e,t){return Object.compare(e[1],t[1])*n}var i=O(t),a=x(e,i);return function(e,t){return a(bt(function(n){function i(e,t){o.addEach(e),o.deleteEach(t)}function a(t,n){return 0===n?t?e(t[0]):e():void 0}if(!n)return e();var o=new Lt(null,E,r),s=K(n,i,t),l=nt(o,a,t);return function(){s(),l()}}),t)}}function I(e,t){return R(e,t,1)}function F(e,t){return R(e,t,-1)}function N(e){return function(t){return function(n,r){return n=gt(n),t(bt(function(t){if(!t)return n();var i=e(t,n);return K(t,function(e,t,r){return n(i(e,t,r))},r)}),r)}}}function q(e){return"number"==typeof e&&!isNaN(e)}function W(e,t,n){return function(r,i){return e(bt(function(e){return e?n(bt(function(n){return null==n?r():t(bt(function(t){function a(r,i,a){var s=r.length-i.length;t>a&&0>s&&n>s?(o.swap(o.length,0,e.slice(t+n+s,t+n)),o.splice(0,-s)):t>a&&s>0&&n>s?(o.swap(0,0,e.slice(t,t+s)),o.splice(o.length-s,s)):a>=t&&0>s&&t+n>a?(o.swap(o.length,0,e.slice(t+n+s,t+n)),o.splice(a-t,-s)):a>=t&&s>0&&t+n>a?(o.swap(a-t,0,e.slice(a,a+s)),o.splice(o.length-s,s)):t+n>a&&o.swap(0,o.length,e.slice(t,t+n))}if(null==t)return r();var o=[],s=K(e,a,i),l=r(o)||Function.noop;return yt(function(){l(),s()})}),i)}),i):r()}),i)}}function V(e){return function(t,n){return e(bt(function(e){function r(e){for(;a.length>e;e++)a[e].set(0,e)}function i(e,t,n){a.swap(n,t.length,e.map(function(e,t){return[n+t,e]})),r(n+e.length)}if(!e)return t();var a=[],o=K(e,i,n),s=t(a)||Function.noop;return function(){s(),o()}}),n)}}function U(e){return function(t,n){var r=[],i=t(r)||Function.noop,a=e(function(e){if(e>>>=0,null==e)r.clear();else if(e>r.length){for(var t=[],n=r.length;e>n;n++)t.push(n);r.swap(r.length,0,t)}else r.length>e&&r.splice(e,r.length)},n);return function(){i(),a()}}}function H(e,t){return function(n,r){return t(function(t){var i=RegExp("^"+RegExp.escape(t));return e(function(e){return n(i.test(e))||Function.noop},r)},r)}}function Y(e,t){return function(n,r){return t(function(t){var i=RegExp(RegExp.escape(t)+"$");return e(function(e){return n(i.test(e))||Function.noop},r)},r)}}function G(e,t){return function(n,r){return t(function(t){var i=RegExp(RegExp.escape(t));return e(function(e){return n(i.test(e))||Function.noop},r)},r)}}function X(e,t){return t=t||jt,function(n,r){return e(bt(function(e){return e?t(bt(function(t){function i(){a=n(e.join(t))||Function.noop}if("string"!=typeof t)return n()||Function.noop;var a=Function.noop,o=K(e,i,r);return function(){o(),a()}}),r):n()||Function.noop}),r)}}function K(e,t,n){function r(e,n,r){i(),i=t(e,n,r)||Function.noop}if(e){var i=Function.noop;if(e.toArray&&e.addRangeChangeListener){r(e.toArray(),[],0);var a=e.addRangeChangeListener(r,n.beforeChange);return yt(function(){i(),a()})}}}function Z(e){return function(t,n){return e(bt(function(e){return Pt(e,t,n)}),n)}}function J(e,t,n){function r(n,r,s){if(i+=n.length-r.length,!(i>s+r.length&&i>s+n.length)){var l=0>i?null:e.get(i);a(),a=t(l)||Function.noop,o=l}}var i=-1,a=Function.noop,o=null,s=K(e,r,n);return function(){a(),s()}}function $(e){return function(t,n){return e(bt(gt(function(e){return Q(e,t,n)})),n)}}function Q(e,t,n){function r(n,r){return i+=n.length-r.length,1===i?t(e.only()):t()}var i=0;return K(e,r,n)}function et(e){return function(t,n){return e(bt(function(e){return e&&e.addRangeChangeListener?K(e,function(){return t(e)},n):t(e)}),n)}}function tt(e){return function(t,n){return e(bt(function(e){return e&&e.addMapChangeListener?nt(e,function(){return t(e)},n):t(e)}),n)}}function nt(e,t,n){function r(e,n,r){var a=i.get(n)||Function.noop;i["delete"](n),a(),a=t(e,n,r)||Function.noop,void 0===e?a():i.set(n,a)}if(e.addMapChangeListener){var i=new xt;e.forEach(r);var a=e.addMapChangeListener(r,n.beforeChange);return yt(function(){i.forEach(function(e){e()}),a()})}}function rt(e){return function(t,n){return e(bt(function(e){return e?it(e,t,n):t()}),n)}}function it(e,t,n){function r(e,t){var n,r;a.has(t)?null==e?(n=a.get(t),a["delete"](t),r=i.indexOf(n),i.splice(r,1)):(n=a.get(t),n.set(1,e)):(n=[t,e],a.set(t,n),i.push(n))}var i=[],a=xt(),o=t(i)||Function.noop,s=nt(e,r,n)||Function.noop;return yt(function(){o(),s()})}function at(e){var t=Dt(e);return Ot(t,ot)}function ot(e,t){return t.value?e(t.value[0])||Function.noop:e()}function st(e){var t=Dt(e);return Ot(t,lt)}function lt(e,t){return t.value?e(t.value[1])||Function.noop:e()}function ct(e){return function(t,n){var r=new xt,i=t(r)||Function.noop,a=e(bt(function(e){function t(e,t){void 0===e?r["delete"](t):r.set(t,e)}if(r.clear(),e&&"object"==typeof e){if(e.addRangeChangeListener)return At(bt(function(e){function t(e,t){t.forEach(function(e){r["delete"](e[0])}),e.forEach(function(e){r.set(e[0],e[1])})}return K(e,t,n)}),n.nest(e));if(e.addMapChangeListener)return nt(e,t,n);var i=Object.keys(e).map(function(t){return Et(e,t,bt(function(e){void 0===e?r["delete"](t):r.set(t,e)}),n)});return function(){vt(i)}}}),n);return function(){i(),a()}}}function ut(e){return function(t,n){return e(t,n.parent||n.nest())}}function ht(e,t,n){return function(r,i){return r=gt(r),e(bt(function(e){return r(t.call(n,e))}),i)}}function dt(e,t,n){return function(r,i){return r=gt(r),e(bt(function(e){return e&&e.every(Mt.defined)?r(t.apply(n,e)):void 0}),i)}}function pt(t,n){var r=e("./parse"),i=e("./compile-observer");return function(e,a){return e=gt(e),n(bt(function(n){if(null==n)return e();var o,s;try{o=r(n),s=i(o)}catch(l){return e()}return t(bt(function(t){return s(e,a.nest(t))}),a)}),a)}}function ft(e,t){return function(n,r){return e(bt(function(e){return t(bt(function(e){return n(e)}),r.nest(e))}),r)}}function mt(e){return function(){var t=e.apply(this,arguments);return function(e,n){var r=[],i=t(bt(function(e){function t(e,t,n){r.swap(n,t.length,e)}if(e){Bt(r,e);var i=e.addRangeChangeListener(t,n.beforeChange);return yt(i)}r.clear()}),n),a=e(r)||Function.noop;return yt(function(){i(),a()})}}}function gt(e){var t;return function(n){if(n!==t){var r=e.apply(this,arguments);return t=n,r}}}function vt(e){e.forEach(function(e){e&&e()})}function bt(e){var t=Function.noop;return function(){return t(),t=e.apply(this,arguments)||Function.noop,function(){t()}}}function yt(e){var t;return function(){return t?Function.noop:(t=!0,e.apply(this,arguments))}}e("collections/shim");var _t=e("collections/listen/property-changes");e("collections/listen/array-changes");var wt=e("collections/sorted-array"),Ct=e("collections/sorted-set"),xt=e("collections/map");e("collections/set");var Lt=e("collections/heap");e("./scope");var Mt=e("./operators");t.makeLiteralObserver=n,t.observeValue=r,t.observeParameters=i,t.makeElementObserver=a,t.makeComponentObserver=o,t.observeProperty=s;var Et=s;t.makePropertyObserver=l,t.observeKey=c,t.observeGet=c;var St=c;t.makeGetObserver=u,t.makeHasObserver=h,t.makeObserversObserver=d,t.makeRecordObserver=p,t.makeObjectObserver=p,t.makeTupleObserver=f,t.makeArrayObserver=f,t.makeOperatorObserverMaker=m,t.makeMethodObserverMaker=g,t.makeNotObserver=v,t.makeAndObserver=b,t.makeOrObserver=y,t.makeConditionalObserver=_,t.makeDefinedObserver=w,t.makeDefaultObserver=C;var Ot=t.makeMapBlockObserver=mt(x),kt=t.makeFilterBlockObserver=mt(L);t.makeSortedBlockObserver=M,t.makeSortedSetBlockObserver=k,t.makeReversedObserver=mt(T);var Tt=t.makeFlattenObserver=mt(z);t.makeConcatObserver=j,t.makeSomeBlockObserver=P,t.makeEveryBlockObserver=D,t.makeGroupBlockObserver=A,t.makeGroupMapBlockObserver=B,t.makeMaxBlockObserver=I,t.makeMinBlockObserver=F;var zt=n("length");t.makeSumObserver=N(function(){var e=0;return function(t,n){return t=t.filter(q),n=n.filter(q),e+=t.sum()-n.sum()}}),t.makeAverageObserver=N(function(){var e=0,t=0;return function(n,r){return n=n.filter(q),r=r.filter(q),e+=n.sum()-r.sum(),t+=n.length-r.length,e/t}}),t.makeViewObserver=mt(W),t.makeEnumerateObserver=mt(V),t.makeEnumerationObserver=t.makeEnumerateObserver,t.makeRangeObserver=U,t.makeStartsWithObserver=H,t.makeEndsWithObserver=Y,t.makeContainsObserver=G,t.makeJoinObserver=X;var jt=n("");t.observeRangeChange=K,t.makeLastObserver=Z,t.observeLast=J;var Pt=J;t.makeOnlyObserver=$,t.observeOnly=Q,t.makeRangeContentObserver=et,t.makeMapContentObserver=tt,t.observeMapChange=nt;var Dt=t.makeEntriesObserver=mt(rt);t.observeEntries=it,t.makeKeysObserver=at,t.observeEntryKey=ot,t.makeValuesObserver=st,t.observeEntryValue=lt,t.makeToMapObserver=ct;var At=Ot(A(r,ot),Z(lt));t.makeParentObserver=ut,t.makeConverterObserver=ht,t.makeComputerObserver=dt,t.makePathObserver=pt,t.makeExpressionObserver=pt,t.makeWithObserver=ft,t.makeToArrayObserver=mt(Function.identity),t.makeAsArrayObserver=t.makeToArrayObserver;var Bt=e("./merge").merge;t.makeUniq=gt,t.cancelEach=vt,t.autoCancelPrevious=bt,t.once=yt}}),montageDefine("51f539f","stringify",{dependencies:["./parse","./language"],factory:function(e,t,n){"use strict";function r(e,t){return r.semantics.stringify(e,t)}function i(e){return function(t,n,r){var i=e+"{"+r(t.args[1],n)+"}";return"value"===t.args[0].type?i:r(t.args[0],n)+"."+i}}e("./parse");var a=e("./language").precedence,o=e("./language").operatorTypes;e("./language").operatorTokens,n.exports=r,r.semantics={makeBlockStringifier:i,stringify:function(e,t,n){function r(e){var n=o(e,t);return n?n:"this"}var i,o=this.stringify.bind(this),s=this.stringifiers;if(s[e.type])i=s[e.type](e,t,o);else if(e.inline)i="&"+e.type+"("+e.args.map(r).join(", ")+")";else{var l;1===e.args.length&&"mapBlock"===e.args[0].type?(l=e.type+"{"+o(e.args[0].args[1],t)+"}",e=e.args[0]):l=e.type+"("+e.args.slice(1).map(r).join(", ")+")",i="value"===e.args[0].type?l:o(e.args[0],t)+"."+l}return!n||n.type===e.type&&"if"!==n.type||a.get(n.type).has(e.type)?i:"("+i+")"},stringifiers:{value:function(){return""},literal:function(e){return"string"==typeof e.value?"'"+e.value.replace("'","\\'")+"'":""+e.value},parameters:function(){return"$"},record:function(e,t,n){return"{"+Object.map(e.args,function(e,r){var i;return i="value"===e.type?"this":n(e,t),r+": "+i}).join(", ")+"}"},tuple:function(e,t,n){return"["+Object.map(e.args,function(e){return"value"===e.type?"this":n(e)}).join(", ")+"]"},component:function(e,t){var n;return t&&t.components&&e.component?t.components.getObjectLabel?n=t.components.getObjectLabel(e.component):t.components.getLabelForObject&&(n=t.components.getLabelForObject(e.component)):n=e.label,"@"+n},element:function(e){return"#"+e.id},mapBlock:i("map"),filterBlock:i("filter"),someBlock:i("some"),everyBlock:i("every"),sortedBlock:i("sorted"),sortedSetBlock:i("sortedSet"),groupBlock:i("group"),groupMapBlock:i("groupMap"),minBlock:i("min"),maxBlock:i("max"),property:function(e,t,n){return"value"===e.args[0].type?"string"==typeof e.args[1].value?e.args[1].value:"literal"===e.args[1].type?"."+e.args[1].value:"this["+n(e.args[1],t)+"]":"parameters"===e.args[0].type?"$"+e.args[1].value:"literal"===e.args[1].type&&/^[\w\d_]+$/.test(e.args[1].value)?n(e.args[0],t,{type:"scope"})+"."+e.args[1].value:n(e.args[0],{type:"scope"},t)+"["+n(e.args[1],t)+"]"},"with":function(e,t,n){var r=n(e.args[1],t,e);return n(e.args[0],t)+"."+r},not:function(e,t,n){return"equals"===e.args[0].type?n(e.args[0].args[0],t,{type:"equals"})+" != "+n(e.args[0].args[1],t,{type:"equals"}):"!"+n(e.args[0],t,e)},neg:function(e,t,n){return"-"+n(e.args[0],t,e)},toNumber:function(e,t,n){return"+"+n(e.args[0],t,e)},parent:function(e,t,n){return"^"+n(e.args[0],t,e)},"if":function(e,t,n){return n(e.args[0],t,e)+" ? "+n(e.args[1],t)+" : "+n(e.args[2],t)},event:function(e,t,n){return e.when+" "+e.event+" -> "+n(e.listener,t)},binding:function(e,t,n,r){var i=r(t.args[0],n)+" "+e+" "+r(t.args[1],n),a="",o=t.descriptor;if(o)for(var s in o)a+=", "+s+": "+r(o[s],n);return i+a},bind:function(e,t,n){return this.binding("<-",e,t,n)},bind2:function(e,t,n){return this.binding("<->",e,t,n)},assign:function(e,t,n){return n(e.args[0],t)+": "+n(e.args[1],t)},block:function(e,t,n){var r="@"+e.label;return e.connection&&("prototype"===e.connection?r+=" < ":"object"===e.connection&&(r+=" : "),r+=n({type:"literal",value:e.module}),e.exports&&"value"!==e.exports.type&&(r+=" "+n(e.exports,t))),r+" {\n"+e.statements.map(function(e){return"    "+n(e,t)+";\n"}).join("")+"}\n"},sheet:function(e,t,n){return"\n"+e.blocks.map(function(e){return n(e,t)}).join("\n")+"\n"}}},o.forEach(function(e,t){r.semantics.stringifiers[t]=function(t,n,r){return t.args.map(function(e){return r(e,n,t)}).join(" "+e+" ").trim()}})}}),montageDefine("51f539f","expand",{dependencies:["collections/set","collections/map","./operators"],factory:function(e,t,n){function r(e,t){var n=r.semantics.expand.bind(r.semantics);return n(e,t,n)}var i=e("collections/set"),a=e("collections/map");e("./operators"),n.exports=r,r.semantics={reflexive:i(["literal","element","rangeContent","mapContent"]),traverseLeft:i(["with","mapBlock","filterBlock","someBlock","everyBlock","sortedBlock","groupBlock","groupMapBlock"]),expanders:a({value:function(e,t){return t.value||{type:"value"}},parameters:function(e,t){return t.parameters||{type:"parameters"}},record:function(e,t,n){var r={type:"record",args:[]};for(var i in e.args)r.args[i]=n(e.args[i],t,n);return r},component:function(e,t){return t.components&&e.component?{type:"component",label:t.components.getObjectLabel(e.component)}:e}}),expand:function(e,t,n){return this.expanders.has(e.type)?this.expanders.get(e.type)(e,t,n):this.traverseLeft.has(e.type)?{type:e.type,args:[n(e.args[0],t,n)].concat(e.args.slice(1))}:this.reflexive.has(e.type)?e:{type:e.type,args:e.args.map(function(e){return n(e,t,n)})}}}}}),montageDefine("51f539f","bindings",{dependencies:["collections/map","./bind","./compute","./observe"],factory:function(e,t){function n(e,t,n){if(t)for(var i in t)r(e,i,t[i],n);return e}function r(e,n,r,a){a=a||Object.empty;var o=i(e);if(d.call(o,n))throw Error("Can't bind to already bound target, "+JSON.stringify(n));return"<-"in r||"<->"in r||"compute"in r?(r.target=e,r.parameters=r.parameters||a.parameters,r.document=r.document||a.document,r.components=r.components||a.components,r.cancel="compute"in r?u(e,n,r):c(e,n,r),o[n]=r,t.count++):("get"in r||"set"in r||"writable"in r||(r.writable=!0),"configurable"in r||(r.configurable=!0),"enumerable"in r||(r.enumerable=!0),Object.defineProperty(e,n,r)),e}function i(e){return h.has(e)||h.set(e,{}),h.get(e)}function a(e,t){var n=i(e);return n[t]}function o(e){var t=i(e);for(var n in t)s(e,n)}function s(e,n){var r=i(e);if(!r[n])throw Error("Can't cancel non-existent binding to "+JSON.stringify(n));var a=r[n];if(a&&a.cancel){a.cancel(),delete r[n],t.count--;for(var n in r)return;h["delete"](e)}}var l=e("collections/map"),c=e("./bind"),u=e("./compute");e("./observe");var h=new l,d=Object.prototype.hasOwnProperty;t.count=0,t.bindings=h,t.defineBindings=n,t.defineBinding=r,t.getBindings=i,t.getBinding=a,t.cancelBindings=o,t.cancelBinding=s}}),montageDefine("51f539f","grammar",{dependencies:[],factory:function(e,t,n){n.exports=function(){function e(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function t(e,t,n,r,i){function a(e,t){function n(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var r,i;switch(e.length){case 0:r="end of input";break;case 1:r=e[0];break;default:r=e.slice(0,-1).join(", ")+" or "+e[e.length-1]}return i=t?'"'+n(t)+'"':"end of input","Expected "+r+" but "+i+" found."}this.expected=e,this.found=t,this.offset=n,this.line=r,this.column=i,this.name="SyntaxError",this.message=a(e,t)}function n(e){function n(t){function n(t,n,r){var i,a;for(i=n;r>i;i++)a=e.charAt(i),"\n"===a?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===a||"\u2028"===a||"\u2029"===a?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return Vi!==t&&(Vi>t&&(Vi=0,Ui={line:1,column:1,seenCR:!1}),n(Ui,Vi,t),Vi=t),Ui}function r(e){Hi>qi||(qi>Hi&&(Hi=qi,Yi=[]),Yi.push(e))}function i(e){var t=0;for(e.sort();e.length>t;)e[t-1]===e[t]?e.splice(t,1):t++}function a(){var e,t;return Gi++,e=l(),Gi--,null===e&&(t=null,0===Gi&&r($)),e}function o(){var t,n,i,o,s,l,c;if(t=qi,n=a(),null!==n){for(i=[],o=qi,44===e.charCodeAt(qi)?(s=et,qi++):(s=null,0===Gi&&r(tt)),null!==s?(l=N(),null!==l?(c=a(),null!==c?(s=[s,l,c],o=s):(qi=o,o=Q)):(qi=o,o=Q)):(qi=o,o=Q);null!==o;)i.push(o),o=qi,44===e.charCodeAt(qi)?(s=et,qi++):(s=null,0===Gi&&r(tt)),null!==s?(l=N(),null!==l?(c=a(),null!==c?(s=[s,l,c],o=s):(qi=o,o=Q)):(qi=o,o=Q)):(qi=o,o=Q);null!==i?(Wi=t,n=nt(n,i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)}else qi=t,t=Q;return t}function s(){var t,n,i,a;return t=qi,40===e.charCodeAt(qi)?(n=rt,qi++):(n=null,0===Gi&&r(it)),null!==n?(i=N(),null!==i?(41===e.charCodeAt(qi)?(a=at,qi++):(a=null,0===Gi&&r(ot)),null!==a?(Wi=t,n=st(),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q),null===t&&(t=qi,40===e.charCodeAt(qi)?(n=rt,qi++):(n=null,0===Gi&&r(it)),null!==n?(i=o(),null!==i?(41===e.charCodeAt(qi)?(a=at,qi++):(a=null,0===Gi&&r(ot)),null!==a?(Wi=t,n=lt(i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)),t}function l(){var t,n,i,o,s,l,u,h,d,p,f;return t=qi,n=c(),null!==n?(i=N(),null!==i?(o=qi,63===e.charCodeAt(qi)?(s=ut,qi++):(s=null,0===Gi&&r(ht)),null!==s?(l=N(),null!==l?(u=a(),null!==u?(h=N(),null!==h?(58===e.charCodeAt(qi)?(d=dt,qi++):(d=null,0===Gi&&r(pt)),null!==d?(p=N(),null!==p?(f=a(),null!==f?(s=[s,l,u,h,d,p,f],o=s):(qi=o,o=Q)):(qi=o,o=Q)):(qi=o,o=Q)):(qi=o,o=Q)):(qi=o,o=Q)):(qi=o,o=Q)):(qi=o,o=Q),null===o&&(o=ct),null!==o?(Wi=t,n=ft(n,o),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q),t}function c(){var t,n,i,a,o,s,l,c;if(t=qi,n=u(),null!==n){for(i=[],a=qi,o=N(),null!==o?(e.substr(qi,2)===mt?(s=mt,qi+=2):(s=null,0===Gi&&r(gt)),null!==s?(l=N(),null!==l?(c=u(),null!==c?(o=[o,s,l,c],a=o):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q);null!==a;)i.push(a),a=qi,o=N(),null!==o?(e.substr(qi,2)===mt?(s=mt,qi+=2):(s=null,0===Gi&&r(gt)),null!==s?(l=N(),null!==l?(c=u(),null!==c?(o=[o,s,l,c],a=o):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q);null!==i?(Wi=t,n=vt(n,i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)}else qi=t,t=Q;return t}function u(){var t,n,i,a,o,s,l,c;if(t=qi,n=h(),null!==n){for(i=[],a=qi,o=N(),null!==o?(e.substr(qi,2)===bt?(s=bt,qi+=2):(s=null,0===Gi&&r(yt)),null!==s?(l=N(),null!==l?(c=h(),null!==c?(o=[o,s,l,c],a=o):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q);null!==a;)i.push(a),a=qi,o=N(),null!==o?(e.substr(qi,2)===bt?(s=bt,qi+=2):(s=null,0===Gi&&r(yt)),null!==s?(l=N(),null!==l?(c=h(),null!==c?(o=[o,s,l,c],a=o):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q);null!==i?(Wi=t,n=vt(n,i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)}else qi=t,t=Q;return t}function h(){var t,n,i,a,o,s,l,c,u;return t=qi,n=d(),null!==n?(i=qi,a=N(),null!==a?(o=qi,e.substr(qi,3)===_t?(s=_t,qi+=3):(s=null,0===Gi&&r(wt)),null===s&&(e.substr(qi,2)===Ct?(s=Ct,qi+=2):(s=null,0===Gi&&r(xt)),null===s&&(e.substr(qi,2)===Lt?(s=Lt,qi+=2):(s=null,0===Gi&&r(Mt)),null===s&&(s=qi,60===e.charCodeAt(qi)?(l=Et,qi++):(l=null,0===Gi&&r(St)),null!==l?(c=qi,Gi++,45===e.charCodeAt(qi)?(u=Ot,qi++):(u=null,0===Gi&&r(kt)),Gi--,null===u?c=ct:(qi=c,c=Q),null!==c?(l=[l,c],s=l):(qi=s,s=Q)):(qi=s,s=Q),null===s&&(62===e.charCodeAt(qi)?(s=Tt,qi++):(s=null,0===Gi&&r(zt)),null===s&&(e.substr(qi,2)===jt?(s=jt,qi+=2):(s=null,0===Gi&&r(Pt)),null===s&&(e.substr(qi,2)===Dt?(s=Dt,qi+=2):(s=null,0===Gi&&r(At)))))))),null!==s&&(s=e.substring(o,qi)),o=s,null!==o?(s=N(),null!==s?(l=d(),null!==l?(a=[a,o,s,l],i=a):(qi=i,i=Q)):(qi=i,i=Q)):(qi=i,i=Q)):(qi=i,i=Q),null===i&&(i=ct),null!==i?(Wi=t,n=Bt(n,i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q),t
}function d(){var t,n,i,a,o,s,l,c;if(t=qi,n=p(),null!==n){for(i=[],a=qi,o=N(),null!==o?(s=qi,43===e.charCodeAt(qi)?(l=Rt,qi++):(l=null,0===Gi&&r(It)),null===l&&(45===e.charCodeAt(qi)?(l=Ot,qi++):(l=null,0===Gi&&r(kt))),null!==l&&(l=e.substring(s,qi)),s=l,null!==s?(l=N(),null!==l?(c=p(),null!==c?(o=[o,s,l,c],a=o):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q);null!==a;)i.push(a),a=qi,o=N(),null!==o?(s=qi,43===e.charCodeAt(qi)?(l=Rt,qi++):(l=null,0===Gi&&r(It)),null===l&&(45===e.charCodeAt(qi)?(l=Ot,qi++):(l=null,0===Gi&&r(kt))),null!==l&&(l=e.substring(s,qi)),s=l,null!==s?(l=N(),null!==l?(c=p(),null!==c?(o=[o,s,l,c],a=o):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q);null!==i?(Wi=t,n=vt(n,i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)}else qi=t,t=Q;return t}function p(){var t,n,i,a,o,s,l,c;if(t=qi,n=f(),null!==n){for(i=[],a=qi,o=N(),null!==o?(s=qi,42===e.charCodeAt(qi)?(l=Ft,qi++):(l=null,0===Gi&&r(Nt)),null===l&&(47===e.charCodeAt(qi)?(l=qt,qi++):(l=null,0===Gi&&r(Wt)),null===l&&(37===e.charCodeAt(qi)?(l=Vt,qi++):(l=null,0===Gi&&r(Ut)),null===l&&(e.substr(qi,3)===Ht?(l=Ht,qi+=3):(l=null,0===Gi&&r(Yt))))),null!==l&&(l=e.substring(s,qi)),s=l,null!==s?(l=N(),null!==l?(c=f(),null!==c?(o=[o,s,l,c],a=o):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q);null!==a;)i.push(a),a=qi,o=N(),null!==o?(s=qi,42===e.charCodeAt(qi)?(l=Ft,qi++):(l=null,0===Gi&&r(Nt)),null===l&&(47===e.charCodeAt(qi)?(l=qt,qi++):(l=null,0===Gi&&r(Wt)),null===l&&(37===e.charCodeAt(qi)?(l=Vt,qi++):(l=null,0===Gi&&r(Ut)),null===l&&(e.substr(qi,3)===Ht?(l=Ht,qi+=3):(l=null,0===Gi&&r(Yt))))),null!==l&&(l=e.substring(s,qi)),s=l,null!==s?(l=N(),null!==l?(c=f(),null!==c?(o=[o,s,l,c],a=o):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q);null!==i?(Wi=t,n=vt(n,i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)}else qi=t,t=Q;return t}function f(){var t,n,i,a,o,s,l,c;if(t=qi,n=m(),null!==n){for(i=[],a=qi,o=N(),null!==o?(s=qi,e.substr(qi,2)===Gt?(l=Gt,qi+=2):(l=null,0===Gi&&r(Xt)),null===l&&(e.substr(qi,2)===Kt?(l=Kt,qi+=2):(l=null,0===Gi&&r(Zt)),null===l&&(e.substr(qi,2)===Jt?(l=Jt,qi+=2):(l=null,0===Gi&&r($t)))),null!==l&&(l=e.substring(s,qi)),s=l,null!==s?(l=N(),null!==l?(c=m(),null!==c?(o=[o,s,l,c],a=o):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q);null!==a;)i.push(a),a=qi,o=N(),null!==o?(s=qi,e.substr(qi,2)===Gt?(l=Gt,qi+=2):(l=null,0===Gi&&r(Xt)),null===l&&(e.substr(qi,2)===Kt?(l=Kt,qi+=2):(l=null,0===Gi&&r(Zt)),null===l&&(e.substr(qi,2)===Jt?(l=Jt,qi+=2):(l=null,0===Gi&&r($t)))),null!==l&&(l=e.substring(s,qi)),s=l,null!==s?(l=N(),null!==l?(c=m(),null!==c?(o=[o,s,l,c],a=o):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q);null!==i?(Wi=t,n=vt(n,i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)}else qi=t,t=Q;return t}function m(){var t,n,i,a,o,s,l,c;if(t=qi,n=g(),null!==n){for(i=[],a=qi,o=N(),null!==o?(e.substr(qi,2)===Qt?(s=Qt,qi+=2):(s=null,0===Gi&&r(en)),null!==s?(l=N(),null!==l?(c=g(),null!==c?(o=[o,s,l,c],a=o):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q);null!==a;)i.push(a),a=qi,o=N(),null!==o?(e.substr(qi,2)===Qt?(s=Qt,qi+=2):(s=null,0===Gi&&r(en)),null!==s?(l=N(),null!==l?(c=g(),null!==c?(o=[o,s,l,c],a=o):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q);null!==i?(Wi=t,n=vt(n,i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)}else qi=t,t=Q;return t}function g(){var t,n,i;return t=qi,n=qi,33===e.charCodeAt(qi)?(i=tn,qi++):(i=null,0===Gi&&r(nn)),null===i&&(43===e.charCodeAt(qi)?(i=Rt,qi++):(i=null,0===Gi&&r(It)),null===i&&(45===e.charCodeAt(qi)?(i=Ot,qi++):(i=null,0===Gi&&r(kt)))),null!==i&&(i=e.substring(n,qi)),n=i,null!==n?(i=g(),null!==i?(Wi=t,n=rn(n,i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q),null===t&&(t=v()),t}function v(){var e,t,n,r;if(e=qi,t=_(),null!==t){for(n=[],r=b();null!==r;)n.push(r),r=b();null!==n?(Wi=e,t=an(t,n),null===t?(qi=e,e=t):e=t):(qi=e,e=Q)}else qi=e,e=Q;return e}function b(){var t,n,i,o;return t=qi,46===e.charCodeAt(qi)?(n=on,qi++):(n=null,0===Gi&&r(sn)),null!==n?(i=y(),null!==i?(Wi=t,n=ln(i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q),null===t&&(t=qi,91===e.charCodeAt(qi)?(n=cn,qi++):(n=null,0===Gi&&r(un)),null!==n?(i=a(),null!==i?(93===e.charCodeAt(qi)?(o=hn,qi++):(o=null,0===Gi&&r(dn)),null!==o?(Wi=t,n=pn(i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)),t}function y(){var t,n,i,o,l;return t=qi,n=w(),null!==n?(123===e.charCodeAt(qi)?(i=fn,qi++):(i=null,0===Gi&&r(mn)),null!==i?(o=a(),null!==o?(125===e.charCodeAt(qi)?(l=gn,qi++):(l=null,0===Gi&&r(vn)),null!==l?(Wi=t,n=bn(n,o),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q),null===t&&(t=qi,n=w(),null!==n?(i=s(),null!==i?(Wi=t,n=yn(n,i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q),null===t&&(t=qi,n=B(),null!==n&&(Wi=t,n=_n(n)),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,n=w(),null!==n&&(Wi=t,n=wn(n)),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,n=S(),null!==n&&(Wi=t,n=Cn(n)),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,n=O(),null!==n&&(Wi=t,n=Cn(n)),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,40===e.charCodeAt(qi)?(n=rt,qi++):(n=null,0===Gi&&r(it)),null!==n?(i=a(),null!==i?(41===e.charCodeAt(qi)?(o=at,qi++):(o=null,0===Gi&&r(ot)),null!==o?(Wi=t,n=Cn(i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q))))))),t}function _(){var t,n,i,o;return t=S(),null===t&&(t=O(),null===t&&(t=C(),null===t&&(t=z(),null===t&&(t=qi,e.substr(qi,4)===xn?(n=xn,qi+=4):(n=null,0===Gi&&r(Ln)),null!==n&&(Wi=t,n=Mn()),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,e.substr(qi,4)===En?(n=En,qi+=4):(n=null,0===Gi&&r(Sn)),null!==n&&(Wi=t,n=On()),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,e.substr(qi,5)===kn?(n=kn,qi+=5):(n=null,0===Gi&&r(Tn)),null!==n&&(Wi=t,n=zn()),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,e.substr(qi,4)===jn?(n=jn,qi+=4):(n=null,0===Gi&&r(Pn)),null!==n&&(Wi=t,n=Dn()),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,64===e.charCodeAt(qi)?(n=An,qi++):(n=null,0===Gi&&r(Bn)),null!==n?(i=w(),null!==i?(Wi=t,n=Rn(i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q),null===t&&(t=qi,36===e.charCodeAt(qi)?(n=In,qi++):(n=null,0===Gi&&r(Fn)),null!==n?(i=w(),null!==i?(Wi=t,n=Nn(i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q),null===t&&(t=qi,36===e.charCodeAt(qi)?(n=In,qi++):(n=null,0===Gi&&r(Fn)),null!==n&&(Wi=t,n=qn()),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,35===e.charCodeAt(qi)?(n=Wn,qi++):(n=null,0===Gi&&r(Vn)),null!==n?(i=w(),null!==i?(Wi=t,n=Un(i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q),null===t&&(t=qi,38===e.charCodeAt(qi)?(n=Hn,qi++):(n=null,0===Gi&&r(Yn)),null!==n?(i=w(),null!==i?(o=s(),null!==o?(Wi=t,n=Gn(i,o),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q),null===t&&(t=qi,94===e.charCodeAt(qi)?(n=Xn,qi++):(n=null,0===Gi&&r(Kn)),null!==n?(i=_(),null!==i?(Wi=t,n=Zn(i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q),null===t&&(t=qi,40===e.charCodeAt(qi)?(n=rt,qi++):(n=null,0===Gi&&r(it)),null!==n?(i=a(),null!==i?(41===e.charCodeAt(qi)?(o=at,qi++):(o=null,0===Gi&&r(ot)),null!==o?(Wi=t,n=Jn(i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q),null===t&&(t=qi,n=y(),null!==n&&(Wi=t,n=$n(n)),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,n=[],null!==n&&(Wi=t,n=Qn()),null===n?(qi=t,t=n):t=n)))))))))))))))),t}function w(){var t,n,i;if(Gi++,t=qi,n=[],tr.test(e.charAt(qi))?(i=e.charAt(qi),qi++):(i=null,0===Gi&&r(nr)),null!==i)for(;null!==i;)n.push(i),tr.test(e.charAt(qi))?(i=e.charAt(qi),qi++):(i=null,0===Gi&&r(nr));else n=Q;return null!==n&&(Wi=t,n=rr(n)),null===n?(qi=t,t=n):t=n,Gi--,null===t&&(n=null,0===Gi&&r(er)),t}function C(){var t,n,i,a;if(Gi++,t=qi,39===e.charCodeAt(qi)?(n=ar,qi++):(n=null,0===Gi&&r(or)),null!==n){for(i=[],a=x();null!==a;)i.push(a),a=x();null!==i?(39===e.charCodeAt(qi)?(a=ar,qi++):(a=null,0===Gi&&r(or)),null!==a?(Wi=t,n=sr(i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)}else qi=t,t=Q;if(null===t)if(t=qi,34===e.charCodeAt(qi)?(n=lr,qi++):(n=null,0===Gi&&r(cr)),null!==n){for(i=[],a=L();null!==a;)i.push(a),a=L();null!==i?(34===e.charCodeAt(qi)?(a=lr,qi++):(a=null,0===Gi&&r(cr)),null!==a?(Wi=t,n=sr(i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)}else qi=t,t=Q;return Gi--,null===t&&(n=null,0===Gi&&r(ir)),t}function x(){var t,n;return ur.test(e.charAt(qi))?(t=e.charAt(qi),qi++):(t=null,0===Gi&&r(hr)),null===t&&(t=qi,e.substr(qi,2)===dr?(n=dr,qi+=2):(n=null,0===Gi&&r(pr)),null!==n&&(Wi=t,n=fr()),null===n?(qi=t,t=n):t=n,null===t&&(t=M())),t}function L(){var t,n;return mr.test(e.charAt(qi))?(t=e.charAt(qi),qi++):(t=null,0===Gi&&r(gr)),null===t&&(t=qi,e.substr(qi,2)===vr?(n=vr,qi+=2):(n=null,0===Gi&&r(br)),null!==n&&(Wi=t,n=yr()),null===n?(qi=t,t=n):t=n,null===t&&(t=M())),t}function M(){var t,n,i,a,o,s,l,c;return t=qi,e.substr(qi,2)===_r?(n=_r,qi+=2):(n=null,0===Gi&&r(wr)),null!==n&&(Wi=t,n=Cr()),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,e.substr(qi,2)===xr?(n=xr,qi+=2):(n=null,0===Gi&&r(Lr)),null!==n&&(Wi=t,n=Mr()),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,e.substr(qi,2)===Er?(n=Er,qi+=2):(n=null,0===Gi&&r(Sr)),null!==n&&(Wi=t,n=Or()),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,e.substr(qi,2)===kr?(n=kr,qi+=2):(n=null,0===Gi&&r(Tr)),null!==n&&(Wi=t,n=zr()),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,e.substr(qi,2)===jr?(n=jr,qi+=2):(n=null,0===Gi&&r(Pr)),null!==n&&(Wi=t,n=Dr()),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,e.substr(qi,2)===Ar?(n=Ar,qi+=2):(n=null,0===Gi&&r(Br)),null!==n&&(Wi=t,n=Rr()),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,e.substr(qi,2)===Ir?(n=Ir,qi+=2):(n=null,0===Gi&&r(Fr)),null!==n&&(Wi=t,n=Nr()),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,e.substr(qi,2)===qr?(n=qr,qi+=2):(n=null,0===Gi&&r(Wr)),null!==n&&(Wi=t,n=Vr()),null===n?(qi=t,t=n):t=n,null===t&&(t=qi,e.substr(qi,2)===Ur?(n=Ur,qi+=2):(n=null,0===Gi&&r(Hr)),null!==n?(i=qi,a=qi,o=E(),null!==o?(s=E(),null!==s?(l=E(),null!==l?(c=E(),null!==c?(o=[o,s,l,c],a=o):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q),null!==a&&(a=e.substring(i,qi)),i=a,null!==i?(Wi=t,n=Yr(i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q))))))))),t}function E(){var t;return Gr.test(e.charAt(qi))?(t=e.charAt(qi),qi++):(t=null,0===Gi&&r(Xr)),t}function S(){var t,n,i,a;return t=qi,91===e.charCodeAt(qi)?(n=cn,qi++):(n=null,0===Gi&&r(un)),null!==n?(i=N(),null!==i?(93===e.charCodeAt(qi)?(a=hn,qi++):(a=null,0===Gi&&r(dn)),null!==a?(Wi=t,n=Kr(),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q),null===t&&(t=qi,91===e.charCodeAt(qi)?(n=cn,qi++):(n=null,0===Gi&&r(un)),null!==n?(i=o(),null!==i?(93===e.charCodeAt(qi)?(a=hn,qi++):(a=null,0===Gi&&r(dn)),null!==a?(Wi=t,n=Zr(i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)),t}function O(){var t,n,i,a,o,s;return t=qi,123===e.charCodeAt(qi)?(n=fn,qi++):(n=null,0===Gi&&r(mn)),null!==n?(i=N(),null!==i?(125===e.charCodeAt(qi)?(a=gn,qi++):(a=null,0===Gi&&r(vn)),null!==a?(o=N(),null!==o?(Wi=t,n=Jr(),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q),null===t&&(t=qi,123===e.charCodeAt(qi)?(n=fn,qi++):(n=null,0===Gi&&r(mn)),null!==n?(i=N(),null!==i?(a=k(),null!==a?(125===e.charCodeAt(qi)?(o=gn,qi++):(o=null,0===Gi&&r(vn)),null!==o?(s=N(),null!==s?(Wi=t,n=$r(a),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)),t}function k(){var t,n,i,a,o,s,l;if(t=qi,n=T(),null!==n){for(i=[],a=qi,44===e.charCodeAt(qi)?(o=et,qi++):(o=null,0===Gi&&r(tt)),null!==o?(s=N(),null!==s?(l=T(),null!==l?(o=[o,s,l],a=o):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q);null!==a;)i.push(a),a=qi,44===e.charCodeAt(qi)?(o=et,qi++):(o=null,0===Gi&&r(tt)),null!==o?(s=N(),null!==s?(l=T(),null!==l?(o=[o,s,l],a=o):(qi=a,a=Q)):(qi=a,a=Q)):(qi=a,a=Q);null!==i?(Wi=t,n=Qr(n,i),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)}else qi=t,t=Q;return t}function T(){var t,n,i,o,s;return t=qi,n=w(),null!==n?(58===e.charCodeAt(qi)?(i=dt,qi++):(i=null,0===Gi&&r(pt)),null!==i?(o=N(),null!==o?(s=a(),null!==s?(Wi=t,n=ei(n,s),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q),t}function z(){var t,n,i;return Gi++,t=qi,n=qi,i=j(),null!==i&&(i=e.substring(n,qi)),n=i,null!==n&&(Wi=t,n=ni(n)),null===n?(qi=t,t=n):t=n,Gi--,null===t&&(n=null,0===Gi&&r(ti)),t}function j(){var e,t,n,r;return e=qi,t=P(),null!==t?(n=D(),null!==n?(r=A(),null!==r?(t=[t,n,r],e=t):(qi=e,e=Q)):(qi=e,e=Q)):(qi=e,e=Q),null===e&&(e=qi,t=P(),null!==t?(n=D(),null!==n?(t=[t,n],e=t):(qi=e,e=Q)):(qi=e,e=Q),null===e&&(e=qi,t=P(),null!==t?(n=A(),null!==n?(t=[t,n],e=t):(qi=e,e=Q)):(qi=e,e=Q),null===e&&(e=P()))),e}function P(){var t,n,i,a;return t=qi,n=F(),null!==n?(i=B(),null!==i?(n=[n,i],t=n):(qi=t,t=Q)):(qi=t,t=Q),null===t&&(t=I(),null===t&&(t=qi,45===e.charCodeAt(qi)?(n=Ot,qi++):(n=null,0===Gi&&r(kt)),null!==n?(i=F(),null!==i?(a=B(),null!==a?(n=[n,i,a],t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q),null===t&&(t=qi,45===e.charCodeAt(qi)?(n=Ot,qi++):(n=null,0===Gi&&r(kt)),null!==n?(i=I(),null!==i?(n=[n,i],t=n):(qi=t,t=Q)):(qi=t,t=Q)))),t}function D(){var t,n,i;return t=qi,46===e.charCodeAt(qi)?(n=on,qi++):(n=null,0===Gi&&r(sn)),null!==n?(i=B(),null!==i?(n=[n,i],t=n):(qi=t,t=Q)):(qi=t,t=Q),t}function A(){var e,t,n;return e=qi,t=R(),null!==t?(n=B(),null!==n?(t=[t,n],e=t):(qi=e,e=Q)):(qi=e,e=Q),e}function B(){var e,t;if(e=[],t=I(),null!==t)for(;null!==t;)e.push(t),t=I();else e=Q;return e}function R(){var t,n,i;return t=qi,ri.test(e.charAt(qi))?(n=e.charAt(qi),qi++):(n=null,0===Gi&&r(ii)),null!==n?(ai.test(e.charAt(qi))?(i=e.charAt(qi),qi++):(i=null,0===Gi&&r(oi)),null===i&&(i=ct),null!==i?(n=[n,i],t=n):(qi=t,t=Q)):(qi=t,t=Q),t}function I(){var t;return si.test(e.charAt(qi))?(t=e.charAt(qi),qi++):(t=null,0===Gi&&r(li)),t}function F(){var t;return ci.test(e.charAt(qi))?(t=e.charAt(qi),qi++):(t=null,0===Gi&&r(ui)),t}function N(){var e,t;for(e=[],t=q(),null===t&&(t=W());null!==t;)e.push(t),t=q(),null===t&&(t=W());return e}function q(){var t,n;return Gi++,di.test(e.charAt(qi))?(t=e.charAt(qi),qi++):(t=null,0===Gi&&r(pi)),null===t&&(fi.test(e.charAt(qi))?(t=e.charAt(qi),qi++):(t=null,0===Gi&&r(mi))),Gi--,null===t&&(n=null,0===Gi&&r(hi)),t}function W(){var t,n;return Gi++,vi.test(e.charAt(qi))?(t=e.charAt(qi),qi++):(t=null,0===Gi&&r(bi)),Gi--,null===t&&(n=null,0===Gi&&r(gi)),t}function V(){var e,t,n,r;if(e=qi,t=N(),null!==t){for(n=[],r=U();null!==r;)n.push(r),r=U();null!==n?(r=N(),null!==r?(Wi=e,t=yi(n),null===t?(qi=e,e=t):e=t):(qi=e,e=Q)):(qi=e,e=Q)}else qi=e,e=Q;return e}function U(){var t,n,i,a,o,s,l,c,u,h;return t=qi,64===e.charCodeAt(qi)?(n=An,qi++):(n=null,0===Gi&&r(Bn)),null!==n?(i=w(),null!==i?(a=N(),null!==a?(o=H(),null===o&&(o=ct),null!==o?(123===e.charCodeAt(qi)?(s=fn,qi++):(s=null,0===Gi&&r(mn)),null!==s?(l=N(),null!==l?(c=Y(),null!==c?(125===e.charCodeAt(qi)?(u=gn,qi++):(u=null,0===Gi&&r(vn)),null!==u?(h=N(),null!==h?(Wi=t,n=_i(i,o,c),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q),t}function H(){var t,n,i,o,s,l,c,u;return t=qi,60===e.charCodeAt(qi)?(n=Et,qi++):(n=null,0===Gi&&r(St)),null===n&&(58===e.charCodeAt(qi)?(n=dt,qi++):(n=null,0===Gi&&r(pt))),null!==n?(i=N(),null!==i?(o=C(),null===o&&(o=ct),null!==o?(s=N(),null!==s?(l=qi,c=qi,Gi++,123===e.charCodeAt(qi)?(u=fn,qi++):(u=null,0===Gi&&r(mn)),Gi--,null===u?c=ct:(qi=c,c=Q),null!==c?(u=a(),null!==u?(c=[c,u],l=c):(qi=l,l=Q)):(qi=l,l=Q),null===l&&(l=ct),null!==l?(c=N(),null!==c?(Wi=t,n=wi(n,o,l),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q),null===t&&(t=qi,n=N(),null!==n&&(Wi=t,n=Ci()),null===n?(qi=t,t=n):t=n),t}function Y(){var t,n,i,a,o,s,l,c,u;if(t=qi,n=G(),null!==n)if(i=N(),null!==i){for(a=[],o=qi,59===e.charCodeAt(qi)?(s=xi,qi++):(s=null,0===Gi&&r(Li)),null!==s?(l=N(),null!==l?(c=G(),null!==c?(u=N(),null!==u?(s=[s,l,c,u],o=s):(qi=o,o=Q)):(qi=o,o=Q)):(qi=o,o=Q)):(qi=o,o=Q);null!==o;)a.push(o),o=qi,59===e.charCodeAt(qi)?(s=xi,qi++):(s=null,0===Gi&&r(Li)),null!==s?(l=N(),null!==l?(c=G(),null!==c?(u=N(),null!==u?(s=[s,l,c,u],o=s):(qi=o,o=Q)):(qi=o,o=Q)):(qi=o,o=Q)):(qi=o,o=Q);null!==a?(59===e.charCodeAt(qi)?(o=xi,qi++):(o=null,0===Gi&&r(Li)),null===o&&(o=ct),null!==o?(s=N(),null!==s?(Wi=t,n=nt(n,a),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)}else qi=t,t=Q;else qi=t,t=Q;return null===t&&(t=qi,n=G(),null!==n?(i=N(),null!==i?(59===e.charCodeAt(qi)?(a=xi,qi++):(a=null,0===Gi&&r(Li)),null===a&&(a=ct),null!==a?(o=N(),null!==o?(Wi=t,n=Mi(n),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q),null===t&&(t=qi,n=N(),null!==n&&(Wi=t,n=st()),null===n?(qi=t,t=n):t=n)),t}function G(){var t,n,i,o,s,l,c,u,h,d,p,f,m,g,v,b,y;if(t=qi,e.substr(qi,2)===Ei?(n=Ei,qi+=2):(n=null,0===Gi&&r(Si)),null===n&&(e.substr(qi,6)===Oi?(n=Oi,qi+=6):(n=null,0===Gi&&r(ki))),null!==n?(32===e.charCodeAt(qi)?(i=Ti,qi++):(i=null,0===Gi&&r(zi)),null!==i?(o=N(),null!==o?(s=w(),null!==s?(l=N(),null!==l?(e.substr(qi,2)===ji?(c=ji,qi+=2):(c=null,0===Gi&&r(Pi)),null!==c?(u=N(),null!==u?(h=a(),null!==h?(d=N(),null!==d?(Wi=t,n=Di(n,s,h),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q),null===t){if(t=qi,n=a(),null!==n)if(i=N(),null!==i)if(58===e.charCodeAt(qi)?(o=dt,qi++):(o=null,0===Gi&&r(pt)),null===o&&(e.substr(qi,3)===Ai?(o=Ai,qi+=3):(o=null,0===Gi&&r(Bi)),null===o&&(e.substr(qi,2)===Ri?(o=Ri,qi+=2):(o=null,0===Gi&&r(Ii)))),null!==o)if(s=N(),null!==s)if(l=a(),null!==l)if(c=N(),null!==c){for(u=[],h=qi,44===e.charCodeAt(qi)?(d=et,qi++):(d=null,0===Gi&&r(tt)),null!==d?(p=N(),null!==p?(f=w(),null!==f?(m=N(),null!==m?(58===e.charCodeAt(qi)?(g=dt,qi++):(g=null,0===Gi&&r(pt)),null!==g?(v=N(),null!==v?(b=a(),null!==b?(y=N(),null!==y?(d=[d,p,f,m,g,v,b,y],h=d):(qi=h,h=Q)):(qi=h,h=Q)):(qi=h,h=Q)):(qi=h,h=Q)):(qi=h,h=Q)):(qi=h,h=Q)):(qi=h,h=Q)):(qi=h,h=Q);null!==h;)u.push(h),h=qi,44===e.charCodeAt(qi)?(d=et,qi++):(d=null,0===Gi&&r(tt)),null!==d?(p=N(),null!==p?(f=w(),null!==f?(m=N(),null!==m?(58===e.charCodeAt(qi)?(g=dt,qi++):(g=null,0===Gi&&r(pt)),null!==g?(v=N(),null!==v?(b=a(),null!==b?(y=N(),null!==y?(d=[d,p,f,m,g,v,b,y],h=d):(qi=h,h=Q)):(qi=h,h=Q)):(qi=h,h=Q)):(qi=h,h=Q)):(qi=h,h=Q)):(qi=h,h=Q)):(qi=h,h=Q)):(qi=h,h=Q);null!==u?(Wi=t,n=Fi(n,o,l,u),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)}else qi=t,t=Q;else qi=t,t=Q;else qi=t,t=Q;else qi=t,t=Q;else qi=t,t=Q;else qi=t,t=Q;null===t&&(t=qi,n=w(),null!==n?(i=N(),null!==i?(o=a(),null!==o?(s=N(),null!==s?(Wi=t,n=Ni(n,o),null===n?(qi=t,t=n):t=n):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q)):(qi=t,t=Q))}return t}var X,K=arguments.length>1?arguments[1]:{},Z={expression:a,sheet:V},J=a,$="expression",Q=null,et=",",tt='","',nt=function(e,t){for(var n=[e],r=0;t.length>r;r++)n.push(t[r][2]);return n},rt="(",it='"("',at=")",ot='")"',st=function(){return[]},lt=function(e){return e},ct="",ut="?",ht='"?"',dt=":",pt='":"',ft=function(e,t){if(t){var n=t[2],r=t[6];return{type:"if",args:[e,n,r]}}return e},mt="||",gt='"||"',vt=function(e,t){for(var n=0;t.length>n;n++)e={type:Xi[t[n][1]],args:[e,t[n][3]]};return e},bt="&&",yt='"&&"',_t="<=>",wt='"<=>"',Ct="<=",xt='"<="',Lt=">=",Mt='">="',Et="<",St='"<"',Ot="-",kt='"-"',Tt=">",zt='">"',jt="==",Pt='"=="',Dt="!=",At='"!="',Bt=function(e,t){if(t){var n=t[1],r=t[3];return"!="===n?{type:"not",args:[{type:"equals",args:[e,r]}]}:{type:Xi[n],args:[e,r]}}return e},Rt="+",It='"+"',Ft="*",Nt='"*"',qt="/",Wt='"/"',Vt="%",Ut='"%"',Ht="rem",Yt='"rem"',Gt="**",Xt='"**"',Kt="//",Zt='"//"',Jt="%%",$t='"%%"',Qt="??",en='"??"',tn="!",nn='"!"',rn=function(e,t){return{type:Ki[e],args:[t]}},an=function(e,t){for(var n=0;t.length>n;n++)e=t[n](e);return e},on=".",sn='"."',ln=function(e){return e},cn="[",un='"["',hn="]",dn='"]"',pn=function(e){return function(t){return{type:"property",args:[t,e]}}},fn="{",mn='"{"',gn="}",vn='"}"',bn=function(e,t){return Zi[e]?function(n){return{type:Zi[e],args:[n,t]}}:"value"===t.type?function(t){return{type:e,args:[t]}}:function(n){return{type:e,args:[{type:"mapBlock",args:[n,t]}]}}},yn=function(e,t){return function(n){return{type:e,args:[n].concat(t)}}},_n=function(e){return function(t){return{type:"property",args:[t,{type:"literal",value:+e.join("")}]}}},wn=function(e){return function(t){return{type:"property",args:[t,{type:"literal",value:e}]}}},Cn=function(e){return function(t){return{type:"with",args:[t,e]}}},xn="this",Ln='"this"',Mn=function(){return{type:"value"}},En="true",Sn='"true"',On=function(){return{type:"literal",value:!0}},kn="false",Tn='"false"',zn=function(){return{type:"literal",value:!1}},jn="null",Pn='"null"',Dn=function(){return{type:"literal",value:null}},An="@",Bn='"@"',Rn=function(e){return{type:"component",label:e}},In="$",Fn='"$"',Nn=function(e){return{type:"property",args:[{type:"parameters"},{type:"literal",value:e}]}},qn=function(){return{type:"parameters"}},Wn="#",Vn='"#"',Un=function(e){return{type:"element",id:e}},Hn="&",Yn='"&"',Gn=function(e,t){return{type:e,args:t,inline:!0}},Xn="^",Kn='"^"',Zn=function(e){return{type:"parent",args:[e]}},Jn=function(e){return e},$n=function(e){return e({type:"value"})},Qn=function(){return{type:"value"}},er="word",tr=/^[a-zA-Z_0-9\-]/,nr="[a-zA-Z_0-9\\-]",rr=function(e){return e.join("")},ir="string",ar="'",or='"\'"',sr=function(e){return{type:"literal",value:e.join("")}},lr='"',cr='"\\""',ur=/^[^'\\\0-\x1F]/,hr="[^'\\\\\\0-\\x1F]",dr="\\'",pr='"\\\\\'"',fr=function(){return"'"},mr=/^[^"\\\0-\x1F]/,gr='[^"\\\\\\0-\\x1F]',vr='\\"',br='"\\\\\\""',yr=function(){return'"'},_r="\\\\",wr='"\\\\\\\\"',Cr=function(){return"\\"},xr="\\/",Lr='"\\\\/"',Mr=function(){return"/"},Er="\\b",Sr='"\\\\b"',Or=function(){return"\b"},kr="\\f",Tr='"\\\\f"',zr=function(){return"\f"},jr="\\n",Pr='"\\\\n"',Dr=function(){return"\n"},Ar="\\r",Br='"\\\\r"',Rr=function(){return"\r"},Ir="\\t",Fr='"\\\\t"',Nr=function(){return"	"},qr="\\0",Wr='"\\\\0"',Vr=function(){return"\0"},Ur="\\u",Hr='"\\\\u"',Yr=function(e){return String.fromCharCode(parseInt(e,16))},Gr=/^[0-9a-fA-F]/,Xr="[0-9a-fA-F]",Kr=function(){return{type:"tuple",args:[]}},Zr=function(e){return{type:"tuple",args:e}},Jr=function(){return{type:"record",args:[]}},$r=function(e){return{type:"record",args:e}},Qr=function(e,t){var n={};n[e[0]]=e[1];for(var r=0;t.length>r;r++)n[t[r][2][0]]=t[r][2][1];return n},ei=function(e,t){return[e,t]},ti="number",ni=function(e){return{type:"literal",value:+e}},ri=/^[eE]/,ii="[eE]",ai=/^[+\-]/,oi="[+\\-]",si=/^[0-9]/,li="[0-9]",ci=/^[1-9]/,ui="[1-9]",hi="whitespace",di=/^[\t\x0B\f \xA0\uFEFF]/,pi="[\\t\\x0B\\f \\xA0\\uFEFF]",fi=/^[ \xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000]/,mi="[ \\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000]",gi="line terminator",vi=/^[\n\r\u2028\u2029]/,bi="[\\n\\r\\u2028\\u2029]",yi=function(e){return{type:"sheet",blocks:e}},_i=function(e,t,n){return{type:"block",connection:t.connection,module:t.module,exports:t.exports,label:e,statements:n}},wi=function(e,t,n){return{connection:{"<":"prototype",":":"object"}[e],module:t&&t.value,exports:""!==n?n[1]:void 0}},Ci=function(){return{}},xi=";",Li='";"',Mi=function(e){return[e]},Ei="on",Si='"on"',Oi="before",ki='"before"',Ti=" ",zi='" "',ji="->",Pi='"->"',Di=function(e,t,n){return{type:"event",when:e,event:t,listener:n}},Ai="<->",Bi='"<->"',Ri="<-",Ii='"<-"',Fi=function(e,t,n,r){var i={type:Ji[t],args:[e,n]};if(r.length){for(var a={},o=0;r.length>o;o++)a[r[o][2]]=r[o][6];i.descriptor=a}return i},Ni=function(e,t){return{type:"unit",name:e,value:t}},qi=0,Wi=0,Vi=0,Ui={line:1,column:1,seenCR:!1},Hi=0,Yi=[],Gi=0;if("startRule"in K){if(!(K.startRule in Z))throw Error("Can't start parsing from rule \""+K.startRule+'".');J=Z[K.startRule]}var Xi={"**":"pow","//":"root","%%":"log","*":"mul","/":"div","%":"mod",rem:"rem","+":"add","-":"sub","<":"lt",">":"gt","<=":"le",">=":"ge","==":"equals","<=>":"compare","??":"default","&&":"and","||":"or","<-":"bind","<->":"bind2",":":"assign"},Ki={"+":"toNumber","-":"neg","!":"not","^":"parent"},Zi={map:"mapBlock",filter:"filterBlock",some:"someBlock",every:"everyBlock",sorted:"sortedBlock",sortedSet:"sortedSetBlock",group:"groupBlock",groupMap:"groupMapBlock",min:"minBlock",max:"maxBlock"},Ji={":":"assign","<-":"bind","<->":"bind2"};if(X=J(),null!==X&&qi===e.length)return X;throw i(Yi),Wi=Math.max(qi,Hi),new t(Yi,e.length>Wi?e.charAt(Wi):null,Wi,n(Wi).line,n(Wi).column)}return e(t,Error),{SyntaxError:t,parse:n}}()}}),montageDefine("51f539f","compile-evaluator",{dependencies:["collections/shim-object","collections/map","collections/sorted-set","./operators","./scope","./parse"],factory:function(e,t,n){function r(e){return r.semantics.compile(e)}var i=e("collections/shim-object"),a=e("collections/map"),o=e("collections/sorted-set"),s=e("./operators");e("./scope"),n.exports=r;var l={literal:function(e){return function(){return e.value}},value:function(){return function(e){return e.value}},parameters:function(){return function(e){return e.parameters}},element:function(e){return function(t){return t.document.getElementById(e.id)}},component:function(e){return function(t){return t.components.getObjectByLabel(e.label)}},tuple:function(e){var t=e.args.map(this.compile,this);return function(e){return t.map(function(t){return t(e)})}},record:function(e){var t=e.args,n={};for(var r in t)n[r]=this.compile(t[r]);return function(e){var t={};for(var r in n)t[r]=n[r](e);return t}}},c={mapBlock:function(e,t){return function(n){return e(n).map(function(e){return t(n.nest(e))})}},filterBlock:function(e,t){return function(n){return e(n).filter(function(e){return t(n.nest(e))})}},someBlock:function(e,t){return function(n){return e(n).some(function(e){return t(n.nest(e))})}},everyBlock:function(e,t){return function(n){return e(n).every(function(e){return t(n.nest(e))})}},sortedBlock:function(e,t){return function(n){return e(n).sorted(Function.by(function(e){return t(n.nest(e))}))}},sortedSetBlock:function(e,t){return function(n){function r(e){return t(n.nest(e))}function a(e,t){return i.compare(r(e),r(t))}function s(e,t){return i.equals(r(e),r(t))}return new o(e(n),s,a)}},groupBlock:function(e,t){return function(n){return e(n).group(function(e){return t(n.nest(e))})}},groupMapBlock:function(e,t){return function(n){return new a(e(n).group(function(e){return t(n.nest(e))}))}},minBlock:function(e,t){return function(n){return e(n).min(Function.by(function(e){return t(n.nest(e))}))}},maxBlock:function(e,t){return function(n){return e(n).max(Function.by(function(e){return t(n.nest(e))}))}},parent:function(e){return function(t){return e(t.parent)}},"with":function(e,t){return function(n){return t(n.nest(e(n)))}},"if":function(e,t,n){return function(r){return e(r)?t(r):n(r)}},not:function(e){return function(t){return!e(t)}},and:function(e,t){return function(n){return e(n)&&t(n)}},or:function(e,t){return function(n){return e(n)||t(n)}},"default":function(e,t){return function(n){var r=e(n);return null==r&&(r=t(n)),r}},defined:function(e){return function(t){var n=e(t);return null!=n}},path:function(t,n){return function(i){var a=t(i),o=n(i),s=e("./parse");try{var l=s(o),c=r(l);return c(i.nest(a))}catch(u){}}}},u=i.clone(s,1);i.addEach(u,{property:function(e,t){return e[t]},get:function(e,t){return e.get(t)},mapContent:Function.identity,rangeContent:Function.identity,view:function(e,t,n){return e.slice(t,t+n)}}),r.semantics={compilers:l,argCompilers:c,operators:u,compile:function(e){var t=this.compilers,n=this.argCompilers,r=this.operators;if(t.hasOwnProperty(e.type))return t[e.type].call(this,e);if(n.hasOwnProperty(e.type)){var i=e.args.map(this.compile,this);return n[e.type].apply(null,i)}r.hasOwnProperty(e.type)||(r[e.type]=function(t){var n=Array.prototype.slice.call(arguments,1);if(!t[e.type])throw new TypeError("Can't call "+JSON.stringify(e.type)+" of "+t);return t[e.type].apply(t,n)});var a=r[e.type],i=e.args.map(this.compile,this);return function(e){var t=i.map(function(t){return t(e)});return t.every(s.defined)?a.apply(null,t):void 0}}}}}),montageDefine("51f539f","compile-assigner",{dependencies:["./compile-evaluator","./algebra","./scope"],factory:function(e,t,n){function r(e){return r.semantics.compile(e)}var i=e("./compile-evaluator"),a=e("./algebra");e("./scope");var o={type:"value"},s={type:"literal",value:!0},l={type:"literal",value:!1};n.exports=r,r.semantics={compile:function(e){var t=this.compilers;if("equals"===e.type){var n=this.compile(e.args[0]),r=this.compileEvaluator(e.args[1]);return t.equals(n,r)}if("if"===e.type){var i=this.compileEvaluator(e.args[0]),s=this.compile(e.args[1]),l=this.compile(e.args[2]);return t["if"](i,s,l)}if("and"===e.type||"or"===e.type){var c=a(e.args[0],o),u=a(e.args[1],o),h=this.compileEvaluator(e.args[0]),r=this.compileEvaluator(e.args[1]),d=this.compileEvaluator(c[1]),p=this.compileEvaluator(u[1]),n=this.compile(c[0]),f=this.compile(u[0]);return t[e.type](n,f,h,r,d,p)}if("everyBlock"===e.type){var m=this.compileEvaluator(e.args[0]),g=a(e.args[1],{type:"literal",value:!0}),v=this.compile(g[0]),b=this.compileEvaluator(g[1]);return t.everyBlock(m,v,b)}if("parent"===e.type){var y=this.compile(e.args[0]);return function(e,t){return y(e,t.parent)}}if(t.hasOwnProperty(e.type)){var _=e.args.map(this.compileEvaluator,this.compileEvaluator.semantics);return t[e.type].apply(null,_)}throw Error("Can't compile assigner for "+JSON.stringify(e.type))},compileEvaluator:i,compilers:{property:function(e,t){return function(n,r){var i=e(r);if(i){var a=t(r);null!=a&&(Array.isArray(i)?i.set(a,n):i[a]=n)}}},get:function(e,t){return function(n,r){var i=e(r);if(i){var a=t(r);null!=a&&i.set(a,n)}}},has:function(e,t){return function(n,r){var i=e(r);if(i){var a=t(r);null!=n&&(n?(i.has||i.contains).call(i,a)||i.add(a):(i.has||i.contains).call(i,a)&&(i.remove||i["delete"]).call(i,a))}}},equals:function(e,t){return function(n,r){return n?e(t(r),r):void 0}},"if":function(e,t,n){return function(r,i){var a=e(i);return null!=a?a?t(r,i):n(r,i):void 0}},and:function(e,t,n,r,i,a){return function(o,l){null!=o&&(o?(e(i(s),l),t(a(s),l)):e(n(l)&&!r(l),l))}},or:function(e,t,n,r,i,a){return function(o,s){null!=o&&(o?e(n(s)||!r(s),s):(e(i(l),s),t(a(l),s)))}},rangeContent:function(e){return function(t,n){var r=e(n);r&&(t?r.swap(0,r.length,t):r.clear())}},mapContent:function(e){return function(t,n){var r=e(n);r&&(r.clear(),n.value&&r.addEach(t))}},reversed:function(e){return function(t,n){var r=e(n);r&&r.swap(0,r.length,t.reversed())}},everyBlock:function(e,t,n){return function(r,i){if(r){var a=e(i),o=n(i);a.forEach(function(e){t(o,i.nest(e))})}}}}}}}),montageDefine("51f539f","algebra",{dependencies:[],factory:function(e,t,n){function r(e,t){return r.semantics.solve(e,t)}n.exports=r,r.semantics={solve:function(e,t){for(;;){for(;this.simplifiers.hasOwnProperty(e.type);){var n=this.simplifiers[e.type](e);if(!n)break;e=n}if(!this.solvers.hasOwnProperty(e.type))break;t=this.solvers[e.type](e,t),e=e.args[0]}return[e,t]},simplifiers:{not:function(e){var t=e.args[0];return"not"===t.type?t.args[0]:void 0},add:function(e){var t=e.args[0];return"literal"===t.type&&""===t.value?{type:"toString",args:[e.args[1]]}:void 0},someBlock:function(e){return{type:"not",args:[{type:"everyBlock",args:[e.args[0],{type:"not",args:[e.args[1]]}]}]}}},solvers:{reflect:function(e,t){return{type:e.type,args:[t]}},invert:function(e,t,n){return{type:n,args:[t,e.args[1]]}},toNumber:function(e,t){return this.reflect(e,t)},toString:function(e,t){return this.reflect(e,t)},not:function(e,t){return this.reflect(e,t)},neg:function(e,t){return this.reflect(e,t)},add:function(e,t){return this.invert(e,t,"sub")},sub:function(e,t){return this.invert(e,t,"add")},mul:function(e,t){return this.invert(e,t,"div")},div:function(e,t){return this.invert(e,t,"mul")},pow:function(e,t){return this.invert(e,t,"root")},root:function(e,t){return this.invert(e,t,"pow")},join:function(e,t){return this.invert(e,t,"split")},split:function(e,t){return this.invert(e,t,"join")}}}}}),montageDefine("51f539f","compile-binder",{dependencies:["./compile-observer","./observers","./binders","./algebra"],factory:function(e,t,n){function r(e){return r.semantics.compile(e)}var i=e("./compile-observer");e("./observers");var a=e("./binders"),o=e("./algebra"),s={type:"value"},l={type:"literal",value:!0};n.exports=r,r.semantics={compilers:{property:a.makePropertyBinder,get:a.makeGetBinder,has:a.makeHasBinder,only:a.makeOnlyBinder,rangeContent:a.makeRangeContentBinder,mapContent:a.makeMapContentBinder,reversed:a.makeReversedBinder,and:a.makeAndBinder,or:a.makeOrBinder},compile:function(e){var t=this.compilers;
if("default"===e.type)return this.compile(e.args[0]);if("literal"===e.type){if(null==e.value)return Function.noop;throw Error("Can't bind to literal: "+e.value)}if("equals"===e.type){var n=this.compile(e.args[0]),r=i(e.args[1]);return a.makeEqualityBinder(n,r)}if("if"===e.type){var c=i(e.args[0]),u=this.compile(e.args[1]),h=this.compile(e.args[2]);return a.makeConditionalBinder(c,u,h)}if("and"===e.type||"or"===e.type){var d=o(e.args[0],s),p=o(e.args[1],s),n=this.compile(d[0]),f=this.compile(p[0]),m=i(d[1]),g=i(p[1]),v=i(e.args[0]),r=i(e.args[1]);return this.compilers[e.type](n,f,v,r,m,g)}if("everyBlock"===e.type){var b=i(e.args[0]),y=o(e.args[1],l),_=this.compile(y[0]),w=i(y[1]);return a.makeEveryBlockBinder(b,_,w)}if("rangeContent"===e.type){var C,x=i(e.args[0]);try{C=this.compile(e.args[0])}catch(L){C=Function.noop}return a.makeRangeContentBinder(x,C)}if("defined"===e.type){var C=this.compile(e.args[0]);return a.makeDefinedBinder(C)}if("parent"===e.type){var C=this.compile(e.args[0]);return a.makeParentBinder(C)}if("with"===e.type){var x=i(e.args[0]),C=this.compile(e.args[1]);return a.makeWithBinder(x,C)}if(t.hasOwnProperty(e.type)){var M=e.args.map(i,i.semantics);return t[e.type].apply(null,M)}throw Error("Can't compile binder for "+JSON.stringify(e.type))}}}}),montageDefine("51f539f","operators",{dependencies:["collections/shim-object","collections/shim-regexp","collections/map","collections/set"],factory:function(e,t){e("collections/shim-object"),e("collections/shim-regexp");var n=e("collections/map"),r=e("collections/set");t.toNumber=function(e){return+e},t.toString=function(e){return null==e?e:"string"==typeof e||"number"==typeof e?""+e:null},t.toArray=Array.from,t.toMap=n,t.toSet=r,t.not=function(e){return!e},t.neg=function(e){return-e},t.pow=function(e,t){return Math.pow(e,t)},t.root=function(e,t){return Math.pow(e,1/t)},t.log=function(e,t){return Math.log(e)/Math.log(t)},t.mul=function(e,t){return e*t},t.div=function(e,t){return e/t},t.mod=function(e,t){return(e%t+t)%t},t.rem=function(e,t){return e%t},t.add=function(e,t){return e+t},t.sub=function(e,t){return e-t},t.lt=function(e,t){return 0>Object.compare(e,t)},t.gt=function(e,t){return Object.compare(e,t)>0},t.le=function(e,t){return 0>=Object.compare(e,t)},t.ge=function(e,t){return Object.compare(e,t)>=0},t.equals=Object.equals,t.compare=Object.compare,t.and=function(e,t){return e&&t},t.or=function(e,t){return e||t},t.defined=function(e){return null!=e},t.startsWith=function(e,t){var n=RegExp("^"+RegExp.escape(t));return n.test(e)},t.endsWith=function(e,t){var n=RegExp(RegExp.escape(t)+"$");return n.test(e)},t.contains=function(e,t){var n=RegExp(RegExp.escape(t));return n.test(e)},t.join=function(e,t){return e.join(t||"")},t.split=function(e,t){return e.split(t||"")},t.range=function(e){for(var t=[],n=0;e>n;n++)t.push(n);return t},t.last=function(e){return e.get(e.length-1)}}}),montageDefine("51f539f","merge",{dependencies:["collections/shim"],factory:function(e,t){"use strict";function n(e,t){for(var n,r=(t.length+1)*(e.length+1),i=Array(r),a=Array(t.length+1),o=Array(t.length+1),s=0;e.length+1>s;s++){for(var l=0;t.length+1>l;l++){var c,u;if(0===s&&0===l)c=" ",u=0;else if(0===s)c="insert",u=l;else if(0===l)c="delete",u=s;else if(e[s-1]===t[l-1])c="retain",u=o[l-1];else{var h=a[l-1],d=o[l];h>d?(c="delete",u=d+1):(c="insert",u=h+1)}i[s+l*(e.length+1)]=c,a[l]=u}n=a,a=o,o=n}return{edges:i,cost:o[t.length],source:t,target:e}}function r(e){for(var t,n,r=[],i=e.edges,a=t=e.target.length,o=e.source.length;t||o;){var s=i[t+o*(a+1)];if("delete"===s){if(n&&"delete"===n[0])n[1]++;else{var l=["delete",1];n=l,r.push(l)}t--}else if("insert"===s){if(n&&"insert"===n[0])n[1]++;else{var l=["insert",1];n=l,r.push(l)}o--}else if("retain"===s){var l=["retain",1];n&&"retain"===n[0]?n[1]++:(n=l,r.push(l)),t--,o--}}return r.reverse(),r}function i(e,t){return r(n(e,t))}function a(e,t){for(var n=i(e,t),r=[],a=0,o=0,s=0;n.length>s;){var l=n[s++];if("insert"===l[0])r.push([o,0,t.slice(o,o+l[1])]),o+=l[1];else if("delete"===l[0])if(n.length>s&&"insert"===n[s][0]){var c=n[s++];r.push([o,l[1],t.slice(o,o+c[1])]),a+=l[1],o+=c[1]}else r.push([o,l[1]]),a+=l[1];else"retain"==l[0]&&(a+=l[1],o+=l[1])}return r}function o(e,t){for(var n=0;t.length>n;n++)e.swap.apply(e,t[n])}function s(e,t){o(e,a(e,t))}e("collections/shim"),t.graphOt=n,t.traceOt=r,t.ot=i,t.diff=a,t.apply=o,t.merge=s}}),montageDefine("51f539f","language",{dependencies:["collections/set","collections/dict"],factory:function(e,t){var n=e("collections/set"),r=e("collections/dict"),i=t.precedence=r(),a=t.precedenceLevels=[["tuple","record"],["literal","value","parameters","property","element","component","mapBlock","filterBlock","sortedBlock","groupBlock","groupMapBlock","with"],["not","neg","number","parent"],["scope"],["default"],["pow","root","log"],["mul","div","mod","rem"],["add","sub"],["equals","lt","gt","le","ge","compare"],["and"],["or"],["if"]];a.forEach(function(e){var t=n(i.keys());e.forEach(function(e){i.set(e,t)})});var o=t.operatorTokens=r({"**":"pow","//":"root","%%":"log","*":"mul","/":"div","%":"mod",rem:"rem","+":"add","-":"sub","<":"lt",">":"gt","<=":"le",">=":"ge","==":"equals","<=>":"compare","!=":"notEquals","??":"default","&&":"and","||":"or","?":"then",":":"else"});t.operatorTypes=r(o.map(function(e,t){return[e,t]}))}}),montageDefine("51f539f","compute",{dependencies:["./parse","./compile-observer","./compile-binder","./observers","./scope"],factory:function(e,t,n){function r(e,t,n){n.target=e,n.targetPath=t;var r=n.source=n.source||e,c=n.args,u=n.compute,h=n.parameters=n.parameters||r,d=n.document,p=n.components,f=n.trace,m=n.sourceScope=new l(r);m.parameters=h,m.document=d,m.components=p;var g=n.targetScope=new l(e);g.parameters=h,g.document=d,g.components=p;var v=c.map(function(e){return i(e)}).map(function(e){if("rangeContent"===e.type){var t=a(e.args[0]);return s.makeRangeContentObserver(t)}if("mapContent"===e.type){var t=a(e.args[0]);return s.makeMapContentObserver(t)}return a(e)}),b=s.makeRangeContentObserver(s.makeObserversObserver(v)),y=s.makeComputerObserver(b,u,e),_=i(t),w=o(_);return w(y,m,g,n,f?{sourcePath:c.join(", "),targetPath:t}:void 0)}var i=e("./parse"),a=e("./compile-observer"),o=e("./compile-binder"),s=e("./observers"),l=e("./scope");n.exports=r}}),montageDefine("51f539f","binders",{dependencies:["./scope","./observers"],factory:function(e,t){function n(){return Error("").stack.replace(/^.*\n.*\n/,"\n")}function r(e,t,r,i,a,o){return r(x(function(r){if(!a.isActive)try{a.isActive=!0,o&&console.log("SET",o.targetPath,"TO",r,"ON",e,"BECAUSE",o.sourcePath,n()),Array.isArray(e)&&t>>>0===t?e.set(t,r):e[t]=r}finally{a.isActive=!1}}),i)}function i(e,t){return function(n,r,i,a,o){return t(x(function(t){return null!=t?e(x(function(e){return null!=e?e.bindProperty?e.bindProperty(t,n,r,a,o):P(e,t,n,r,a,o):void 0}),i):void 0}),i)}}function a(e,t,r,i,a,o){return r(x(function(r){if(!a.isActive)try{a.isActive=!0,o&&console.log("SET FOR KEY",t,"TO",r,"ON",e,"BECAUSE",o.sourcePath,n()),e.set(t,r)}finally{a.isActive=!1}}),i)}function o(e,t){return function(n,r,i,a,o){return e(x(function(e){return e?t(x(function(t){return null!=t?D(e,t,n,r,a,o):void 0}),i):void 0}),i)}}function s(e,t){return function(r,i,a,o,s){return e(x(function(e){return e?t(x(function(t){return null!=t?r(x(function(r){if(r)(e.has||e.contains).call(e,t)||(s&&console.log("ADD",t,"TO",s.targetPath,"BECAUSE",s.sourcePath,n()),e.add(t));else for(;(e.has||e.contains).call(e,t);)s&&console.log("REMOVE",t,"FROM",s.targetPath,"BECAUSE",s.sourcePath,n()),(e.remove||e["delete"]).call(e,t)}),i):void 0}),a):void 0}),a)}}function l(e,t){return function(r,i,a,o,s){return r(x(function(r){return r?(s&&console.log("BIND",s.targetPath,"TO",s.sourcePath,n()),e(t,i,i,o,s),function(){s&&console.log("UNBIND",s.targetPath,"FROM",s.sourcePath,n())}):void 0}),a)}}function c(e,t,n){return function(r,i,a,o,s){return r(x(function(r){return r?e(x(function(e){function r(e,r,l){i.swap(l,r.length,e.map(function(e){var r=a.nest(e);return t(n,r,r,o,s)}))}if(e){var i=[],l=M(e,r,a);return function(){E(i),l()}}}),a):void 0}),i)}}function u(e,t,n,r,i,a){var o=S(r),s=k(n,o);return function(n,r,o,l,c){return n(x(function(n){if(null!=n){if(n){var r=e(i,z,o,l,c),u=t(a,z,o,l,c);return function(){r(),u()}}return e(s,o,o,l,c)}}),r)}}function h(e,t,n,r,i,a){var o=S(r),s=O(n,o);return function(n,r,o,l,c){return n(x(function(n){if(null!=n){if(n)return e(s,o,o,l,c);var r=e(i,j,o,l,c),u=t(a,j,o,l,c);return function(){r(),u()}}}),r)}}function d(e,t,n){return function(r,i,a,o,s){return e(x(function(e){return null!=e?e?t(r,i,a,o,s):n(r,i,a,o,s):void 0}),i)}}function p(e){return function(t,n,r){return e(x(function(e){return e?t(x(function(t){null!=t&&(e.splice?e.splice(0,e.length,t):e.clear&&e.add&&(e.clear(),e.add(t)))}),n):void 0}),r)}}function f(e,t){return function(r,i,a,o,s){return e(x(function(e){return e?r(x(function(t){function r(t,r,i){_(e)||(s&&console.log("SWAPPING",r,"FOR",t,"AT",i,"ON",s.targetPath,n()),e.swap?e.swap(i,r.length,t):e.add&&(e.remove||e["delete"])&&(t.forEach(e.add,e),r.forEach(e.remove||e["delete"],e)))}if(t!==e){if(!t)return e.clear(),void 0;if(t.addRangeChangeListener)return t.addRangeChangeListener(r),r(Array.from(t),Array.from(e),0),L(function(){t.removeRangeChangeListener(r)})}}),i):t(C.makeLiteralObserver([]),i,a,o,s)}),a)}}function m(e){return function(t,r,i,a,o){return e(x(function(e){return e?t(x(function(t){function r(t,r){if(!a.isActive)try{a.isActive=!0,void 0===t?(o&&o&&console.log("DELETED",o.targetPath,"FOR KEY",r,"ON",e,"BECAUSE",o.sourcePath,n()),Array.isArray(e)?e.splice(r,1):e["delete"](r)):(o&&o&&console.log("SET",o.targetPath,"FOR KEY",r,"TO",t,"ON",e,"BECAUSE",o.sourcePath,n()),e.set(r,t))}finally{a.isActive=!1}}return t?(e.clear(),t.forEach(r),t.addMapChangeListener(r)):(e.clear(),void 0)}),r):void 0}),i)}}function g(e){return function(t,n,r){return e(x(function(e){return e?t(x(function(t){function n(t,n,r){if(!_(e)){var i=e.length-r-n.length;e.swap(i,n.length,t.reversed())}}return t?(t.addRangeChangeListener(n),n(t,e,0),L(function(){t.removeRangeChangeListener(n)})):(e.clear(),void 0)}),n):void 0}),r)}}function v(e){return function(t,n,r,i,a){return t(x(function(t){return t?Function.noop:e(T,n,r,i,a)}),r)}}function b(e){return function(t,n,r,i,a){return r.parent?e(t,n,r.parent,i,a):void 0}}function y(e,t){return function(n,r,i,a,o){return e(x(function(e){return null!=e?t(n,r,i.nest(e),a,o):void 0}),i)}}function _(e){return e.getRangeChangeDescriptor&&e.getRangeChangeDescriptor().isActive}var w=e("./scope"),C=e("./observers"),x=C.autoCancelPrevious,L=C.once,M=C.observeRangeChange,E=C.cancelEach,S=C.makeNotObserver,O=C.makeOrObserver,k=C.makeAndObserver;C.observeValue;var T=C.makeLiteralObserver(),z=new w(!0),j=new w(!1);t.bindProperty=r;var P=r;t.makePropertyBinder=i,t.bindGet=a;var D=a;t.makeGetBinder=o,t.makeHasBinder=s,t.makeEqualityBinder=l,t.makeEveryBlockBinder=c,t.makeAndBinder=u,t.makeOrBinder=h,t.makeConditionalBinder=d,t.makeOnlyBinder=p,t.makeRangeContentBinder=f,t.makeMapContentBinder=m,t.makeReversedBinder=g,t.makeDefinedBinder=v,t.makeParentBinder=b,t.makeWithBinder=y}});